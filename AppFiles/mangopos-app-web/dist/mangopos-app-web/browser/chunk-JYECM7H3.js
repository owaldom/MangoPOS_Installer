import{a as pe}from"./chunk-HYURECNX.js";import"./chunk-2UF7BHSI.js";import{a as se}from"./chunk-BK63NQ7D.js";import{c as F}from"./chunk-6OXQWIOV.js";import{a as ce}from"./chunk-RFRKPPY3.js";import{a as oe,e as re,h as le}from"./chunk-Z6YHTX75.js";import{a as W}from"./chunk-26KDQVR5.js";import{a as ae}from"./chunk-DGQM6DPS.js";import{b as ee,c as te}from"./chunk-APXOZHQA.js";import"./chunk-YCMZOG5D.js";import{a as q,b as J,c as U,e as Y,f as $,h as G}from"./chunk-ZWM7H6SC.js";import{b as K,e as Q,i as X,j as Z}from"./chunk-EWTXOCXT.js";import{b as j,f as L,j as z,x as H}from"./chunk-AVLO2MYP.js";import{a as ie,b as ne}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{I as D,K as N}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as B,l as k,r as V,v as R}from"./chunk-ZD4QWOHN.js";import{$ as d,Fb as c,Gb as n,Hb as a,Mb as I,Nb as w,Pb as _,Ub as h,Wa as o,Wb as p,ea as g,fa as u,gc as x,ic as r,jb as O,jc as E,kc as C,lc as P,nc as v,oc as b,pb as f,pc as M,vc as T,xc as A}from"./chunk-WSMHJDAT.js";import{a as S,b as y}from"./chunk-C6Q5SG76.js";function me(i,s){i&1&&(n(0,"mat-card-header")(1,"mat-card-title"),r(2,"Apertura de Caja"),a()())}function de(i,s){i&1&&(n(0,"h2",12),r(1,"Apertura de Caja"),a())}function ge(i,s){i&1&&(n(0,"div",13)(1,"mat-icon",14),r(2,"check_circle"),a(),n(3,"p"),r(4,"Ya existe una sesi\xF3n de caja abierta en este equipo."),a()())}function ue(i,s){if(i&1){let t=_();n(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),r(3,"Fondo Inicial (Bs.)"),a(),n(4,"input",17),M("ngModelChange",function(e){g(t);let m=p();return b(m.initialBalance,e)||(m.initialBalance=e),u(e)}),a(),n(5,"span",18),r(6,"Bs. \xA0"),a()(),n(7,"mat-form-field",16)(8,"mat-label"),r(9,"Fondo Inicial ($ USD)"),a(),n(10,"input",17),M("ngModelChange",function(e){g(t);let m=p();return b(m.initialBalanceAlt,e)||(m.initialBalanceAlt=e),u(e)}),a(),n(11,"span",18),r(12,"$ \xA0"),a()()()}if(i&2){let t=p();o(4),v("ngModel",t.initialBalance),o(6),v("ngModel",t.initialBalanceAlt)}}function fe(i,s){if(i&1){let t=_();n(0,"mat-form-field",16)(1,"mat-label"),r(2),a(),n(3,"input",24),M("ngModelChange",function(e){g(t);let m=p().$implicit;return b(m.exchange_rate,e)||(m.exchange_rate=e),u(e)}),a(),n(4,"span",18),r(5),a()()}if(i&2){let t=p().$implicit;o(2),P("Tasa ",t.name," (",t.symbol,")"),o(),v("ngModel",t.exchange_rate),o(2),C("",t.symbol," \xA0")}}function _e(i,s){if(i&1&&(I(0),f(1,fe,6,4,"mat-form-field",23),w()),i&2){let t=s.$implicit;o(),c("ngIf",!t.is_base)}}function he(i,s){if(i&1&&(n(0,"div",19)(1,"p",20),r(2,"Actualizar Tasas de Cambio"),a(),n(3,"div",21),f(4,_e,2,1,"ng-container",22),a()()),i&2){let t=p();o(4),c("ngForOf",t.currencies)}}function Ce(i,s){i&1&&(n(0,"p",25),r(1,"Al abrir la caja, podr\xE1s comenzar a registrar ventas."),a())}function xe(i,s){if(i&1){let t=_();n(0,"button",26),h("click",function(){g(t);let e=p();return u(e.onCancel())}),r(1),a()}if(i&2){let t=p();o(),C(" ",t.cashService.isOpened()?"VOLVER":"CANCELAR"," ")}}function ve(i,s){if(i&1){let t=_();n(0,"button",27),h("click",function(){g(t);let e=p();return u(e.printOpening())}),n(1,"mat-icon"),r(2,"print"),a(),r(3," RE-IMPRIMIR "),a()}}function be(i,s){if(i&1){let t=_();n(0,"button",28),h("click",function(){g(t);let e=p();return u(e.goToPos())}),r(1," IR AL PUNTO DE VENTA "),a()}}var Ye=(()=>{class i{cashService=d(se);settingsService=d(ae);printService=d(pe);dialogRef=d(oe,{optional:!0});snackBar=d(W);router=d(F);initialBalance=0;initialBalanceAlt=0;currencies=[];today=new Date;loading=!1;isPage=!1;constructor(){this.isPage=!this.dialogRef}ngOnInit(){this.loadCurrencies()}loadCurrencies(){this.settingsService.getCurrencies().subscribe({next:t=>{this.currencies=t},error:t=>console.error("Error loading currencies",t)})}onCancel(){this.dialogRef?this.dialogRef.close(!1):this.router.navigate(["/dashboard"])}async onConfirm(){this.loading=!0;try{for(let l of this.currencies)l.is_base||await this.settingsService.updateCurrency(l.id,y(S({},l),{exchange_rate:Number(l.exchange_rate)}));let t=await this.cashService.openCash({initial_balance:Number(this.initialBalance),initial_balance_alt:Number(this.initialBalanceAlt)});this.snackBar.open("Caja abierta exitosamente","Cerrar",{duration:3e3}),await this.printService.printCashOpening(t),this.dialogRef?this.dialogRef.close(!0):this.router.navigate(["/dashboard/ventas/pos"])}catch{this.snackBar.open("Error al abrir la caja","Cerrar",{duration:5e3})}finally{this.loading=!1}}printOpening(){this.cashService.currentSession$&&this.cashService.currentSession$.subscribe(t=>{t&&this.printService.printCashOpening(t)}).unsubscribe()}goToPos(){this.router.navigate(["/dashboard/ventas/pos"])}static \u0275fac=function(l){return new(l||i)};static \u0275cmp=O({type:i,selectors:[["app-cash-opening"]],decls:23,vars:22,consts:[[4,"ngIf"],["mat-dialog-title","",4,"ngIf"],[1,"opening-info"],["class","status-box",4,"ngIf"],["class","balance-inputs",4,"ngIf"],["class","rates-section",4,"ngIf"],["class","hint",4,"ngIf"],["align","end"],["mat-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-dialog-title",""],[1,"status-box"],["color","primary"],[1,"balance-inputs"],["appearance","outline",1,"half-width"],["matInput","","type","text","placeholder","0.00","appMoneyInput","","decimalType","total",3,"ngModelChange","ngModel"],["matPrefix",""],[1,"rates-section"],[1,"section-title"],[1,"rates-inputs"],[4,"ngFor","ngForOf"],["appearance","outline","class","half-width",4,"ngIf"],["matInput","","type","text","placeholder","0.00","appMoneyInput","","decimalType","price",3,"ngModelChange","ngModel"],[1,"hint"],["mat-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(l,e){l&1&&(n(0,"div")(1,"mat-card"),f(2,me,3,0,"mat-card-header",0)(3,de,2,0,"h2",1),n(4,"mat-card-content")(5,"div",2)(6,"p"),r(7,"Equipo: "),n(8,"strong"),r(9),a()(),n(10,"p"),r(11),T(12,"date"),a()(),f(13,ge,5,0,"div",3)(14,ue,13,2,"div",4)(15,he,5,1,"div",5)(16,Ce,2,0,"p",6),a(),n(17,"mat-card-actions",7),f(18,xe,2,1,"button",8)(19,ve,4,0,"button",9),n(20,"button",10),h("click",function(){return e.onConfirm()}),r(21),a(),f(22,be,2,0,"button",11),a()()()),l&2&&(x("page-container",e.isPage),o(),x("opening-card",e.isPage),o(),c("ngIf",e.isPage),o(),c("ngIf",!e.isPage),o(),x("dialog-content",!e.isPage),o(5),E(e.cashService.hostName),o(2),C("Fecha: ",A(12,19,e.today,"dd/MM/yyyy HH:mm")),o(2),c("ngIf",e.cashService.isOpened()),o(),c("ngIf",!e.cashService.isOpened()),o(),c("ngIf",!e.cashService.isOpened()&&e.currencies.length>0),o(),c("ngIf",!e.cashService.isOpened()),o(2),c("ngIf",!e.cashService.isOpened()||!e.isPage),o(),c("ngIf",e.cashService.isOpened()),o(),c("disabled",e.loading||e.cashService.isOpened()),o(),C(" ",e.loading?"ABRIENDO...":e.cashService.isOpened()?"CAJA YA ABIERTA":"ABRIR CAJA"," "),o(),c("ngIf",e.cashService.isOpened()&&e.isPage))},dependencies:[R,B,k,H,j,L,z,le,re,Z,X,K,Q,te,ee,N,D,ne,ie,G,q,Y,U,$,J,ce,V],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-top:10px}.balance-inputs[_ngcontent-%COMP%]{display:flex;gap:15px;margin-top:10px}.half-width[_ngcontent-%COMP%]{flex:1}.opening-info[_ngcontent-%COMP%]{margin-bottom:20px;color:#666}.hint[_ngcontent-%COMP%]{font-size:.9rem;color:#888;font-style:italic}.page-container[_ngcontent-%COMP%]{padding:40px;display:flex;justify-content:center;align-items:flex-start;min-height:80vh}.opening-card[_ngcontent-%COMP%]{width:100%;max-width:500px}.dialog-content[_ngcontent-%COMP%]{padding:0 24px}.status-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:20px;background:#e8f5e9;border-radius:8px;margin-bottom:20px}.status-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#2e7d32;font-weight:500}.rates-section[_ngcontent-%COMP%]{margin-top:20px;border-top:1px solid #eee;padding-top:15px}.section-title[_ngcontent-%COMP%]{font-weight:500;color:#555;margin-bottom:10px;font-size:.9rem;text-transform:uppercase;letter-spacing:.5px}.rates-inputs[_ngcontent-%COMP%]{display:flex;gap:15px;flex-wrap:wrap}"]})}return i})();export{Ye as CashOpeningComponent};
