import{a as R}from"./chunk-4LX67P6M.js";import{a as U}from"./chunk-6OXQWIOV.js";import{a as Nt,b as At}from"./chunk-XEWEKXFC.js";import{a as It,b as Dt,c as Ot,e as Tt,f as Ft,g as Rt,h as F}from"./chunk-Z6YHTX75.js";import{a as Y,b as Z}from"./chunk-26KDQVR5.js";import{a as ht}from"./chunk-SCPRHZYR.js";import"./chunk-EQXJNMRX.js";import{b as ut,c as ft}from"./chunk-APXOZHQA.js";import{a as Mt,b as xt,c as bt,d as vt,e as St,f as Pt,g as yt,h as Kt,i as Et,j as kt,l as wt}from"./chunk-VJGP4MMT.js";import{a as O,b as T}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as ct,c as pt,h as st}from"./chunk-ZWM7H6SC.js";import{a as Ct}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as S}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as w,i as I,j as D}from"./chunk-EWTXOCXT.js";import{b as tt,d as K,f as E,g as et,j as it,k as nt,l as ot,n as at,o as rt,t as mt,w as lt,x as dt,y as k}from"./chunk-AVLO2MYP.js";import{a as _t,b as gt}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as X,I as P,K as y}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as b,l as Q,v}from"./chunk-ZD4QWOHN.js";import{$ as p,Fb as d,Gb as n,Hb as i,Ib as u,Mb as _,Nb as g,Pb as j,Ub as f,Wa as m,Wb as M,db as L,ea as A,fa as B,gc as $,ic as o,jb as h,jc as H,kc as C,lc as x,nc as z,oc as W,pb as c,pc as J}from"./chunk-WSMHJDAT.js";import{a as G,b as q}from"./chunk-C6Q5SG76.js";function jt(e,l){if(e&1&&(n(0,"mat-option",17),o(1),i()),e&2){let t=l.$implicit;d("value",t.id),m(),x(" ",t.name," (",t.reference,") ")}}var V=(()=>{class e{data;form;eligibleProducts=[];fb=p(lt);kitService=p(R);dialogRef=p(It);constructor(t){this.data=t,this.form=this.fb.group({component_id:[null,K.required],quantity:[1,[K.required,K.min(1e-4)]],group_id:[null],group_name:[""],is_mandatory:[!0]})}ngOnInit(){this.kitService.getEligibleComponents().subscribe(t=>{this.eligibleProducts=t,this.data.component&&this.form.patchValue(this.data.component)})}onSubmit(){if(this.form.valid){let t=this.form.getRawValue(),r=this.eligibleProducts.find(a=>a.id===t.component_id);this.dialogRef.close(q(G({},t),{component_name:r?.name,component_reference:r?.reference}))}}static \u0275fac=function(r){return new(r||e)(L(Dt))};static \u0275cmp=h({type:e,selectors:[["app-product-kit-dialog"]],decls:37,vars:5,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-container"],["appearance","outline",1,"full-width"],["formControlName","component_id",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"row"],["appearance","outline",1,"half-width"],["matInput","","type","number","formControlName","quantity","min","0.0001"],[1,"half-width","checkbox-container"],["formControlName","is_mandatory"],[1,"group-header"],["matInput","","type","number","formControlName","group_id","placeholder","Ej: 1"],["matInput","","formControlName","group_name","placeholder","Ej: Bebidas"],["align","end"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(r,a){r&1&&(n(0,"h2",0),o(1),i(),n(2,"form",1),f("ngSubmit",function(){return a.onSubmit()}),n(3,"mat-dialog-content")(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),o(7,"Producto Componente"),i(),n(8,"mat-select",4),c(9,jt,2,3,"mat-option",5),i()(),n(10,"div",6)(11,"mat-form-field",7)(12,"mat-label"),o(13,"Cantidad"),i(),u(14,"input",8),i(),n(15,"div",9)(16,"mat-checkbox",10),o(17,"Obligatorio"),i()()(),n(18,"div",11)(19,"span"),o(20,"Flexibilidad (Opcional)"),i(),n(21,"small"),o(22,"Componentes en el mismo grupo son alternativas entre s\xED."),i()(),n(23,"div",6)(24,"mat-form-field",7)(25,"mat-label"),o(26,"ID de Grupo (N\xFAmero)"),i(),u(27,"input",12),i(),n(28,"mat-form-field",7)(29,"mat-label"),o(30,"Nombre del Grupo"),i(),u(31,"input",13),i()()()(),n(32,"mat-dialog-actions",14)(33,"button",15),f("click",function(){return a.dialogRef.close()}),o(34,"Cancelar"),i(),n(35,"button",16),o(36,"Confirmar"),i()()()),r&2&&(m(),C("",a.data.component?"Editar":"Agregar"," Componente"),m(),d("formGroup",a.form),m(6),d("disabled",!!a.data.component),m(),d("ngForOf",a.eligibleProducts),m(26),d("disabled",a.form.invalid))},dependencies:[v,b,k,nt,tt,ot,E,et,mt,rt,at,F,Tt,Rt,Ft,D,I,w,ft,ut,T,O,S,y,P,At,Nt],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding-top:10px}.full-width[_ngcontent-%COMP%]{width:100%}.row[_ngcontent-%COMP%]{display:flex;gap:16px}.half-width[_ngcontent-%COMP%]{width:50%}.checkbox-container[_ngcontent-%COMP%]{display:flex;align-items:center}.group-header[_ngcontent-%COMP%]{margin-top:16px;padding:8px;background:#f5f5f5;border-radius:4px;display:flex;flex-direction:column}.group-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;font-size:13px}.group-header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#666;font-size:11px}"]})}return e})();function $t(e,l){if(e&1&&(n(0,"mat-option",9),o(1),i()),e&2){let t=l.$implicit;d("value",t.id),m(),x(" ",t.name," (",t.reference,") ")}}function zt(e,l){e&1&&(n(0,"th",22),o(1," Grupo / Categor\xEDa "),i())}function Wt(e,l){if(e&1&&(n(0,"td",23)(1,"span",24),o(2),i()()),e&2){let t=l.$implicit;m(),$("flexible",t.group_id),m(),C(" ",t.group_name||"Fijo (General)"," ")}}function Jt(e,l){e&1&&(n(0,"th",22),o(1," Producto Componente "),i())}function Qt(e,l){if(e&1&&(n(0,"td",23)(1,"strong"),o(2),i(),u(3,"br"),n(4,"small",25),o(5),i()()),e&2){let t=l.$implicit;m(2),H(t.component_name),m(3),H(t.component_reference)}}function Ut(e,l){e&1&&(n(0,"th",22),o(1," Cantidad "),i())}function Xt(e,l){if(e&1&&(n(0,"td",23),o(1),i()),e&2){let t=l.$implicit;m(),C(" ",t.quantity," ")}}function Yt(e,l){e&1&&(n(0,"th",22),o(1," Obligatorio "),i())}function Zt(e,l){if(e&1&&(n(0,"td",23)(1,"mat-icon",26),o(2),i()()),e&2){let t=l.$implicit;m(),d("color",t.is_mandatory?"primary":"warn"),m(),C(" ",t.is_mandatory?"check_circle":"cancel"," ")}}function te(e,l){e&1&&(n(0,"th",22),o(1," Acciones "),i())}function ee(e,l){if(e&1){let t=j();n(0,"td",23)(1,"button",27),f("click",function(){let a=A(t).$implicit,s=M(2);return B(s.editComponent(a))}),n(2,"mat-icon"),o(3,"edit"),i()(),n(4,"button",28),f("click",function(){let a=A(t).$implicit,s=M(2);return B(s.removeComponent(a))}),n(5,"mat-icon"),o(6,"delete"),i()()()}}function ie(e,l){e&1&&u(0,"tr",29)}function ne(e,l){e&1&&u(0,"tr",30)}function oe(e,l){e&1&&(n(0,"div",31)(1,"mat-icon"),o(2,"inventory_2"),i(),n(3,"p"),o(4,"Este kit no tiene componentes configurados a\xFAn."),i()())}function ae(e,l){if(e&1&&(n(0,"div",10)(1,"mat-card")(2,"table",11),_(3,12),c(4,zt,2,0,"th",13)(5,Wt,3,3,"td",14),g(),_(6,15),c(7,Jt,2,0,"th",13)(8,Qt,6,2,"td",14),g(),_(9,16),c(10,Ut,2,0,"th",13)(11,Xt,2,1,"td",14),g(),_(12,17),c(13,Yt,2,0,"th",13)(14,Zt,3,2,"td",14),g(),_(15,18),c(16,te,2,0,"th",13)(17,ee,7,0,"td",14),g(),c(18,ie,1,0,"tr",19)(19,ne,1,0,"tr",20),i(),c(20,oe,5,0,"div",21),i()()),e&2){let t=M();m(2),d("dataSource",t.components),m(16),d("matHeaderRowDef",t.displayedColumns),m(),d("matRowDefColumns",t.displayedColumns),m(),d("ngIf",t.components.length===0)}}var Le=(()=>{class e{kitHeaders=[];selectedKitId=null;components=[];displayedColumns=["group","component","quantity","mandatory","actions"];kitService=p(R);dialog=p(Ot);snackBar=p(Y);route=p(U);ngOnInit(){this.loadKitHeaders(),this.route.queryParams.subscribe(t=>{t.id&&(this.selectedKitId=+t.id,this.loadKitComponents())})}loadKitHeaders(){this.kitService.getKitHeaders(1,100).subscribe(t=>{this.kitHeaders=t.data})}loadKitComponents(){this.selectedKitId&&this.kitService.getKitComponents(this.selectedKitId).subscribe(t=>{this.components=t})}addComponent(){this.dialog.open(V,{width:"500px",data:{kitId:this.selectedKitId}}).afterClosed().subscribe(r=>{r&&this.saveComponentLocally(r)})}editComponent(t){this.dialog.open(V,{width:"500px",data:{kitId:this.selectedKitId,component:t}}).afterClosed().subscribe(a=>{a&&this.updateComponentLocally(t,a)})}saveComponentLocally(t){let r=this.components.findIndex(a=>a.component_id===t.component_id);r>-1?this.components[r]=t:this.components=[...this.components,t],this.persistKit()}updateComponentLocally(t,r){let a=this.components.indexOf(t);a>-1&&(this.components[a]=r,this.persistKit())}removeComponent(t){confirm(`\xBFEst\xE1s seguro de eliminar "${t.component_name}" del kit?`)&&(this.components=this.components.filter(r=>r!==t),this.persistKit())}persistKit(){this.selectedKitId&&this.kitService.saveKit(this.selectedKitId,this.components).subscribe({next:()=>{this.snackBar.open("Configuraci\xF3n del kit guardada","Cerrar",{duration:3e3}),this.loadKitComponents()},error:()=>this.snackBar.open("Error al guardar configuraci\xF3n","Cerrar",{duration:3e3})})}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=h({type:e,selectors:[["app-product-kits"]],decls:18,vars:4,consts:[[1,"container"],[1,"header"],[1,"selection-card"],[1,"row"],["appearance","outline",1,"kit-selector"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",3,"click","disabled"],["class","table-container",4,"ngIf"],[3,"value"],[1,"table-container"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","group"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","component"],["matColumnDef","quantity"],["matColumnDef","mandatory"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","empty-state",4,"ngIf"],["mat-header-cell",""],["mat-cell",""],[1,"badge"],[1,"text-muted"],[3,"color"],["mat-icon-button","","color","primary","matTooltip","Editar",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""],[1,"empty-state"]],template:function(r,a){r&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Kits de Productos (Combos)"),i()(),n(4,"div",2)(5,"mat-card")(6,"mat-card-content")(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),o(10,"Seleccionar Kit (Producto tipo KI)"),i(),n(11,"mat-select",5),J("ngModelChange",function(N){return W(a.selectedKitId,N)||(a.selectedKitId=N),N}),f("selectionChange",function(){return a.loadKitComponents()}),c(12,$t,2,3,"mat-option",6),i()(),n(13,"button",7),f("click",function(){return a.addComponent()}),n(14,"mat-icon"),o(15,"add"),i(),o(16," Agregar Componente "),i()()()()(),c(17,ae,21,4,"div",8),i()),r&2&&(m(11),z("ngModel",a.selectedKitId),m(),d("ngForOf",a.kitHeaders),m(),d("disabled",!a.selectedKitId),m(4),d("ngIf",a.selectedKitId))},dependencies:[v,b,Q,dt,E,it,k,wt,Mt,bt,yt,vt,xt,Kt,St,Pt,Et,kt,y,P,X,gt,_t,st,ct,pt,T,I,w,O,S,D,F,Z,ht,Ct],styles:[".container[_ngcontent-%COMP%]{padding:24px}.header[_ngcontent-%COMP%], .selection-card[_ngcontent-%COMP%]{margin-bottom:24px}.row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.kit-selector[_ngcontent-%COMP%]{flex:1}.full-width[_ngcontent-%COMP%]{width:100%}.badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;background:#eee}.badge.flexible[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2}.text-muted[_ngcontent-%COMP%]{color:#666;font-size:11px}.empty-state[_ngcontent-%COMP%]{padding:48px;text-align:center;color:#888}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}"]})}return e})();export{Le as ProductKitsComponent};
