import{a as xt}from"./chunk-VALAE6MC.js";import{a as Mt,b as bt,c as St}from"./chunk-G6XU55TA.js";import{a as E}from"./chunk-34EVCEMG.js";import{a as gt,b as _t,c as Ct,e as Dt,f as ht,g as vt,h as x}from"./chunk-Z6YHTX75.js";import{a as V,b as q}from"./chunk-26KDQVR5.js";import"./chunk-EQXJNMRX.js";import{b as Y,c as Z}from"./chunk-APXOZHQA.js";import{a as it,b as ot,c as nt,d as at,e as rt,f as mt,g as lt,h as ct,i as st,j as dt,l as ut}from"./chunk-VJGP4MMT.js";import{a as pt,b as ft}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import"./chunk-TEMJ73U5.js";import{d as B}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as Q,c as U,i as W,j as X}from"./chunk-EWTXOCXT.js";import{b as j,d as g,f as P,g as A,k as $,l as G,n as H,o as z,w as J,y as K}from"./chunk-AVLO2MYP.js";import{a as tt,b as et}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as O,I as b,K as S}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as L,l as N,v as M}from"./chunk-ZD4QWOHN.js";import{$ as h,Fb as c,Gb as o,Hb as i,Ib as f,Mb as C,Nb as D,Pb as R,Ub as u,Wa as r,Wb as T,db as _,ea as y,fa as F,ic as n,jb as v,kc as p,lc as k,pb as s}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function Tt(t,l){t&1&&(o(0,"mat-error"),n(1,"El nombre es requerido"),i())}function wt(t,l){t&1&&(o(0,"mat-error"),n(1,"El valor es requerido"),i())}function It(t,l){if(t&1&&(o(0,"mat-option",9),n(1),i()),t&2){let e=l.$implicit;c("value",e.id),r(),p(" ",e.name," ")}}function Rt(t,l){t&1&&(o(0,"mat-error"),n(1,"La categor\xEDa es requerida"),i())}function kt(t,l){if(t&1&&(o(0,"mat-option",9),n(1),i()),t&2){let e=l.$implicit;c("value",e.id),r(),p(" ",e.name," ")}}var Et=(()=>{class t{fb;discountService;dialogRef;data;form;categories=[];custCategories=[];constructor(e,m,a,d){this.fb=e,this.discountService=m,this.dialogRef=a,this.data=d,this.form=this.fb.group({name:["",g.required],quantity:[0,[g.required,g.min(0)]],percentage:[!0,g.required],idcategory:["",g.required],custcategory:[null]})}ngOnInit(){this.loadCategories(),this.data.discount&&this.form.patchValue(this.data.discount)}loadCategories(){this.discountService.getDiscountCategories().subscribe(e=>{if(this.categories=e,!this.form.get("idcategory")?.value&&this.categories.length>0){let m=this.categories.find(a=>a.name.toLowerCase()==="general");m?this.form.patchValue({idcategory:m.id}):this.form.patchValue({idcategory:this.categories[0].id})}}),this.discountService.getDiscountCustCategories().subscribe(e=>{this.custCategories=e})}onSubmit(){this.form.valid&&this.dialogRef.close(this.form.value)}onCancel(){this.dialogRef.close()}static \u0275fac=function(m){return new(m||t)(_(J),_(E),_(gt),_(_t))};static \u0275cmp=v({type:t,selectors:[["app-discount-form"]],decls:41,vars:11,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-container"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Ej. Descuento Verano"],[4,"ngIf"],["matInput","","type","number","formControlName","quantity"],[1,"radio-group"],["formControlName","percentage"],[3,"value"],["formControlName","idcategory"],[3,"value",4,"ngFor","ngForOf"],["formControlName","custcategory"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(m,a){if(m&1&&(o(0,"h2",0),n(1),i(),o(2,"form",1),u("ngSubmit",function(){return a.onSubmit()}),o(3,"mat-dialog-content")(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),n(7,"Nombre"),i(),f(8,"input",4),s(9,Tt,2,0,"mat-error",5),i(),o(10,"mat-form-field",3)(11,"mat-label"),n(12,"Valor"),i(),f(13,"input",6),s(14,wt,2,0,"mat-error",5),i(),o(15,"div",7)(16,"label"),n(17,"Tipo de Descuento:"),i(),o(18,"mat-radio-group",8)(19,"mat-radio-button",9),n(20,"Porcentaje (%)"),i(),o(21,"mat-radio-button",9),n(22,"Monto Fijo ($)"),i()()(),o(23,"mat-form-field",3)(24,"mat-label"),n(25,"Categor\xEDa de Producto"),i(),o(26,"mat-select",10),s(27,It,2,2,"mat-option",11),i(),s(28,Rt,2,0,"mat-error",5),i(),o(29,"mat-form-field",3)(30,"mat-label"),n(31,"Categor\xEDa de Cliente (Opcional)"),i(),o(32,"mat-select",12)(33,"mat-option",9),n(34,"-- Ninguna (General) --"),i(),s(35,kt,2,2,"mat-option",11),i()()()(),o(36,"mat-dialog-actions",13)(37,"button",14),u("click",function(){return a.onCancel()}),n(38,"Cancelar"),i(),o(39,"button",15),n(40,"Guardar"),i()()()),m&2){let d,w,I;r(),p("",a.data.discount?"Editar":"Nuevo"," Descuento"),r(),c("formGroup",a.form),r(7),c("ngIf",(d=a.form.get("name"))==null?null:d.hasError("required")),r(5),c("ngIf",(w=a.form.get("quantity"))==null?null:w.hasError("required")),r(5),c("value",!0),r(2),c("value",!1),r(6),c("ngForOf",a.categories),r(),c("ngIf",(I=a.form.get("idcategory"))==null?null:I.hasError("required")),r(5),c("value",null),r(2),c("ngForOf",a.custCategories),r(4),c("disabled",a.form.invalid)}},dependencies:[M,L,N,K,$,j,G,P,A,z,H,x,Dt,vt,ht,X,W,Q,U,Z,Y,S,b,St,Mt,bt,ft,pt,B],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-width:300px}.radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:8px}mat-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}"]})}return t})();function Lt(t,l){t&1&&(o(0,"th",12),n(1," Nombre "),i())}function Nt(t,l){if(t&1&&(o(0,"td",13),n(1),i()),t&2){let e=l.$implicit;r(),p(" ",e.name," ")}}function Bt(t,l){t&1&&(o(0,"th",12),n(1," Valor "),i())}function Ot(t,l){if(t&1&&(o(0,"td",13),n(1),i()),t&2){let e=l.$implicit;r(),k(" ",e.quantity," ",e.percentage?"%":""," ")}}function Vt(t,l){t&1&&(o(0,"th",12),n(1," Tipo "),i())}function qt(t,l){if(t&1&&(o(0,"td",13),n(1),i()),t&2){let e=l.$implicit;r(),p(" ",e.percentage?"Porcentaje":"Importe Fijo"," ")}}function jt(t,l){t&1&&(o(0,"th",12),n(1," Acciones "),i())}function Pt(t,l){if(t&1){let e=R();o(0,"td",13)(1,"button",14),u("click",function(){let a=y(e).$implicit,d=T();return F(d.openForm(a))}),o(2,"mat-icon"),n(3,"edit"),i()(),o(4,"button",15),u("click",function(){let a=y(e).$implicit,d=T();return F(d.deleteDiscount(a))}),o(5,"mat-icon"),n(6,"delete"),i()()()}}function At(t,l){t&1&&f(0,"tr",16)}function $t(t,l){t&1&&f(0,"tr",17)}var Se=(()=>{class t{discounts=[];displayedColumns=["name","value","type","actions"];discountService=h(E);dialog=h(Ct);snackBar=h(V);ngOnInit(){this.loadDiscounts()}loadDiscounts(){this.discountService.getAll().subscribe({next:e=>this.discounts=e,error:e=>console.error("Error loading discounts",e)})}openForm(e){this.dialog.open(Et,{width:"500px",data:{discount:e}}).afterClosed().subscribe(a=>{a&&(e?this.updateDiscount(e.id,a):this.createDiscount(a))})}createDiscount(e){this.discountService.create(e).subscribe({next:()=>{this.snackBar.open("Descuento creado","Cerrar",{duration:3e3}),this.loadDiscounts()},error:()=>this.snackBar.open("Error al crear descuento","Cerrar",{duration:3e3})})}updateDiscount(e,m){this.discountService.update(e,m).subscribe({next:()=>{this.snackBar.open("Descuento actualizado","Cerrar",{duration:3e3}),this.loadDiscounts()},error:()=>this.snackBar.open("Error al actualizar descuento","Cerrar",{duration:3e3})})}deleteDiscount(e){this.dialog.open(xt,{data:{title:"Confirmar eliminaci\xF3n",message:`\xBFEst\xE1 seguro de eliminar el descuento "${e.name}"?`}}).afterClosed().subscribe(a=>{a&&this.discountService.deleteDiscount(e.id).subscribe({next:()=>{this.snackBar.open("Descuento eliminado","Cerrar",{duration:3e3}),this.loadDiscounts()},error:()=>this.snackBar.open("Error al eliminar descuento","Cerrar",{duration:3e3})})})}static \u0275fac=function(m){return new(m||t)};static \u0275cmp=v({type:t,selectors:[["app-discount-list"]],decls:24,vars:3,consts:[[1,"container"],["mat-raised-button","","color","primary",3,"click"],[1,"table-container","mat-elevation-z8"],["mat-table","",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(m,a){m&1&&(o(0,"div",0)(1,"header")(2,"h1"),n(3,"Descuentos"),i(),o(4,"button",1),u("click",function(){return a.openForm()}),o(5,"mat-icon"),n(6,"add"),i(),n(7," Nuevo Descuento "),i()(),o(8,"div",2)(9,"table",3),C(10,4),s(11,Lt,2,0,"th",5)(12,Nt,2,1,"td",6),D(),C(13,7),s(14,Bt,2,0,"th",5)(15,Ot,2,2,"td",6),D(),C(16,8),s(17,Vt,2,0,"th",5)(18,qt,2,1,"td",6),D(),C(19,9),s(20,jt,2,0,"th",5)(21,Pt,7,0,"td",6),D(),s(22,At,1,0,"tr",10)(23,$t,1,0,"tr",11),i()()()),m&2&&(r(9),c("dataSource",a.discounts),r(13),c("matHeaderRowDef",a.displayedColumns),r(),c("matRowDefColumns",a.displayedColumns))},dependencies:[M,ut,it,nt,lt,at,ot,ct,rt,mt,st,dt,S,b,O,et,tt,x,q],styles:[".container[_ngcontent-%COMP%]{padding:20px}header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}"]})}return t})();export{Se as DiscountListComponent};
