import{a as Zt,b as te}from"./chunk-XEWEKXFC.js";import{a as S}from"./chunk-NN3ONOAJ.js";import{a as vt}from"./chunk-RFRKPPY3.js";import{a as ht,b as Pt,c as Qt,d as Ot,e as Y,f as K,g as W,h as E}from"./chunk-Z6YHTX75.js";import{a as I,b as F}from"./chunk-26KDQVR5.js";import{a as kt,c as xt}from"./chunk-UMEZ73TD.js";import"./chunk-DGQM6DPS.js";import{a as Xt}from"./chunk-SCPRHZYR.js";import{a as Jt,b as Yt,c as Kt,d as Wt}from"./chunk-N7P7XLP2.js";import{a as ot,b as rt}from"./chunk-N5ZCCEPE.js";import{d as $t}from"./chunk-GRESZPIF.js";import"./chunk-EQXJNMRX.js";import{b as q,c as U}from"./chunk-APXOZHQA.js";import{a as lt,b as ct,c as mt,d as st,e as dt,f as pt,g as _t,h as ft,i as gt,j as ut,l as Ct}from"./chunk-VJGP4MMT.js";import{a as bt,b as Mt}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as nt,b as Ht,c as at,f as zt,h as it}from"./chunk-ZWM7H6SC.js";import{a as Ut}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as et}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as H,c as Gt,f as qt,i as z,j as G}from"./chunk-EWTXOCXT.js";import{b as w,d as k,f as N,g as R,k as A,n as V,o as $,v as Lt,w as j,y as L}from"./chunk-AVLO2MYP.js";import{a as X,b as J}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as jt,I as v,K as y}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as tt,l as P,s as Vt,v as O}from"./chunk-ZD4QWOHN.js";import{$ as Q,Fb as m,Gb as a,Hb as n,Ib as _,Mb as g,Nb as u,Pb as Z,Ub as M,Wa as o,Wb as p,db as b,ea as D,ec as yt,fa as T,gc as B,ic as i,jb as h,jc as f,kc as C,lc as At,mc as Et,pb as s,v as Rt,vc as St,xc as Dt}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function se(e,c){e&1&&(a(0,"mat-error"),i(1," El nombre es requerido "),n())}function de(e,c){if(e&1&&(a(0,"mat-option",6),i(1),n()),e&2){let t=c.$implicit;m("value",t.id),o(),C(" ",t.name," ")}}function pe(e,c){e&1&&(a(0,"mat-error"),i(1," El n\xFAmero de cuenta debe tener exactamente 20 d\xEDgitos num\xE9ricos "),n())}function _e(e,c){if(e&1&&(a(0,"mat-option",6),i(1),n()),e&2){let t=c.$implicit;m("value",t.id),o(),C(" ",t.name," ")}}function fe(e,c){e&1&&(a(0,"mat-error"),i(1," El tipo de cuenta es requerido "),n())}function ge(e,c){if(e&1&&(a(0,"mat-option",6),i(1),n()),e&2){let t=c.$implicit;m("value",t.value),o(),C(" ",t.label," ")}}function ue(e,c){e&1&&(a(0,"mat-error"),i(1," El saldo debe ser mayor o igual a 0 "),n())}function Ce(e,c){if(e&1&&(a(0,"mat-form-field",2)(1,"mat-label"),i(2,"Saldo Inicial"),n(),_(3,"input",19),s(4,ue,2,0,"mat-error",4),n()),e&2){let t,l=p();o(4),m("ngIf",(t=l.bankForm.get("initial_balance"))==null?null:t.hasError("min"))}}function be(e,c){e&1&&(a(0,"mat-checkbox",20),i(1," Banco Activo "),n())}var wt=(()=>{class e{fb;banksService;dialogRef;snackBar;data;bankForm;mode;bank;saving=!1;bankEntities=[];accountTypes=[];currencies=[{value:"VES",label:"Bol\xEDvares (VES)"},{value:"USD",label:"D\xF3lares (USD)"}];constructor(t,l,r,d,x){this.fb=t,this.banksService=l,this.dialogRef=r,this.snackBar=d,this.data=x,this.mode=x.mode,this.bank=x.bank,this.bankForm=this.fb.group({name:["",k.required],bank_entity_id:[null],account_number:["",[k.pattern("^[0-9]{20}$")]],account_type_id:[null,k.required],currency:["VES",k.required],initial_balance:[0,[k.required,k.min(0)]],notes:[""],active:[!0],allows_pago_movil:[!1]})}ngOnInit(){this.loadInitialData()}loadInitialData(){Rt({entities:this.banksService.getBankEntities(),types:this.banksService.getBankAccountTypes()}).subscribe({next:t=>{this.bankEntities=t.entities,this.accountTypes=t.types,this.mode==="edit"&&this.bank&&(this.bankForm.patchValue(this.bank),this.bankForm.get("initial_balance")?.disable())},error:t=>{console.error("Error loading initial data:",t),this.snackBar.open("Error al cargar datos iniciales","Cerrar",{duration:3e3})}})}onSubmit(){if(this.bankForm.invalid){this.snackBar.open("Por favor complete todos los campos requeridos","Cerrar",{duration:3e3});return}this.saving=!0;let t=this.bankForm.getRawValue();this.mode==="create"?this.banksService.createBank(t).subscribe({next:()=>{this.snackBar.open("Banco creado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:l=>{console.error("Error creating bank:",l),this.snackBar.open("Error al crear banco","Cerrar",{duration:3e3}),this.saving=!1}}):this.banksService.updateBank(this.bank.id,t).subscribe({next:()=>{this.snackBar.open("Banco actualizado exitosamente","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:l=>{console.error("Error updating bank:",l),this.snackBar.open("Error al actualizar banco","Cerrar",{duration:3e3}),this.saving=!1}})}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(l){return new(l||e)(b(j),b(S),b(ht),b(I),b(Pt))};static \u0275cmp=h({type:e,selectors:[["app-bank-form-dialog"]],decls:46,vars:14,consts:[["mat-dialog-title",""],[1,"bank-form",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Ej: Cuenta Principal"],[4,"ngIf"],["formControlName","bank_entity_id"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","account_number","placeholder","Ej: 01020304050607080910","maxlength","20"],[1,"form-row"],["formControlName","account_type_id"],["formControlName","currency"],["appearance","outline",4,"ngIf"],["matInput","","formControlName","notes","rows","3","placeholder","Notas adicionales..."],["formControlName","active",4,"ngIf"],["formControlName","allows_pago_movil"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["matInput","","type","text","formControlName","initial_balance","appMoneyInput","","decimalType","total"],["formControlName","active"]],template:function(l,r){if(l&1&&(a(0,"h2",0),i(1),n(),a(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),i(6,"Nombre del Banco *"),n(),_(7,"input",3),s(8,se,2,0,"mat-error",4),n(),a(9,"mat-form-field",2)(10,"mat-label"),i(11,"Entidad Bancaria"),n(),a(12,"mat-select",5)(13,"mat-option",6),i(14,"Ninguno"),n(),s(15,de,2,2,"mat-option",7),n()(),a(16,"mat-form-field",2)(17,"mat-label"),i(18,"N\xFAmero de Cuenta"),n(),_(19,"input",8),s(20,pe,2,0,"mat-error",4),n(),a(21,"div",9)(22,"mat-form-field",2)(23,"mat-label"),i(24,"Tipo de Cuenta *"),n(),a(25,"mat-select",10),s(26,_e,2,2,"mat-option",7),n(),s(27,fe,2,0,"mat-error",4),n(),a(28,"mat-form-field",2)(29,"mat-label"),i(30,"Moneda *"),n(),a(31,"mat-select",11),s(32,ge,2,2,"mat-option",7),n()()(),s(33,Ce,5,1,"mat-form-field",12),a(34,"mat-form-field",2)(35,"mat-label"),i(36,"Notas"),n(),_(37,"textarea",13),n(),s(38,be,2,0,"mat-checkbox",14),a(39,"mat-checkbox",15),i(40," Habilitar Pago M\xF3vil para esta cuenta "),n()()(),a(41,"mat-dialog-actions",16)(42,"button",17),M("click",function(){return r.onCancel()}),i(43,"Cancelar"),n(),a(44,"button",18),M("click",function(){return r.onSubmit()}),i(45),n()()),l&2){let d,x,Nt;o(),f(r.mode==="create"?"Nuevo Banco":"Editar Banco"),o(2),m("formGroup",r.bankForm),o(5),m("ngIf",(d=r.bankForm.get("name"))==null?null:d.hasError("required")),o(5),m("value",null),o(2),m("ngForOf",r.bankEntities),o(5),m("ngIf",(x=r.bankForm.get("account_number"))==null?null:x.hasError("pattern")),o(6),m("ngForOf",r.accountTypes),o(),m("ngIf",(Nt=r.bankForm.get("account_type_id"))==null?null:Nt.hasError("required")),o(5),m("ngForOf",r.currencies),o(),m("ngIf",r.mode==="create"),o(5),m("ngIf",r.mode==="edit"),o(4),m("disabled",r.saving),o(2),m("disabled",r.saving||r.bankForm.invalid),o(),C(" ",r.saving?"Guardando...":r.mode==="create"?"Crear":"Actualizar"," ")}},dependencies:[O,tt,P,L,A,w,N,R,Lt,$,V,E,Y,W,K,G,z,H,Gt,U,q,Mt,bt,et,y,v,te,Zt,F,vt],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;padding:20px}mat-dialog-content[_ngcontent-%COMP%]   .bank-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}mat-dialog-content[_ngcontent-%COMP%]   .bank-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}mat-dialog-content[_ngcontent-%COMP%]   .bank-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-content[_ngcontent-%COMP%]   .bank-form[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-top:8px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid #e0e0e0}"]})}return e})();function Pe(e,c){e&1&&(a(0,"div",20),_(1,"mat-spinner"),n())}function Oe(e,c){e&1&&(a(0,"div",21)(1,"mat-icon"),i(2,"receipt_long"),n(),a(3,"p"),i(4,"No hay transacciones en el per\xEDodo seleccionado"),n()())}function ve(e,c){e&1&&(a(0,"th",35),i(1,"Fecha"),n())}function ye(e,c){if(e&1&&(a(0,"td",36),i(1),n()),e&2){let t=c.$implicit,l=p(2);o(),f(l.formatDate(t.transaction_date))}}function Ee(e,c){e&1&&(a(0,"th",35),i(1,"Tipo"),n())}function Se(e,c){if(e&1&&(a(0,"td",36)(1,"mat-chip"),i(2),n()()),e&2){let t=c.$implicit,l=p(2);o(),B("income",t.transaction_type==="INCOME")("expense",t.transaction_type==="EXPENSE"),o(),C(" ",l.getTransactionTypeLabel(t.transaction_type)," ")}}function De(e,c){e&1&&(a(0,"th",35),i(1,"Monto"),n())}function Te(e,c){if(e&1&&(a(0,"td",37)(1,"strong"),i(2),n()()),e&2){let t=c.$implicit,l=p(2);o(),B("income",t.transaction_type==="INCOME")("expense",t.transaction_type==="EXPENSE"),o(),C(" ",l.formatCurrency(t.amount)," ")}}function Be(e,c){e&1&&(a(0,"th",35),i(1,"Saldo Despu\xE9s"),n())}function Ie(e,c){if(e&1&&(a(0,"td",36),i(1),n()),e&2){let t=c.$implicit,l=p(2);o(),f(l.formatCurrency(t.balance_after))}}function Fe(e,c){e&1&&(a(0,"th",35),i(1,"Referencia"),n())}function we(e,c){if(e&1&&(a(0,"span"),i(1),n()),e&2){let t=p().$implicit,l=p(2);o(),f(l.getReferenceTypeLabel(t.reference_type))}}function Ne(e,c){e&1&&(a(0,"span"),i(1,"-"),n())}function Re(e,c){if(e&1&&(a(0,"td",36),s(1,we,2,1,"span",38)(2,Ne,2,0,"span",38),n()),e&2){let t=c.$implicit;o(),m("ngIf",t.reference_type),o(),m("ngIf",!t.reference_type)}}function Ae(e,c){e&1&&(a(0,"th",35),i(1,"M\xE9todo de Pago"),n())}function Ve(e,c){if(e&1&&(a(0,"td",36),i(1),n()),e&2){let t=c.$implicit,l=p(2);o(),C("",l.getPaymentMethodLabel(t.payment_method)||"-"," ")}}function $e(e,c){e&1&&(a(0,"th",35),i(1,"Descripci\xF3n"),n())}function je(e,c){if(e&1&&(a(0,"td",36),i(1),n()),e&2){let t=c.$implicit;o(),f(t.description||"-")}}function Le(e,c){e&1&&_(0,"tr",39)}function He(e,c){e&1&&_(0,"tr",40)}function ze(e,c){if(e&1&&(a(0,"table",22),g(1,23),s(2,ve,2,0,"th",24)(3,ye,2,1,"td",25),u(),g(4,26),s(5,Ee,2,0,"th",24)(6,Se,3,5,"td",25),u(),g(7,27),s(8,De,2,0,"th",24)(9,Te,3,5,"td",28),u(),g(10,29),s(11,Be,2,0,"th",24)(12,Ie,2,1,"td",25),u(),g(13,30),s(14,Fe,2,0,"th",24)(15,Re,3,2,"td",25),u(),g(16,31),s(17,Ae,2,0,"th",24)(18,Ve,2,1,"td",25),u(),g(19,32),s(20,$e,2,0,"th",24)(21,je,2,1,"td",25),u(),s(22,Le,1,0,"tr",33)(23,He,1,0,"tr",34),n()),e&2){let t=p();m("dataSource",t.transactions),o(22),m("matHeaderRowDef",t.displayedColumns),o(),m("matRowDefColumns",t.displayedColumns)}}var re=(()=>{class e{fb;banksService;data;bank;transactions=[];displayedColumns=["transaction_date","type","amount","balance_after","reference","payment_method","description"];loading=!1;filterForm;totalIncome=0;totalExpense=0;constructor(t,l,r){this.fb=t,this.banksService=l,this.data=r,this.bank=r.bank;let d=new Date,x=new Date(d.getFullYear(),d.getMonth(),1);this.filterForm=this.fb.group({startDate:[x],endDate:[d]})}ngOnInit(){this.loadTransactions()}loadTransactions(){this.loading=!0;let t=this.filterForm.get("startDate")?.value?.toISOString().split("T")[0],l=this.filterForm.get("endDate")?.value?.toISOString().split("T")[0];this.banksService.getBankTransactions(this.bank.id,t,l).subscribe({next:r=>{this.transactions=r,this.calculateTotals(),this.loading=!1},error:r=>{console.error("Error loading transactions:",r),this.loading=!1}})}calculateTotals(){this.totalIncome=this.transactions.filter(t=>t.transaction_type==="INCOME").reduce((t,l)=>t+Number(l.amount),0),this.totalExpense=this.transactions.filter(t=>t.transaction_type==="EXPENSE").reduce((t,l)=>t+Number(l.amount),0)}getTransactionTypeLabel(t){return{INCOME:"Ingreso",EXPENSE:"Egreso",TRANSFER:"Transferencia",ADJUSTMENT:"Ajuste"}[t]||t}getPaymentMethodLabel(t){return{card:"Tarjeta",transfer:"Transferencia",cash:"Efectivo",debt:"Cr\xE9dito",PagoMovil:"Pago M\xF3vil",Debito:"Tarjeta D\xE9bito",Credito:"Tarjeta Cr\xE9dito"}[t]||t}getReferenceTypeLabel(t){return{PURCHASE:"Compra",SALE:"Venta",TRANSFER:"Transferencia",INITIAL:"Saldo Inicial",DEBT_PAYMENT:"Pago de Deuda",MANUAL:"Manual"}[t]||t}formatCurrency(t){let l=this.bank.currency==="USD"?"$":"Bs.",r=Number(t)||0;return`${l} ${r.toLocaleString("es-VE",{minimumFractionDigits:2,maximumFractionDigits:2})}`}formatDate(t){return new Date(t).toLocaleString("es-VE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(l){return new(l||e)(b(j),b(S),b(Pt))};static \u0275cmp=h({type:e,selectors:[["app-bank-transactions-dialog"]],decls:49,vars:12,consts:[["startPicker",""],["endPicker",""],["mat-dialog-title",""],[1,"summary-cards"],[1,"summary-card","balance"],[1,"label"],[1,"value"],[1,"summary-card","income"],[1,"summary-card","expense"],[1,"filters",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],["mat-raised-button","","color","primary",3,"click"],["class","loading-container",4,"ngIf"],["class","no-data",4,"ngIf"],["mat-table","","class","transactions-table",3,"dataSource",4,"ngIf"],["align","end"],["mat-button","","mat-dialog-close",""],[1,"loading-container"],[1,"no-data"],["mat-table","",1,"transactions-table",3,"dataSource"],["matColumnDef","transaction_date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","amount"],["mat-cell","","class","amount-cell",4,"matCellDef"],["matColumnDef","balance_after"],["matColumnDef","reference"],["matColumnDef","payment_method"],["matColumnDef","description"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"amount-cell"],[4,"ngIf"],["mat-header-row",""],["mat-row",""]],template:function(l,r){if(l&1){let d=Z();a(0,"h2",2)(1,"mat-icon"),i(2,"receipt_long"),n(),i(3),n(),a(4,"mat-dialog-content")(5,"div",3)(6,"mat-card",4)(7,"mat-card-content")(8,"div",5),i(9,"Saldo Actual"),n(),a(10,"div",6),i(11),n()()(),a(12,"mat-card",7)(13,"mat-card-content")(14,"div",5),i(15,"Total Ingresos"),n(),a(16,"div",6),i(17),n()()(),a(18,"mat-card",8)(19,"mat-card-content")(20,"div",5),i(21,"Total Egresos"),n(),a(22,"div",6),i(23),n()()()(),a(24,"form",9)(25,"mat-form-field",10)(26,"mat-label"),i(27,"Fecha Inicio"),n(),_(28,"input",11)(29,"mat-datepicker-toggle",12)(30,"mat-datepicker",null,0),n(),a(32,"mat-form-field",10)(33,"mat-label"),i(34,"Fecha Fin"),n(),_(35,"input",13)(36,"mat-datepicker-toggle",12)(37,"mat-datepicker",null,1),n(),a(39,"button",14),M("click",function(){return D(d),T(r.loadTransactions())}),a(40,"mat-icon"),i(41,"search"),n(),i(42," Filtrar "),n()(),s(43,Pe,2,0,"div",15)(44,Oe,5,0,"div",16)(45,ze,24,3,"table",17),n(),a(46,"mat-dialog-actions",18)(47,"button",19),i(48,"Cerrar"),n()()}if(l&2){let d=yt(31),x=yt(38);o(3),C(" Movimientos de ",r.bank.name,`
`),o(8),f(r.formatCurrency(r.bank.current_balance)),o(6),f(r.formatCurrency(r.totalIncome)),o(6),f(r.formatCurrency(r.totalExpense)),o(),m("formGroup",r.filterForm),o(4),m("matDatepicker",d),o(),m("for",d),o(6),m("matDatepicker",x),o(),m("for",x),o(7),m("ngIf",r.loading),o(),m("ngIf",!r.loading&&r.transactions.length===0),o(),m("ngIf",!r.loading&&r.transactions.length>0)}},dependencies:[O,P,L,A,w,N,R,$,V,E,Ot,Y,W,K,Ct,lt,mt,_t,st,ct,ft,dt,pt,gt,ut,y,v,J,X,it,nt,at,xt,kt,G,z,H,qt,U,q,Wt,Jt,Yt,Kt,$t,rt,ot],styles:["h2[mat-dialog-title][_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin:0;padding:20px;border-bottom:1px solid #e0e0e0}mat-dialog-content[_ngcontent-%COMP%]{padding:20px;max-height:calc(80vh - 120px);overflow-y:auto}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:20px}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-bottom:8px}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:24px;font-weight:600}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   .summary-card.balance[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#2196f3}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   .summary-card.income[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#4caf50}mat-dialog-content[_ngcontent-%COMP%]   .summary-cards[_ngcontent-%COMP%]   .summary-card.expense[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#f44336}mat-dialog-content[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;margin-bottom:20px}mat-dialog-content[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}mat-dialog-content[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}mat-dialog-content[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}mat-dialog-content[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#999}mat-dialog-content[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.3}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]{width:100%;background:#fff}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;background:#f5f5f5}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   .amount-cell[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:14px}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   .amount-cell[_ngcontent-%COMP%]   strong.income[_ngcontent-%COMP%]{color:#4caf50}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   .amount-cell[_ngcontent-%COMP%]   strong.expense[_ngcontent-%COMP%]{color:#f44336}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{font-size:11px;min-height:22px;padding:4px 10px}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   mat-chip.income[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}mat-dialog-content[_ngcontent-%COMP%]   .transactions-table[_ngcontent-%COMP%]   mat-chip.expense[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid #e0e0e0}"]})}return e})();function Ge(e,c){if(e&1&&(a(0,"mat-option",13),i(1),St(2,"number"),n()),e&2){let t=c.$implicit;m("value",t.id),o(),Et(" ",t.name," (",t.currency," - ",Dt(2,4,t.current_balance,"1.2-2"),") ")}}function qe(e,c){if(e&1&&(a(0,"mat-option",13),i(1),St(2,"number"),n()),e&2){let t=c.$implicit;m("value",t.id),o(),Et(" ",t.name," (",t.currency," - ",Dt(2,4,t.current_balance,"1.2-2"),") ")}}function Ue(e,c){if(e&1&&(a(0,"div",14)(1,"mat-icon",15),i(2,"info"),n(),i(3," Las cuentas tienen monedas diferentes. Por favor especifique la tasa de cambio. "),_(4,"br"),a(5,"strong"),i(6),n()()),e&2){let t=p();o(6),At("1 ",t.originBank==null?null:t.originBank.currency," = ? ",t.destinationBank==null?null:t.destinationBank.currency)}}function Xe(e,c){e&1&&(a(0,"mat-form-field",2)(1,"mat-label"),i(2,"Tasa de Cambio"),n(),_(3,"input",16),n())}var le=(()=>{class e{fb=Q(j);banksService=Q(S);dialogRef=Q(ht);snackBar=Q(I);transferForm;banks=[];saving=!1;constructor(){this.transferForm=this.fb.group({origin_bank_id:["",k.required],destination_bank_id:["",k.required],amount:[0,[k.required,k.min(.01)]],exchange_rate:[1,[k.required,k.min(1e-6)]],notes:[""]})}ngOnInit(){this.loadBanks(),this.transferForm.get("origin_bank_id")?.valueChanges.subscribe(()=>this.checkCurrencies()),this.transferForm.get("destination_bank_id")?.valueChanges.subscribe(()=>this.checkCurrencies())}loadBanks(){this.banksService.getBanks(!0).subscribe(t=>this.banks=t)}get originBank(){return this.banks.find(t=>t.id===this.transferForm.get("origin_bank_id")?.value)}get destinationBank(){return this.banks.find(t=>t.id===this.transferForm.get("destination_bank_id")?.value)}get currenciesDifferent(){return!!this.originBank&&!!this.destinationBank&&this.originBank.currency!==this.destinationBank.currency}checkCurrencies(){this.currenciesDifferent||this.transferForm.patchValue({exchange_rate:1})}onSubmit(){this.transferForm.invalid||(this.saving=!0,this.banksService.transferFunds(this.transferForm.value).subscribe({next:()=>{this.snackBar.open("Transferencia completada","OK",{duration:3e3}),this.dialogRef.close(!0)},error:t=>{console.error(t),this.snackBar.open("Error al transferir: "+(t.error?.error||t.message),"Cerrar"),this.saving=!1}}))}static \u0275fac=function(l){return new(l||e)};static \u0275cmp=h({type:e,selectors:[["app-bank-transfer-dialog"]],decls:29,vars:7,consts:[["mat-dialog-title",""],[1,"transfer-form",3,"formGroup"],["appearance","outline"],["formControlName","origin_bank_id"],[3,"value",4,"ngFor","ngForOf"],["formControlName","destination_bank_id"],["matInput","","type","text","formControlName","amount","appMoneyInput","","decimalType","total"],["class","rate-info",4,"ngIf"],["appearance","outline",4,"ngIf"],["matInput","","formControlName","notes","rows","2"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"value"],[1,"rate-info"],["inline",""],["matInput","","type","text","formControlName","exchange_rate","appMoneyInput","","decimalType","total"]],template:function(l,r){l&1&&(a(0,"h2",0),i(1,"Transferencia entre Cuentas"),n(),a(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),i(6,"Cuenta Origen"),n(),a(7,"mat-select",3),s(8,Ge,3,7,"mat-option",4),n()(),a(9,"mat-form-field",2)(10,"mat-label"),i(11,"Cuenta Destino"),n(),a(12,"mat-select",5),s(13,qe,3,7,"mat-option",4),n()(),a(14,"mat-form-field",2)(15,"mat-label"),i(16,"Monto a Transferir (Moneda Origen)"),n(),_(17,"input",6),n(),s(18,Ue,7,2,"div",7)(19,Xe,4,0,"mat-form-field",8),a(20,"mat-form-field",2)(21,"mat-label"),i(22,"Notas / Referencia"),n(),_(23,"textarea",9),n()()(),a(24,"mat-dialog-actions",10)(25,"button",11),i(26,"Cancelar"),n(),a(27,"button",12),M("click",function(){return r.onSubmit()}),i(28),n()()),l&2&&(o(3),m("formGroup",r.transferForm),o(5),m("ngForOf",r.banks),o(5),m("ngForOf",r.banks),o(5),m("ngIf",r.currenciesDifferent),o(),m("ngIf",r.currenciesDifferent),o(8),m("disabled",r.transferForm.invalid||r.saving),o(),C(" ",r.saving?"Procesando...":"Transferir"," "))},dependencies:[O,tt,P,L,A,w,N,R,$,V,E,Ot,Y,W,K,G,z,H,U,q,Mt,bt,et,y,v,F,J,X,vt,Vt],styles:[".transfer-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;padding:10px 0}.rate-info[_ngcontent-%COMP%]{background:#fff8e1;padding:10px;border-radius:4px;font-size:13px;margin-bottom:10px}"]})}return e})();function Je(e,c){e&1&&(a(0,"div",7),_(1,"mat-spinner"),n())}function Ye(e,c){if(e&1){let t=Z();a(0,"div",8)(1,"mat-icon"),i(2,"account_balance"),n(),a(3,"p"),i(4,"No hay bancos registrados"),n(),a(5,"button",3),M("click",function(){D(t);let r=p();return T(r.openCreateDialog())}),i(6," Crear Primer Banco "),n()()}}function Ke(e,c){e&1&&(a(0,"th",23),i(1,"Nombre"),n())}function We(e,c){if(e&1&&(a(0,"small"),i(1),n()),e&2){let t=p().$implicit;o(),f(t.bank_entity_name)}}function Qe(e,c){if(e&1&&(a(0,"small"),i(1),n()),e&2){let t=p().$implicit;o(),f(t.bank_entity)}}function Ze(e,c){if(e&1&&(a(0,"td",24)(1,"div",25)(2,"strong"),i(3),n(),s(4,We,2,1,"small",26)(5,Qe,2,1,"small",26),n()()),e&2){let t=c.$implicit;o(3),f(t.name),o(),m("ngIf",t.bank_entity_name),o(),m("ngIf",!t.bank_entity_name&&t.bank_entity)}}function tn(e,c){e&1&&(a(0,"th",23),i(1,"N\xFAmero de Cuenta"),n())}function en(e,c){if(e&1&&(a(0,"td",24),i(1),n()),e&2){let t=c.$implicit;o(),f(t.account_number||"-")}}function nn(e,c){e&1&&(a(0,"th",23),i(1,"Tipo"),n())}function an(e,c){if(e&1&&(a(0,"td",24)(1,"mat-chip"),i(2),n()()),e&2){let t=c.$implicit,l=p(2);o(2),f(t.account_type_name||l.getAccountTypeLabel(t.account_type))}}function on(e,c){e&1&&(a(0,"th",23),i(1,"Moneda"),n())}function rn(e,c){if(e&1&&(a(0,"td",24)(1,"mat-chip"),i(2),n()()),e&2){let t=c.$implicit;o(),B("usd",t.currency==="USD"),o(),f(t.currency)}}function ln(e,c){e&1&&(a(0,"th",23),i(1,"Saldo Actual"),n())}function cn(e,c){if(e&1&&(a(0,"td",27)(1,"strong"),i(2),n()()),e&2){let t=c.$implicit,l=p(2);o(),B("positive",t.current_balance>0)("negative",t.current_balance<0),o(),C(" ",l.formatCurrency(t.current_balance,t.currency)," ")}}function mn(e,c){e&1&&(a(0,"th",23),i(1,"Estado"),n())}function sn(e,c){if(e&1&&(a(0,"td",24)(1,"mat-chip"),i(2),n()()),e&2){let t=c.$implicit;o(),B("active",t.active)("inactive",!t.active),o(),C(" ",t.active?"Activo":"Inactivo"," ")}}function dn(e,c){e&1&&(a(0,"th",28),i(1,"Acciones"),n())}function pn(e,c){if(e&1){let t=Z();a(0,"td",24)(1,"div",29)(2,"button",30),M("click",function(){let r=D(t).$implicit,d=p(2);return T(d.openTransactionsDialog(r))}),a(3,"mat-icon"),i(4,"receipt_long"),n()(),a(5,"button",31),M("click",function(){let r=D(t).$implicit,d=p(2);return T(d.openEditDialog(r))}),a(6,"mat-icon"),i(7,"edit"),n()(),a(8,"button",32),M("click",function(){let r=D(t).$implicit,d=p(2);return T(d.deleteBank(r))}),a(9,"mat-icon"),i(10,"delete"),n()()()()}e&2&&(o(2),m("matTooltip","Ver Movimientos"),o(3),m("matTooltip","Editar"),o(3),m("matTooltip","Eliminar"))}function _n(e,c){e&1&&_(0,"tr",33)}function fn(e,c){e&1&&_(0,"tr",34)}function gn(e,c){if(e&1&&(a(0,"table",9),g(1,10),s(2,Ke,2,0,"th",11)(3,Ze,6,3,"td",12),u(),g(4,13),s(5,tn,2,0,"th",11)(6,en,2,1,"td",12),u(),g(7,14),s(8,nn,2,0,"th",11)(9,an,3,1,"td",12),u(),g(10,15),s(11,on,2,0,"th",11)(12,rn,3,3,"td",12),u(),g(13,16),s(14,ln,2,0,"th",11)(15,cn,3,5,"td",17),u(),g(16,18),s(17,mn,2,0,"th",11)(18,sn,3,5,"td",12),u(),g(19,19),s(20,dn,2,0,"th",20)(21,pn,11,3,"td",12),u(),s(22,_n,1,0,"tr",21)(23,fn,1,0,"tr",22),n()),e&2){let t=p();m("dataSource",t.banks),o(22),m("matHeaderRowDef",t.displayedColumns),o(),m("matRowDefColumns",t.displayedColumns)}}var Ta=(()=>{class e{banksService;dialog;snackBar;banks=[];displayedColumns=["name","account_number","account_type","currency","current_balance","status","actions"];loading=!1;constructor(t,l,r){this.banksService=t,this.dialog=l,this.snackBar=r}ngOnInit(){this.loadBanks()}loadBanks(){this.loading=!0,this.banksService.getBanks().subscribe({next:t=>{this.banks=t,this.loading=!1},error:t=>{console.error("Error loading banks:",t),this.snackBar.open("Error al cargar bancos","Cerrar",{duration:3e3}),this.loading=!1}})}openCreateDialog(){this.dialog.open(wt,{width:"600px",data:{mode:"create"}}).afterClosed().subscribe(l=>{l&&this.loadBanks()})}openEditDialog(t){this.dialog.open(wt,{width:"600px",data:{mode:"edit",bank:t}}).afterClosed().subscribe(r=>{r&&this.loadBanks()})}openTransferDialog(){this.dialog.open(le,{width:"500px"}).afterClosed().subscribe(l=>{l&&this.loadBanks()})}openTransactionsDialog(t){this.dialog.open(re,{width:"90%",maxWidth:"1200px",height:"80vh",data:{bank:t}})}deleteBank(t){confirm(`\xBFEst\xE1 seguro de eliminar el banco "${t.name}"?`)&&this.banksService.deleteBank(t.id).subscribe({next:l=>{this.snackBar.open(l.message||"Banco eliminado exitosamente","Cerrar",{duration:3e3}),this.loadBanks()},error:l=>{console.error("Error deleting bank:",l),this.snackBar.open("Error al eliminar banco","Cerrar",{duration:3e3})}})}getAccountTypeLabel(t){return{CORRIENTE:"Corriente",AHORRO:"Ahorro",CREDITO:"Cr\xE9dito"}[t]||t}formatCurrency(t,l){let r=l==="USD"?"$":"Bs.",d=Number(t)||0;return`${r} ${d.toFixed(2)}`}static \u0275fac=function(l){return new(l||e)(b(S),b(Qt),b(I))};static \u0275cmp=h({type:e,selectors:[["app-banks"]],decls:20,vars:3,consts:[[1,"banks-container"],[1,"header-actions"],["mat-stroked-button","","color","primary",1,"me-2",3,"click"],["mat-raised-button","","color","primary",3,"click"],["class","loading-container",4,"ngIf"],["class","no-data",4,"ngIf"],["mat-table","","class","banks-table",3,"dataSource",4,"ngIf"],[1,"loading-container"],[1,"no-data"],["mat-table","",1,"banks-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","account_number"],["matColumnDef","account_type"],["matColumnDef","currency"],["matColumnDef","current_balance"],["mat-cell","","class","balance-cell",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"bank-name"],[4,"ngIf"],["mat-cell","",1,"balance-cell"],["mat-header-cell","",1,"actions-header"],[1,"actions-container"],["mat-icon-button","","color","accent",3,"click","matTooltip"],["mat-icon-button","","color","primary",3,"click","matTooltip"],["mat-icon-button","","color","warn",3,"click","matTooltip"],["mat-header-row",""],["mat-row",""]],template:function(l,r){l&1&&(a(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon"),i(5,"account_balance"),n(),i(6," Gesti\xF3n de Bancos "),n(),a(7,"div",1)(8,"button",2),M("click",function(){return r.openTransferDialog()}),a(9,"mat-icon"),i(10,"swap_horiz"),n(),i(11," Transferir "),n(),a(12,"button",3),M("click",function(){return r.openCreateDialog()}),a(13,"mat-icon"),i(14,"add"),n(),i(15," Nuevo Banco "),n()()(),a(16,"mat-card-content"),s(17,Je,2,0,"div",4)(18,Ye,7,0,"div",5)(19,gn,24,3,"table",6),n()()()),l&2&&(o(17),m("ngIf",r.loading),o(),m("ngIf",!r.loading&&r.banks.length===0),o(),m("ngIf",!r.loading&&r.banks.length>0))},dependencies:[O,P,Ct,lt,mt,_t,st,ct,ft,dt,pt,gt,ut,y,v,jt,J,X,E,F,it,nt,at,zt,Ht,xt,kt,Xt,Ut,rt,ot],styles:[".banks-container[_ngcontent-%COMP%]{padding:20px;height:100%}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e0e0e0}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:24px;margin:0}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{flex:1;overflow:auto;padding:20px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:400px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#999}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:20px;opacity:.3}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;margin-bottom:20px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]{width:100%;background:#fff}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;background:#f5f5f5}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .bank-name[_ngcontent-%COMP%]{display:flex;flex-direction:column}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .bank-name[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:14px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .bank-name[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#666;font-size:12px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .balance-cell[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:16px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .balance-cell[_ngcontent-%COMP%]   strong.positive[_ngcontent-%COMP%]{color:#4caf50}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .balance-cell[_ngcontent-%COMP%]   strong.negative[_ngcontent-%COMP%]{color:#f44336}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{font-size:12px;min-height:24px;padding:4px 12px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   mat-chip.usd[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   mat-chip.active[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   mat-chip.inactive[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .actions-header[_ngcontent-%COMP%]{text-align:center}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{transition:transform .2s}.banks-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .banks-table[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]:hover{transform:scale(1.1)}"]})}return e})();export{Ta as BanksComponent};
