import{a as Mt,b as vt}from"./chunk-O2W4PKCN.js";import{a as Be}from"./chunk-LJW6EPWE.js";import{a as St}from"./chunk-GZG33B4A.js";import{a as _t,b as ht,c as Ct,d as Et}from"./chunk-ISB5W5SX.js";import{a as gt}from"./chunk-BK63NQ7D.js";import{b as Ie,c as we}from"./chunk-HIZ742YJ.js";import{a as rt}from"./chunk-XGFVHFBN.js";import{a as xt}from"./chunk-RFRKPPY3.js";import{a as pt,b as st,c as dt,e as ct,f as ft,g as ut,h as Ne}from"./chunk-Z6YHTX75.js";import{a as w,b as Ze}from"./chunk-26KDQVR5.js";import{b as lt,c as mt}from"./chunk-UMEZ73TD.js";import"./chunk-DGQM6DPS.js";import{a as ge}from"./chunk-SCPRHZYR.js";import{a as ke,b as Le,c as Oe,d as Pe}from"./chunk-N7P7XLP2.js";import{d as me}from"./chunk-GRESZPIF.js";import"./chunk-EQXJNMRX.js";import{b as N,c as B}from"./chunk-APXOZHQA.js";import{a as _e,b as he,c as Ce,d as Ee,e as Se,f as Me,g as ve,h as De,i as ye,j as be,l as Te}from"./chunk-VJGP4MMT.js";import{a as K,b as X}from"./chunk-VNZMNOUU.js";import{a as Fe}from"./chunk-YCMZOG5D.js";import{a as tt,b as it,c as nt,d as at,f as ot,h as ce}from"./chunk-ZWM7H6SC.js";import{a as xe}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as j}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as L,c as fe,d as ue,f as J,i as O,j as P}from"./chunk-EWTXOCXT.js";import{b as F,d as M,f as k,g as H,j as et,k as z,m as se,n as U,o as W,w as Y,x as de,y as Q}from"./chunk-AVLO2MYP.js";import{a as q,b as y}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as pe,I as T,K as I}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import{d as le}from"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as A,l as oe,s as re,t as Xe,v as D}from"./chunk-ZD4QWOHN.js";import{$ as c,Fb as p,Gb as n,Hb as i,Ib as u,Mb as _,Nb as h,Pb as $,Ub as g,W as ne,Wa as l,Wb as G,db as ee,ea as E,ec as te,fa as S,gc as Ue,ic as a,jb as v,jc as We,kc as f,lc as Ye,nc as Qe,oc as Je,pb as d,pc as Ke,vc as b,wc as ae,xc as R,zb as ze}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";var V=(()=>{class t{http=c(le);apiUrl=`${Fe.apiUrl}/expenses`;getAll(e=1,o=20,r){let s={page:e.toString(),limit:o.toString()};return r&&(s.search=r),this.http.get(this.apiUrl,{params:s})}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e,o){return this.http.put(`${this.apiUrl}/${e}`,o)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}static \u0275fac=function(o){return new(o||t)};static \u0275prov=ne({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ft(t,m){t&1&&(n(0,"mat-error"),a(1,"El nombre es requerido"),i())}function kt(t,m){if(t&1&&(n(0,"mat-option",11),a(1),i()),t&2){let e=m.$implicit;p("value",e),l(),f(" ",e," ")}}function Lt(t,m){t&1&&(n(0,"mat-error"),a(1,"La frecuencia es requerida"),i())}function Ot(t,m){if(t&1&&(n(0,"mat-option",11),a(1),i()),t&2){let e=m.$implicit;p("value",e.id),l(),f(" ",e.name," ")}}function Pt(t,m){if(t&1&&(n(0,"mat-option",11),a(1),i()),t&2){let e=m.$implicit;p("value",e.id),l(),f(" ",e.name," ")}}function Nt(t,m){t&1&&(n(0,"mat-error"),a(1,"El proveedor es requerido"),i())}var bt=(()=>{class t{dialogRef;data;form;loading=!1;fb=c(Y);frequencies=["Diario","Semanal","Quincenal","Mensual","Bimestral","Trimestral","Semestral","Anual","\xDAnico"];suppliers=[];filteredSuppliers=[];supplierFilterCtrl=this.fb.control("");taxCategories=[];expenseService=c(V);supplierService=c(St);taxService=c(Be);snackBar=c(w);constructor(e,o){this.dialogRef=e,this.data=o,this.form=this.fb.group({name:["",M.required],frequency:["Mensual",M.required],idsupplier:[null,M.required],taxcat:[null],visible:[!0]})}ngOnInit(){this.loadSuppliers(),this.loadTaxCategories(),this.data&&this.form.patchValue(this.data),this.supplierFilterCtrl.valueChanges.subscribe(e=>{this.filterSuppliers(e||"")})}loadSuppliers(){this.supplierService.getAll(1,100).subscribe(e=>{this.suppliers=e.data,this.filteredSuppliers=this.suppliers})}loadTaxCategories(){this.taxService.getAllCategories().subscribe(e=>{this.taxCategories=e})}filterSuppliers(e){if(!e){this.filteredSuppliers=this.suppliers;return}e=e.toLowerCase(),this.filteredSuppliers=this.suppliers.filter(o=>o.name.toLowerCase().includes(e))}onSubmit(){if(this.form.invalid)return;this.loading=!0;let e=this.form.value;(this.data?this.expenseService.update(this.data.id,e):this.expenseService.create(e)).subscribe({next:r=>{this.loading=!1,this.dialogRef.close(!0)},error:r=>{console.error("Error saving expense definition",r),this.snackBar.open("Error al guardar el tipo de gasto","Cerrar",{duration:3e3}),this.loading=!1}})}onCancel(){this.dialogRef.close()}static \u0275fac=function(o){return new(o||t)(ee(pt),ee(st))};static \u0275cmp=v({type:t,selectors:[["app-expense-definition-dialog"]],decls:43,vars:13,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"dialog-content"],[1,"form-grid"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ej. Alquiler, Luz, Agua"],[4,"ngIf"],["appearance","outline"],["formControlName","frequency"],[3,"value",4,"ngFor","ngForOf"],["formControlName","taxcat"],[3,"value"],["formControlName","idsupplier"],["placeholderLabel","Buscar proveedor...","noEntriesFoundLabel","No encontrado",3,"formControl"],[1,"toggle-container"],["formControlName","visible","color","primary"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(o,r){if(o&1&&(n(0,"h2",0),a(1),i(),n(2,"form",1),g("ngSubmit",function(){return r.onSubmit()}),n(3,"mat-dialog-content",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Nombre del Gasto"),i(),u(8,"input",5),d(9,Ft,2,0,"mat-error",6),i(),n(10,"mat-form-field",7)(11,"mat-label"),a(12,"Frecuencia"),i(),n(13,"mat-select",8),d(14,kt,2,2,"mat-option",9),i(),d(15,Lt,2,0,"mat-error",6),i(),n(16,"mat-form-field",7)(17,"mat-label"),a(18,"Categor\xEDa de Impuesto"),i(),n(19,"mat-select",10)(20,"mat-option",11),a(21,"Ninguno"),i(),d(22,Ot,2,2,"mat-option",9),i()(),n(23,"mat-form-field",4)(24,"mat-label"),a(25,"Proveedor Asociado"),i(),n(26,"mat-select",12)(27,"mat-option"),u(28,"ngx-mat-select-search",13),i(),n(29,"mat-option",11),a(30,"-- Ninguno --"),i(),d(31,Pt,2,2,"mat-option",9),i(),d(32,Nt,2,0,"mat-error",6),n(33,"mat-hint"),a(34,"Si selecciona un proveedor, este se pre-cargar\xE1 al registrar el gasto"),i()(),n(35,"div",14)(36,"mat-slide-toggle",15),a(37," Gasto Activo "),i()()()(),n(38,"mat-dialog-actions",16)(39,"button",17),g("click",function(){return r.onCancel()}),a(40,"Cancelar"),i(),n(41,"button",18),a(42),i()()()),o&2){let s,x,C;l(),f(" ",r.data?"Editar Gasto":"Nuevo Tipo de Gasto"," "),l(),p("formGroup",r.form),l(7),p("ngIf",(s=r.form.get("name"))==null?null:s.hasError("required")),l(5),p("ngForOf",r.frequencies),l(),p("ngIf",(x=r.form.get("frequency"))==null?null:x.hasError("required")),l(5),p("value",null),l(2),p("ngForOf",r.taxCategories),l(6),p("formControl",r.supplierFilterCtrl),l(),p("value",null),l(2),p("ngForOf",r.filteredSuppliers),l(),p("ngIf",(C=r.form.get("idsupplier"))==null?null:C.hasError("required")),l(9),p("disabled",r.form.invalid||r.loading),l(),f(" ",r.data?"Actualizar":"Crear"," ")}},dependencies:[D,A,oe,Q,z,F,k,H,se,W,U,Ne,ct,ut,ft,I,T,P,O,L,ue,fe,B,N,X,K,j,vt,Mt,y],styles:[".dialog-content[_ngcontent-%COMP%]{padding-top:10px;min-width:400px;max-width:600px}.form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.full-width[_ngcontent-%COMP%]{width:100%}.toggle-container[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:20px}"]})}return t})();function Vt(t,m){t&1&&(n(0,"th",18),a(1," Nombre "),i())}function $t(t,m){if(t&1&&(n(0,"td",19),a(1),i()),t&2){let e=m.$implicit;l(),f(" ",e.name," ")}}function Rt(t,m){t&1&&(n(0,"th",18),a(1," Frecuencia "),i())}function Gt(t,m){if(t&1&&(n(0,"td",19)(1,"mat-chip-option",20),a(2),i()()),t&2){let e=m.$implicit;l(),p("selectable",!1),l(),We(e.frequency)}}function At(t,m){t&1&&(n(0,"th",18),a(1," Proveedor "),i())}function jt(t,m){if(t&1&&(n(0,"td",19),a(1),i()),t&2){let e=m.$implicit;l(),f(" ",e.supplier_name||"-"," ")}}function Ht(t,m){t&1&&(n(0,"th",18),a(1," Impuesto "),i())}function zt(t,m){if(t&1&&(n(0,"td",19),a(1),i()),t&2){let e=m.$implicit;l(),f(" ",e.taxcat_name||"-"," ")}}function Ut(t,m){t&1&&(n(0,"th",18),a(1," Estado "),i())}function Wt(t,m){if(t&1&&(n(0,"td",19)(1,"span"),a(2),i()()),t&2){let e=m.$implicit;l(),Ue("active-status",e.visible)("inactive-status",!e.visible),l(),f(" ",e.visible?"Activo":"Inactivo"," ")}}function Yt(t,m){t&1&&(n(0,"th",18),a(1," Acciones "),i())}function Qt(t,m){if(t&1){let e=$();n(0,"td",19)(1,"button",21),g("click",function(){let r=E(e).$implicit,s=G();return S(s.openDialog(r))}),n(2,"mat-icon"),a(3,"edit"),i()(),n(4,"button",22),g("click",function(){let r=E(e).$implicit,s=G();return S(s.delete(r))}),n(5,"mat-icon"),a(6,"delete"),i()()()}}function Jt(t,m){t&1&&u(0,"tr",23)}function Kt(t,m){t&1&&u(0,"tr",24)}var Tt=(()=>{class t{displayedColumns=["name","frequency","supplier","taxcat","status","actions"];expenses=[];totalElements=0;pageSize=50;searchText="";expenseService=c(V);dialog=c(dt);snackBar=c(w);ngOnInit(){this.loadExpenses()}loadExpenses(e=1){this.expenseService.getAll(e,this.pageSize,this.searchText).subscribe(o=>{this.expenses=o.data,this.totalElements=o.total})}onPageChange(e){this.loadExpenses(e.pageIndex+1)}openDialog(e){this.dialog.open(bt,{width:"500px",data:e||null}).afterClosed().subscribe(r=>{r&&(this.loadExpenses(),this.snackBar.open(e?"Gasto actualizado":"Gasto creado","Cerrar",{duration:3e3}))})}delete(e){confirm(`\xBFEst\xE1 seguro que desea eliminar el tipo de gasto "${e.name}"?`)&&this.expenseService.delete(e.id).subscribe({next:()=>{this.snackBar.open("Gasto eliminado","Cerrar",{duration:3e3}),this.loadExpenses()},error:o=>{console.error(o),this.snackBar.open("Error al eliminar (puede tener registros asociados)","Cerrar",{duration:3e3})}})}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=v({type:t,selectors:[["app-expense-definition-list"]],decls:35,vars:7,consts:[[1,"actions-container"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Nombre...",3,"ngModelChange","keyup.enter","ngModel"],["mat-icon-button","","matSuffix","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"table-container","mat-elevation-z2"],["mat-table","",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","frequency"],["matColumnDef","supplier"],["matColumnDef","taxcat"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize"],["mat-header-cell",""],["mat-cell",""],[3,"selectable"],["mat-icon-button","","color","primary","matTooltip","Editar",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,r){o&1&&(n(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),a(3,"Buscar gasto"),i(),n(4,"input",2),Ke("ngModelChange",function(x){return Je(r.searchText,x)||(r.searchText=x),x}),g("keyup.enter",function(){return r.loadExpenses()}),i(),n(5,"button",3),g("click",function(){return r.loadExpenses()}),n(6,"mat-icon"),a(7,"search"),i()()(),n(8,"button",4),g("click",function(){return r.openDialog()}),n(9,"mat-icon"),a(10,"add"),i(),a(11," Nuevo Tipo de Gasto "),i()(),n(12,"div",5)(13,"table",6),_(14,7),d(15,Vt,2,0,"th",8)(16,$t,2,1,"td",9),h(),_(17,10),d(18,Rt,2,0,"th",8)(19,Gt,3,2,"td",9),h(),_(20,11),d(21,At,2,0,"th",8)(22,jt,2,1,"td",9),h(),_(23,12),d(24,Ht,2,0,"th",8)(25,zt,2,1,"td",9),h(),_(26,13),d(27,Ut,2,0,"th",8)(28,Wt,3,5,"td",9),h(),_(29,14),d(30,Yt,2,0,"th",8)(31,Qt,7,0,"td",9),h(),d(32,Jt,1,0,"tr",15)(33,Kt,1,0,"tr",16),i(),n(34,"app-shared-paginator",17),g("page",function(x){return r.onPageChange(x)}),i()()),o&2&&(l(4),Qe("ngModel",r.searchText),l(),ze("aria-label","Buscar"),l(8),p("dataSource",r.expenses),l(19),p("matHeaderRowDef",r.displayedColumns),l(),p("matRowDefColumns",r.displayedColumns),l(),p("length",r.totalElements)("pageSize",r.pageSize))},dependencies:[D,de,F,k,et,Te,_e,Ce,ve,Ee,he,De,Se,Me,ye,be,Ie,we,I,T,pe,y,q,B,N,O,L,J,P,ge,xe,Ne,Ze,mt,lt],styles:[".actions-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.search-field[_ngcontent-%COMP%]{width:300px}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}.active-status[_ngcontent-%COMP%]{color:green;font-weight:700}.inactive-status[_ngcontent-%COMP%]{color:gray}"]})}return t})();var qe=(()=>{class t{http=c(le);apiUrl=`${Fe.apiUrl}/daily-expenses`;getAll(e={}){let o={page:(e.page||1).toString(),limit:(e.limit||20).toString()};return e.search&&(o.search=e.search),e.startDate&&(o.startDate=e.startDate),e.endDate&&(o.endDate=e.endDate),e.idgastos&&(o.idgastos=e.idgastos.toString()),e.payment&&(o.payment=e.payment),this.http.get(this.apiUrl,{params:o})}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e,o){return this.http.put(`${this.apiUrl}/${e}`,o)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}getTotalsByPeriod(e,o,r="day"){let s={startDate:e,endDate:o,groupBy:r};return this.http.get(`${this.apiUrl}/reports/totals`,{params:s})}static \u0275fac=function(o){return new(o||t)};static \u0275prov=ne({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Zt(t,m){if(t&1&&(n(0,"mat-option",20),a(1),n(2,"span",30),a(3),i()()),t&2){let e=m.$implicit;p("value",e.id),l(),f(" ",e.name," "),l(2),f("(",e.frequency,")")}}function ei(t,m){t&1&&(n(0,"mat-error"),a(1,"Requerido"),i())}function ti(t,m){t&1&&(n(0,"mat-error"),a(1,"Requerido"),i())}function ii(t,m){t&1&&(n(0,"mat-error"),a(1,"Debe ser mayor a 0"),i())}function ni(t,m){if(t&1&&(n(0,"mat-option",20),a(1),b(2,"percent"),i()),t&2){let e=m.$implicit;p("value",e.id),l(),Ye(" ",e.name," (",ae(2,3,e.rate),") ")}}function ai(t,m){t&1&&(n(0,"mat-error"),a(1,"Requerido"),i())}function oi(t,m){t&1&&(n(0,"div",31)(1,"mat-icon"),a(2,"warning"),i(),a(3," La caja debe estar abierta para registrar gastos. "),i())}var It=(()=>{class t{form;loading=!1;fb=c(Y);isCashOpened=!1;expenses=[];filteredExpenses=[];taxes=[];expenseFilterCtrl=this.fb.control("");dailyExpenseService=c(qe);expenseService=c(V);cashService=c(gt);taxService=c(Be);snackBar=c(w);constructor(){this.form=this.fb.group({idgastos:[null,M.required],date:[new Date,M.required],payment:["cash",M.required],taxId:[null],taxbase:[null,[M.required,M.min(.01)]],tax:[0],total:[0],numberinvoice:["",M.required],notes:[""]})}ngOnInit(){this.checkCashStatus(),this.loadExpenses(),this.loadTaxes(),this.expenseFilterCtrl.valueChanges.subscribe(e=>{this.filterExpenses(e||"")}),this.form.get("taxbase")?.valueChanges.subscribe(e=>{this.calculateTotal()}),this.form.get("taxId")?.valueChanges.subscribe(e=>{this.calculateTotal()})}async checkCashStatus(){this.isCashOpened=await this.cashService.checkStatus(),this.isCashOpened||this.form.disable()}loadExpenses(){this.expenseService.getAll(1,100).subscribe(e=>{this.expenses=e.data,this.filteredExpenses=this.expenses})}loadTaxes(){this.taxService.getAll().subscribe(e=>{this.taxes=e})}filterExpenses(e){if(!e){this.filteredExpenses=this.expenses;return}e=e.toLowerCase(),this.filteredExpenses=this.expenses.filter(o=>o.name.toLowerCase().includes(e))}onExpenseTypeChange(e){if(e){let o=this.expenses.find(r=>r.id===e);if(o&&o.taxcat){let r=this.taxes.find(s=>s.category===o.taxcat);r?this.form.patchValue({taxId:r.id}):this.form.patchValue({taxId:null})}else this.form.patchValue({taxId:null})}}calculateTotal(){let e=this.form.get("taxbase")?.value,o=this.form.get("taxId")?.value;if(!e){this.form.patchValue({tax:0,total:0},{emitEvent:!1});return}let r=0;if(o){let C=this.taxes.find(ie=>ie.id===o);C&&(r=C.rate)}let s=e*r,x=e+s;this.form.patchValue({tax:s,total:x},{emitEvent:!1})}onSubmit(){if(this.form.invalid||!this.isCashOpened)return;this.loading=!0;let e=this.form.value;this.dailyExpenseService.create(e).subscribe({next:o=>{this.snackBar.open("Gasto registrado exitosamente","Cerrar",{duration:3e3}),this.resetForm(),this.loading=!1},error:o=>{console.error("Error creating daily expense",o),this.snackBar.open("Error al registrar el gasto","Cerrar",{duration:3e3}),this.loading=!1}})}resetForm(){this.form.reset({idgastos:null,date:new Date,payment:"cash",taxId:null,taxbase:null,tax:0,total:0,numberinvoice:"",notes:""}),this.checkCashStatus()}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=v({type:t,selectors:[["app-daily-expense-form"]],decls:66,vars:17,consts:[["picker",""],[1,"form-container"],[3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","outline",1,"full-width"],["formControlName","idgastos",3,"selectionChange"],["placeholderLabel","Buscar gasto...",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","outline"],["matInput","","formControlName","date",3,"matDatepicker"],["matSuffix","",3,"for"],["formControlName","payment"],["value","cash"],["value","magcard"],["value","check"],["value","transfer"],[1,"amounts-row"],["matInput","","appMoneyInput","","decimalType","total","formControlName","taxbase"],["formControlName","taxId"],[3,"value"],["align","end"],["appearance","outline",1,"total-field"],["matInput","","appMoneyInput","","decimalType","total","formControlName","total","readonly",""],["matInput","","formControlName","numberinvoice"],["matInput","","formControlName","notes","rows","2"],[1,"actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["class","cash-warning",4,"ngIf"],[1,"frequency-hint"],[1,"cash-warning"]],template:function(o,r){if(o&1){let s=$();n(0,"div",1)(1,"form",2),g("ngSubmit",function(){return E(s),S(r.onSubmit())}),n(2,"div",3)(3,"mat-form-field",4)(4,"mat-label"),a(5,"Tipo de Gasto"),i(),n(6,"mat-select",5),g("selectionChange",function(C){return E(s),S(r.onExpenseTypeChange(C.value))}),n(7,"mat-option"),u(8,"ngx-mat-select-search",6),i(),d(9,Zt,4,3,"mat-option",7),i(),d(10,ei,2,0,"mat-error",8),i(),n(11,"mat-form-field",9)(12,"mat-label"),a(13,"Fecha"),i(),u(14,"input",10)(15,"mat-datepicker-toggle",11)(16,"mat-datepicker",null,0),i(),n(18,"mat-form-field",9)(19,"mat-label"),a(20,"M\xE9todo de Pago"),i(),n(21,"mat-select",12)(22,"mat-option",13),a(23,"Efectivo"),i(),n(24,"mat-option",14),a(25,"Tarjeta"),i(),n(26,"mat-option",15),a(27,"Cheque"),i(),n(28,"mat-option",16),a(29,"Transferencia"),i()()(),n(30,"div",17)(31,"mat-form-field",9)(32,"mat-label"),a(33,"Base Imponible"),i(),u(34,"input",18),d(35,ti,2,0,"mat-error",8)(36,ii,2,0,"mat-error",8),i(),n(37,"mat-form-field",9)(38,"mat-label"),a(39,"Impuestos (Tasa)"),i(),n(40,"mat-select",19)(41,"mat-option",20),a(42,"Sin Impuesto"),i(),d(43,ni,3,5,"mat-option",7),i(),n(44,"mat-hint",21),a(45),b(46,"number"),i()(),n(47,"mat-form-field",22)(48,"mat-label"),a(49,"Total"),i(),u(50,"input",23),i()(),n(51,"mat-form-field",9)(52,"mat-label"),a(53,"N\xBA Factura"),i(),u(54,"input",24),d(55,ai,2,0,"mat-error",8),i(),n(56,"mat-form-field",4)(57,"mat-label"),a(58,"Notas"),i(),u(59,"textarea",25),i()(),n(60,"div",26)(61,"button",27),g("click",function(){return E(s),S(r.resetForm())}),a(62,"Limpiar"),i(),n(63,"button",28),a(64," Registrar Gasto "),i()(),d(65,oi,4,0,"div",29),i()()}if(o&2){let s,x,C,ie,je,He=te(17);l(),p("formGroup",r.form),l(7),p("formControl",r.expenseFilterCtrl),l(),p("ngForOf",r.filteredExpenses),l(),p("ngIf",(s=r.form.get("idgastos"))==null?null:s.hasError("required")),l(4),p("matDatepicker",He),l(),p("for",He),l(20),p("ngIf",(x=r.form.get("taxbase"))==null?null:x.hasError("required")),l(),p("ngIf",(C=r.form.get("taxbase"))==null?null:C.hasError("min")),l(5),p("value",null),l(2),p("ngForOf",r.taxes),l(2),f("Monto: ",R(46,14,(ie=r.form.get("tax"))==null?null:ie.value,"1.2-2")),l(10),p("ngIf",(je=r.form.get("numberinvoice"))==null?null:je.hasError("required")),l(8),p("disabled",r.form.invalid||r.loading||!r.isCashOpened),l(2),p("ngIf",!r.isCashOpened)}},dependencies:[D,A,oe,Q,z,F,k,H,se,W,U,P,O,L,ue,fe,J,B,N,X,K,j,I,T,y,q,Pe,ke,Le,Oe,me,ce,xt,re,Xe],styles:[".form-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px}.form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.amounts-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px}.full-width[_ngcontent-%COMP%]{width:100%}.total-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-weight:700;color:#3f51b5}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}.frequency-hint[_ngcontent-%COMP%]{color:gray;font-size:.8em}.cash-warning[_ngcontent-%COMP%]{color:#f44336;display:flex;align-items:center;gap:8px;margin-top:10px;padding:10px;background:#ffebee;border-radius:4px}@media(max-width:600px){.amounts-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}return t})();function ri(t,m){if(t&1&&(n(0,"mat-option",12),a(1),i()),t&2){let e=m.$implicit;p("value",e.id),l(),f(" ",e.name," ")}}function li(t,m){t&1&&(n(0,"th",34),a(1," Fecha "),i())}function mi(t,m){if(t&1&&(n(0,"td",35),a(1),b(2,"systemDate"),i()),t&2){let e=m.$implicit;l(),f(" ",ae(2,1,e.date)," ")}}function pi(t,m){t&1&&(n(0,"th",34),a(1," Gasto "),i())}function si(t,m){if(t&1&&(n(0,"td",35),a(1),i()),t&2){let e=m.$implicit;l(),f(" ",e.expense_name," ")}}function di(t,m){t&1&&(n(0,"th",34),a(1," Notas "),i())}function ci(t,m){if(t&1&&(n(0,"td",35),a(1),i()),t&2){let e=m.$implicit;l(),f(" ",e.notes||"-"," ")}}function fi(t,m){t&1&&(n(0,"th",34),a(1," Pago "),i())}function ui(t,m){if(t&1&&(n(0,"td",35),a(1),i()),t&2){let e=m.$implicit,o=G();l(),f(" ",o.getPaymentLabel(e.payment)," ")}}function xi(t,m){t&1&&(n(0,"th",34),a(1," Base "),i())}function gi(t,m){if(t&1&&(n(0,"td",35),a(1),b(2,"number"),i()),t&2){let e=m.$implicit;l(),f(" ",R(2,1,e.taxbase,"1.2-2")," ")}}function _i(t,m){t&1&&(n(0,"th",34),a(1," Imp. "),i())}function hi(t,m){if(t&1&&(n(0,"td",35),a(1),b(2,"number"),i()),t&2){let e=m.$implicit;l(),f(" ",R(2,1,e.tax,"1.2-2")," ")}}function Ci(t,m){t&1&&(n(0,"th",34),a(1," Total "),i())}function Ei(t,m){if(t&1&&(n(0,"td",36),a(1),b(2,"number"),i()),t&2){let e=m.$implicit;l(),f(" ",R(2,1,e.total,"1.2-2")," ")}}function Si(t,m){t&1&&(n(0,"th",34),a(1," Acciones "),i())}function Mi(t,m){if(t&1){let e=$();n(0,"td",35)(1,"button",37),g("click",function(){let r=E(e).$implicit,s=G();return S(s.delete(r))}),n(2,"mat-icon"),a(3,"delete"),i()()()}}function vi(t,m){t&1&&u(0,"tr",38)}function Di(t,m){t&1&&u(0,"tr",39)}var wt=(()=>{class t{fb;displayedColumns=["date","expense_name","notes","payment","taxbase","tax","total","actions"];dailyExpenses=[];expenses=[];totalElements=0;pageSize=50;filterForm;dailyExpenseService=c(qe);expenseService=c(V);snackBar=c(w);constructor(e){this.fb=e;let o=new Date,r=new Date(o.getFullYear(),o.getMonth(),1);this.filterForm=this.fb.group({startDate:[r],endDate:[o],search:[""],idgastos:[null]})}ngOnInit(){this.loadExpenseTypes(),this.loadExpenses()}loadExpenseTypes(){this.expenseService.getAll(1,100).subscribe(e=>{this.expenses=e.data})}loadExpenses(e=1){let o=this.filterForm.value,r={page:e,limit:this.pageSize,search:o.search,startDate:o.startDate?o.startDate.toISOString():void 0,endDate:o.endDate?o.endDate.toISOString():void 0,idgastos:o.idgastos};this.dailyExpenseService.getAll(r).subscribe(s=>{this.dailyExpenses=s.data,this.totalElements=s.total})}onPageChange(e){this.loadExpenses(e.pageIndex+1)}resetFilters(){let e=new Date,o=new Date(e.getFullYear(),e.getMonth(),1);this.filterForm.reset({startDate:o,endDate:e,search:"",idgastos:null}),this.loadExpenses()}delete(e){confirm("\xBFEst\xE1 seguro que desea eliminar este registro de gasto?")&&this.dailyExpenseService.delete(e.id).subscribe({next:()=>{this.snackBar.open("Registro eliminado","Cerrar",{duration:3e3}),this.loadExpenses()},error:o=>{console.error(o),this.snackBar.open("Error al eliminar registro","Cerrar",{duration:3e3})}})}getPaymentLabel(e){return{cash:"Efectivo",magcard:"Tarjeta",check:"Cheque",transfer:"Transferencia"}[e]||e}getTotalPeriod(){return this.dailyExpenses.reduce((e,o)=>e+Number(o.total),0)}static \u0275fac=function(o){return new(o||t)(ee(Y))};static \u0275cmp=v({type:t,selectors:[["app-daily-expense-list"]],decls:68,vars:16,consts:[["startPicker",""],["endPicker",""],[1,"filter-container"],[1,"filter-form",3,"formGroup"],["appearance","outline",1,"small-field"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],["appearance","outline",1,"search-field"],["matInput","","formControlName","search","placeholder","Gasto o nota"],["appearance","outline"],["formControlName","idgastos"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-actions"],["mat-raised-button","","color","primary",3,"click"],["mat-button","",3,"click"],[1,"table-container","mat-elevation-z2"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","expense_name"],["matColumnDef","notes"],["matColumnDef","payment"],["matColumnDef","taxbase"],["matColumnDef","tax"],["matColumnDef","total"],["mat-cell","","class","total-cell",4,"matCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize"],[1,"totals-footer"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"total-cell"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,r){if(o&1){let s=$();n(0,"div",2)(1,"form",3)(2,"mat-form-field",4)(3,"mat-label"),a(4,"Desde"),i(),u(5,"input",5)(6,"mat-datepicker-toggle",6)(7,"mat-datepicker",null,0),i(),n(9,"mat-form-field",4)(10,"mat-label"),a(11,"Hasta"),i(),u(12,"input",7)(13,"mat-datepicker-toggle",6)(14,"mat-datepicker",null,1),i(),n(16,"mat-form-field",8)(17,"mat-label"),a(18,"Buscar..."),i(),u(19,"input",9),i(),n(20,"mat-form-field",10)(21,"mat-label"),a(22,"Tipo de Gasto"),i(),n(23,"mat-select",11)(24,"mat-option",12),a(25,"Todos"),i(),d(26,ri,2,2,"mat-option",13),i()(),n(27,"div",14)(28,"button",15),g("click",function(){return E(s),S(r.loadExpenses())}),n(29,"mat-icon"),a(30,"search"),i(),a(31," Filtrar "),i(),n(32,"button",16),g("click",function(){return E(s),S(r.resetFilters())}),n(33,"mat-icon"),a(34,"clear"),i()()()()(),n(35,"div",17)(36,"table",18),_(37,19),d(38,li,2,0,"th",20)(39,mi,3,3,"td",21),h(),_(40,22),d(41,pi,2,0,"th",20)(42,si,2,1,"td",21),h(),_(43,23),d(44,di,2,0,"th",20)(45,ci,2,1,"td",21),h(),_(46,24),d(47,fi,2,0,"th",20)(48,ui,2,1,"td",21),h(),_(49,25),d(50,xi,2,0,"th",20)(51,gi,3,4,"td",21),h(),_(52,26),d(53,_i,2,0,"th",20)(54,hi,3,4,"td",21),h(),_(55,27),d(56,Ci,2,0,"th",20)(57,Ei,3,4,"td",28),h(),_(58,29),d(59,Si,2,0,"th",20)(60,Mi,4,0,"td",21),h(),d(61,vi,1,0,"tr",30)(62,Di,1,0,"tr",31),i(),n(63,"app-shared-paginator",32),g("page",function(C){return E(s),S(r.onPageChange(C))}),i(),n(64,"div",33)(65,"strong"),a(66),b(67,"number"),i()()()}if(o&2){let s=te(8),x=te(15);l(),p("formGroup",r.filterForm),l(4),p("matDatepicker",s),l(),p("for",s),l(6),p("matDatepicker",x),l(),p("for",x),l(11),p("value",null),l(2),p("ngForOf",r.expenses),l(10),p("dataSource",r.dailyExpenses),l(25),p("matHeaderRowDef",r.displayedColumns),l(),p("matRowDefColumns",r.displayedColumns),l(),p("length",r.totalElements)("pageSize",r.pageSize),l(3),f("Total Periodo: ",R(67,13,r.getTotalPeriod(),"1.2-2"))}},dependencies:[D,A,de,z,F,k,H,Q,W,U,Te,_e,Ce,ve,Ee,he,De,Se,Me,ye,be,Ie,we,I,T,pe,y,q,B,N,O,L,J,P,Pe,ke,Le,Oe,me,X,K,j,ge,xe,re,rt],styles:[".filter-container[_ngcontent-%COMP%]{margin-bottom:20px;padding:10px;background-color:#f5f5f5;border-radius:4px}.filter-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;align-items:flex-start}.small-field[_ngcontent-%COMP%]{width:140px}.search-field[_ngcontent-%COMP%]{flex:1;min-width:200px}.filter-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:5px}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}.total-cell[_ngcontent-%COMP%]{font-weight:700}.totals-footer[_ngcontent-%COMP%]{padding:15px;text-align:right;font-size:1.2em;background-color:#e0f7fa;margin-top:10px}"]})}return t})();function yi(t,m){t&1&&(n(0,"mat-icon",5),a(1,"category"),i(),a(2," Definir Gastos "))}function bi(t,m){t&1&&(n(0,"mat-icon",5),a(1,"add_circle"),i(),a(2," Registrar Gasto "))}function Ti(t,m){t&1&&(n(0,"mat-icon",5),a(1,"list_alt"),i(),a(2," Consultar Gastos "))}var Ca=(()=>{class t{ngOnInit(){}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=v({type:t,selectors:[["app-expenses"]],decls:23,vars:0,consts:[[1,"container"],[1,"main-card"],["animationDuration","300ms"],["mat-tab-label",""],[1,"tab-content"],[1,"tab-icon"]],template:function(o,r){o&1&&(n(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon"),a(5,"receipt_long"),i(),a(6," Gesti\xF3n de Gastos "),i(),n(7,"mat-card-subtitle"),a(8,"Administre tipos de gastos y registre gastos diarios"),i()(),n(9,"mat-card-content")(10,"mat-tab-group",2)(11,"mat-tab"),d(12,yi,3,0,"ng-template",3),n(13,"div",4),u(14,"app-expense-definition-list"),i()(),n(15,"mat-tab"),d(16,bi,3,0,"ng-template",3),n(17,"div",4),u(18,"app-daily-expense-form"),i()(),n(19,"mat-tab"),d(20,Ti,3,0,"ng-template",3),n(21,"div",4),u(22,"app-daily-expense-list"),i()()()()()())},dependencies:[D,Et,_t,ht,Ct,ce,tt,nt,ot,at,it,y,q,Tt,It,wt],styles:[".container[_ngcontent-%COMP%]{padding:20px}.main-card[_ngcontent-%COMP%]{padding:10px}mat-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px}mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:24px}.tab-icon[_ngcontent-%COMP%]{margin-right:8px}.tab-content[_ngcontent-%COMP%]{padding:20px 0}  .mat-mdc-tab-labels{justify-content:flex-start}  .mat-mdc-tab-label{min-width:160px}"]})}return t})();export{Ca as ExpensesComponent};
