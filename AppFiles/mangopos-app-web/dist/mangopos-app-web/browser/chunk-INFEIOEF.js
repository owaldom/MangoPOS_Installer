import{a as k}from"./chunk-LJW6EPWE.js";import{a as $e,b as Ae}from"./chunk-XEWEKXFC.js";import{a as Re,b as Oe,c as qe,e as Be,f as Ve,g as Pe,h as I}from"./chunk-Z6YHTX75.js";import{a as D,b as w}from"./chunk-26KDQVR5.js";import{a as Ie,b as ke,c as Fe,d as Ne}from"./chunk-N7P7XLP2.js";import{d as L}from"./chunk-GRESZPIF.js";import"./chunk-EQXJNMRX.js";import{b as de,c as se}from"./chunk-APXOZHQA.js";import{a as _e,b as xe,c as Ce,d as ge,e as Te,f as Me,g as he,h as ve,i as Se,j as Ee,k as be,l as ye}from"./chunk-VJGP4MMT.js";import{a as De,b as we}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as ae,c as ne,h as oe}from"./chunk-ZWM7H6SC.js";import"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as j}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as re,c as me,f as le,i as pe,j as ce}from"./chunk-EWTXOCXT.js";import{b as J,d as M,f as K,g as Q,k as U,l as W,n as X,o as Y,u as Z,w as ee,x as te,y as ie}from"./chunk-AVLO2MYP.js";import{a as ue,b as fe}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as z,I as b,K as y}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as A,l as G,t as H,v as E}from"./chunk-ZD4QWOHN.js";import{$ as u,Fb as l,Gb as a,Hb as i,Ib as f,Mb as _,Nb as x,Pb as S,Ub as C,Wa as m,Wb as F,db as B,ea as g,ec as V,fa as T,ic as n,jb as v,kc as s,pb as c,vc as P,wc as $}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function ze(e,o){e&1&&(a(0,"mat-error"),n(1,"Requerido"),i())}function Je(e,o){e&1&&(a(0,"mat-error"),n(1,"Requerido"),i())}function Ke(e,o){if(e&1&&(a(0,"mat-option",15),n(1),i()),e&2){let t=o.$implicit;l("value",t.id),m(),s(" ",t.name," ")}}function Qe(e,o){e&1&&(a(0,"mat-error"),n(1,"Requerido"),i())}function Ue(e,o){e&1&&(a(0,"mat-error"),n(1,"Requerido"),i())}function We(e,o){if(e&1&&(a(0,"mat-option",15),n(1),i()),e&2){let t=o.$implicit;l("value",t.id),m(),s(" ",t.name," ")}}function Xe(e,o){if(e&1&&(a(0,"mat-option",15),n(1),i()),e&2){let t=o.$implicit;l("value",t.id),m(),s(" ",t.name," ")}}function Ye(e,o){e&1&&(a(0,"mat-form-field",23)(1,"mat-label"),n(2,"Orden"),i(),f(3,"input",24),i())}var Ge=(()=>{class e{data;form;isEdit=!1;categories=[];custCategories=[];parentTaxes=[];fb=u(ee);taxService=u(k);snackBar=u(D);dialogRef=u(Re);constructor(t){this.data=t,this.isEdit=!!t,this.form=this.fb.group({name:[t?.name||"",M.required],rate:[t?.rate||0,M.required],category:[t?.category||null,M.required],custcategory:[t?.custcategory||null],parentid:[t?.parentid||null],ratecascade:[t?.ratecascade||!1],rateorder:[t?.rateorder||null],validfrom:[t?new Date(t.validfrom):new Date,M.required]})}ngOnInit(){this.loadDropdowns()}loadDropdowns(){this.taxService.getTaxCategories().subscribe(t=>this.categories=t),this.taxService.getTaxCustCategories().subscribe(t=>this.custCategories=t),this.taxService.getAll().subscribe(t=>{this.isEdit&&this.data?this.parentTaxes=t.filter(p=>p.id!==this.data.id):this.parentTaxes=t})}save(){if(this.form.invalid)return;let t=this.form.value;(this.isEdit?this.taxService.update(this.data.id,t):this.taxService.create(t)).subscribe({next:r=>{this.snackBar.open(this.isEdit?"Impuesto actualizado":"Impuesto creado","Cerrar",{duration:3e3}),this.dialogRef.close(!0)},error:r=>{console.error(r);let d="Error al guardar";r.error&&r.error.error&&(d=r.error.error),this.snackBar.open(d,"Cerrar",{duration:5e3})}})}static \u0275fac=function(p){return new(p||e)(B(Oe))};static \u0275cmp=v({type:e,selectors:[["app-tax-form"]],decls:54,vars:15,consts:[["picker",""],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"row"],["appearance","outline",1,"col-8"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["appearance","outline",1,"col-4"],["matInput","","type","number","formControlName","rate","required","","step","0.01"],["appearance","outline",1,"col-6"],["formControlName","category","required",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","validfrom","required","",3,"matDatepicker"],["matIconSuffix","",3,"for"],["formControlName","custcategory"],[3,"value"],["formControlName","parentid"],[1,"row","checkboxes"],["formControlName","ratecascade"],["appearance","outline","class","small-field",4,"ngIf"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outline",1,"small-field"],["matInput","","type","number","formControlName","rateorder"]],template:function(p,r){if(p&1){let d=S();a(0,"h2",1),n(1),i(),a(2,"form",2),C("ngSubmit",function(){return g(d),T(r.save())}),a(3,"mat-dialog-content")(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),n(7,"Nombre"),i(),f(8,"input",5),c(9,ze,2,0,"mat-error",6),i(),a(10,"mat-form-field",7)(11,"mat-label"),n(12,"Tasa (0.10 = 10%)"),i(),f(13,"input",8),c(14,Je,2,0,"mat-error",6),i()(),a(15,"div",3)(16,"mat-form-field",9)(17,"mat-label"),n(18,"Categor\xEDa"),i(),a(19,"mat-select",10),c(20,Ke,2,2,"mat-option",11),i(),c(21,Qe,2,0,"mat-error",6),i(),a(22,"mat-form-field",9)(23,"mat-label"),n(24,"V\xE1lido Desde"),i(),f(25,"input",12)(26,"mat-datepicker-toggle",13)(27,"mat-datepicker",null,0),c(29,Ue,2,0,"mat-error",6),i()(),a(30,"div",3)(31,"mat-form-field",9)(32,"mat-label"),n(33,"Categor\xEDa Cliente (Opcional)"),i(),a(34,"mat-select",14)(35,"mat-option",15),n(36,"-- Ninguna --"),i(),c(37,We,2,2,"mat-option",11),i()(),a(38,"mat-form-field",9)(39,"mat-label"),n(40,"Impuesto Padre (Opcional)"),i(),a(41,"mat-select",16)(42,"mat-option",15),n(43,"-- Ninguno --"),i(),c(44,Xe,2,2,"mat-option",11),i()()(),a(45,"div",17)(46,"mat-checkbox",18),n(47,"Cascada"),i(),c(48,Ye,4,0,"mat-form-field",19),i()(),a(49,"mat-dialog-actions",20)(50,"button",21),C("click",function(){return g(d),T(r.dialogRef.close())}),n(51,"Cancelar"),i(),a(52,"button",22),n(53,"Guardar"),i()()()}if(p&2){let d,h,N,R,O,q=V(28);m(),s("",r.isEdit?"Editar":"Nuevo"," Impuesto"),m(),l("formGroup",r.form),m(7),l("ngIf",(d=r.form.get("name"))==null?null:d.hasError("required")),m(5),l("ngIf",(h=r.form.get("rate"))==null?null:h.hasError("required")),m(6),l("ngForOf",r.categories),m(),l("ngIf",(N=r.form.get("category"))==null?null:N.hasError("required")),m(4),l("matDatepicker",q),m(),l("for",q),m(3),l("ngIf",(R=r.form.get("validfrom"))==null?null:R.hasError("required")),m(6),l("value",null),m(2),l("ngForOf",r.custCategories),m(5),l("value",null),m(2),l("ngForOf",r.parentTaxes),m(4),l("ngIf",(O=r.form.get("ratecascade"))==null?null:O.value),m(4),l("disabled",r.form.invalid)}},dependencies:[E,A,G,ie,U,J,W,K,Q,Z,Y,X,te,I,Be,Pe,Ve,ce,pe,re,me,le,se,de,y,b,we,De,j,Ae,$e,Ne,Ie,ke,Fe,L,w],styles:[".row[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:5px}.col-8[_ngcontent-%COMP%]{flex:2}.col-4[_ngcontent-%COMP%], .col-6[_ngcontent-%COMP%]{flex:1}.checkboxes[_ngcontent-%COMP%]{align-items:center}.small-field[_ngcontent-%COMP%]{width:100px;margin-left:20px}"]})}return e})();function Ze(e,o){e&1&&(a(0,"th",15),n(1," Nombre "),i())}function et(e,o){if(e&1&&(a(0,"td",16),n(1),i()),e&2){let t=o.$implicit;m(),s(" ",t.name," ")}}function tt(e,o){e&1&&(a(0,"th",15),n(1," Tasa "),i())}function it(e,o){if(e&1&&(a(0,"td",16),n(1),P(2,"percent"),i()),e&2){let t=o.$implicit;m(),s(" ",$(2,1,t.rate)," ")}}function at(e,o){e&1&&(a(0,"th",15),n(1," Categor\xEDa "),i())}function nt(e,o){if(e&1&&(a(0,"td",16),n(1),i()),e&2){let t=o.$implicit;m(),s(" ",t.category_name," ")}}function ot(e,o){e&1&&(a(0,"th",15),n(1," Cat. Cliente "),i())}function rt(e,o){if(e&1&&(a(0,"td",16),n(1),i()),e&2){let t=o.$implicit;m(),s(" ",t.custcategory_name||"-"," ")}}function mt(e,o){e&1&&(a(0,"th",15),n(1," Padre "),i())}function lt(e,o){if(e&1&&(a(0,"td",16),n(1),i()),e&2){let t=o.$implicit;m(),s(" ",t.parent_name||"-"," ")}}function pt(e,o){e&1&&f(0,"th",15)}function ct(e,o){if(e&1){let t=S();a(0,"td",16)(1,"button",17),C("click",function(){let r=g(t).$implicit,d=F();return T(d.openForm(r))}),a(2,"mat-icon"),n(3,"edit"),i()(),a(4,"button",18),C("click",function(){let r=g(t).$implicit,d=F();return T(d.deleteTax(r))}),a(5,"mat-icon"),n(6,"delete"),i()()()}}function dt(e,o){e&1&&f(0,"tr",19)}function st(e,o){e&1&&f(0,"tr",20)}function ut(e,o){e&1&&(a(0,"tr",21)(1,"td",22),n(2,"No hay impuestos registrados"),i()())}var Xt=(()=>{class e{taxes=[];displayedColumns=["name","rate","category","custcategory","parent","actions"];taxService=u(k);dialog=u(qe);snackBar=u(D);ngOnInit(){this.loadTaxes()}loadTaxes(){this.taxService.getAll().subscribe({next:t=>{this.taxes=t},error:t=>{console.error(t),this.snackBar.open("Error al cargar impuestos","Cerrar",{duration:3e3})}})}openForm(t){this.dialog.open(Ge,{width:"600px",data:t||null}).afterClosed().subscribe(r=>{r&&this.loadTaxes()})}deleteTax(t){confirm(`\xBFEst\xE1s seguro de eliminar el impuesto "${t.name}"?`)&&this.taxService.delete(t.id).subscribe({next:()=>{this.snackBar.open("Impuesto eliminado","Cerrar",{duration:3e3}),this.loadTaxes()},error:p=>{console.error(p),this.snackBar.open("Error al eliminar: "+p.message,"Cerrar",{duration:5e3})}})}static \u0275fac=function(p){return new(p||e)};static \u0275cmp=v({type:e,selectors:[["app-taxes"]],decls:32,vars:3,consts:[[1,"container"],[1,"header"],["mat-raised-button","","color","primary",3,"click"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","rate"],["matColumnDef","category"],["matColumnDef","custcategory"],["matColumnDef","parent"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"]],template:function(p,r){p&1&&(a(0,"div",0)(1,"div",1)(2,"h2"),n(3,"Gesti\xF3n de Impuestos"),i(),a(4,"button",2),C("click",function(){return r.openForm()}),a(5,"mat-icon"),n(6,"add"),i(),n(7," Nuevo Impuesto "),i()(),a(8,"mat-card")(9,"mat-card-content")(10,"table",3),_(11,4),c(12,Ze,2,0,"th",5)(13,et,2,1,"td",6),x(),_(14,7),c(15,tt,2,0,"th",5)(16,it,3,3,"td",6),x(),_(17,8),c(18,at,2,0,"th",5)(19,nt,2,1,"td",6),x(),_(20,9),c(21,ot,2,0,"th",5)(22,rt,2,1,"td",6),x(),_(23,10),c(24,mt,2,0,"th",5)(25,lt,2,1,"td",6),x(),_(26,11),c(27,pt,1,0,"th",5)(28,ct,7,0,"td",6),x(),c(29,dt,1,0,"tr",12)(30,st,1,0,"tr",13)(31,ut,3,0,"tr",14),i()()()()),p&2&&(m(10),l("dataSource",r.taxes),m(19),l("matHeaderRowDef",r.displayedColumns),m(),l("matRowDefColumns",r.displayedColumns))},dependencies:[E,ye,_e,Ce,he,ge,xe,ve,Te,Me,Se,Ee,be,y,b,z,fe,ue,oe,ae,ne,I,w,H],styles:[".container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.full-width[_ngcontent-%COMP%]{width:100%}td.mat-cell[_ngcontent-%COMP%]{padding:8px}"]})}return e})();export{Xt as TaxesComponent};
