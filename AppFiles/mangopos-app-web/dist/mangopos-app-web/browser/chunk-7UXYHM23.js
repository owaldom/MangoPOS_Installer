import{a as ae}from"./chunk-BK63NQ7D.js";import{a as ge}from"./chunk-YSABNZJU.js";import{a as Ue,b as ze,c as Le}from"./chunk-HIZ742YJ.js";import{a as Y}from"./chunk-XGFVHFBN.js";import"./chunk-6OXQWIOV.js";import{a as Ke}from"./chunk-RFRKPPY3.js";import{a as Ae,c as Ge,e as Qe,f as Ye,g as Je,h as oe}from"./chunk-Z6YHTX75.js";import{a as Ce,b as Me}from"./chunk-26KDQVR5.js";import{a as Z}from"./chunk-DGQM6DPS.js";import"./chunk-SCPRHZYR.js";import{a as ee,b as te,c as ie,d as ne}from"./chunk-N7P7XLP2.js";import{d as R}from"./chunk-GRESZPIF.js";import"./chunk-EQXJNMRX.js";import{b as L,c as A}from"./chunk-APXOZHQA.js";import{a as ke,b as Pe,c as Ve,d as Oe,e as Ne,f as Re,g as $e,h as Be,i as qe,j as We,l as je,m as He}from"./chunk-VJGP4MMT.js";import{a as J,b as K}from"./chunk-VNZMNOUU.js";import{a as X}from"./chunk-YCMZOG5D.js";import{a as Te,c as Fe,h as Ie}from"./chunk-ZWM7H6SC.js";import"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as N}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as j,f as H,i as U,j as z}from"./chunk-EWTXOCXT.js";import{b as q,d as y,f as W,g as _e,j as ve,k as ye,n as Se,o as be,u as xe,w as De,x as we,y as Ee}from"./chunk-AVLO2MYP.js";import{a as G,b as Q}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{I as $,K as B}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import{d as O}from"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as P,l as he,r as le,s as T,v as V}from"./chunk-ZD4QWOHN.js";import{$ as f,$b as pe,Fb as d,Gb as n,Hb as t,Ib as M,Mb as _,Nb as v,Pb as I,Ub as C,Wa as m,Wb as k,_b as se,ac as de,ea as u,ec as x,fa as h,gc as re,ic as a,jb as F,kc as S,lc as b,nc as D,oc as w,pb as g,pc as E,rc as ce,vc as me,wc as fe,xc as ue}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function lt(i,p){if(i&1&&(n(0,"mat-option",19),a(1),t()),i&2){let e=p.$implicit;d("value",e.id),m(),b(" ",e.name," (",e.symbol,") ")}}function st(i,p){i&1&&(n(0,"div",20)(1,"mat-icon"),a(2,"info"),t(),n(3,"span"),a(4,"No hay una sesi\xF3n de caja abierta. El movimiento se registrar\xE1 sin asociar a una sesi\xF3n."),t()())}function pt(i,p){if(i&1&&(n(0,"div",21)(1,"mat-icon"),a(2,"check_circle"),t(),n(3,"span"),a(4),t()()),i&2){let e=k();m(4),b("Sesi\xF3n activa: ",e.cashSession.host," #",e.cashSession.hostsequence)}}var Xe=(()=>{class i{form;cashSession=null;currencies=[];fb=f(De);cashService=f(ae);authService=f(ge);http=f(O);dialogRef=f(Ae);settingsService=f(Z);constructor(){this.form=this.fb.group({date:[new Date,y.required],movementType:["IN",y.required],amount:[0,[y.required,y.min(.01)]],currencyId:[1,y.required],concept:["",y.required]})}ngOnInit(){this.http.get(`${X.apiUrl}/sales/currencies`).subscribe(e=>{if(this.currencies=e,this.cashSession?.currency_id)this.form.patchValue({currencyId:this.cashSession.currency_id});else if(e.length>0){let r=e.find(o=>o.is_base)||e[0];this.form.patchValue({currencyId:r.id})}}),this.cashService.currentSession$.subscribe(e=>{this.cashSession=e,e?.currency_id&&this.currencies.length>0&&this.form.patchValue({currencyId:e.currency_id})})}onSubmit(){if(this.form.valid){let e=this.form.value,r=this.authService.getCurrentUser(),o={date:e.date,movementType:e.movementType,amount:e.amount,concept:e.concept,moneyId:this.cashSession?.money||null,currencyId:e.currencyId,person:r?.id||null};this.dialogRef.close(o)}}static \u0275fac=function(r){return new(r||i)};static \u0275cmp=F({type:i,selectors:[["app-cash-movement-form"]],decls:39,vars:7,consts:[["picker",""],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"dialog-content"],["appearance","outline",1,"full-width"],["matInput","","formControlName","date","required","",3,"matDatepicker"],["matIconSuffix","",3,"for"],["formControlName","movementType","required",""],["value","IN"],["value","OUT"],["matInput","","type","text","formControlName","amount","required","","appMoneyInput","","decimalType","total"],["formControlName","currencyId","required",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","concept","rows","3","required",""],["class","info-box",4,"ngIf"],["class","info-box success",4,"ngIf"],["align","end"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[3,"value"],[1,"info-box"],[1,"info-box","success"]],template:function(r,o){if(r&1){let s=I();n(0,"h2",1),a(1,"Nuevo Movimiento de Caja"),t(),n(2,"form",2),C("ngSubmit",function(){return u(s),h(o.onSubmit())}),n(3,"mat-dialog-content",3)(4,"mat-form-field",4)(5,"mat-label"),a(6,"Fecha"),t(),M(7,"input",5)(8,"mat-datepicker-toggle",6)(9,"mat-datepicker",null,0),t(),n(11,"mat-form-field",4)(12,"mat-label"),a(13,"Tipo de Movimiento"),t(),n(14,"mat-select",7)(15,"mat-option",8),a(16,"Entrada de Efectivo"),t(),n(17,"mat-option",9),a(18,"Salida de Efectivo"),t()()(),n(19,"mat-form-field",4)(20,"mat-label"),a(21,"Monto"),t(),M(22,"input",10),t(),n(23,"mat-form-field",4)(24,"mat-label"),a(25,"Moneda"),t(),n(26,"mat-select",11),g(27,lt,2,3,"mat-option",12),t()(),n(28,"mat-form-field",4)(29,"mat-label"),a(30,"Concepto / Descripci\xF3n"),t(),M(31,"textarea",13),t(),g(32,st,5,0,"div",14)(33,pt,5,2,"div",15),t(),n(34,"mat-dialog-actions",16)(35,"button",17),C("click",function(){return u(s),h(o.dialogRef.close())}),a(36,"Cancelar"),t(),n(37,"button",18),a(38,"Registrar"),t()()()}if(r&2){let s=x(10);m(2),d("formGroup",o.form),m(5),d("matDatepicker",s),m(),d("for",s),m(19),d("ngForOf",o.currencies),m(5),d("ngIf",!o.cashSession),m(),d("ngIf",o.cashSession),m(4),d("disabled",o.form.invalid)}},dependencies:[V,P,he,Ee,ye,q,W,_e,xe,be,Se,oe,Qe,Je,Ye,z,U,j,H,A,L,B,$,K,J,N,ne,ee,te,ie,R,Q,G,Ke],styles:[".dialog-content[_ngcontent-%COMP%]{min-width:500px;display:flex;flex-direction:column;gap:16px;padding-top:10px}.full-width[_ngcontent-%COMP%]{width:100%}.info-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;border-radius:4px;background:#fff3cd;border:1px solid #ffc107;color:#856404}.info-box.success[_ngcontent-%COMP%]{background:#d4edda;border-color:#28a745;color:#155724}.info-box[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}"]})}return i})();function dt(i,p){if(i&1&&(n(0,"mat-option",13),a(1),t()),i&2){let e=p.$implicit;d("value",e.id),m(),b(" ",e.name," (",e.symbol,") ")}}function ct(i,p){i&1&&(n(0,"th",31),a(1," Fecha "),t())}function ft(i,p){if(i&1&&(n(0,"td",32),a(1),me(2,"systemDate"),t()),i&2){let e=p.$implicit;m(),S(" ",fe(2,1,e.datenew)," ")}}function ut(i,p){i&1&&(n(0,"th",31),a(1," Tipo "),t())}function ht(i,p){if(i&1&&(n(0,"td",32)(1,"span"),a(2),t()()),i&2){let e=p.$implicit;m(),re("type-in",e.movement_type==="IN")("type-out",e.movement_type==="OUT"),m(),S(" ",e.movement_type==="IN"?"Entrada":"Salida"," ")}}function gt(i,p){i&1&&(n(0,"th",31),a(1," Monto "),t())}function Ct(i,p){if(i&1&&(n(0,"td",32),a(1),me(2,"number"),t()),i&2){let e=p.$implicit,r=k();re("amount-in",e.movement_type==="IN")("amount-out",e.movement_type==="OUT"),m(),b(" ",e.currency_symbol||"$"," ",ue(2,6,e.amount,r.settingsService.getDecimalFormat("total"))," ")}}function Mt(i,p){i&1&&(n(0,"th",31),a(1," Concepto "),t())}function _t(i,p){if(i&1&&(n(0,"td",32),a(1),t()),i&2){let e=p.$implicit;m(),S(" ",e.concept||"-"," ")}}function vt(i,p){i&1&&(n(0,"th",31),a(1," Usuario "),t())}function yt(i,p){if(i&1&&(n(0,"td",32),a(1),t()),i&2){let e=p.$implicit;m(),S(" ",e.person_name||"-"," ")}}function St(i,p){i&1&&(n(0,"th",31),a(1," Sesi\xF3n "),t())}function bt(i,p){if(i&1&&(n(0,"td",32),a(1),t()),i&2){let e=p.$implicit;m(),S(" ",e.host?e.host+" #"+e.hostsequence:"-"," ")}}function xt(i,p){i&1&&M(0,"tr",33)}function Dt(i,p){i&1&&M(0,"tr",34)}var Mi=(()=>{class i{displayedColumns=["date","type","amount","concept","person","session"];dataSource=new He([]);totalElements=0;pageSize=50;filterStartDate=null;filterEndDate=null;filterType=null;filterCurrency=null;currencies=[];paginator;cashService=f(ae);dialog=f(Ge);snackBar=f(Ce);http=f(O);settingsService=f(Z);datePipe=f(le);decimalPipe=f(T);systemDatePipe=f(Y);ngOnInit(){this.loadCurrencies(),this.loadMovements(1)}loadMovements(e){let r={};this.filterStartDate&&(r.startDate=this.formatDate(this.filterStartDate)),this.filterEndDate&&(r.endDate=this.formatDate(this.filterEndDate)),this.filterType&&(r.movementType=this.filterType),this.filterCurrency&&(r.currencyId=this.filterCurrency),this.cashService.getCashMovements(e,this.pageSize,r).subscribe(o=>{this.dataSource.data=o.data,this.totalElements=o.total})}onPageChange(e){this.loadMovements(e.pageIndex+1)}applyFilters(){this.loadMovements(1)}clearFilters(){this.filterStartDate=null,this.filterEndDate=null,this.filterType=null,this.filterCurrency=null,this.loadMovements(1)}loadCurrencies(){this.http.get(`${X.apiUrl}/sales/currencies`).subscribe(e=>{this.currencies=e})}openForm(){this.dialog.open(Xe,{width:"600px",maxWidth:"95vw"}).afterClosed().subscribe(r=>{r&&this.cashService.createCashMovement(r).subscribe({next:()=>{this.snackBar.open("Movimiento registrado correctamente","Cerrar",{duration:3e3}),this.loadMovements(1)},error:o=>{this.snackBar.open("Error: "+(o.error?.error||o.message),"Cerrar",{duration:5e3})}})})}formatDate(e){let r=o=>o<10?"0"+o:o;return`${e.getFullYear()}-${r(e.getMonth()+1)}-${r(e.getDate())}`}exportPdf(){let e=window.open("","_blank","width=800,height=600");if(!e)return;let r=this.filterStartDate||this.filterEndDate?`Del ${this.filterStartDate?this.formatDate(this.filterStartDate):"Inicio"} al ${this.filterEndDate?this.formatDate(this.filterEndDate):"Actualidad"}`:"Todo el historial",o=this.dataSource.data.map(l=>`
            <tr>
                <td>${this.systemDatePipe.transform(l.datenew)}</td>
                <td>
                    <span style="color: ${l.movement_type==="IN"?"green":"red"}; font-weight: bold;">
                        ${l.movement_type==="IN"?"Entrada":"Salida"}
                    </span>
                </td>
                <td style="text-align: right;">
                    ${l.currency_symbol} ${this.decimalPipe.transform(l.amount,"1.2-2")}
                </td>
                <td>${l.concept||"-"}</td>
                <td>${l.person_name||"-"}</td>
                <td>${l.host?l.host+" #"+l.hostsequence:"-"}</td>
            </tr>
        `).join(""),s=`
            <html>
            <head>
                <title>Reporte de Movimientos de Caja</title>
                <style>
                    body { font-family: Arial, sans-serif; font-size: 12px; }
                    h1 { text-align: center; color: #333; }
                    .metadata { margin-bottom: 20px; text-align: center; color: #666; }
                    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                    th { background-color: #f2f2f2; font-weight: bold; text-align: center; }
                    tr:nth-child(even) { background-color: #f9f9f9; }
                </style>
            </head>
            <body>
                <h1>Reporte de Movimientos de Caja</h1>
                <div class="metadata">
                    <strong>Rango:</strong> ${r} <br>
                    <strong>Generado:</strong> ${this.systemDatePipe.transform(new Date)}
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Monto</th>
                            <th>Concepto</th>
                            <th>Usuario</th>
                            <th>Sesi\xF3n</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${o}
                    </tbody>
                </table>
                <script>
                    window.onload = function() { window.print(); window.close(); }
                <\/script>
            </body>
            </html>
        `;e.document.write(s),e.document.close()}static \u0275fac=function(r){return new(r||i)};static \u0275cmp=F({type:i,selectors:[["app-cash-movements"]],viewQuery:function(r,o){if(r&1&&se(Ue,5),r&2){let s;pe(s=de())&&(o.paginator=s.first)}},features:[ce([le,T,Y])],decls:75,vars:16,consts:[["pickerStart",""],["pickerEnd",""],[1,"container"],[1,"header"],["mat-flat-button","","color","primary",3,"click"],[1,"actions-row",2,"margin-bottom","20px","display","flex","justify-content","flex-end"],["mat-stroked-button","",3,"click"],[1,"filters-card"],[1,"filters-row"],["appearance","outline"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],[3,"ngModelChange","ngModel"],[3,"value"],["value","IN"],["value","OUT"],[3,"value",4,"ngFor","ngForOf"],[1,"table-container"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","amount"],["mat-cell","",3,"amount-in","amount-out",4,"matCellDef"],["matColumnDef","concept"],["matColumnDef","person"],["matColumnDef","session"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(r,o){if(r&1){let s=I();n(0,"div",2)(1,"div",3)(2,"h1"),a(3,"Movimientos de Caja"),t(),n(4,"button",4),C("click",function(){return u(s),h(o.openForm())}),n(5,"mat-icon"),a(6,"add"),t(),a(7," Nuevo Movimiento "),t()(),n(8,"div",5)(9,"button",6),C("click",function(){return u(s),h(o.exportPdf())}),n(10,"mat-icon"),a(11,"picture_as_pdf"),t(),a(12," Exportar Reporte "),t()(),n(13,"mat-card",7)(14,"mat-card-content")(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),a(18,"Fecha Desde"),t(),n(19,"input",10),E("ngModelChange",function(c){return u(s),w(o.filterStartDate,c)||(o.filterStartDate=c),h(c)}),C("ngModelChange",function(){return u(s),h(o.applyFilters())}),t(),M(20,"mat-datepicker-toggle",11)(21,"mat-datepicker",null,0),t(),n(23,"mat-form-field",9)(24,"mat-label"),a(25,"Fecha Hasta"),t(),n(26,"input",10),E("ngModelChange",function(c){return u(s),w(o.filterEndDate,c)||(o.filterEndDate=c),h(c)}),C("ngModelChange",function(){return u(s),h(o.applyFilters())}),t(),M(27,"mat-datepicker-toggle",11)(28,"mat-datepicker",null,1),t(),n(30,"mat-form-field",9)(31,"mat-label"),a(32,"Tipo"),t(),n(33,"mat-select",12),E("ngModelChange",function(c){return u(s),w(o.filterType,c)||(o.filterType=c),h(c)}),C("ngModelChange",function(){return u(s),h(o.applyFilters())}),n(34,"mat-option",13),a(35,"Todos"),t(),n(36,"mat-option",14),a(37,"Entrada"),t(),n(38,"mat-option",15),a(39,"Salida"),t()()(),n(40,"mat-form-field",9)(41,"mat-label"),a(42,"Moneda"),t(),n(43,"mat-select",12),E("ngModelChange",function(c){return u(s),w(o.filterCurrency,c)||(o.filterCurrency=c),h(c)}),C("ngModelChange",function(){return u(s),h(o.applyFilters())}),n(44,"mat-option",13),a(45,"Todas"),t(),g(46,dt,2,3,"mat-option",16),t()(),n(47,"button",6),C("click",function(){return u(s),h(o.clearFilters())}),n(48,"mat-icon"),a(49,"clear"),t(),a(50," Limpiar Filtros "),t()()()(),n(51,"mat-card")(52,"div",17)(53,"table",18),_(54,19),g(55,ct,2,0,"th",20)(56,ft,3,3,"td",21),v(),_(57,22),g(58,ut,2,0,"th",20)(59,ht,3,5,"td",21),v(),_(60,23),g(61,gt,2,0,"th",20)(62,Ct,3,9,"td",24),v(),_(63,25),g(64,Mt,2,0,"th",20)(65,_t,2,1,"td",21),v(),_(66,26),g(67,vt,2,0,"th",20)(68,yt,2,1,"td",21),v(),_(69,27),g(70,St,2,0,"th",20)(71,bt,2,1,"td",21),v(),g(72,xt,1,0,"tr",28)(73,Dt,1,0,"tr",29),t()(),n(74,"app-shared-paginator",30),C("page",function(c){return u(s),h(o.onPageChange(c))}),t()()()}if(r&2){let s=x(22),l=x(29);m(19),d("matDatepicker",s),D("ngModel",o.filterStartDate),m(),d("for",s),m(6),d("matDatepicker",l),D("ngModel",o.filterEndDate),m(),d("for",l),m(6),D("ngModel",o.filterType),m(),d("value",null),m(9),D("ngModel",o.filterCurrency),m(),d("value",null),m(2),d("ngForOf",o.currencies),m(7),d("dataSource",o.dataSource),m(19),d("matHeaderRowDef",o.displayedColumns),m(),d("matRowDefColumns",o.displayedColumns),m(),d("length",o.totalElements)("pageSize",o.pageSize)}},dependencies:[V,P,we,q,W,ve,je,ke,Ve,$e,Oe,Pe,Be,Ne,Re,qe,We,ze,Le,B,$,Q,G,Ie,Te,Fe,oe,z,U,j,H,A,L,K,J,N,ne,ee,te,ie,R,Me,T,Y],styles:[".container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.filters-card[_ngcontent-%COMP%]{margin-bottom:20px}.filters-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;flex-wrap:wrap}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.type-in[_ngcontent-%COMP%]{color:#388e3c;font-weight:500}.type-out[_ngcontent-%COMP%]{color:#d32f2f;font-weight:500}.amount-in[_ngcontent-%COMP%]{color:#388e3c;font-weight:700}.amount-out[_ngcontent-%COMP%]{color:#d32f2f;font-weight:700}"]})}return i})();export{Mi as CashMovementsComponent};
