import{a as $}from"./chunk-7MVBSPFH.js";import{a as J}from"./chunk-6OXQWIOV.js";import{a as Tt,b as Ot,c as Ft,e as kt,f as Rt,g as Nt,h as A}from"./chunk-Z6YHTX75.js";import{a as T,b as O}from"./chunk-26KDQVR5.js";import{a as gt}from"./chunk-SCPRHZYR.js";import{b as st,c as pt}from"./chunk-APXOZHQA.js";import{a as ht,b as Pt,c as Mt,d as xt,e as vt,f as Et,g as St,h as bt,i as wt,j as Dt,k as yt,l as It}from"./chunk-VJGP4MMT.js";import{a as V,b as q}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as rt,b as at,c as dt,f as mt,h as lt}from"./chunk-ZWM7H6SC.js";import{a as Ct}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as D}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as R,c as ct,d as ut,i as N,j as B}from"./chunk-EWTXOCXT.js";import{b as Q,d as g,f as F,g as W,i as X,k as Y,l as Z,m as tt,n as et,o as ot,t as nt,w as it,y as k}from"./chunk-AVLO2MYP.js";import{a as ft,b as _t}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as K,I as y,K as I}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as S,l as b,v as w}from"./chunk-ZD4QWOHN.js";import{$ as s,Fb as l,Gb as n,Hb as o,Ib as h,Mb as _,Nb as C,Pb as H,Ub as f,Wa as d,Wb as P,db as z,ea as M,fa as x,ic as i,jb as v,kc as p,lc as E,pb as c}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function jt(e,a){if(e&1&&(n(0,"mat-option",13),i(1),o()),e&2){let t=a.$implicit;l("value",t.id),d(),E(" ",t.name," (",t.reference,") ")}}function Gt(e,a){e&1&&(n(0,"mat-error"),i(1," El insumo es obligatorio "),o())}function Lt(e,a){e&1&&(n(0,"mat-error"),i(1," La cantidad es obligatoria "),o())}function zt(e,a){e&1&&(n(0,"mat-error"),i(1," La cantidad debe ser mayor a 0 "),o())}function Jt(e,a){if(e&1&&(n(0,"mat-option",13),i(1),o()),e&2){let t=a.$implicit;l("value",t.code),d(),p(" ",t.name," ")}}function Kt(e,a){e&1&&(n(0,"mat-error"),i(1," La unidad del producto es obligatoria "),o())}function Qt(e,a){if(e&1&&(n(0,"mat-option",13),i(1),o()),e&2){let t=a.$implicit;l("value",t.code),d(),p(" ",t.name," ")}}function Wt(e,a){e&1&&(n(0,"mat-error"),i(1," La unidad del insumo es obligatoria "),o())}var Bt=(()=>{class e{data;form;insumos=[];unidades=[];saving=!1;fb=s(it);compoundProductsService=s($);snackBar=s(T);dialogRef=s(Tt);constructor(t){this.data=t,this.form=this.fb.group({idinsumo:[null,g.required],cantidad:[null,[g.required,g.min(.01)]],unidadproduct:[null,g.required],unidadinsumo:[null,g.required]})}ngOnInit(){this.loadInsumos(),this.loadUnidades(),this.data.compoundProduct&&this.form.patchValue({idinsumo:this.data.compoundProduct.idinsumo,cantidad:this.data.compoundProduct.cantidad,unidadproduct:this.data.compoundProduct.unidadproduct,unidadinsumo:this.data.compoundProduct.unidadinsumo})}loadInsumos(){this.compoundProductsService.getInsumos().subscribe({next:t=>{this.insumos=t},error:t=>{console.error("Error cargando insumos",t),this.showError("Error al cargar insumos")}})}loadUnidades(){this.compoundProductsService.getUnidades().subscribe({next:t=>{this.unidades=t},error:t=>{console.error("Error cargando unidades",t),this.showError("Error al cargar unidades")}})}onSave(){if(this.form.valid){this.saving=!0;let t=this.form.value,m={idproduct:this.data.productId,idinsumo:t.idinsumo,cantidad:t.cantidad,unidadproduct:t.unidadproduct,unidadinsumo:t.unidadinsumo,nameinsumo:""};this.data.compoundProduct?this.compoundProductsService.updateCompoundProduct(this.data.compoundProduct.id,m).subscribe({next:()=>{this.showSuccess("Insumo actualizado correctamente"),this.dialogRef.close(!0)},error:r=>{this.saving=!1,this.showError("Error al actualizar: "+r.error?.error)}}):this.compoundProductsService.createCompoundProduct(m).subscribe({next:()=>{this.showSuccess("Insumo agregado correctamente"),this.dialogRef.close(!0)},error:r=>{this.saving=!1,this.showError("Error al crear: "+r.error?.error)}})}}onCancel(){this.dialogRef.close(!1)}showSuccess(t){this.snackBar.open(t,"Cerrar",{duration:3e3})}showError(t){this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(m){return new(m||e)(z(Ot))};static \u0275cmp=v({type:e,selectors:[["app-compound-product-dialog"]],decls:37,vars:13,consts:[["mat-dialog-title",""],[3,"formGroup"],["appearance","outline",1,"full-width"],["formControlName","idinsumo",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","number","formControlName","cantidad","step","0.01","min","0.01"],["formControlName","unidadproduct"],["formControlName","unidadinsumo"],[1,"required-note"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"value"]],template:function(m,r){if(m&1&&(n(0,"h2",0),i(1),o(),n(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),i(6,"Insumo *"),o(),n(7,"mat-select",3),c(8,jt,2,3,"mat-option",4),o(),c(9,Gt,2,0,"mat-error",5),o(),n(10,"mat-form-field",2)(11,"mat-label"),i(12,"Cantidad *"),o(),h(13,"input",6),n(14,"mat-hint"),i(15,"Use coma (,) como separador decimal. Ej: 25,76"),o(),c(16,Lt,2,0,"mat-error",5)(17,zt,2,0,"mat-error",5),o(),n(18,"mat-form-field",2)(19,"mat-label"),i(20,"Unidad del Producto *"),o(),n(21,"mat-select",7),c(22,Jt,2,2,"mat-option",4),o(),c(23,Kt,2,0,"mat-error",5),o(),n(24,"mat-form-field",2)(25,"mat-label"),i(26,"Unidad del Insumo *"),o(),n(27,"mat-select",8),c(28,Qt,2,2,"mat-option",4),o(),c(29,Wt,2,0,"mat-error",5),o(),n(30,"p",9),i(31,"* Campos obligatorios"),o()()(),n(32,"mat-dialog-actions",10)(33,"button",11),f("click",function(){return r.onCancel()}),i(34,"Cancelar"),o(),n(35,"button",12),f("click",function(){return r.onSave()}),i(36),o()()),m&2){let u,U,j,G,L;d(),p("",r.data.compoundProduct?"Editar":"Agregar"," Insumo"),d(2),l("formGroup",r.form),d(4),l("disabled",!!r.data.compoundProduct),d(),l("ngForOf",r.insumos),d(),l("ngIf",(u=r.form.get("idinsumo"))==null?null:u.hasError("required")),d(7),l("ngIf",(U=r.form.get("cantidad"))==null?null:U.hasError("required")),d(),l("ngIf",(j=r.form.get("cantidad"))==null?null:j.hasError("min")),d(5),l("ngForOf",r.unidades),d(),l("ngIf",(G=r.form.get("unidadproduct"))==null?null:G.hasError("required")),d(5),l("ngForOf",r.unidades),d(),l("ngIf",(L=r.form.get("unidadinsumo"))==null?null:L.hasError("required")),d(6),l("disabled",!r.form.valid||r.saving),d(),p(" ",r.saving?"Guardando...":"Guardar"," ")}},dependencies:[w,S,b,k,Y,Q,Z,F,W,nt,ot,et,A,kt,Nt,Rt,I,y,B,N,R,ut,ct,pt,st,q,V,D,O],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;padding-top:20px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.required-note[_ngcontent-%COMP%]{color:#0000008a;font-size:12px;margin-top:8px}"]})}return e})();function Xt(e,a){if(e&1&&(n(0,"mat-option",8),i(1),o()),e&2){let t=a.$implicit;l("value",t.id),d(),E(" ",t.name," (",t.reference,") ")}}function Yt(e,a){e&1&&(n(0,"th",22),i(1," Insumo "),o())}function Zt(e,a){if(e&1&&(n(0,"td",23),i(1),o()),e&2){let t=a.$implicit;d(),p(" ",t.nameinsumo||t.insumo_name," ")}}function te(e,a){e&1&&(n(0,"th",22),i(1," Cantidad "),o())}function ee(e,a){if(e&1&&(n(0,"td",23),i(1),o()),e&2){let t=a.$implicit;d(),p(" ",t.cantidad," ")}}function oe(e,a){e&1&&(n(0,"th",22),i(1," Unidad Producto "),o())}function ne(e,a){if(e&1&&(n(0,"td",23),i(1),o()),e&2){let t=a.$implicit;d(),p(" ",t.unidad_product_name||t.unidadproduct," ")}}function ie(e,a){e&1&&(n(0,"th",22),i(1," Unidad Insumo "),o())}function re(e,a){if(e&1&&(n(0,"td",23),i(1),o()),e&2){let t=a.$implicit;d(),p(" ",t.unidad_insumo_name||t.unidadinsumo," ")}}function ae(e,a){e&1&&(n(0,"th",22),i(1," Acciones "),o())}function de(e,a){if(e&1){let t=H();n(0,"td",23)(1,"button",24),f("click",function(){let r=M(t).$implicit,u=P(2);return x(u.openDialog(r))}),n(2,"mat-icon"),i(3,"edit"),o()(),n(4,"button",25),f("click",function(){let r=M(t).$implicit,u=P(2);return x(u.deleteCompoundProduct(r))}),n(5,"mat-icon"),i(6,"delete"),o()()()}}function me(e,a){e&1&&h(0,"tr",26)}function le(e,a){e&1&&h(0,"tr",27)}function ce(e,a){e&1&&(n(0,"tr",28)(1,"td",29),i(2,"No hay insumos configurados para este producto"),o()())}function ue(e,a){if(e&1){let t=H();n(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),i(3," Insumos del Producto "),n(4,"button",9),f("click",function(){M(t);let r=P();return x(r.openDialog())}),n(5,"mat-icon"),i(6,"add"),o(),i(7," Agregar Insumo "),o()()(),n(8,"mat-card-content")(9,"div",10)(10,"table",11),_(11,12),c(12,Yt,2,0,"th",13)(13,Zt,2,1,"td",14),C(),_(14,15),c(15,te,2,0,"th",13)(16,ee,2,1,"td",14),C(),_(17,16),c(18,oe,2,0,"th",13)(19,ne,2,1,"td",14),C(),_(20,17),c(21,ie,2,0,"th",13)(22,re,2,1,"td",14),C(),_(23,18),c(24,ae,2,0,"th",13)(25,de,7,0,"td",14),C(),c(26,me,1,0,"tr",19)(27,le,1,0,"tr",20)(28,ce,3,0,"tr",21),o()()()()}if(e&2){let t=P();d(10),l("dataSource",t.compoundProducts),d(16),l("matHeaderRowDef",t.displayedColumns),d(),l("matRowDefColumns",t.displayedColumns)}}function se(e,a){e&1&&(n(0,"div",30)(1,"mat-icon"),i(2,"inventory_2"),o(),n(3,"p"),i(4,"Seleccione un producto para configurar sus insumos"),o()())}var Ke=(()=>{class e{products=[];compoundProducts=[];selectedProductControl=new X(null);displayedColumns=["insumo","cantidad","unidadproduct","unidadinsumo","actions"];compoundProductsService=s($);dialog=s(Ft);snackBar=s(T);route=s(J);ngOnInit(){this.loadProducts(),this.route.queryParams.subscribe(t=>{t.id&&(this.selectedProductControl.setValue(+t.id),this.loadCompoundProducts(+t.id))})}loadProducts(){this.compoundProductsService.getProductsForCompounds(1,100).subscribe({next:t=>{this.products=t.data},error:t=>console.error("Error cargando productos",t)})}onProductChange(){let t=this.selectedProductControl.value;t?this.loadCompoundProducts(t):this.compoundProducts=[]}loadCompoundProducts(t){this.compoundProductsService.getCompoundProducts(t).subscribe({next:m=>{this.compoundProducts=m},error:m=>{console.error("Error cargando productos compuestos",m),this.showError("Error al cargar insumos")}})}openDialog(t){let m=this.selectedProductControl.value;if(!m){this.showError("Debe seleccionar un producto primero");return}this.dialog.open(Bt,{width:"600px",data:{compoundProduct:t,productId:m}}).afterClosed().subscribe(u=>{u&&this.loadCompoundProducts(m)})}deleteCompoundProduct(t){confirm(`\xBFEst\xE1 seguro de eliminar el insumo "${t.nameinsumo}"?`)&&this.compoundProductsService.deleteCompoundProduct(t.id).subscribe({next:()=>{this.showSuccess("Insumo eliminado correctamente"),this.loadCompoundProducts(this.selectedProductControl.value)},error:m=>this.showError("Error al eliminar: "+m.error?.error)})}showSuccess(t){this.snackBar.open(t,"Cerrar",{duration:3e3})}showError(t){this.snackBar.open(t,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(m){return new(m||e)};static \u0275cmp=v({type:e,selectors:[["app-compound-products"]],decls:13,vars:4,consts:[[1,"container"],[1,"header"],[1,"filter-card"],["appearance","outline",1,"full-width"],[3,"selectionChange","formControl"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"value"],["mat-raised-button","","color","primary",1,"add-button",3,"click"],[1,"table-container"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","insumo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","cantidad"],["matColumnDef","unidadproduct"],["matColumnDef","unidadinsumo"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary","matTooltip","Editar",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"],[1,"empty-state"]],template:function(m,r){m&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),i(3,"Configurar Productos Compuestos"),o()(),n(4,"mat-card",2)(5,"mat-card-content")(6,"mat-form-field",3)(7,"mat-label"),i(8,"Seleccionar Producto Compuesto"),o(),n(9,"mat-select",4),f("selectionChange",function(){return r.onProductChange()}),c(10,Xt,2,3,"mat-option",5),o()()()(),c(11,ue,29,3,"mat-card",6)(12,se,5,0,"div",7),o()),m&2&&(d(9),l("formControl",r.selectedProductControl),d(),l("ngForOf",r.products),d(),l("ngIf",r.selectedProductControl.value),d(),l("ngIf",!r.selectedProductControl.value))},dependencies:[w,S,b,k,F,tt,lt,rt,dt,mt,at,I,y,K,_t,ft,It,ht,Mt,St,xt,Pt,bt,vt,Et,wt,Dt,yt,A,O,q,N,R,V,D,B,gt,Ct],styles:[".container[_ngcontent-%COMP%]{padding:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.filter-card[_ngcontent-%COMP%]{margin-bottom:24px}.full-width[_ngcontent-%COMP%]{width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:right}.add-button[_ngcontent-%COMP%]{margin-left:16px}mat-card-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px;color:#0000008a}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}"]})}return e})();export{Ke as CompoundProductsComponent};
