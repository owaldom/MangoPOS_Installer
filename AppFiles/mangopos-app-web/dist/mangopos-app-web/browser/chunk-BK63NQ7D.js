import{a as m}from"./chunk-YCMZOG5D.js";import{c as h,d as p}from"./chunk-3TNWXQYU.js";import{$ as u,W as c,f as i,n as o}from"./chunk-WSMHJDAT.js";import{a}from"./chunk-C6Q5SG76.js";var b=(()=>{class r{http=u(p);apiUrl=`${m.apiUrl}/cash`;currentSessionSubject=new i(null);currentSession$=this.currentSessionSubject.asObservable();constructor(){this.checkStatus()}get hostName(){return window.location.hostname||"LOCAL-HOST"}async checkStatus(){try{let t=await o(this.http.get(`${this.apiUrl}/status?host=${this.hostName}`));return t.opened&&t.session?(this.currentSessionSubject.next(t.session),!0):(this.currentSessionSubject.next(null),!1)}catch(t){return console.error("Error checking cash status",t),!1}}async openCash(t={}){let s=a({host:this.hostName},t),e=await o(this.http.post(`${this.apiUrl}/open`,s));return this.currentSessionSubject.next(e),e}async closeCash(){let t=this.currentSessionSubject.value;t&&(await o(this.http.post(`${this.apiUrl}/close`,{moneyId:t.money})),this.currentSessionSubject.next(null))}getSummary(t){return this.http.get(`${this.apiUrl}/summary/${t}`)}isOpened(){return this.currentSessionSubject.value!==null}getMoneyId(){return this.currentSessionSubject.value?.money||null}getCashRegisterId(){return this.currentSessionSubject.value?.cash_register_id||null}getCashMovements(t=1,s=50,e){let n=new h().set("page",t.toString()).set("limit",s.toString());return e?.startDate&&(n=n.set("startDate",e.startDate)),e?.endDate&&(n=n.set("endDate",e.endDate)),e?.moneyId&&(n=n.set("moneyId",e.moneyId)),e?.movementType&&(n=n.set("movementType",e.movementType)),e?.currencyId&&(n=n.set("currencyId",e.currencyId.toString())),this.http.get(`${this.apiUrl}/movements`,{params:n})}createCashMovement(t){return t.datenew instanceof Date&&(t.datenew=this.formatLocalDate(t.datenew)),this.http.post(`${this.apiUrl}/movements`,t)}formatLocalDate(t){let s=e=>e<10?"0"+e:e;return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())} ${s(t.getHours())}:${s(t.getMinutes())}:${s(t.getSeconds())}`}static \u0275fac=function(s){return new(s||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{b as a};
