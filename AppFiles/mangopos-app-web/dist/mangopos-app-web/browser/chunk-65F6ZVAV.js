import{a as ie}from"./chunk-6KZJ4RFY.js";import{a as te}from"./chunk-HLIXJ3A2.js";import{a as ee}from"./chunk-5MBFWMTP.js";import{a as $}from"./chunk-DEAF3FKS.js";import{c as j}from"./chunk-6OXQWIOV.js";import"./chunk-YCMZOG5D.js";import{b as A,f as B,g as R,h as z,j as U,k as G,l as Q,p as H,q as J,r as K,t as X,u as Y,x as Z}from"./chunk-AVLO2MYP.js";import"./chunk-3TNWXQYU.js";import{k as q,l as W,u as L,v as N}from"./chunk-ZD4QWOHN.js";import{D as I,Fb as s,G as V,Gb as n,Hb as i,Ib as T,P as D,Pb as O,Ub as f,Wa as o,Wb as b,db as y,e as F,ea as u,ec as P,fa as m,ic as r,jb as k,jc as h,kc as S,lc as E,nc as C,oc as x,pb as _,pc as v,vc as M,zc as w}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function ne(a,g){if(a&1&&(n(0,"div",30),r(1),i()),a&2){let e=b();o(),S(" ",e.error," ")}}function re(a,g){if(a&1&&(n(0,"option",11),r(1),i()),a&2){let e=g.$implicit;s("value",e.id),o(),S(" ",e.name," ")}}function oe(a,g){if(a&1&&(n(0,"option",11),r(1),i()),a&2){let e=g.$implicit;s("value",e.id),o(),S(" ",e.name," ")}}function ae(a,g){if(a&1&&(n(0,"option",33),r(1),i()),a&2){let e=g.$implicit;s("ngValue",e),o(),E(" ",e.name," (",e.code||e.reference,") ")}}function de(a,g){if(a&1){let e=O();n(0,"div",16)(1,"label"),r(2,"Producto por Categor\xEDa"),i(),n(3,"select",31),v("ngModelChange",function(t){u(e);let l=b();return x(l.selectedProduct,t)||(l.selectedProduct=t),m(t)}),n(4,"option",11),r(5,"Seleccione producto"),i(),_(6,ae,2,3,"option",32),i()()}if(a&2){let e=b();o(3),C("ngModel",e.selectedProduct),o(),s("value",null),o(2),s("ngForOf",e.categoryProducts)}}function ce(a,g){if(a&1){let e=O();n(0,"div",36),f("click",function(){let t=u(e).$implicit,l=b(2),p=P(44);return l.selectProduct(t),m(p.value=t.name)}),n(1,"span",37),r(2),i(),n(3,"span",38),r(4),i(),n(5,"span",39),r(6),M(7,"currency"),i()()}if(a&2){let e=g.$implicit;o(2),h(e.name),o(2),h(e.code||e.reference),o(2),h(w(7,3,e.pricebuy,"USD","symbol","1.2-2"))}}function le(a,g){if(a&1&&(n(0,"div",34),_(1,ce,8,8,"div",35),i()),a&2){let e=b();o(),s("ngForOf",e.searchResults)}}function se(a,g){if(a&1&&(n(0,"div",40),r(1),i()),a&2){let e=b();o(),E(" Cod: ",e.selectedProduct.code||e.selectedProduct.reference," - Stock: ",e.selectedProduct.stock_current||0," ")}}function pe(a,g){if(a&1){let e=O();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td")(6,"input",45,2),f("change",function(){let t=u(e).$implicit,l=P(7),p=b(2);return m(p.updateQuantity(t,+l.value))}),i()(),n(8,"td"),r(9),M(10,"currency"),i(),n(11,"td"),r(12),M(13,"currency"),i(),n(14,"td")(15,"button",46),f("click",function(){let t=u(e).index,l=b(2);return m(l.removeLine(t))}),n(16,"i",25),r(17,"delete"),i()()()()}if(a&2){let e=g.$implicit;o(2),h(e.product_code),o(2),h(e.product_name),o(2),s("value",e.quantity_sent),o(3),h(w(10,5,e.unit_cost,"USD","symbol","1.2-2")),o(3),h(w(13,10,e.quantity_sent*e.unit_cost,"USD","symbol","1.2-2"))}}function ue(a,g){if(a&1&&(n(0,"div",41)(1,"table")(2,"thead")(3,"tr")(4,"th"),r(5,"C\xF3digo"),i(),n(6,"th"),r(7,"Producto"),i(),n(8,"th"),r(9,"Cantidad"),i(),n(10,"th"),r(11,"Costo Unit."),i(),n(12,"th"),r(13,"Subtotal"),i(),n(14,"th"),r(15,"Acciones"),i()()(),n(16,"tbody"),_(17,pe,18,15,"tr",42),i(),n(18,"tfoot")(19,"tr")(20,"td",43)(21,"strong"),r(22,"Total"),i()(),n(23,"td")(24,"strong"),r(25),i()(),T(26,"td",44),i()()()()),a&2){let e=b();o(17),s("ngForOf",e.order.lines),o(8),h(e.getTotalItems())}}function me(a,g){a&1&&(n(0,"div",47),r(1," No hay productos agregados. Use el buscador para agregar productos. "),i())}var ke=(()=>{class a{distributionService;warehouseService;productService;categoryService;router;order={origin_location_id:0,origin_location_name:"",destination_location_name:"",notes:"",lines:[]};locations=[];categories=[];categoryProducts=[];selectedCategoryId=null;searchResults=[];selectedProduct=null;quantity=0;loading=!1;error=null;searchSubject=new F;constructor(e,d,t,l,p){this.distributionService=e,this.warehouseService=d,this.productService=t,this.categoryService=l,this.router=p}ngOnInit(){this.loadLocations(),this.loadCategories(),this.setupSearch()}setupSearch(){this.searchSubject.pipe(I(300),V(),D(e=>{if(e.trim().length<2)return this.searchResults=[],[];let d={search:e};return this.order.origin_location_id&&(d.locationId=this.order.origin_location_id),this.productService.getAll(1,10,d)})).subscribe({next:e=>{this.searchResults=e.data},error:e=>console.error("Error in product search",e)})}loadLocations(){this.warehouseService.getAll().subscribe({next:e=>{this.locations=e.filter(d=>d.type==="factory"),this.locations.length===1&&(this.order.origin_location_id=this.locations[0].id)},error:e=>console.error("Error loading locations",e)})}onOriginLocationChange(){this.selectedCategoryId=null,this.categoryProducts=[],this.selectedProduct=null,this.searchResults=[]}loadCategories(){this.categoryService.getAll(1,100).subscribe({next:e=>this.categories=e.data,error:e=>console.error("Error loading categories",e)})}onCategoryChange(e){if(this.selectedCategoryId=e,this.categoryProducts=[],this.selectedProduct=null,e){let d={category:e};this.order.origin_location_id&&(d.locationId=this.order.origin_location_id),this.productService.getAll(1,100,d).subscribe({next:t=>{this.categoryProducts=t.data},error:t=>console.error("Error loading products for category",t)})}}searchProducts(e){this.searchSubject.next(e)}selectProduct(e){this.selectedProduct=e,this.searchResults=[]}addProduct(){if(!this.selectedProduct||this.quantity<=0){alert("Seleccione un producto y cantidad v\xE1lida");return}let e=this.order.lines?.find(d=>d.product_id===this.selectedProduct.id);if(e)e.quantity_sent+=this.quantity;else{let d={product_id:this.selectedProduct.id,product_name:this.selectedProduct.name,product_code:this.selectedProduct.code||this.selectedProduct.reference,quantity_sent:this.quantity,unit_cost:this.selectedProduct.pricebuy||0};this.order.lines=[...this.order.lines||[],d]}this.selectedProduct=null,this.quantity=0}removeLine(e){this.order.lines=this.order.lines?.filter((d,t)=>t!==e)||[]}updateQuantity(e,d){d>0&&(e.quantity_sent=d)}getTotalItems(){return this.order.lines?.reduce((e,d)=>e+d.quantity_sent,0)||0}canSubmit(){return!!(this.order.origin_location_id&&this.order.destination_location_name&&this.order.lines&&this.order.lines.length>0)}submit(){if(!this.canSubmit()){alert("Complete todos los campos requeridos");return}this.loading=!0,this.error=null,this.distributionService.createOrder(this.order).subscribe({next:e=>{alert("Orden de distribuci\xF3n creada exitosamente"),this.router.navigate(["/dashboard/inventario/distribution-orders"])},error:e=>{this.error=e.error?.error||"Error al crear la orden",alert(this.error),this.loading=!1}})}cancel(){this.router.navigate(["/dashboard/inventario/distribution-orders"])}static \u0275fac=function(d){return new(d||a)(y(ie),y($),y(ee),y(te),y(j))};static \u0275cmp=k({type:a,selectors:[["app-distribution-order-form"]],decls:67,vars:19,consts:[["catSelect",""],["searchInput",""],["qtyInput",""],[1,"distribution-form-container"],[1,"header"],["class","error",4,"ngIf"],[1,"distribution-form"],[1,"form-section"],[1,"form-row"],[1,"form-group"],["name","origin","required","",3,"ngModelChange","change","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["type","text","name","destination","placeholder","Ej: Punto de Venta Centro","required","",3,"ngModelChange","ngModel"],["name","notes","rows","3","placeholder","Observaciones adicionales...",3,"ngModelChange","ngModel"],[1,"product-selector"],[1,"form-group","flex-grow"],["name","category",3,"ngModelChange","change","ngModel"],["class","form-group flex-grow",4,"ngIf"],[1,"form-group","flex-grow","relative"],["type","text","placeholder","Buscar por nombre o c\xF3digo...","autocomplete","off",3,"input"],["class","search-results",4,"ngIf"],["class","selected-product-info",4,"ngIf"],["type","number","name","quantity","min","0","step","1",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"material-icons"],["class","products-table",4,"ngIf"],["class","no-products",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"error"],["name","catProduct",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"search-results"],["class","search-item",3,"click",4,"ngFor","ngForOf"],[1,"search-item",3,"click"],[1,"name"],[1,"code"],[1,"price"],[1,"selected-product-info"],[1,"products-table"],[4,"ngFor","ngForOf"],["colspan","2"],["colspan","3"],["type","number","min","1",1,"quantity-input",3,"change","value"],["type","button","title","Eliminar",1,"btn-icon","btn-danger",3,"click"],[1,"no-products"]],template:function(d,t){if(d&1){let l=O();n(0,"div",3)(1,"div",4)(2,"h2"),r(3,"Nueva Orden de Distribuci\xF3n"),i()(),_(4,ne,2,1,"div",5),n(5,"form",6)(6,"div",7)(7,"h3"),r(8,"Informaci\xF3n General"),i(),n(9,"div",8)(10,"div",9)(11,"label"),r(12,"Almac\xE9n Origen *"),i(),n(13,"select",10),v("ngModelChange",function(c){return u(l),x(t.order.origin_location_id,c)||(t.order.origin_location_id=c),m(c)}),f("change",function(){return u(l),m(t.onOriginLocationChange())}),n(14,"option",11),r(15,"Seleccione almac\xE9n"),i(),_(16,re,2,2,"option",12),i()(),n(17,"div",9)(18,"label"),r(19,"Punto de Venta Destino *"),i(),n(20,"input",13),v("ngModelChange",function(c){return u(l),x(t.order.destination_location_name,c)||(t.order.destination_location_name=c),m(c)}),i()()(),n(21,"div",9)(22,"label"),r(23,"Notas"),i(),n(24,"textarea",14),v("ngModelChange",function(c){return u(l),x(t.order.notes,c)||(t.order.notes=c),m(c)}),i()()(),n(25,"div",7)(26,"h3"),r(27,"Productos"),i(),n(28,"div",15)(29,"div",8)(30,"div",16)(31,"label"),r(32,"Categor\xEDa"),i(),n(33,"select",17,0),v("ngModelChange",function(c){return u(l),x(t.selectedCategoryId,c)||(t.selectedCategoryId=c),m(c)}),f("change",function(){u(l);let c=P(34);return m(t.onCategoryChange(+c.value))}),n(35,"option",11),r(36,"Todas las categor\xEDas"),i(),_(37,oe,2,2,"option",12),i()(),_(38,de,7,3,"div",18),i(),n(39,"div",8)(40,"div",19)(41,"label"),r(42,"O Buscar Producto (Global)"),i(),n(43,"input",20,1),f("input",function(){u(l);let c=P(44);return m(t.searchProducts(c.value))}),i(),_(45,le,2,1,"div",21)(46,se,2,2,"div",22),i(),n(47,"div",9)(48,"label"),r(49,"Cantidad"),i(),n(50,"input",23),v("ngModelChange",function(c){return u(l),x(t.quantity,c)||(t.quantity=c),m(c)}),i()(),n(51,"div",9)(52,"label"),r(53,"\xA0"),i(),n(54,"button",24),f("click",function(){return u(l),m(t.addProduct())}),n(55,"i",25),r(56,"add"),i(),r(57," Agregar "),i()()()(),_(58,ue,27,2,"div",26)(59,me,2,0,"div",27),i(),n(60,"div",28)(61,"button",24),f("click",function(){return u(l),m(t.cancel())}),r(62," Cancelar "),i(),n(63,"button",29),f("click",function(){return u(l),m(t.submit())}),n(64,"i",25),r(65,"save"),i(),r(66),i()()()()}d&2&&(o(4),s("ngIf",t.error),o(9),C("ngModel",t.order.origin_location_id),o(),s("value",0),o(2),s("ngForOf",t.locations),o(4),C("ngModel",t.order.destination_location_name),o(4),C("ngModel",t.order.notes),o(9),C("ngModel",t.selectedCategoryId),o(2),s("value",null),o(2),s("ngForOf",t.categories),o(),s("ngIf",t.categoryProducts.length>0),o(7),s("ngIf",t.searchResults.length>0),o(),s("ngIf",t.selectedProduct),o(4),C("ngModel",t.quantity),o(4),s("disabled",!t.selectedProduct||t.quantity<=0),o(4),s("ngIf",t.order.lines&&t.order.lines.length>0),o(),s("ngIf",!t.order.lines||t.order.lines.length===0),o(2),s("disabled",t.loading),o(2),s("disabled",!t.canSubmit()||t.loading),o(3),S(" ",t.loading?"Guardando...":"Crear Distribuci\xF3n"," "))},dependencies:[N,q,W,Z,G,J,K,A,Q,H,B,R,Y,X,U,z,L],styles:[".distribution-form-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:24px;color:#333}.error[_ngcontent-%COMP%]{padding:12px;margin-bottom:20px;background-color:#ffebee;color:#d32f2f;border-radius:4px;border-left:4px solid #d32f2f}.distribution-form[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 8px #0000001a;padding:24px}.form-section[_ngcontent-%COMP%]{margin-bottom:30px}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:18px;color:#333;border-bottom:2px solid #4CAF50;padding-bottom:8px}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-bottom:16px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group.flex-grow[_ngcontent-%COMP%]{flex:1}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#555}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:10px;border:1px solid #ddd;border-radius:4px;font-size:14px;font-family:inherit}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#4caf50;box-shadow:0 0 0 2px #4caf501a}.product-selector[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:16px;border-radius:4px;margin-bottom:20px}.products-table[_ngcontent-%COMP%]{overflow-x:auto;margin-top:16px}.products-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.products-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f5f5f5}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:12px;text-align:left;font-weight:600;color:#333;border-bottom:2px solid #ddd}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #eee}.products-table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]{background-color:#f9f9f9;font-weight:600}.quantity-input[_ngcontent-%COMP%]{width:80px;padding:6px;border:1px solid #ddd;border-radius:4px}.no-products[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#999;font-style:italic;background-color:#f9f9f9;border-radius:4px}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;display:inline-flex;align-items:center;gap:8px;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#45a049}.btn-secondary[_ngcontent-%COMP%]{background-color:#757575;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#616161}.btn-icon[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:6px;border-radius:4px;color:#666}.btn-icon[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.btn-danger[_ngcontent-%COMP%]{color:#d32f2f}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#ffebee}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px;padding-top:24px;border-top:1px solid #eee}",".relative[_ngcontent-%COMP%]{position:relative}.search-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:4px;z-index:1000;max-height:200px;overflow-y:auto;box-shadow:0 4px 6px #0000001a}.search-item[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee}.search-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.search-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:500;flex:1}.search-item[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{color:#666;font-size:12px;margin:0 10px}.search-item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#2e7d32;font-weight:700}.selected-product-info[_ngcontent-%COMP%]{font-size:12px;color:#1976d2;margin-top:4px}"]})}return a})();export{ke as DistributionOrderFormComponent};
