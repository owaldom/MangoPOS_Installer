import{c}from"./chunk-6OXQWIOV.js";import{d as u}from"./chunk-3TNWXQYU.js";import{$ as o,S as i,W as a,f as n}from"./chunk-WSMHJDAT.js";var U=(()=>{class r{http=o(u);router=o(c);apiUrl="http://localhost:3000/api/auth";currentUserSubject=new n(null);currentUser$=this.currentUserSubject.asObservable();constructor(){let t=this.getToken(),e=this.getUser();t&&e&&this.currentUserSubject.next(e)}login(t,e){return this.http.post(`${this.apiUrl}/login`,{username:t,password:e}).pipe(i(s=>{s.success&&(this.setToken(s.data.token),this.setUser(s.data.user),this.currentUserSubject.next(s.data.user))}))}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.currentUserSubject.next(null),this.router.navigate(["/login"])}changePassword(t,e){return this.http.post(`${this.apiUrl}/change-password`,{currentPassword:t,newPassword:e})}forgotPassword(t){return this.http.post(`${this.apiUrl}/forgot-password`,{username:t})}getToken(){return localStorage.getItem("token")}setToken(t){localStorage.setItem("token",t)}getUser(){let t=localStorage.getItem("user");return t?JSON.parse(t):null}setUser(t){localStorage.setItem("user",JSON.stringify(t))}isAuthenticated(){return!!this.getToken()}getCurrentUser(){return this.currentUserSubject.value}hasPermission(t){let e=this.getCurrentUser();return!e||!e.permissions?!1:e.permissions.includes("*")||e.permissions.includes(t)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{U as a};
