import{a as ce}from"./chunk-NN3ONOAJ.js";import{a as le}from"./chunk-RFRKPPY3.js";import{a as j,b as R}from"./chunk-26KDQVR5.js";import"./chunk-DGQM6DPS.js";import{a as ie,b as ae}from"./chunk-N5ZCCEPE.js";import{b as Z,c as ee}from"./chunk-APXOZHQA.js";import{a as oe,b as re}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as L,b as $,c as J,f as K,h as Q}from"./chunk-ZWM7H6SC.js";import"./chunk-TEMJ73U5.js";import{d as P}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as U,d as W,i as X,j as Y}from"./chunk-EWTXOCXT.js";import{b as T,d as u,f as D,g as V,k as G,n as z,o as A,w as q,y as H}from"./chunk-AVLO2MYP.js";import{a as te,b as ne}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{I as w,K as N}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{j as y,k as F,l as I,s as E,v as O}from"./chunk-ZD4QWOHN.js";import{Fb as c,Gb as i,Hb as n,Ib as p,Pb as M,Ub as k,Wa as o,Wb as f,db as d,ea as x,fa as v,ic as a,jb as C,kc as B,lc as g,mc as h,pb as s,uc as S,vc as b,xc as _}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";var se=(t,m)=>({positive:t,negative:m});function de(t,m){t&1&&(i(0,"div",4),p(1,"mat-spinner",5),n())}function pe(t,m){if(t&1&&(i(0,"mat-option",16),a(1),n()),t&2){let e=m.$implicit;c("value",e.id),o(),h(" ",e.name," - ",e.account_type_name," (",e.currency,") ")}}function fe(t,m){if(t&1&&(i(0,"div",17)(1,"div",18)(2,"label"),a(3,"Saldo en Sistema"),n(),i(4,"span"),a(5),b(6,"number"),n()(),i(7,"div",18)(8,"label"),a(9,"Diferencia de Ajuste"),n(),i(10,"span",19),a(11),b(12,"number"),n()()()),t&2){let e=f(2);o(5),g("",e.selectedBank.currency," ",_(6,5,e.selectedBank.current_balance,"1.2-2")),o(5),c("ngClass",S(11,se,e.difference>0,e.difference<0)),o(),g(" ",e.selectedBank.currency," ",_(12,8,e.difference,"1.2-2")," ")}}function ue(t,m){t&1&&(i(0,"mat-icon"),a(1,"check_circle"),n())}function ge(t,m){if(t&1){let e=M();i(0,"form",6),k("ngSubmit",function(){x(e);let l=f();return v(l.onSubmit())}),i(1,"mat-form-field",7)(2,"mat-label"),a(3,"Seleccionar Cuenta Bancaria"),n(),i(4,"mat-select",8),s(5,pe,2,4,"mat-option",9),n()(),s(6,fe,13,14,"div",10),i(7,"mat-form-field",7)(8,"mat-label"),a(9,"Saldo seg\xFAn Estado de Cuenta"),n(),p(10,"input",11),i(11,"mat-hint"),a(12,"Ingrese el saldo real que muestra el banco para generar el ajuste autom\xE1tico"),n()(),i(13,"mat-form-field",7)(14,"mat-label"),a(15,"Notas / Motivo del ajuste"),n(),p(16,"textarea",12),n(),i(17,"div",13)(18,"button",14),s(19,ue,2,0,"mat-icon",15),a(20),n()()()}if(t&2){let e=f();c("formGroup",e.reconcileForm),o(5),c("ngForOf",e.banks),o(),c("ngIf",e.selectedBank),o(12),c("disabled",e.reconcileForm.invalid||e.saving),o(),c("ngIf",!e.saving),o(),B(" ",e.saving?"Procesando...":"Aplicar Conciliaci\xF3n"," ")}}var He=(()=>{class t{fb;banksService;snackBar;reconcileForm;banks=[];selectedBank;loading=!1;saving=!1;constructor(e,r,l){this.fb=e,this.banksService=r,this.snackBar=l,this.reconcileForm=this.fb.group({bank_id:["",u.required],new_balance:[0,[u.required,u.min(0)]],notes:[""]})}ngOnInit(){this.loadBanks(),this.reconcileForm.get("bank_id")?.valueChanges.subscribe(e=>{this.selectedBank=this.banks.find(r=>r.id===e),this.selectedBank&&this.reconcileForm.patchValue({new_balance:this.selectedBank.current_balance})})}loadBanks(){this.loading=!0,this.banksService.getBanks(!0).subscribe({next:e=>{this.banks=e,this.loading=!1},error:e=>{console.error("Error loading banks:",e),this.snackBar.open("Error al cargar bancos","Cerrar",{duration:3e3}),this.loading=!1}})}get difference(){return this.selectedBank?(this.reconcileForm.get("new_balance")?.value||0)-this.selectedBank.current_balance:0}onSubmit(){if(this.reconcileForm.invalid)return;this.saving=!0;let{bank_id:e,new_balance:r,notes:l}=this.reconcileForm.value;this.banksService.reconcileBalance(e,r,l).subscribe({next:()=>{this.snackBar.open("Conciliaci\xF3n realizada con \xE9xito","Cerrar",{duration:3e3}),this.loadBanks(),this.saving=!1,this.reconcileForm.get("notes")?.reset()},error:me=>{console.error("Error in reconciliation:",me),this.snackBar.open("Error al realizar conciliaci\xF3n","Cerrar",{duration:3e3}),this.saving=!1}})}static \u0275fac=function(r){return new(r||t)(d(q),d(ce),d(j))};static \u0275cmp=C({type:t,selectors:[["app-bank-reconcile"]],decls:10,vars:2,consts:[[1,"reconcile-container"],["color","primary"],["class","loading-container",4,"ngIf"],["class","reconcile-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"reconcile-form",3,"ngSubmit","formGroup"],["appearance","outline"],["formControlName","bank_id"],[3,"value",4,"ngFor","ngForOf"],["class","balance-info",4,"ngIf"],["matInput","","type","text","formControlName","new_balance","appMoneyInput","","decimalType","total"],["matInput","","formControlName","notes","rows","3","placeholder","Ej: Correcci\xF3n de saldo, comisiones no registradas..."],[1,"actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[4,"ngIf"],[3,"value"],[1,"balance-info"],[1,"balance-item"],[1,"difference",3,"ngClass"]],template:function(r,l){r&1&&(i(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon",1),a(5,"fact_check"),n(),a(6," Conciliaci\xF3n Bancaria "),n()(),i(7,"mat-card-content"),s(8,de,2,0,"div",2)(9,ge,21,6,"form",3),n()()()),r&2&&(o(8),c("ngIf",l.loading),o(),c("ngIf",!l.loading))},dependencies:[O,y,F,I,H,G,T,D,V,A,z,Q,L,J,K,$,Y,X,U,W,ee,Z,re,oe,P,N,w,ne,te,R,ae,ie,le,E],styles:[".reconcile-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.reconcile-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-top:20px}.balance-info[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;padding:20px;background:#00000008;border-radius:8px;border-left:4px solid #3f51b5}.balance-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.balance-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.85rem;color:#666;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}.balance-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:500}.difference[_ngcontent-%COMP%]{font-weight:600}.positive[_ngcontent-%COMP%]{color:#2e7d32}.negative[_ngcontent-%COMP%]{color:#d32f2f}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:10px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}"]})}return t})();export{He as BankReconcileComponent};
