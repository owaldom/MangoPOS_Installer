import{a as Et}from"./chunk-TIGUL45J.js";import{a as Pt}from"./chunk-LJW6EPWE.js";import{a as Ce}from"./chunk-HLIXJ3A2.js";import{b as vt,c as St,d as bt}from"./chunk-ISB5W5SX.js";import{a as Ct}from"./chunk-PGWFKS4C.js";import{a as ht}from"./chunk-5MBFWMTP.js";import{a as xt}from"./chunk-6XGWOI35.js";import"./chunk-DEAF3FKS.js";import{a as _t}from"./chunk-34EVCEMG.js";import"./chunk-7UZYWCAJ.js";import"./chunk-7KQW3R3P.js";import{c as $e,d as ze,f as ve,g as Se,h as qe}from"./chunk-CJPLD6EO.js";import{b as ut,c as gt}from"./chunk-HIZ742YJ.js";import{a as Ae}from"./chunk-6OXQWIOV.js";import{a as _e,b as xe}from"./chunk-XEWEKXFC.js";import{a as he}from"./chunk-RFRKPPY3.js";import{a as se,b as pe,c as ft,e as ue,f as ge,g as fe,h as U}from"./chunk-Z6YHTX75.js";import{a as Z,b as ee}from"./chunk-26KDQVR5.js";import{a as j}from"./chunk-DGQM6DPS.js";import{a as et}from"./chunk-SCPRHZYR.js";import"./chunk-EQXJNMRX.js";import{b as $,c as z}from"./chunk-APXOZHQA.js";import{a as tt,b as it,c as nt,d as ot,e as at,f as rt,g as lt,h as mt,i as ct,j as dt,k as st,l as pt}from"./chunk-VJGP4MMT.js";import{a as ce,b as de}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as Le,b as Ke,c as Qe,f as Je,h as Xe}from"./chunk-ZWM7H6SC.js";import{a as Ze}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as Y}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as B,c as Ye,e as le,f as me,i as R,j as A}from"./chunk-EWTXOCXT.js";import{b as N,d as E,f as V,g as te,j as je,k as ie,l as Ue,n as ne,o as oe,u as We,w as ae,x as He,y as re}from"./chunk-AVLO2MYP.js";import{a as q,b as G}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as Ge,I as k,K as O}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as J,l as T,s as D,t as Re,u as X,v as F}from"./chunk-ZD4QWOHN.js";import{$ as x,$b as we,Ac as Be,Fb as d,Gb as i,Hb as t,Ib as C,Mb as S,Nb as b,Pb as y,Sa as K,Ub as u,Wa as l,Wb as h,_b as ye,ac as Ie,db as w,ea as f,ec as Q,fa as _,gc as W,ic as n,jb as I,jc as Te,kc as s,lc as De,nc as Fe,oc as ke,pb as g,pc as Oe,sc as Ne,vc as v,wc as Ve,xc as P,zb as Me,zc as H}from"./chunk-WSMHJDAT.js";import{a as L}from"./chunk-C6Q5SG76.js";function At(a,c){a&1&&(i(0,"mat-error"),n(1,"Requerido"),t())}function $t(a,c){a&1&&(i(0,"mat-error"),n(1,"Requerido"),t())}function zt(a,c){if(a&1&&(i(0,"mat-option",60),n(1),t()),a&2){let e=c.$implicit;d("value",e.code),l(),s(" ",e.name," ")}}function qt(a,c){a&1&&(i(0,"mat-error"),n(1,"Requerido"),t())}function Gt(a,c){if(a&1&&(i(0,"mat-option",60),n(1),t()),a&2){let e=c.$implicit;d("value",e.id),l(),s(" ",e.name," ")}}function jt(a,c){if(a&1&&(i(0,"mat-option",60),n(1),v(2,"percent"),t()),a&2){let e=c.$implicit;d("value",e.category),l(),De(" ",e.name," (",Ve(2,3,e.rate),") ")}}function Ut(a,c){if(a&1&&(i(0,"mat-option",60),n(1),t()),a&2){let e=c.$implicit;d("value",e.id.toString()),l(),s(" ",e.name," ")}}function Wt(a,c){if(a&1&&(i(0,"div",61),C(1,"img",62),t()),a&2){let e,r=h();l(),d("src",r.imageBase64||((e=r.form.get("image"))==null?null:e.value),K)}}function Ht(a,c){a&1&&(i(0,"div",63)(1,"mat-icon"),n(2,"add_photo_alternate"),t(),i(3,"span"),n(4,"Haga clic para subir imagen"),t()())}function Lt(a,c){if(a&1){let e=y();i(0,"div",64)(1,"button",65),u("click",function(o){f(e);let m=h();return _(m.removeImage(o))}),i(2,"mat-icon"),n(3,"delete"),t(),n(4," Eliminar Imagen "),t(),i(5,"button",66),u("click",function(){f(e),h();let o=Q(142);return _(o.click())}),i(6,"mat-icon"),n(7,"edit"),t(),n(8," Cambiar "),t()()}}var kt=(()=>{class a{data;form;categories=[];taxCategories=[];taxes=[];units=[];discountCategories=[];imageBase64=null;priceSellWithTax=null;selectedTaxRate=0;fb=x(ae);categoryService=x(Ce);taxService=x(Pt);settingsService=x(j);unitService=x(Ct);discountService=x(_t);dialogRef=x(se);constructor(e){this.data=e,this.form=this.fb.group({reference:["",E.required],code:["",E.required],name:["",E.required],pricebuy:[0,[E.min(0)]],pricesell:[0,[E.min(0)]],margin:[0],category:[null,E.required],taxcat:[1,E.required],stockcost:[0],stockvolume:[0],image:[null],iscom:[!1],isscale:[!1],incatalog:[!0],codetype:["CODE128"],attributeset_id:[null],discount:["001"],regulated:[!1],servicio:[!1],averagecost:[0],marketable:[!0],codeunit:["KG",E.required],typeproduct:["SI"]})}ngOnInit(){this.categoryService.getAll(1,1e3).subscribe(e=>this.categories=e.data),this.unitService.getAll().subscribe(e=>this.units=e),this.discountService.getDiscountCategories().subscribe(e=>this.discountCategories=e),this.settingsService.settings$.subscribe(e=>{e&&(this.calculatePriceWithTax(),this.data.product&&setTimeout(()=>{this.data.product&&(this.form.patchValue(this.data.product),this.data.product.image?this.imageBase64=`data:image/png;base64,${this.data.product.image}`:this.imageBase64=null,this.calculateMarginFromPrices())},0))}),this.taxService.getTaxes().subscribe(e=>{this.taxes=e,this.data.product&&this.onTaxChange()}),this.form.get("taxcat")?.valueChanges.subscribe(()=>this.onTaxChange())}onFileSelected(e){let r=e.target.files[0];if(r){let o=new FileReader;o.onload=()=>{this.imageBase64=o.result,this.form.patchValue({image:this.imageBase64})},o.readAsDataURL(r)}}removeImage(e){e.stopPropagation(),this.imageBase64=null,this.form.patchValue({image:null})}onPriceBuyChange(){let e=this.form.get("pricebuy")?.value||0,r=this.form.get("margin")?.value||0,o=this.settingsService.getSettings()?.price_decimals||2,m=e*(1+r/100);this.form.patchValue({pricesell:parseFloat(m.toFixed(o))},{emitEvent:!1}),this.calculatePriceWithTax()}onMarginChange(){let e=this.form.get("pricebuy")?.value||0,r=this.form.get("margin")?.value||0,o=this.settingsService.getSettings()?.price_decimals||2,m=e*(1+r/100);this.form.patchValue({pricesell:parseFloat(m.toFixed(o))},{emitEvent:!1}),this.calculatePriceWithTax()}onPriceSellChange(){let e=this.form.get("pricebuy")?.value||0,r=this.form.get("pricesell")?.value||0,o=this.settingsService.getSettings()?.price_decimals||2;if(e>0){let m=(r/e-1)*100;this.form.patchValue({margin:parseFloat(m.toFixed(o))},{emitEvent:!1})}this.calculatePriceWithTax()}calculateMarginFromPrices(){let e=this.form.get("pricebuy")?.value||0,r=this.form.get("pricesell")?.value||0,o=this.settingsService.getSettings()?.price_decimals||2;if(e>0){let m=(r/e-1)*100;this.form.patchValue({margin:parseFloat(m.toFixed(o))},{emitEvent:!1})}this.onTaxChange()}onTaxChange(){let e=this.form.get("taxcat")?.value;if(e){let r=this.taxes.find(o=>o.category===e);this.selectedTaxRate=r?r.rate:0}else this.selectedTaxRate=0;this.calculatePriceWithTax()}calculatePriceWithTax(){let r=(this.form.get("pricesell")?.value||0)*(1+parseFloat(this.selectedTaxRate.toString())),o=this.settingsService.getSettings()?.price_decimals||2;this.priceSellWithTax=parseFloat(r.toFixed(o))}onSubmit(){if(this.form.valid){let e=L({},this.form.value);if(this.imageBase64){let r=this.imageBase64.indexOf(",");r>-1?e.image=this.imageBase64.substring(r+1):e.image=this.imageBase64}else e.image=null;delete e.margin,this.dialogRef.close(e)}}static \u0275fac=function(r){return new(r||a)(w(pe))};static \u0275cmp=I({type:a,selectors:[["app-product-form"]],decls:149,vars:21,consts:[["noImage",""],["fileInput",""],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"dialog-content"],["label","General"],[1,"tab-content"],[1,"row"],["appearance","outline",1,"half-width"],["matInput","","formControlName","reference","required",""],[4,"ngIf"],["matInput","","formControlName","code","required",""],["formControlName","codetype"],["value","CODE128"],["value","EAN13"],["value","EAN8"],["value","UPC-A"],["value","UPC-E"],["formControlName","codeunit"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","required",""],["formControlName","category","required",""],["formControlName","taxcat","required","",3,"selectionChange"],[1,"row",2,"margin-top","10px"],["formControlName","typeproduct"],["value","SI"],["value","CO"],["value","IN"],["value","KI"],["formControlName","discount"],["matInput","","type","number","formControlName","attributeset_id"],["label","Configuraci\xF3n"],[1,"row","checkboxes"],["formControlName","iscom"],["formControlName","incatalog"],["formControlName","marketable"],["formControlName","isscale"],["formControlName","regulated"],["formControlName","servicio"],["label","Precios"],["matInput","","type","text","formControlName","pricebuy","appMoneyInput","","decimalType","price",3,"input"],["matPrefix",""],["matInput","","type","text","formControlName","margin","appMoneyInput","","decimalType","price",3,"input"],["matSuffix",""],["matInput","","type","text","formControlName","pricesell","appMoneyInput","","decimalType","price",3,"input"],["appearance","outline",1,"full-width","readonly-field"],["matInput","","type","text","readonly","",3,"value"],["label","Inventario"],["matInput","","type","text","formControlName","stockcost","appMoneyInput","","decimalType","quantity"],["matInput","","type","text","formControlName","stockvolume","appMoneyInput","","decimalType","quantity"],["label","Imagen"],[1,"tab-content","centered-content"],[1,"image-upload-container",3,"click"],["class","image-preview-large",4,"ngIf","ngIfElse"],["type","file","accept","image/*",2,"display","none",3,"change"],["class","image-actions",4,"ngIf"],["align","end"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[3,"value"],[1,"image-preview-large"],["alt","Producto",3,"src"],[1,"upload-placeholder"],[1,"image-actions"],["mat-stroked-button","","color","warn","type","button",3,"click"],["mat-flat-button","","color","primary","type","button",3,"click"]],template:function(r,o){if(r&1){let m=y();i(0,"h2",2),n(1),t(),i(2,"form",3),u("ngSubmit",function(){return f(m),_(o.onSubmit())}),i(3,"mat-dialog-content",4)(4,"mat-tab-group")(5,"mat-tab",5)(6,"div",6)(7,"div",7)(8,"mat-form-field",8)(9,"mat-label"),n(10,"Referencia"),t(),C(11,"input",9),g(12,At,2,0,"mat-error",10),t(),i(13,"mat-form-field",8)(14,"mat-label"),n(15,"C\xF3digo de Barras"),t(),C(16,"input",11),g(17,$t,2,0,"mat-error",10),t()(),i(18,"div",7)(19,"mat-form-field",8)(20,"mat-label"),n(21,"Tipo C\xF3digo"),t(),i(22,"mat-select",12)(23,"mat-option",13),n(24,"CODE128"),t(),i(25,"mat-option",14),n(26,"EAN13"),t(),i(27,"mat-option",15),n(28,"EAN8"),t(),i(29,"mat-option",16),n(30,"UPC-A"),t(),i(31,"mat-option",17),n(32,"UPC-E"),t()()(),i(33,"mat-form-field",8)(34,"mat-label"),n(35,"Unidad"),t(),i(36,"mat-select",18),g(37,zt,2,2,"mat-option",19),t()()(),i(38,"mat-form-field",20)(39,"mat-label"),n(40,"Nombre"),t(),C(41,"input",21),g(42,qt,2,0,"mat-error",10),t(),i(43,"div",7)(44,"mat-form-field",8)(45,"mat-label"),n(46,"Categor\xEDa"),t(),i(47,"mat-select",22),g(48,Gt,2,2,"mat-option",19),t()(),i(49,"mat-form-field",8)(50,"mat-label"),n(51,"Impuesto"),t(),i(52,"mat-select",23),u("selectionChange",function(){return f(m),_(o.onTaxChange())}),g(53,jt,3,5,"mat-option",19),t()()(),i(54,"div",24)(55,"mat-form-field",8)(56,"mat-label"),n(57,"Tipo Producto"),t(),i(58,"mat-select",25)(59,"mat-option",26),n(60,"Est\xE1ndar (Simple)"),t(),i(61,"mat-option",27),n(62,"Compuesto"),t(),i(63,"mat-option",28),n(64,"Insumo"),t(),i(65,"mat-option",29),n(66,"Kit (Combo)"),t()()(),i(67,"mat-form-field",8)(68,"mat-label"),n(69,"Lista Descuento"),t(),i(70,"mat-select",30),g(71,Ut,2,2,"mat-option",19),t()()(),i(72,"div",7)(73,"mat-form-field",8)(74,"mat-label"),n(75,"Set de Atributos (ID)"),t(),C(76,"input",31),t()()()(),i(77,"mat-tab",32)(78,"div",6)(79,"div",33)(80,"mat-checkbox",34),n(81,"Es Comprobable"),t(),i(82,"mat-checkbox",35),n(83,"En Cat\xE1logo (TPV)"),t(),i(84,"mat-checkbox",36),n(85,"Comercializable"),t(),i(86,"mat-checkbox",37),n(87,"Usa Balanza"),t()(),i(88,"div",33)(89,"mat-checkbox",38),n(90,"Regulado (Precios)"),t(),i(91,"mat-checkbox",39),n(92,"Es Servicio"),t()()()(),i(93,"mat-tab",40)(94,"div",6)(95,"mat-form-field",20)(96,"mat-label"),n(97,"Precio de Compra"),t(),i(98,"input",41),u("input",function(){return f(m),_(o.onPriceBuyChange())}),t(),i(99,"span",42),n(100,"$\xA0"),t()(),i(101,"mat-form-field",20)(102,"mat-label"),n(103,"Margen (%)"),t(),i(104,"input",43),u("input",function(){return f(m),_(o.onMarginChange())}),t(),i(105,"span",44),n(106,"%"),t()(),i(107,"mat-form-field",20)(108,"mat-label"),n(109,"Precio de Venta (Base)"),t(),i(110,"input",45),u("input",function(){return f(m),_(o.onPriceSellChange())}),t(),i(111,"span",42),n(112,"$\xA0"),t()(),i(113,"mat-form-field",46)(114,"mat-label"),n(115,"Precio de Venta (Con Impuesto)"),t(),C(116,"input",47),v(117,"number"),i(118,"span",42),n(119,"$\xA0"),t()()()(),i(120,"mat-tab",48)(121,"div",6)(122,"mat-form-field",20)(123,"mat-label"),n(124,"Stock Costo"),t(),C(125,"input",49),t(),i(126,"mat-form-field",20)(127,"mat-label"),n(128,"Stock Volumen"),t(),C(129,"input",50),t(),i(130,"mat-form-field",46)(131,"mat-label"),n(132,"Costo Promedio"),t(),C(133,"input",47),v(134,"number"),t()()(),i(135,"mat-tab",51)(136,"div",52)(137,"div",53),u("click",function(){f(m);let M=Q(142);return _(M.click())}),g(138,Wt,2,1,"div",54)(139,Ht,5,0,"ng-template",null,0,Be),i(141,"input",55,1),u("change",function(M){return f(m),_(o.onFileSelected(M))}),t()(),g(143,Lt,9,0,"div",56),t()()()(),i(144,"mat-dialog-actions",57)(145,"button",58),u("click",function(){return f(m),_(o.dialogRef.close())}),n(146,"Cancelar"),t(),i(147,"button",59),n(148,"Guardar"),t()()()}if(r&2){let m,p,M,be,Pe,Ee,Nt=Q(140);l(),s("",o.data.product?"Editar":"Nuevo"," Producto"),l(),d("formGroup",o.form),l(10),d("ngIf",(m=o.form.get("reference"))==null?null:m.hasError("required")),l(5),d("ngIf",(p=o.form.get("code"))==null?null:p.hasError("required")),l(20),d("ngForOf",o.units),l(5),d("ngIf",(M=o.form.get("name"))==null?null:M.hasError("required")),l(6),d("ngForOf",o.categories),l(5),d("ngForOf",o.taxes),l(18),d("ngForOf",o.discountCategories),l(45),d("value",P(117,15,o.priceSellWithTax,o.settingsService.getDecimalFormat("price"))),l(17),d("value",P(134,18,(be=o.form.get("averagecost"))==null?null:be.value,o.settingsService.getDecimalFormat("price"))),l(5),d("ngIf",o.imageBase64||((Pe=o.form.get("image"))==null?null:Pe.value))("ngIfElse",Nt),l(5),d("ngIf",o.imageBase64||((Ee=o.form.get("image"))==null?null:Ee.value)),l(4),d("disabled",o.form.invalid)}},dependencies:[F,J,T,re,ie,N,Ue,V,te,We,oe,ne,U,ue,fe,ge,A,R,B,Ye,le,me,z,$,O,k,de,ce,Y,G,q,xe,_e,bt,vt,St,he,D,Re],styles:[".dialog-content[_ngcontent-%COMP%]{min-width:500px;padding-top:10px}.tab-content[_ngcontent-%COMP%]{padding:24px 0;display:flex;flex-direction:column;gap:16px}.row[_ngcontent-%COMP%]{display:flex;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.half-width[_ngcontent-%COMP%]{width:50%}.checkboxes[_ngcontent-%COMP%]{display:flex;gap:20px;margin-top:10px}.centered-content[_ngcontent-%COMP%]{align-items:center;justify-content:center}.image-upload-container[_ngcontent-%COMP%]{width:100%;max-width:300px;height:300px;border:2px dashed #ccc;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;background-color:#fafafa;overflow:hidden}.image-upload-container[_ngcontent-%COMP%]:hover{border-color:#6200ee;background-color:#f0ebff}.image-preview-large[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;max-height:300px}.upload-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;color:#888;gap:8px}.upload-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.image-actions[_ngcontent-%COMP%]{display:flex;gap:16px;margin-top:16px}.readonly-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#666}"]})}return a})();function Kt(a,c){if(a&1&&(i(0,"div",13)(1,"div",14)(2,"span"),n(3,"Diferencia:"),t(),i(4,"span"),n(5),v(6,"currency"),t()(),i(7,"div",14)(8,"span"),n(9,"Cambio Porcentual:"),t(),i(10,"span"),n(11),v(12,"number"),t()()()),a&2){let e=h();l(4),W("positive",e.difference>0)("negative",e.difference<0),l(),s(" ",H(6,10,e.difference,"USD","$",e.settingsService.getDecimalFormat("total"))," "),l(5),W("positive",e.percentageChange>0)("negative",e.percentageChange<0),l(),s(" ",P(12,15,e.percentageChange,"1.2-2"),"% ")}}function Qt(a,c){a&1&&(i(0,"div",15)(1,"mat-icon"),n(2,"warning"),t(),i(3,"span"),n(4,"El precio debe ser mayor a 0"),t()())}function Jt(a,c){a&1&&(i(0,"mat-icon"),n(1,"save"),t())}function Xt(a,c){a&1&&(i(0,"mat-icon",16),n(1,"sync"),t())}var Ot=(()=>{class a{data;priceChangeService=x(Et);settingsService=x(j);snackBar=x(Z);dialogRef=x(se);newPrice=0;difference=0;percentageChange=0;saving=!1;constructor(e){this.data=e,this.newPrice=e.currentPrice,this.calculateDifference()}calculateDifference(){let e=Number(this.newPrice),r=Number(this.data.currentPrice)||0;e&&e>0?(this.difference=e-r,this.percentageChange=r>0?this.difference/r*100:0):(this.difference=0,this.percentageChange=0)}isValid(){let e=Number(this.newPrice),r=Number(this.data.currentPrice)||0;return e>0&&e!==r}cancel(){this.dialogRef.close()}save(){this.isValid()&&(this.saving=!0,this.priceChangeService.updateProductPrice(this.data.productId,Number(this.newPrice)).subscribe({next:e=>{this.saving=!1,this.snackBar.open("Precio actualizado correctamente","Cerrar",{duration:3e3}),this.dialogRef.close(e.product)},error:e=>{console.error("Error updating price:",e),this.saving=!1,this.snackBar.open("Error al actualizar el precio","Cerrar",{duration:3e3})}}))}static \u0275fac=function(r){return new(r||a)(w(pe))};static \u0275cmp=I({type:a,selectors:[["app-price-change-dialog"]],decls:30,vars:14,consts:[["mat-dialog-title",""],[1,"product-info"],["appearance","outline",1,"full-width"],["matInput","","type","text","placeholder","0.00","appMoneyInput","","decimalType","price","autofocus","",3,"ngModelChange","ngModel"],["matPrefix",""],["matSuffix",""],["class","price-summary",4,"ngIf"],["class","warning",4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[4,"ngIf"],["class","spinner",4,"ngIf"],[1,"price-summary"],[1,"summary-row"],[1,"warning"],[1,"spinner"]],template:function(r,o){r&1&&(i(0,"h2",0),n(1,"Cambiar Precio"),t(),i(2,"mat-dialog-content")(3,"div",1)(4,"p")(5,"strong"),n(6,"Producto:"),t(),n(7),t(),i(8,"p")(9,"strong"),n(10,"Precio Actual:"),t(),n(11),v(12,"currency"),t()(),i(13,"mat-form-field",2)(14,"mat-label"),n(15,"Nuevo Precio"),t(),i(16,"input",3),Oe("ngModelChange",function(p){return ke(o.newPrice,p)||(o.newPrice=p),p}),u("ngModelChange",function(){return o.calculateDifference()}),t(),i(17,"span",4),n(18,"$\xA0"),t(),i(19,"mat-icon",5),n(20,"attach_money"),t()(),g(21,Kt,13,18,"div",6)(22,Qt,5,0,"div",7),t(),i(23,"mat-dialog-actions",8)(24,"button",9),u("click",function(){return o.cancel()}),n(25,"Cancelar"),t(),i(26,"button",10),u("click",function(){return o.save()}),g(27,Jt,2,0,"mat-icon",11)(28,Xt,2,0,"mat-icon",12),n(29),t()()),r&2&&(l(7),s(" ",o.data.productName),l(4),s(" ",H(12,9,o.data.currentPrice,"USD","$",o.settingsService.getDecimalFormat("total"))),l(5),Fe("ngModel",o.newPrice),l(5),d("ngIf",o.newPrice&&o.newPrice>0),l(),d("ngIf",o.newPrice&&o.newPrice<=0),l(4),d("disabled",!o.isValid()||o.saving),l(),d("ngIf",!o.saving),l(),d("ngIf",o.saving),l(),s(" ",o.saving?"Guardando...":"Guardar"," "))},dependencies:[F,T,He,N,V,je,U,ue,fe,ge,A,R,B,le,me,z,$,O,k,G,q,ee,he,D,X],styles:[".product-info[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:15px;border-radius:4px;margin-bottom:20px}.product-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;color:#333}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.price-summary[_ngcontent-%COMP%]{background-color:#e3f2fd;padding:15px;border-radius:4px;margin-bottom:15px}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px}.summary-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.positive[_ngcontent-%COMP%]{color:#2e7d32;font-weight:600}.negative[_ngcontent-%COMP%]{color:#c62828;font-weight:600}.warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background-color:#fff3e0;padding:12px;border-radius:4px;color:#e65100}.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}mat-dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px}"]})}return a})();var Yt=["barcodeInput"],Zt=()=>["expandedDetail"];function ei(a,c){if(a&1&&(i(0,"mat-option",50),n(1),t()),a&2){let e=c.$implicit;d("value",e.id),l(),s(" ",e.name," ")}}function ti(a,c){a&1&&(i(0,"th",51),n(1," Referencia "),t())}function ii(a,c){if(a&1&&(i(0,"td",52),n(1),t()),a&2){let e=c.$implicit;l(),s(" ",e.reference," ")}}function ni(a,c){a&1&&(i(0,"th",51),n(1," C\xF3digo "),t())}function oi(a,c){if(a&1&&(i(0,"td",52),n(1),t()),a&2){let e=c.$implicit;l(),s(" ",e.code," ")}}function ai(a,c){a&1&&(i(0,"th",51),n(1," Nombre "),t())}function ri(a,c){if(a&1&&(i(0,"td",52),n(1),t()),a&2){let e=c.$implicit;l(),s(" ",e.name," ")}}function li(a,c){a&1&&(i(0,"th",51),n(1," Categor\xEDa "),t())}function mi(a,c){if(a&1&&(i(0,"td",52),n(1),t()),a&2){let e=c.$implicit;l(),s(" ",e.category_name||e.category," ")}}function ci(a,c){a&1&&(i(0,"th",53),n(1," Precio Venta Bs. "),t())}function di(a,c){if(a&1&&(i(0,"td",54),n(1),v(2,"currency"),t()),a&2){let e,r=c.$implicit,o=h();l(),s(" ",H(2,1,r.pricesell*o.exchangeRate,(e=o.settingsService.getSettings())==null?null:e.currency_symbol,"symbol",o.settingsService.getDecimalFormat("price"))," ")}}function si(a,c){a&1&&(i(0,"th",53),n(1," Precio Venta USD "),t())}function pi(a,c){if(a&1&&(i(0,"td",54),n(1),v(2,"number"),t()),a&2){let e=c.$implicit,r=h();l(),s(" $ ",P(2,1,e.pricesell,r.settingsService.getDecimalFormat("price")))}}function ui(a,c){a&1&&(i(0,"th",55),n(1," Acciones "),t())}function gi(a,c){if(a&1){let e=y();i(0,"td",56)(1,"div",57)(2,"button",58),u("click",function(o){let m=f(e).$implicit;return h().openPriceDialog(m),_(o.stopPropagation())}),i(3,"mat-icon"),n(4,"price_change"),t()(),i(5,"button",59),u("click",function(o){let m=f(e).$implicit;return h().openForm(m),_(o.stopPropagation())}),i(6,"mat-icon"),n(7,"edit"),t()(),i(8,"button",60),u("click",function(o){let m=f(e).$implicit;return h().deleteProduct(m),_(o.stopPropagation())}),i(9,"mat-icon"),n(10,"delete"),t()(),i(11,"button",61),u("click",function(o){let m=f(e).$implicit,p=h();return _(p.toggleExpand(m,o))}),i(12,"mat-icon"),n(13),t()()()()}if(a&2){let e=c.$implicit,r=h();l(13),Te(r.expandedElement===e?"expand_less":"expand_more")}}function fi(a,c){if(a&1&&(i(0,"div",67),C(1,"img",68),t()),a&2){let e=h().$implicit;l(),d("src","data:image/png;base64,"+e.image,K)}}function _i(a,c){if(a&1&&(i(0,"td",52)(1,"div",62)(2,"div",63)(3,"div",64)(4,"div",65)(5,"p")(6,"strong"),n(7,"Precio Compra USD:"),t(),n(8),v(9,"number"),t(),i(10,"p")(11,"strong"),n(12,"Tipo:"),t(),n(13),t(),i(14,"p")(15,"strong"),n(16,"Unidad:"),t(),n(17),t(),i(18,"p")(19,"strong"),n(20,"Stock Actual:"),t(),n(21),v(22,"number"),t()(),i(23,"div",65)(24,"p")(25,"strong"),n(26,"Servicio:"),t(),n(27),t(),i(28,"p")(29,"strong"),n(30,"Balanza:"),t(),n(31),t(),i(32,"p")(33,"strong"),n(34,"Regulado:"),t(),n(35),t(),i(36,"p")(37,"strong"),n(38,"Cat\xE1logo:"),t(),n(39),t()(),g(40,fi,2,1,"div",66),t()()()()),a&2){let e=c.$implicit,r=h();Me("colspan",r.displayedColumns.length),l(),d("@detailExpand",e==r.expandedElement?"expanded":"collapsed"),l(7),s(" $ ",P(9,11,e.pricebuy,r.settingsService.getDecimalFormat("price"))),l(5),s(" ",r.getTypeLabel(e.typeproduct)),l(4),s(" ",e.codeunit),l(4),s(" ",P(22,14,e.stock_current,"1.2-2")),l(6),s(" ",e.servicio?"S\xED":"No"),l(4),s(" ",e.isscale?"S\xED":"No"),l(4),s(" ",e.regulated?"S\xED":"No"),l(4),s(" ",e.incatalog?"S\xED":"No"),l(),d("ngIf",e.image)}}function xi(a,c){a&1&&C(0,"tr",69)}function hi(a,c){if(a&1){let e=y();i(0,"tr",70),u("click",function(o){let m=f(e).$implicit,p=h();return _(p.toggleExpand(m,o))}),t()}if(a&2){let e=c.$implicit,r=h();W("expanded-row",r.expandedElement===e)}}function Ci(a,c){a&1&&C(0,"tr",71)}function vi(a,c){a&1&&(i(0,"tr",72)(1,"td",73),n(2,"No hay productos que coincidan con los filtros"),t()())}var Bn=(()=>{class a{SalesService;products=[];categories=[];displayedColumns=["code","name","category","pricesell","pricesellusd","actions"];expandedElement=null;filterForm;barcodeInput;totalProducts=0;pageSize=50;currentPage=0;productService=x(ht);categoryService=x(Ce);dialog=x(ft);snackBar=x(Z);route=x(Ae);fb=x(ae);settingsService=x(j);exchange_rate=0;Currency;usdCurrency=null;currencies=[];exchangeRate=1;constructor(e){this.SalesService=e,this.filterForm=this.fb.group({name:[""],category:["all"],code:[""],typeproduct:[""],servicio:[""],isscale:[""],regulated:[""]})}ngOnInit(){this.loadCategories(),this.loadProducts(),this.SalesService.getCurrencies().subscribe(e=>{if(this.currencies=e,this.usdCurrency=e.find(r=>r.code==="USD")||null,this.usdCurrency){let r=this.settingsService.getSettings()?.price_decimals||2,o=Number(this.usdCurrency.exchange_rate);this.exchangeRate=parseFloat(o.toFixed(r))}}),this.route.queryParams.subscribe(e=>{e.id&&this.productService.getById(+e.id).subscribe(r=>{this.openForm(r)})}),setTimeout(()=>this.focusBarcode(),500)}focusBarcode(){this.barcodeInput&&this.barcodeInput.nativeElement.focus()}loadCategories(){this.categoryService.getAll(1,1e3).subscribe(e=>this.categories=e.data)}loadProducts(){let e=this.currentPage+1,r=this.filterForm.value,o=L({},r);o.category==="all"&&delete o.category,this.productService.getAll(e,this.pageSize,o).subscribe({next:m=>{this.products=m.data,this.totalProducts=m.total},error:m=>console.error("Error cargando productos",m)})}applyFilters(){this.currentPage=0,this.loadProducts(),this.focusBarcode()}clearFilters(){this.filterForm.reset({category:"all",typeproduct:"",servicio:"",isscale:"",regulated:""}),this.applyFilters()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadProducts()}toggleExpand(e,r){r.stopPropagation(),this.expandedElement=this.expandedElement===e?null:e}openForm(e){this.dialog.open(kt,{width:"900px",maxWidth:"95vw",data:{product:e}}).afterClosed().subscribe(o=>{o&&(e?this.productService.update(e.id,o).subscribe({next:()=>{this.showSuccess("Producto actualizado"),this.loadProducts()},error:m=>this.showError("Error al actualizar: "+m.error?.error)}):this.productService.create(o).subscribe({next:()=>{this.showSuccess("Producto creado"),this.loadProducts()},error:m=>this.showError("Error al crear: "+m.error?.error)}))})}deleteProduct(e){confirm(`\xBFEst\xE1s seguro de eliminar el producto "${e.name}"?`)&&this.productService.delete(e.id).subscribe({next:()=>{this.showSuccess("Producto eliminado"),this.loadProducts()},error:r=>this.showError("Error al eliminar: "+r.error?.error)})}openPriceDialog(e){this.dialog.open(Ot,{width:"500px",data:{productId:e.id,productName:e.name,currentPrice:e.pricesell}}).afterClosed().subscribe(o=>{o&&(this.showSuccess("Precio actualizado correctamente"),this.loadProducts())})}getTypeLabel(e){switch(e){case"SI":return"Est\xE1ndar";case"CO":return"Compuesto";case"IN":return"Insumo";case"KI":return"Kit/Combo";default:return e}}showSuccess(e){this.snackBar.open(e,"Cerrar",{duration:3e3})}showError(e){this.snackBar.open(e,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(r){return new(r||a)(w(xt))};static \u0275cmp=I({type:a,selectors:[["app-productos"]],viewQuery:function(r,o){if(r&1&&ye(Yt,5),r&2){let m;we(m=Ie())&&(o.barcodeInput=m.first)}},decls:91,vars:10,consts:[["barcodeInput",""],[1,"container"],[1,"header"],["mat-flat-button","","color","primary",3,"click"],[1,"filter-card"],[1,"filter-form",3,"ngSubmit","formGroup"],[1,"filter-row"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Ej: Arroz..."],["formControlName","category"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"barcode-container"],[1,"barcode-icon"],["type","text","formControlName","code","placeholder","Escanea C\xF3digo...",1,"barcode-input",3,"keyup.enter"],["formControlName","typeproduct"],["value",""],["value","SI"],["value","CO"],["value","IN"],["value","KI"],[1,"checkbox-group"],["formControlName","servicio"],["formControlName","isscale"],["formControlName","regulated"],[1,"button-group"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit"],[1,"table-card"],[1,"table-container"],["mat-table","","multiTemplateDataRows","",1,"full-width",3,"dataSource"],["matColumnDef","reference"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","name"],["matColumnDef","category"],["matColumnDef","pricesell"],["mat-header-cell","","style","text-align: right;",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right;",4,"matCellDef"],["matColumnDef","pricesellusd"],["matColumnDef","actions"],["mat-header-cell","","style","text-align: center;",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center;",4,"matCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","element-row",3,"expanded-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"page","length","pageSize","pageIndex"],[3,"value"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",2,"text-align","center"],["mat-cell","",2,"text-align","center"],[1,"action-buttons-cell"],["mat-icon-button","","color","accent","matTooltip","Cambiar Precio",3,"click"],["mat-icon-button","","color","primary","matTooltip","Editar",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-icon-button","",3,"click"],[1,"element-detail"],[1,"detail-container"],[1,"detail-grid"],[1,"detail-info"],["class","detail-image",4,"ngIf"],[1,"detail-image"],["alt","Producto",3,"src"],["mat-header-row",""],["mat-row","",1,"element-row",3,"click"],["mat-row","",1,"detail-row"],[1,"mat-row"],["colspan","6",1,"mat-cell"]],template:function(r,o){if(r&1){let m=y();i(0,"div",1)(1,"div",2)(2,"h1"),n(3,"Gesti\xF3n de Productos"),t(),i(4,"button",3),u("click",function(){return f(m),_(o.openForm())}),i(5,"mat-icon"),n(6,"add"),t(),n(7," Nuevo Producto "),t()(),i(8,"mat-card",4)(9,"mat-card-header")(10,"mat-card-title"),n(11,"Filtros Avanzados"),t()(),i(12,"mat-card-content")(13,"form",5),u("ngSubmit",function(){return f(m),_(o.applyFilters())}),i(14,"div",6)(15,"mat-form-field",7)(16,"mat-label"),n(17,"Nombre"),t(),C(18,"input",8),t(),i(19,"mat-form-field",7)(20,"mat-label"),n(21,"Categor\xEDa"),t(),i(22,"mat-select",9)(23,"mat-option",10),n(24,"Todas"),t(),g(25,ei,2,2,"mat-option",11),t()(),i(26,"div",12)(27,"mat-icon",13),n(28,"qr_code_scanner"),t(),i(29,"input",14,0),u("keyup.enter",function(){return f(m),_(o.applyFilters())}),t()(),i(31,"mat-form-field",7)(32,"mat-label"),n(33,"Tipo"),t(),i(34,"mat-select",15)(35,"mat-option",16),n(36,"Cualquiera"),t(),i(37,"mat-option",17),n(38,"Est\xE1ndar"),t(),i(39,"mat-option",18),n(40,"Compuesto"),t(),i(41,"mat-option",19),n(42,"Insumo"),t(),i(43,"mat-option",20),n(44,"Kit/Combo"),t()()()(),i(45,"div",6)(46,"div",21)(47,"mat-checkbox",22),n(48,"Servicio"),t(),i(49,"mat-checkbox",23),n(50,"Balanza"),t(),i(51,"mat-checkbox",24),n(52,"Regulado"),t()(),i(53,"div",25)(54,"button",26),u("click",function(){return f(m),_(o.clearFilters())}),n(55,"Limpiar"),t(),i(56,"button",27)(57,"mat-icon"),n(58,"filter_alt"),t(),n(59," Filtrar "),t()()()()()(),i(60,"mat-card",28)(61,"div",29)(62,"table",30),S(63,31),g(64,ti,2,0,"th",32)(65,ii,2,1,"td",33),b(),S(66,34),g(67,ni,2,0,"th",32)(68,oi,2,1,"td",33),b(),S(69,35),g(70,ai,2,0,"th",32)(71,ri,2,1,"td",33),b(),S(72,36),g(73,li,2,0,"th",32)(74,mi,2,1,"td",33),b(),S(75,37),g(76,ci,2,0,"th",38)(77,di,3,6,"td",39),b(),S(78,40),g(79,si,2,0,"th",38)(80,pi,3,4,"td",39),b(),S(81,41),g(82,ui,2,0,"th",42)(83,gi,14,1,"td",43),b(),S(84,44),g(85,_i,41,17,"td",33),b(),g(86,xi,1,0,"tr",45)(87,hi,1,2,"tr",46)(88,Ci,1,0,"tr",47)(89,vi,3,0,"tr",48),t()(),i(90,"app-shared-paginator",49),u("page",function(M){return f(m),_(o.onPageChange(M))}),t()()()}r&2&&(l(13),d("formGroup",o.filterForm),l(12),d("ngForOf",o.categories),l(37),d("dataSource",o.products),l(24),d("matHeaderRowDef",o.displayedColumns),l(),d("matRowDefColumns",o.displayedColumns),l(),d("matRowDefColumns",Ne(9,Zt)),l(2),d("length",o.totalProducts)("pageSize",o.pageSize)("pageIndex",o.currentPage))},dependencies:[F,J,T,re,ie,N,V,te,oe,ne,Xe,Le,Qe,Je,Ke,O,k,Ge,G,q,pt,tt,nt,lt,ot,it,mt,at,rt,ct,dt,st,U,ee,ut,gt,et,Ze,A,R,B,z,$,de,ce,Y,xe,_e,D,X],styles:[".container[_ngcontent-%COMP%]{padding:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.full-width[_ngcontent-%COMP%]{width:100%}.filter-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:12px}.filter-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding-top:16px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;align-items:center}.filter-row[_ngcontent-%COMP%] > mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:150px}.checkbox-group[_ngcontent-%COMP%]{display:flex;gap:24px;flex:2;padding:0 16px}.button-group[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;align-items:center}.barcode-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f0f2f5;border-radius:8px;padding:4px 12px;border:1px solid #ddd;box-shadow:inset 0 1px 3px #0000000d;transition:all .3s ease;height:50px;margin-bottom:4px;flex:1.5;min-width:200px}.barcode-container[_ngcontent-%COMP%]:focus-within{border-color:#6200ee;background:#fff;box-shadow:0 0 0 2px #6200ee1a}.barcode-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px;color:#666;margin-right:12px}.barcode-input[_ngcontent-%COMP%]{border:none;background:transparent;outline:none;width:100%;font-size:1rem;color:#333}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0;cursor:pointer}.element-row[_ngcontent-%COMP%]:hover{background:#0000000a}.detail-row[_ngcontent-%COMP%]{height:0}.element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex}.detail-container[_ngcontent-%COMP%]{width:100%;padding:20px;background:#fcfcfc;border-bottom:1px solid #eee}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 150px;gap:20px}.detail-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0}.detail-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#666;margin-right:8px}.detail-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:contain;border-radius:8px;border:1px solid #eee;background:#fff}.action-buttons-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}"],data:{animation:[$e("detailExpand",[Se("collapsed,void",ve({height:"0px",minHeight:"0",visibility:"hidden"})),Se("expanded",ve({height:"*",visibility:"visible"})),qe("expanded <=> collapsed",ze("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}})}return a})();export{Bn as ProductosComponent};
