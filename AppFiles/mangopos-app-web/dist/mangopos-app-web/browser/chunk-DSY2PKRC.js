import{a as ze}from"./chunk-QS7ZRVAC.js";import{a as we,b as Ee,c as De}from"./chunk-HIZ742YJ.js";import{b as F}from"./chunk-UPZQJ6EF.js";import{a as pe,b as de,c as ge,d as ue,e as fe,f as z}from"./chunk-TIBWJKFL.js";import{a as Fe,b as G}from"./chunk-XEWEKXFC.js";import{a as Oe,b as Te,c as Ie,e as Be,f as Le,g as Ve,h as A}from"./chunk-Z6YHTX75.js";import{a as K,b as U}from"./chunk-26KDQVR5.js";import{a as me}from"./chunk-SCPRHZYR.js";import"./chunk-EQXJNMRX.js";import{b as se,c as B}from"./chunk-APXOZHQA.js";import{a as _e,b as be,c as Ce,d as xe,e as he,f as Me,g as Pe,h as ye,i as ve,j as ke,l as Re,m as Se}from"./chunk-VJGP4MMT.js";import"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as te,b as ne,c as oe,f as ie,h as ae}from"./chunk-ZWM7H6SC.js";import{a as ce}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as re,i as le,j as I}from"./chunk-EWTXOCXT.js";import{b as X,f as Y,j as Z,u as ee,x as T}from"./chunk-AVLO2MYP.js";import{a as L,b as V}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as E,I as D,K as O}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as q,v as w}from"./chunk-ZD4QWOHN.js";import{$ as C,$b as j,Fb as d,Gb as o,Hb as a,Ib as P,Mb as y,Nb as v,Pb as x,Ub as p,Wa as s,Wb as g,_b as J,ac as N,db as h,ea as u,fa as f,gc as W,ic as r,jb as M,jc as b,kc as $,lc as Q,nc as k,oc as R,pb as _,pc as S}from"./chunk-WSMHJDAT.js";import{a as H}from"./chunk-C6Q5SG76.js";function Ae(i,m){i&1&&(o(0,"th",12),r(1," Nombre "),a())}function Ge(i,m){if(i&1&&(o(0,"td",13),r(1),a()),i&2){let e=m.$implicit;s(),$(" ",e.name," ")}}function He(i,m){i&1&&(o(0,"th",12),r(1," Acciones "),a())}function Je(i,m){if(i&1){let e=x();o(0,"td",13)(1,"button",14),p("click",function(){let t=u(e).$implicit,l=g();return f(l.editRole(t))}),o(2,"mat-icon"),r(3,"edit"),a()(),o(4,"button",15),p("click",function(){let t=u(e).$implicit,l=g();return f(l.deleteRole(t))}),o(5,"mat-icon"),r(6,"delete"),a()()()}}function je(i,m){i&1&&P(0,"tr",16)}function Ne(i,m){i&1&&P(0,"tr",17)}function We(i,m){if(i&1){let e=x();o(0,"div",23)(1,"mat-checkbox",24),S("ngModelChange",function(t){let l=u(e).$implicit,c=g(2);return R(c.selectedPermissions[l.key],t)||(c.selectedPermissions[l.key]=t),f(t)}),o(2,"span",25),r(3),a()()()}if(i&2){let e=m.$implicit,n=g(2);s(),k("ngModel",n.selectedPermissions[e.key]),s(2),b(e.label)}}function $e(i,m){if(i&1){let e=x();o(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",15)(4,"mat-icon"),r(5),a(),o(6,"span"),r(7),a()()(),o(8,"mat-panel-description")(9,"span",16),r(10),a()()(),o(11,"div",17)(12,"div",18)(13,"button",19),p("click",function(t){let l=u(e).$implicit;return g().toggleGroup(l,!0),f(t.stopPropagation())}),o(14,"mat-icon"),r(15,"done_all"),a(),r(16," Seleccionar Todos "),a(),o(17,"button",20),p("click",function(t){let l=u(e).$implicit;return g().toggleGroup(l,!1),f(t.stopPropagation())}),o(18,"mat-icon"),r(19,"close"),a(),r(20," Ninguno "),a()(),o(21,"div",21),_(22,We,4,2,"div",22),a()()()}if(i&2){let e=m.$implicit,n=g();d("expanded",!0),s(5),b(e.icon),s(2),b(e.name),s(2),W("all-selected",n.getSelectedCount(e)===e.permissions.length),s(),Q(" ",n.getSelectedCount(e)," / ",e.permissions.length," activos "),s(12),d("ngForOf",e.permissions)}}var Qe=[{name:"Ventas (POS)",icon:"point_of_sale",permissions:[{key:"com.openbravo.pos.sales.JPanelTicketSales",label:"Punto de Venta (POS)"},{key:"com.openbravo.pos.sales.JPanelTicketEdits",label:"Editar L\xEDneas / Ventas"},{key:"com.openbravo.pos.sales.JPanelTicketSales$JPanelTicketSalesHistory",label:"Historial de Ventas"},{key:"com.openbravo.pos.panels.JPanelCloseMoney",label:"Apertura / Cierre / Movimientos de Caja"},{key:"com.openbravo.pos.customers.CustomersPanel",label:"Gesti\xF3n de Clientes"}]},{name:"Inventario",icon:"inventory_2",permissions:[{key:"com.openbravo.pos.inventory.ProductsPanel",label:"Gesti\xF3n de Productos"},{key:"com.openbravo.pos.inventory.CategoriesPanel",label:"Categor\xEDas"},{key:"com.openbravo.pos.inventory.TaxPanel",label:"Impuestos"},{key:"com.openbravo.pos.inventory.StockDiaryPanel",label:"Movimientos de Stock / Kardex"},{key:"com.openbravo.pos.inventory.StockManagement",label:"Gesti\xF3n de Existencias"},{key:"com.openbravo.pos.inventory.BulkPriceChange",label:"Cambio Masivo de Precios"},{key:"com.openbravo.pos.inventory.KitsPanel",label:"Kits y Combos"},{key:"com.openbravo.pos.inventory.CompoundsPanel",label:"Productos Compuestos (Recetas)"}]},{name:"Administraci\xF3n / Finanzas",icon:"account_balance_wallet",permissions:[{key:"com.openbravo.pos.admin.CxCPanel",label:"Cuentas por Cobrar (CxC)"},{key:"com.openbravo.pos.admin.CxPPanel",label:"Cuentas por Pagar (CxP)"},{key:"com.openbravo.pos.admin.ExpensesPanel",label:"Control de Gastos"},{key:"com.openbravo.pos.admin.HabladoresPanel",label:"Habladores de Precio"}]},{name:"Sistema y Configuraci\xF3n",icon:"settings_suggest",permissions:[{key:"com.openbravo.pos.admin.PeoplePanel",label:"Usuarios del Sistema"},{key:"com.openbravo.pos.admin.RolesPanel",label:"Perfiles / Roles"},{key:"Menu.ChangePassword",label:"Cambio de Clave Personal"},{key:"com.openbravo.pos.config.JPanelConfiguration",label:"Configuraci\xF3n General"},{key:"com.openbravo.pos.panels.JPanelPrinter",label:"Configuraci\xF3n de Perif\xE9ricos (Impresoras)"}]},{name:"Gesti\xF3n Bancaria",icon:"account_balance",permissions:[{key:"com.openbravo.pos.panels.JPanelBanks",label:"Cuentas Bancarias / Resumen"},{key:"com.openbravo.pos.panels.JPanelBankReconcile",label:"Conciliaci\xF3n Bancaria"},{key:"com.openbravo.pos.panels.JPanelBankEntities",label:"Configuraci\xF3n: Entidades"},{key:"com.openbravo.pos.panels.JPanelBankAccountTypes",label:"Configuraci\xF3n: Tipos de Cuenta"}]}],Dt=(()=>{class i{roleService=C(ze);dialog=C(Ie);snackBar=C(K);dataSource=new Se([]);displayedColumns=["name","actions"];totalRecords=0;pageSize=50;currentPage=1;paginator;ngOnInit(){this.loadRoles()}loadRoles(){this.roleService.getRoles(this.currentPage,this.pageSize).subscribe({next:e=>{Array.isArray(e)?(this.dataSource.data=e,this.totalRecords=e.length):(this.dataSource.data=e.data,this.totalRecords=e.total)},error:e=>{console.error("Error loading roles",e),this.dataSource.data=[],this.totalRecords=0}})}onPageChange(e){this.currentPage=e.pageIndex+1,this.pageSize=e.pageSize,this.loadRoles()}editRole(e){this.dialog.open(qe,{width:"1000px",maxWidth:"95vw",data:e||{name:"",permissions:""}}).afterClosed().subscribe(t=>{t&&(e?.id?this.roleService.updateRole(e.id,t).subscribe(()=>{this.snackBar.open("Rol actualizado","Cerrar",{duration:3e3}),this.loadRoles()}):this.roleService.createRole(t).subscribe(()=>{this.snackBar.open("Rol creado","Cerrar",{duration:3e3}),this.loadRoles()}))})}deleteRole(e){confirm(`\xBFEst\xE1 seguro de eliminar el rol "${e.name}"?`)&&this.roleService.deleteRole(e.id).subscribe({next:()=>{this.snackBar.open("Rol eliminado","Cerrar",{duration:3e3}),this.loadRoles()},error:n=>{this.snackBar.open("Error al eliminar rol: "+(n.error?.message||n.message),"Cerrar",{duration:5e3})}})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=M({type:i,selectors:[["app-roles-list"]],viewQuery:function(n,t){if(n&1&&J(we,5),n&2){let l;j(l=N())&&(t.paginator=l.first)}},decls:21,vars:6,consts:[[1,"container"],[1,"main-card"],[1,"header-actions"],["mat-raised-button","","color","primary",3,"click"],["mat-table","",1,"roles-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary","matTooltip","Editar",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,t){n&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Gesti\xF3n de Roles"),a(),o(5,"div",2)(6,"button",3),p("click",function(){return t.editRole(null)}),o(7,"mat-icon"),r(8,"add"),a(),r(9," Nuevo Rol "),a()()(),o(10,"mat-card-content")(11,"table",4),y(12,5),_(13,Ae,2,0,"th",6)(14,Ge,2,1,"td",7),v(),y(15,8),_(16,He,2,0,"th",6)(17,Je,7,0,"td",7),v(),_(18,je,1,0,"tr",9)(19,Ne,1,0,"tr",10),a(),o(20,"app-shared-paginator",11),p("page",function(c){return t.onPageChange(c)}),a()()()()),n&2&&(s(11),d("dataSource",t.dataSource),s(7),d("matHeaderRowDef",t.displayedColumns),s(),d("matRowDefColumns",t.displayedColumns),s(),d("length",t.totalRecords)("pageSize",t.pageSize)("pageIndex",t.currentPage-1))},dependencies:[w,T,ae,te,oe,ie,ne,O,D,E,V,L,Re,_e,Ce,Pe,xe,be,ye,he,Me,ve,ke,A,U,I,B,G,F,z,Ee,De,me,ce],styles:[".container[_ngcontent-%COMP%], .main-card[_ngcontent-%COMP%]{padding:20px}mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.header-actions[_ngcontent-%COMP%]{margin-left:auto}.roles-table[_ngcontent-%COMP%]{width:100%}"]})}return i})(),qe=(()=>{class i{data;dialogRef;localData;permissionGroups=Qe;selectedPermissions={};constructor(e,n){this.data=e,this.dialogRef=n,this.localData=H({},e),this.parsePermissions()}getSelectedCount(e){return e.permissions.filter(n=>this.selectedPermissions[n.key]).length}toggleGroup(e,n){e.permissions.forEach(t=>{this.selectedPermissions[t.key]=n})}parsePermissions(){let e=this.localData.permissions||"",n=/<class\s+name="([^"]+)"\s*\/>/g,t;for(this.permissionGroups.forEach(l=>{l.permissions.forEach(c=>{this.selectedPermissions[c.key]=!1})});(t=n.exec(e))!==null;)this.selectedPermissions[t[1]]=!0}generateXML(){let e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<permissions>
`;return e+=`  <class name="com.openbravo.pos.forms.JPanelMenu"/>
`,e+=`  <class name="Menu.Exit"/>
`,Object.keys(this.selectedPermissions).forEach(n=>{this.selectedPermissions[n]&&(e+=`  <class name="${n}"/>
`)}),e+="</permissions>",e}onSave(){this.localData.permissions=this.generateXML(),this.dialogRef.close(this.localData)}static \u0275fac=function(n){return new(n||i)(h(Te),h(Oe))};static \u0275cmp=M({type:i,selectors:[["app-role-dialog"]],decls:22,vars:4,consts:[[1,"roles-dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],["mat-icon-button","",1,"close-btn",3,"click"],[1,"dialog-content"],["appearance","outline",1,"full-width","name-field"],["matInput","","required","","placeholder","Ej. Cajero, Administrador...",3,"ngModelChange","ngModel"],[1,"permissions-container"],[1,"section-label"],["multi","true"],["class","group-panel",3,"expanded",4,"ngFor","ngForOf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"group-panel",3,"expanded"],[1,"title-with-icon"],[1,"count-badge"],[1,"panel-inner"],[1,"panel-actions"],["mat-stroked-button","","color","primary",3,"click"],["mat-stroked-button","","color","warn",3,"click"],[1,"checkbox-grid"],["class","perm-item",4,"ngFor","ngForOf"],[1,"perm-item"],["color","primary",3,"ngModelChange","ngModel"],[1,"perm-label"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),r(3),a(),o(4,"button",3),p("click",function(){return t.dialogRef.close()}),o(5,"mat-icon"),r(6,"close"),a()()(),o(7,"mat-dialog-content",4)(8,"mat-form-field",5)(9,"mat-label"),r(10,"Nombre del Rol"),a(),o(11,"input",6),S("ngModelChange",function(c){return R(t.localData.name,c)||(t.localData.name=c),c}),a()(),o(12,"div",7)(13,"label",8),r(14,"Asignaci\xF3n de Permisos de Acceso"),a(),o(15,"mat-accordion",9),_(16,$e,23,8,"mat-expansion-panel",10),a()()(),o(17,"mat-dialog-actions",11)(18,"button",12),p("click",function(){return t.dialogRef.close()}),r(19,"Cancelar"),a(),o(20,"button",13),p("click",function(){return t.onSave()}),r(21,"Guardar Cambios"),a()()()),n&2&&(s(3),b(t.data.id?"Editar Rol":"Nuevo Rol"),s(8),k("ngModel",t.localData.name),s(5),d("ngForOf",t.permissionGroups),s(4),d("disabled",!t.localData.name))},dependencies:[w,q,T,X,Y,ee,Z,O,D,E,I,le,re,B,se,A,Be,Ve,Le,G,Fe,F,z,fe,pe,de,ue,ge,V,L],styles:[".roles-dialog-container[_ngcontent-%COMP%]{padding:0}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #eee;background:#fbfbfb}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0!important;font-weight:500;color:#3f51b5}.close-btn[_ngcontent-%COMP%]{color:#666}.full-width[_ngcontent-%COMP%]{width:100%}.name-field[_ngcontent-%COMP%]{margin-top:16px}.dialog-content[_ngcontent-%COMP%]{width:100%;max-height:70vh;padding:0 24px 24px;overflow-x:hidden;box-sizing:border-box}.section-label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#1a237e;margin-bottom:16px;font-size:1rem;border-left:4px solid #3f51b5;padding-left:12px}.group-panel[_ngcontent-%COMP%]{margin-bottom:12px!important;border:1px solid #e0e0e0;border-radius:8px!important;box-shadow:0 2px 4px #0000000d!important;overflow:hidden}.title-with-icon[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.title-with-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3f51b5}.title-with-icon[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;font-size:.95rem}.count-badge[_ngcontent-%COMP%]{background:#f5f5f5;color:#757575;padding:2px 10px;border-radius:12px;font-size:.75rem;font-weight:600;border:1px solid #e0e0e0}.count-badge.all-selected[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;border-color:#c8e6c9}.panel-inner[_ngcontent-%COMP%]{padding:8px 16px 16px;background:#fafafa}.panel-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid #e0e0e0}.panel-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:.8rem;height:36px;display:flex;align-items:center;gap:6px}.panel-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.checkbox-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}.perm-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;background:#fff;padding:10px;border-radius:6px;border:1px solid #f0f0f0;transition:all .2s ease}.perm-item[_ngcontent-%COMP%]:hover{border-color:#3f51b5;background:#f5f6ff}.perm-label[_ngcontent-%COMP%]{font-size:.85rem;color:#424242;font-weight:400;line-height:1.3}  .mat-expansion-panel-header{background:#fff!important;height:56px!important}  .mat-expansion-panel-header:hover{background:#fcfcfc!important}  .mat-checkbox-inner-container{margin-top:2px!important}"]})}return i})();export{qe as RoleDialogComponent,Dt as RolesListComponent};
