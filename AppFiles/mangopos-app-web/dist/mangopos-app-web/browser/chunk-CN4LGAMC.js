import{a as _e}from"./chunk-R3L57XND.js";import{a as ge,b as Ce}from"./chunk-NL74O3Y5.js";import{a as ne,b as ie,c as oe,d as re,e as ae,f as se}from"./chunk-TW2J4ZKO.js";import{a as le,b as me,e as ce,f as ue,g as de,h as pe}from"./chunk-Z6YHTX75.js";import{a as D}from"./chunk-26KDQVR5.js";import{a as ee,b as te}from"./chunk-N5ZCCEPE.js";import{b as Q,c as X}from"./chunk-APXOZHQA.js";import{b as Y,f as H,i as J,j as K}from"./chunk-EWTXOCXT.js";import{b as j,f as U,j as G,u as q,x as z}from"./chunk-AVLO2MYP.js";import{a as Z,b as $}from"./chunk-JI7GBIO6.js";import{I as N,K as B}from"./chunk-M7DMR53X.js";import{k as A,l as F,v as W}from"./chunk-ZD4QWOHN.js";import{$ as h,D as I,Fb as d,G as T,Gb as n,Hb as o,Ib as R,Mb as S,Nb as M,P as v,Pb as _,Ub as g,Wa as r,Wb as l,e as E,ea as c,fa as u,ic as s,jb as V,jc as b,kc as k,lc as P,nc as C,oc as f,pb as w,pc as x,vc as L,wc as O}from"./chunk-WSMHJDAT.js";import{a as y}from"./chunk-C6Q5SG76.js";function fe(i,p){i&1&&R(0,"mat-spinner",14)}function xe(i,p){if(i&1){let e=_();n(0,"mat-list-item",16),g("click",function(){let t=c(e).$implicit,a=l(3);return u(a.selectCustomer(t))}),n(1,"mat-icon",17),s(2,"person"),o(),n(3,"div",18),s(4),o(),n(5,"div",19),s(6),L(7,"phoneFormat"),o()()}if(i&2){let e=p.$implicit;r(4),b(e.name),r(2),P("",e.taxid||"Sin C\xE9dula"," | ",O(7,3,e.phone)||"Sin tel\xE9fono")}}function he(i,p){if(i&1&&(n(0,"mat-list"),w(1,xe,8,5,"mat-list-item",15),o()),i&2){let e=l(2);r(),d("ngForOf",e.customers)}}function we(i,p){if(i&1){let e=_();n(0,"div",20)(1,"p"),s(2,"No se encontraron clientes que coincidan."),o(),n(3,"button",21),g("click",function(){c(e);let t=l(2);return u(t.isRegistering=!0)}),n(4,"mat-icon"),s(5,"person_add"),o(),s(6," REGISTRAR NUEVO "),o()()}}function Se(i,p){if(i&1){let e=_();S(0),n(1,"mat-form-field",8)(2,"mat-label"),s(3,"Buscar por Nombre, C\xE9dula o RIF"),o(),n(4,"input",9,0),x("ngModelChange",function(t){c(e);let a=l();return f(a.searchText,t)||(a.searchText=t),u(t)}),g("input",function(){c(e);let t=l();return u(t.onSearchChange())}),o(),n(6,"mat-icon",10),s(7,"search"),o()(),n(8,"div",11),w(9,fe,1,0,"mat-spinner",12)(10,he,2,1,"mat-list",3)(11,we,7,0,"div",13),o(),M()}if(i&2){let e=l();r(4),C("ngModel",e.searchText),r(5),d("ngIf",e.loading),r(),d("ngIf",!e.loading&&e.customers.length>0),r(),d("ngIf",!e.loading&&e.customers.length===0&&e.searchText.length>2)}}function Me(i,p){if(i&1){let e=_();S(0),n(1,"div",22)(2,"mat-form-field",8)(3,"mat-label"),s(4,"Nombre Completo / Raz\xF3n Social"),o(),n(5,"input",23),x("ngModelChange",function(t){c(e);let a=l();return f(a.newCustomer.name,t)||(a.newCustomer.name=t),u(t)}),o()(),n(6,"mat-form-field",8)(7,"mat-label"),s(8,"C\xE9dula / RIF"),o(),n(9,"input",24),x("ngModelChange",function(t){c(e);let a=l();return f(a.newCustomer.taxid,t)||(a.newCustomer.taxid=t),u(t)}),o()(),n(10,"div",25)(11,"mat-form-field",26)(12,"mat-label"),s(13,"Tel\xE9fono"),o(),n(14,"input",27),x("ngModelChange",function(t){c(e);let a=l();return f(a.newCustomer.phone,t)||(a.newCustomer.phone=t),u(t)}),o()(),n(15,"mat-form-field",26)(16,"mat-label"),s(17,"Correo"),o(),n(18,"input",28),x("ngModelChange",function(t){c(e);let a=l();return f(a.newCustomer.email,t)||(a.newCustomer.email=t),u(t)}),o()()(),n(19,"mat-form-field",8)(20,"mat-label"),s(21,"Direcci\xF3n"),o(),n(22,"textarea",29),x("ngModelChange",function(t){c(e);let a=l();return f(a.newCustomer.address,t)||(a.newCustomer.address=t),u(t)}),o()()(),M()}if(i&2){let e=l();r(5),C("ngModel",e.newCustomer.name),r(4),C("ngModel",e.newCustomer.taxid),r(5),C("ngModel",e.newCustomer.phone),r(4),C("ngModel",e.newCustomer.email),r(4),C("ngModel",e.newCustomer.address)}}function be(i,p){if(i&1){let e=_();n(0,"button",30),g("click",function(){c(e);let t=l();return u(t.onCancel())}),s(1,"CANCELAR"),o()}}function ye(i,p){if(i&1){let e=_();n(0,"button",30),g("click",function(){c(e);let t=l();return u(t.isRegistering=!1)}),s(1,"VOLVER A BUSCAR"),o()}}function Ee(i,p){if(i&1){let e=_();n(0,"button",31),g("click",function(){c(e);let t=l();return u(t.saveNewCustomer())}),s(1),o()}if(i&2){let e=l();d("disabled",!e.newCustomer.name||e.saving),r(),k(" ",e.saving?"GUARDANDO...":"GUARDAR Y SELECCIONAR"," ")}}function Ie(i,p){if(i&1){let e=_();n(0,"button",21),g("click",function(){c(e);let t=l();return u(t.isRegistering=!0)}),s(1," NUEVO CLIENTE "),o()}}var et=(()=>{class i{customerService=h(_e);dialogRef=h(le);snackBar=h(D);data=h(me,{optional:!0});searchText="";customers=[];loading=!1;isRegistering=!1;saving=!1;newCustomer={name:"",taxid:"",phone:"",email:"",address:""};searchSubject=new E;ngOnInit(){this.data?.customer&&(this.isRegistering=!0,this.newCustomer=y({},this.data.customer)),this.searchSubject.pipe(I(300),T(),v(e=>e.length<2?(this.loading=!1,[{data:[],total:0,page:1,totalPages:0}]):(this.loading=!0,this.customerService.getAll(1,100,e)))).subscribe(e=>{this.customers=e.data,this.loading=!1}),this.loading=!0,this.customerService.getAll(1,20).subscribe(e=>{this.customers=e.data,this.loading=!1})}getTitle(){return this.isRegistering?this.newCustomer.id?"Editar Cliente":"Nuevo Cliente":"Seleccionar Cliente"}onSearchChange(){this.searchSubject.next(this.searchText)}selectCustomer(e){this.dialogRef.close(e)}async saveNewCustomer(){if(this.newCustomer.name){this.saving=!0;try{let e;this.newCustomer.id?e=await this.customerService.update(this.newCustomer.id,this.newCustomer).toPromise():e=await this.customerService.create(this.newCustomer).toPromise(),e&&(this.snackBar.open(this.newCustomer.id?"Cliente actualizado":"Cliente registrado","Cerrar",{duration:3e3}),this.dialogRef.close(e))}catch(e){this.snackBar.open("Error al guardar cliente: "+(e.error?.error||"Error desconocido"),"Cerrar",{duration:5e3})}finally{this.saving=!1}}}onCancel(){this.dialogRef.close()}static \u0275fac=function(m){return new(m||i)};static \u0275cmp=V({type:i,selectors:[["app-customer-selector"]],decls:11,vars:7,consts:[["searchInput",""],["mat-dialog-title",""],[1,"customer-dialog-content"],[4,"ngIf"],["align","end"],["mat-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["appearance","outline",1,"full-width"],["matInput","","placeholder","Ej: Perez o 20.123...",3,"ngModelChange","input","ngModel"],["matSuffix",""],[1,"results-container"],["diameter","40","class","spinner",4,"ngIf"],["class","no-results",4,"ngIf"],["diameter","40",1,"spinner"],["class","customer-item",3,"click",4,"ngFor","ngForOf"],[1,"customer-item",3,"click"],["matListItemIcon",""],["matListItemTitle",""],["matListItemLine",""],[1,"no-results"],["mat-stroked-button","","color","primary",3,"click"],[1,"registration-form"],["matInput","","required","",3,"ngModelChange","ngModel"],["matInput","",3,"ngModelChange","ngModel"],[1,"form-row"],["appearance","outline"],["matInput","","appPhoneFormat","",3,"ngModelChange","ngModel"],["matInput","","type","email",3,"ngModelChange","ngModel"],["matInput","","rows","2",3,"ngModelChange","ngModel"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(m,t){m&1&&(n(0,"div")(1,"h2",1),s(2),o()(),n(3,"mat-dialog-content",2),w(4,Se,12,4,"ng-container",3)(5,Me,23,5,"ng-container",3),o(),n(6,"mat-dialog-actions",4),w(7,be,2,0,"button",5)(8,ye,2,0,"button",5)(9,Ee,2,2,"button",6)(10,Ie,2,0,"button",7),o()),m&2&&(r(2),b(t.getTitle()),r(2),d("ngIf",!t.isRegistering),r(),d("ngIf",t.isRegistering),r(2),d("ngIf",!t.isRegistering),r(),d("ngIf",t.isRegistering),r(),d("ngIf",t.isRegistering),r(),d("ngIf",!t.isRegistering))},dependencies:[W,A,F,z,j,U,q,G,pe,ce,de,ue,K,J,Y,H,X,Q,B,N,$,Z,se,re,ae,oe,ie,ne,te,ee,Ce,ge],styles:[".customer-dialog-content[_ngcontent-%COMP%]{min-width:450px;min-height:350px}.full-width[_ngcontent-%COMP%]{width:100%}.results-container[_ngcontent-%COMP%]{height:250px;overflow-y:auto;margin-top:10px;border:1px solid #eee;border-radius:4px}.spinner[_ngcontent-%COMP%]{margin:50px auto}.customer-item[_ngcontent-%COMP%]{cursor:pointer;transition:background .2s}.customer-item[_ngcontent-%COMP%]:hover{background:#f5f5f5}.no-results[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;gap:10px;color:#666}.registration-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;padding-top:10px}.form-row[_ngcontent-%COMP%]{display:flex;gap:10px}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}"]})}return i})();export{et as a};
