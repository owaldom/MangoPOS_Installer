import{a as Ae}from"./chunk-R3L57XND.js";import{a as Oe,b as Be,c as Ve}from"./chunk-HCWDTVFW.js";import{a as Ce}from"./chunk-XGFVHFBN.js";import{a as ke}from"./chunk-HCKXU6G4.js";import{a as De}from"./chunk-DGQM6DPS.js";import{a as Te,b as Re,c as we,d as Pe}from"./chunk-N7P7XLP2.js";import{a as _e,b as fe}from"./chunk-N5ZCCEPE.js";import{d as L,e as z}from"./chunk-GRESZPIF.js";import"./chunk-EQXJNMRX.js";import{b as de,c as pe}from"./chunk-APXOZHQA.js";import{a as ge,b as ve,c as xe,d as ye,e as he,f as Me,g as Se,h as be,i as Ie,j as Ee,l as Fe}from"./chunk-VJGP4MMT.js";import"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as ie,c as oe,h as re}from"./chunk-ZWM7H6SC.js";import"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as W}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as ae,f as le,i as me,j as ce}from"./chunk-EWTXOCXT.js";import{b as K,f as Q,i as Y,j as Z,m as ee,x as te,y as ne}from"./chunk-AVLO2MYP.js";import{a as se,b as ue}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as q,I as X,K as J}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as j,l as G,r as P,s as I,v as U}from"./chunk-ZD4QWOHN.js";import{$ as M,D as O,Fb as d,G as B,Gb as i,Hb as n,Ib as h,Mb as f,Nb as C,P as V,Pb as D,Ub as b,Wa as a,Wb as S,ea as x,ec as E,fa as y,ic as o,j as k,jb as A,jc as F,kc as _,lc as N,nc as T,oc as R,pb as p,pc as w,rc as $,vc as g,wc as H,xc as v}from"./chunk-WSMHJDAT.js";import"./chunk-C6Q5SG76.js";function $e(e,r){if(e&1&&(i(0,"mat-option",22),o(1),n()),e&2){let t=r.$implicit;d("value",t),a(),N(" ",t.name," (",t.taxid,") ")}}function He(e,r){if(e&1){let t=D();i(0,"button",23),b("click",function(){x(t);let l=S();return y(l.clearCustomer())}),i(1,"mat-icon"),o(2,"close"),n()()}}function je(e,r){e&1&&(i(0,"th",49),o(1," Factura "),n())}function Ge(e,r){if(e&1&&(i(0,"td",50),o(1),n()),e&2){let t=r.$implicit;a(),_(" #",t.ticket_number," ")}}function Ue(e,r){e&1&&(i(0,"th",49),o(1," Fecha "),n())}function We(e,r){if(e&1&&(i(0,"td",50),o(1),g(2,"systemDate"),n()),e&2){let t=r.$implicit;a(),_(" ",H(2,1,t.date)," ")}}function Le(e,r){e&1&&(i(0,"th",49),o(1," Cliente "),n())}function ze(e,r){if(e&1&&(i(0,"small"),o(1),n()),e&2){let t=S().$implicit;a(),F(t.customer_taxid)}}function qe(e,r){if(e&1&&(i(0,"td",50)(1,"div",51)(2,"span"),o(3),n(),p(4,ze,2,1,"small",52),n()()),e&2){let t=r.$implicit;a(3),F(t.customer_name),a(),d("ngIf",t.customer_taxid)}}function Xe(e,r){e&1&&(i(0,"th",53),o(1," Tasa "),n())}function Je(e,r){if(e&1&&(i(0,"td",54),o(1),g(2,"number"),n()),e&2){let t=r.$implicit;a(),_(" ",v(2,1,t.exchange_rate,"1.2-2")," ")}}function Ke(e,r){e&1&&(i(0,"th",53),o(1," Total USD "),n())}function Qe(e,r){if(e&1&&(i(0,"td",54),o(1),g(2,"number"),n()),e&2){let t=r.$implicit;a(),_(" $ ",v(2,1,t.total_usd,"1.2-2")," ")}}function Ye(e,r){e&1&&(i(0,"th",53),o(1," Total Bs "),n())}function Ze(e,r){if(e&1&&(i(0,"td",54),o(1),g(2,"number"),n()),e&2){let t=r.$implicit;a(),_(" Bs. ",v(2,1,t.total_bs,"1.2-2")," ")}}function et(e,r){e&1&&(i(0,"th",55),o(1," IGTF USD "),n())}function tt(e,r){if(e&1&&(i(0,"td",56),o(1),g(2,"number"),n()),e&2){let t=r.$implicit;a(),_(" $ ",v(2,1,t.igtf_usd,"1.2-2")," ")}}function nt(e,r){e&1&&(i(0,"th",55),o(1," IGTF Bs "),n())}function it(e,r){if(e&1&&(i(0,"td",56),o(1),g(2,"number"),n()),e&2){let t=r.$implicit;a(),_(" Bs. ",v(2,1,t.igtf_bs,"1.2-2")," ")}}function ot(e,r){e&1&&(i(0,"th",49),o(1," M\xE9todos "),n())}function rt(e,r){if(e&1&&(i(0,"td",50),o(1),n()),e&2){let t=r.$implicit,c=S(2);a(),_(" ",c.getPaymentMethods(t.payment_methods)," ")}}function at(e,r){e&1&&(i(0,"th",49),o(1," Estado "),n())}function lt(e,r){if(e&1&&(i(0,"td",50),o(1),n()),e&2){let t=r.$implicit,c=S(2);a(),_(" ",c.getStatus_es(t.status)," ")}}function mt(e,r){e&1&&h(0,"tr",57)}function ct(e,r){e&1&&h(0,"tr",58)}function dt(e,r){if(e&1&&(i(0,"div",24)(1,"div",25)(2,"mat-card",26)(3,"mat-card-content")(4,"div",27),o(5,"Total Facturas"),n(),i(6,"div",28),o(7),n()()(),i(8,"mat-card",26)(9,"mat-card-content")(10,"div",27),o(11,"Total Ventas (USD)"),n(),i(12,"div",28),o(13),g(14,"number"),n()()(),i(15,"mat-card",29)(16,"mat-card-content")(17,"div",27),o(18,"Total IGTF (USD)"),n(),i(19,"div",28),o(20),g(21,"number"),n()()(),i(22,"mat-card",29)(23,"mat-card-content")(24,"div",27),o(25,"Total IGTF (Bs)"),n(),i(26,"div",28),o(27),g(28,"number"),n()()()(),i(29,"table",30),f(30,31),p(31,je,2,0,"th",32)(32,Ge,2,1,"td",33),C(),f(33,34),p(34,Ue,2,0,"th",32)(35,We,3,3,"td",33),C(),f(36,35),p(37,Le,2,0,"th",32)(38,qe,5,2,"td",33),C(),f(39,36),p(40,Xe,2,0,"th",37)(41,Je,3,4,"td",38),C(),f(42,39),p(43,Ke,2,0,"th",37)(44,Qe,3,4,"td",38),C(),f(45,40),p(46,Ye,2,0,"th",37)(47,Ze,3,4,"td",38),C(),f(48,41),p(49,et,2,0,"th",42)(50,tt,3,4,"td",43),C(),f(51,44),p(52,nt,2,0,"th",42)(53,it,3,4,"td",43),C(),f(54,45),p(55,ot,2,0,"th",32)(56,rt,2,1,"td",33),C(),f(57,46),p(58,at,2,0,"th",32)(59,lt,2,1,"td",33),C(),p(60,mt,1,0,"tr",47)(61,ct,1,0,"tr",48),n()()),e&2){let t=S();a(7),F(t.summary.total_invoices),a(6),_("$ ",v(14,7,t.summary.total_sales_usd,"1.2-2")),a(7),_("$ ",v(21,10,t.summary.total_igtf_usd,"1.2-2")),a(7),_("Bs. ",v(28,13,t.summary.total_igtf_bs,"1.2-2")),a(2),d("dataSource",t.data),a(31),d("matHeaderRowDef",t.displayedColumns),a(),d("matRowDefColumns",t.displayedColumns)}}function pt(e,r){e&1&&(i(0,"div",59)(1,"mat-icon"),o(2,"info"),n(),i(3,"p"),o(4,"No se encontraron datos para el rango seleccionado."),n()())}function st(e,r){e&1&&(i(0,"div",60),h(1,"mat-spinner",61),i(2,"p"),o(3,"Generando reporte..."),n()())}var zt=(()=>{class e{reportsService=M(ke);customerService=M(Ae);settingsService=M(De);datePipe=M(P);decimalPipe=M(I);startDate=new Date;endDate=new Date;customerControl=new Y("");selectedCustomer=null;filteredCustomers=[];loading=!1;data=[];summary={};displayedColumns=["ticket_number","date","customer","exchange_rate","total_usd","total_bs","igtf_usd","igtf_bs","payments","status"];constructor(){this.startDate.setDate(1),this.customerControl.valueChanges.pipe(O(300),B(),V(t=>{let c=t||"";return c.length>2?this.customerService.getAll(1,20,c):k({data:[]})})).subscribe(t=>{this.filteredCustomers=t.data||[]})}displayCustomer(t){return t?t.name:""}onCustomerSelected(t){this.selectedCustomer=t.option.value}clearCustomer(){this.customerControl.setValue(""),this.selectedCustomer=null}generateReport(){this.loading=!0;let t=this.datePipe.transform(this.startDate,"yyyy-MM-dd")||"",c=this.datePipe.transform(this.endDate,"yyyy-MM-dd")||"",l=this.selectedCustomer?.id;this.reportsService.getInvoicesWithForeignCurrency(t,c,l).subscribe({next:s=>{this.data=s.invoices,this.summary=s.summary,this.loading=!1},error:s=>{console.error("Error generating report:",s),this.loading=!1}})}exportToExcel(){let t=["Nro. Ticket","Fecha","Cliente","RIF/CI","Tasa Cambio","Total USD","Total Bs","IGTF USD","IGTF Bs","M\xE9todos de Pago","Estado"],c=this.data.map(m=>[m.ticket_number,this.datePipe.transform(m.date,"dd/MM/yyyy HH:mm"),m.customer_name,m.customer_taxid,Number(m.exchange_rate).toFixed(2),Number(m.total_usd).toFixed(2),Number(m.total_bs).toFixed(2),Number(m.igtf_usd).toFixed(2),Number(m.igtf_bs).toFixed(2),this.getPaymentMethods(m.payment_methods),this.getStatus_es(m.status)]);c.push(["TOTALES","","","","",(this.summary.total_sales_usd||0).toFixed(2),(this.summary.total_sales_bs||0).toFixed(2),(this.summary.total_igtf_usd||0).toFixed(2),(this.summary.total_igtf_bs||0).toFixed(2),"",""]);let l=[t.join(";"),...c.map(m=>m.map(Ne=>`"${Ne}"`).join(";"))].join(`
`),s=new Blob([l],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a");if(u.download!==void 0){let m=URL.createObjectURL(s);u.setAttribute("href",m),u.setAttribute("download",`Reporte_Facturas_Divisas_${this.datePipe.transform(new Date,"yyyyMMdd")}.csv`),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)}}getPaymentMethods(t){let c={cash:"Efectivo",card:"Tarjeta",transfer:"Transferencia",paper:"Pago M\xF3vil",debt:"Cr\xE9dito",debtpaid:"Abono Deuda",PagoMovil:"Pago M\xF3vil",Credito:"Cr\xE9dito",Debito:"D\xE9bito",magcard:"Tarjeta",cheque:"Cheque"};return t.map(l=>c[l]||l).join(", ")}getStatus_es(t){return{paid:"Pagado",partial:"Parcial",pending:"Pendiente"}[t]||t}static \u0275fac=function(c){return new(c||e)};static \u0275cmp=A({type:e,selectors:[["app-invoices-foreign-currency-report"]],features:[$([P,I,z()])],decls:42,vars:16,consts:[["pickerStart",""],["pickerEnd",""],["auto","matAutocomplete"],[1,"report-container"],[1,"header-section"],[1,"subtitle"],[1,"filter-card"],[1,"filter-content"],["appearance","outline"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],["appearance","outline",1,"customer-field"],["matInput","","placeholder","Buscar cliente...",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],[1,"actions"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","accent",3,"click","disabled"],["class","results-container",4,"ngIf"],["class","no-data",4,"ngIf"],["class","spinner-container",4,"ngIf"],[3,"value"],["mat-icon-button","","matSuffix","",3,"click"],[1,"results-container"],[1,"summary-cards"],[1,"kpi-card"],[1,"kpi-label"],[1,"kpi-value"],[1,"kpi-card","highlight"],["mat-table","",1,"mat-elevation-z2","report-table",3,"dataSource"],["matColumnDef","ticket_number"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","customer"],["matColumnDef","exchange_rate"],["mat-header-cell","","class","numeric-cell",4,"matHeaderCellDef"],["mat-cell","","class","numeric-cell",4,"matCellDef"],["matColumnDef","total_usd"],["matColumnDef","total_bs"],["matColumnDef","igtf_usd"],["mat-header-cell","","class","numeric-cell text-warn",4,"matHeaderCellDef"],["mat-cell","","class","numeric-cell text-warn",4,"matCellDef"],["matColumnDef","igtf_bs"],["matColumnDef","payments"],["matColumnDef","status"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"customer-info"],[4,"ngIf"],["mat-header-cell","",1,"numeric-cell"],["mat-cell","",1,"numeric-cell"],["mat-header-cell","",1,"numeric-cell","text-warn"],["mat-cell","",1,"numeric-cell","text-warn"],["mat-header-row",""],["mat-row",""],[1,"no-data"],[1,"spinner-container"],["diameter","50"]],template:function(c,l){if(c&1){let s=D();i(0,"div",3)(1,"div",4)(2,"h1"),o(3,"Reporte de Facturas en Divisas (IGTF)"),n(),i(4,"p",5),o(5,"Consulta de facturas pagadas en moneda extranjera y desglose de IGTF"),n()(),i(6,"mat-card",6)(7,"mat-card-content",7)(8,"mat-form-field",8)(9,"mat-label"),o(10,"Desde"),n(),i(11,"input",9),w("ngModelChange",function(m){return x(s),R(l.startDate,m)||(l.startDate=m),y(m)}),n(),h(12,"mat-datepicker-toggle",10)(13,"mat-datepicker",null,0),n(),i(15,"mat-form-field",8)(16,"mat-label"),o(17,"Hasta"),n(),i(18,"input",9),w("ngModelChange",function(m){return x(s),R(l.endDate,m)||(l.endDate=m),y(m)}),n(),h(19,"mat-datepicker-toggle",10)(20,"mat-datepicker",null,1),n(),i(22,"mat-form-field",11)(23,"mat-label"),o(24,"Cliente (Opcional)"),n(),h(25,"input",12),i(26,"mat-autocomplete",13,2),b("optionSelected",function(m){return x(s),y(l.onCustomerSelected(m))}),p(28,$e,2,3,"mat-option",14),n(),p(29,He,3,0,"button",15),n(),i(30,"div",16)(31,"button",17),b("click",function(){return x(s),y(l.generateReport())}),i(32,"mat-icon"),o(33,"search"),n(),o(34," GENERAR "),n(),i(35,"button",18),b("click",function(){return x(s),y(l.exportToExcel())}),i(36,"mat-icon"),o(37,"file_download"),n(),o(38," EXCEL "),n()()()(),p(39,dt,62,16,"div",19)(40,pt,5,0,"div",20)(41,st,4,0,"div",21),n()}if(c&2){let s=E(14),u=E(21),m=E(27);a(11),d("matDatepicker",s),T("ngModel",l.startDate),a(),d("for",s),a(6),d("matDatepicker",u),T("ngModel",l.endDate),a(),d("for",u),a(6),d("formControl",l.customerControl)("matAutocomplete",m),a(),d("displayWith",l.displayCustomer),a(2),d("ngForOf",l.filteredCustomers),a(),d("ngIf",l.selectedCustomer),a(2),d("disabled",l.loading),a(4),d("disabled",l.data.length===0),a(4),d("ngIf",!l.loading&&l.data.length>0),a(),d("ngIf",!l.loading&&l.data.length===0),a(),d("ngIf",l.loading)}},dependencies:[U,j,G,te,K,Q,Z,ne,ee,re,ie,oe,ce,me,ae,le,pe,de,J,X,q,ue,se,Fe,ge,xe,Se,ye,ve,be,he,Me,Ie,Ee,Pe,Te,Re,we,L,Ve,Oe,W,Be,fe,_e,I,Ce],styles:[".report-container[_ngcontent-%COMP%]{padding:20px;display:flex;flex-direction:column;gap:20px;height:100%}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.subtitle[_ngcontent-%COMP%]{margin:5px 0 0;color:#666}.filter-card[_ngcontent-%COMP%]{padding:10px}.filter-content[_ngcontent-%COMP%]{display:flex;gap:15px;flex-wrap:wrap;align-items:center}.customer-field[_ngcontent-%COMP%]{flex:1;min-width:250px}.actions[_ngcontent-%COMP%]{display:flex;gap:10px}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:20px}.kpi-card[_ngcontent-%COMP%]{border-left:4px solid #1976d2}.kpi-card.highlight[_ngcontent-%COMP%]{border-left:4px solid #ff9800;background-color:#fff3e0}.kpi-label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;letter-spacing:.5px}.kpi-value[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin-top:5px;color:#333}.highlight[_ngcontent-%COMP%]   .kpi-value[_ngcontent-%COMP%]{color:#e65100}.report-table[_ngcontent-%COMP%]{width:100%}.numeric-cell[_ngcontent-%COMP%]{text-align:right;font-family:Roboto Mono,monospace}.text-warn[_ngcontent-%COMP%]{color:#d32f2f;font-weight:500}.customer-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;line-height:1.2}.customer-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#888;font-size:11px}.no-data[_ngcontent-%COMP%], .spinner-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:50px;color:#666;gap:15px}.spinner-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}"]})}return e})();export{zt as InvoicesForeignCurrencyReportComponent};
