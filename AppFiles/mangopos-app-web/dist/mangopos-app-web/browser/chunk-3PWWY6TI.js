import{a as Te}from"./chunk-HLIXJ3A2.js";import{b as be,c as Me}from"./chunk-HIZ742YJ.js";import{a as Fe,b as Ie}from"./chunk-XEWEKXFC.js";import{a as Se,b as ve,c as ye,e as we,f as Ee,g as De,h as P}from"./chunk-Z6YHTX75.js";import{a as j,b as H}from"./chunk-26KDQVR5.js";import"./chunk-SCPRHZYR.js";import"./chunk-EQXJNMRX.js";import{b as ne,c as oe}from"./chunk-APXOZHQA.js";import{a as re,b as le,c as me,d as se,e as ce,f as de,g as pe,h as ge,i as ue,j as fe,k as Ce,l as _e}from"./chunk-VJGP4MMT.js";import{a as he,b as xe}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as Y,h as Z}from"./chunk-ZWM7H6SC.js";import"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as A}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as ee,c as te,i as ie,j as ae}from"./chunk-EWTXOCXT.js";import{b as G,d as q,f as L,g as U,k as J,n as K,o as Q,w as W,y as X}from"./chunk-AVLO2MYP.js";import{a as I,b as T}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as E,I as D,K as F}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as z,l as $,v as w}from"./chunk-ZD4QWOHN.js";import{$ as S,Fb as c,Gb as a,Hb as n,Ib as _,Mb as h,Nb as x,Pb as M,Sa as V,Ub as p,Wa as l,Wb as f,db as v,ea as g,ec as R,fa as u,ic as r,jb as y,jc as O,kc as C,pb as d}from"./chunk-WSMHJDAT.js";import{a as N,b as B}from"./chunk-C6Q5SG76.js";function Ve(t,m){t&1&&(a(0,"mat-error"),r(1," El nombre es requerido "),n())}function Re(t,m){if(t&1&&(a(0,"mat-option",8),r(1),n()),t&2){let e=m.$implicit;c("value",e.id),l(),C(" ",e.name," ")}}function Oe(t,m){if(t&1){let e=M();a(0,"div",19),_(1,"img",20),a(2,"button",21),p("click",function(){g(e);let i=f();return i.imageBase64=null,u(i.selectedFileName=null)}),a(3,"mat-icon"),r(4,"delete"),n()()()}if(t&2){let e=f();l(),c("src",e.imageBase64,V)}}function ze(t,m){if(t&1&&(a(0,"span"),r(1),n()),t&2){let e=f();l(),O(e.selectedFileName)}}var Pe=(()=>{class t{fb;dialogRef;data;form;parentCategories=[];selectedFileName=null;imageBase64=null;constructor(e,o,i){this.fb=e,this.dialogRef=o,this.data=i,this.form=this.fb.group({name:["",q.required],parentid:[null],image:[null],visible_in_pos:[!0]})}ngOnInit(){this.data.category?(this.parentCategories=this.data.categories.filter(e=>e.id!==this.data.category.id),this.form.patchValue(this.data.category),this.data.category.image&&(this.imageBase64=`data:image/png;base64,${this.data.category.image}`,this.selectedFileName="Imagen actual")):this.parentCategories=this.data.categories}onFileSelected(e){let o=e.target.files[0];if(o){this.selectedFileName=o.name;let i=new FileReader;i.onload=()=>{let s=i.result;this.imageBase64=s},i.readAsDataURL(o)}}onSubmit(){if(this.form.valid){let e=this.form.value,o=null;if(this.imageBase64){let i=this.imageBase64.indexOf(",");i>-1?o=this.imageBase64.substring(i+1):o=this.imageBase64}else o=null;this.dialogRef.close(B(N({},e),{image:o}))}}static \u0275fac=function(o){return new(o||t)(v(W),v(Se),v(ve))};static \u0275cmp=y({type:t,selectors:[["app-category-form"]],decls:36,vars:8,consts:[["fileInput",""],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-container"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ej. Bebidas"],[4,"ngIf"],["formControlName","parentid"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"visibility-section"],["formControlName","visible_in_pos"],[1,"image-upload"],["class","preview-container",4,"ngIf"],["type","button","mat-stroked-button","",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],["align","end"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[1,"preview-container"],["alt","Preview",2,"max-height","100px","max-width","100%","border-radius","4px",3,"src"],["mat-icon-button","","color","warn","type","button",3,"click"]],template:function(o,i){if(o&1){let s=M();a(0,"h2",1),r(1),n(),a(2,"form",2),p("ngSubmit",function(){return g(s),u(i.onSubmit())}),a(3,"mat-dialog-content")(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),r(7,"Nombre"),n(),_(8,"input",5),d(9,Ve,2,0,"mat-error",6),n(),a(10,"mat-form-field",4)(11,"mat-label"),r(12,"Categor\xEDa Padre"),n(),a(13,"mat-select",7)(14,"mat-option",8),r(15,"-- Ninguna (Ra\xEDz) --"),n(),d(16,Re,2,2,"mat-option",9),n()(),a(17,"div",10)(18,"mat-checkbox",11),r(19,"Visible en Carrito de Ventas (POS)"),n()(),a(20,"div",12)(21,"p"),r(22,"Imagen de categor\xEDa (Opcional)"),n(),d(23,Oe,5,1,"div",13),a(24,"button",14),p("click",function(){g(s);let k=R(29);return u(k.click())}),a(25,"mat-icon"),r(26,"cloud_upload"),n(),r(27," Seleccionar Imagen "),n(),a(28,"input",15,0),p("change",function(k){return g(s),u(i.onFileSelected(k))}),n(),d(30,ze,2,1,"span",6),n()()(),a(31,"mat-dialog-actions",16)(32,"button",17),p("click",function(){return g(s),u(i.dialogRef.close())}),r(33,"Cancelar"),n(),a(34,"button",18),r(35,"Guardar"),n()()()}if(o&2){let s;l(),C("",i.data.category?"Editar":"Nueva"," Categor\xEDa"),l(),c("formGroup",i.form),l(7),c("ngIf",(s=i.form.get("name"))==null?null:s.hasError("required")),l(5),c("value",null),l(2),c("ngForOf",i.parentCategories),l(7),c("ngIf",i.imageBase64),l(7),c("ngIf",i.selectedFileName),l(4),c("disabled",i.form.invalid)}},dependencies:[w,z,$,X,J,G,L,U,Q,K,P,we,De,Ee,ae,ie,ee,te,oe,ne,F,D,E,xe,he,A,T,I,Ie,Fe],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-width:350px}.full-width[_ngcontent-%COMP%]{width:100%}.image-upload[_ngcontent-%COMP%]{border:1px dashed #ccc;padding:16px;text-align:center;border-radius:4px}"]})}return t})();function $e(t,m){t&1&&(a(0,"th",16),r(1," ID "),n())}function Ae(t,m){if(t&1&&(a(0,"td",17),r(1),n()),t&2){let e=m.$implicit;l(),C(" ",e.id," ")}}function je(t,m){t&1&&(a(0,"th",16),r(1," Nombre "),n())}function He(t,m){if(t&1&&(a(0,"td",17),r(1),n()),t&2){let e=m.$implicit;l(),C(" ",e.name," ")}}function Ge(t,m){t&1&&(a(0,"th",16),r(1," Categor\xEDa Padre "),n())}function qe(t,m){if(t&1&&(a(0,"td",17),r(1),n()),t&2){let e=m.$implicit,o=f();l(),C(" ",o.getParentName(e.parentid)," ")}}function Le(t,m){t&1&&(a(0,"th",16),r(1," Visible en POS "),n())}function Ue(t,m){if(t&1&&(a(0,"td",17)(1,"mat-icon",18),r(2),n()()),t&2){let e=m.$implicit;l(),c("color",e.visible_in_pos!==!1?"primary":"warn"),l(),C(" ",e.visible_in_pos!==!1?"visibility":"visibility_off"," ")}}function Je(t,m){t&1&&(a(0,"th",16),r(1," Acciones "),n())}function Ke(t,m){if(t&1){let e=M();a(0,"td",17)(1,"button",19),p("click",function(){let i=g(e).$implicit,s=f();return u(s.openForm(i))}),a(2,"mat-icon"),r(3,"edit"),n()(),a(4,"button",20),p("click",function(){let i=g(e).$implicit,s=f();return u(s.deleteCategory(i))}),a(5,"mat-icon"),r(6,"delete"),n()()()}}function Qe(t,m){t&1&&_(0,"tr",21)}function We(t,m){t&1&&_(0,"tr",22)}function Xe(t,m){t&1&&(a(0,"tr",23)(1,"td",24),r(2,"No hay categor\xEDas registradas"),n()())}var Nt=(()=>{class t{categories=[];allCategoriesForParents=[];displayedColumns=["id","name","parent","visible_in_pos","actions"];totalCategories=0;pageSize=50;currentPage=0;categoryService=S(Te);dialog=S(ye);snackBar=S(j);ngOnInit(){this.loadCategories()}loadCategories(){let e=this.currentPage+1;this.categoryService.getAll(e,this.pageSize).subscribe({next:o=>{this.categories=o.data,this.totalCategories=o.total,this.allCategoriesForParents.length===0&&(this.allCategoriesForParents=[...this.categories])},error:o=>console.error("Error cargando categor\xEDas",o)})}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadCategories()}getParentName(e){if(!e)return"-";let o=this.categories.find(i=>i.id===e);return o?o.name:`ID: ${e}`}openForm(e){this.dialog.open(Pe,{width:"400px",data:{category:e,categories:this.categories}}).afterClosed().subscribe(i=>{i&&(e?this.categoryService.update(e.id,i).subscribe({next:()=>{this.showSuccess("Categor\xEDa actualizada"),this.loadCategories()},error:s=>this.showError("Error al actualizar: "+s.error?.error)}):this.categoryService.create(i).subscribe({next:()=>{this.showSuccess("Categor\xEDa creada"),this.loadCategories()},error:s=>this.showError("Error al crear: "+s.error?.error)}))})}deleteCategory(e){confirm(`\xBFEst\xE1s seguro de eliminar la categor\xEDa "${e.name}"?`)&&this.categoryService.delete(e.id).subscribe({next:()=>{this.showSuccess("Categor\xEDa eliminada"),this.loadCategories()},error:o=>this.showError("Error al eliminar: "+o.error?.error)})}showSuccess(e){this.snackBar.open(e,"Cerrar",{duration:3e3})}showError(e){this.snackBar.open(e,"Cerrar",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=y({type:t,selectors:[["app-categorias"]],decls:30,vars:6,consts:[[1,"container"],[1,"header"],["mat-flat-button","","color","primary",3,"click"],[1,"table-container"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","parent"],["matColumnDef","visible_in_pos"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"page","length","pageSize","pageIndex"],["mat-header-cell",""],["mat-cell",""],[3,"color"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(o,i){o&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Categor\xEDas de Productos"),n(),a(4,"button",2),p("click",function(){return i.openForm()}),a(5,"mat-icon"),r(6,"add"),n(),r(7," Nueva Categor\xEDa "),n()(),a(8,"mat-card")(9,"div",3)(10,"table",4),h(11,5),d(12,$e,2,0,"th",6)(13,Ae,2,1,"td",7),x(),h(14,8),d(15,je,2,0,"th",6)(16,He,2,1,"td",7),x(),h(17,9),d(18,Ge,2,0,"th",6)(19,qe,2,1,"td",7),x(),h(20,10),d(21,Le,2,0,"th",6)(22,Ue,3,2,"td",7),x(),h(23,11),d(24,Je,2,0,"th",6)(25,Ke,7,0,"td",7),x(),d(26,Qe,1,0,"tr",12)(27,We,1,0,"tr",13)(28,Xe,3,0,"tr",14),n()(),a(29,"app-shared-paginator",15),p("page",function(b){return i.onPageChange(b)}),n()()()),o&2&&(l(10),c("dataSource",i.categories),l(16),c("matHeaderRowDef",i.displayedColumns),l(),c("matRowDefColumns",i.displayedColumns),l(2),c("length",i.totalCategories)("pageSize",i.pageSize)("pageIndex",i.currentPage))},dependencies:[w,Z,Y,F,D,E,T,I,_e,re,me,pe,se,le,ge,ce,de,ue,fe,Ce,P,H,be,Me],styles:[".container[_ngcontent-%COMP%]{padding:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.full-width[_ngcontent-%COMP%]{width:100%}.mat-column-id[_ngcontent-%COMP%]{width:60px}.mat-column-visible_in_pos[_ngcontent-%COMP%]{width:120px;text-align:center}.mat-column-actions[_ngcontent-%COMP%]{width:100px;text-align:right}"]})}return t})();export{Nt as CategoriasComponent};
