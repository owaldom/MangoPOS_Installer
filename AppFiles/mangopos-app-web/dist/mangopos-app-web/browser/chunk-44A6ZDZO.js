import{a as Mt}from"./chunk-5MBFWMTP.js";import{b as st,c as ft}from"./chunk-HIZ742YJ.js";import{a as Ct,b as ht,e as gt,f as St,g as Pt,h as xt}from"./chunk-Z6YHTX75.js";import{a as _t}from"./chunk-DGQM6DPS.js";import{b as X,c as Y}from"./chunk-APXOZHQA.js";import{a as et,b as it,c as nt,d as ot,e as rt,f as at,g as lt,h as ct,i as mt,j as dt,k as pt,l as ut}from"./chunk-VJGP4MMT.js";import{b as G,f as J,i as K,j as W}from"./chunk-EWTXOCXT.js";import{b as L,f as Q,i as q,m as U,y as j}from"./chunk-AVLO2MYP.js";import{a as Z,b as tt}from"./chunk-JI7GBIO6.js";import{H as B,I as N,K as O}from"./chunk-M7DMR53X.js";import{l as z,s as A,u as H,v as $}from"./chunk-ZD4QWOHN.js";import{$ as g,$b as T,D as v,Fb as p,G as D,Gb as n,Hb as o,Ib as x,Mb as u,Nb as s,Pb as M,Ub as C,Wa as m,Wb as S,_b as I,ac as y,ea as f,fa as _,fc as k,ic as l,jb as E,jc as R,kc as P,pb as d,vc as b,xc as V,zc as F}from"./chunk-WSMHJDAT.js";var wt=["searchInput"];function bt(t,r){if(t&1){let e=M();n(0,"button",22),C("click",function(){f(e);let i=S();return _(i.searchControl.setValue(""))}),n(1,"mat-icon"),l(2,"close"),o()()}}function vt(t,r){t&1&&(n(0,"th",23),l(1," Ref "),o())}function Dt(t,r){if(t&1&&(n(0,"td",24),l(1),o()),t&2){let e=r.$implicit;m(),P(" ",e.reference," ")}}function Et(t,r){t&1&&(n(0,"th",23),l(1," C\xF3digo "),o())}function It(t,r){if(t&1&&(n(0,"td",24),l(1),o()),t&2){let e=r.$implicit;m(),P(" ",e.code," ")}}function Tt(t,r){t&1&&(n(0,"th",23),l(1," Nombre "),o())}function yt(t,r){if(t&1&&(n(0,"td",24)(1,"strong"),l(2),o()()),t&2){let e=r.$implicit;m(2),R(e.name)}}function kt(t,r){t&1&&(n(0,"th",23),l(1," Precio Venta "),o())}function Rt(t,r){if(t&1&&(n(0,"td",24),l(1),b(2,"currency"),o()),t&2){let e=r.$implicit,a=S();m(),P(" ",F(2,1,e.pricesell,"USD","$ ",a.settingsService.getDecimalFormat("price"))," ")}}function Vt(t,r){t&1&&(n(0,"th",23),l(1," Stock "),o())}function Ft(t,r){if(t&1&&(n(0,"td",24)(1,"span",25),l(2),b(3,"number"),o()()),t&2){let e=r.$implicit,a=S();m(),k("color",(e.stock_current||0)<=0?"red":"green"),m(),P(" ",V(3,3,e.stock_current||0,a.settingsService.getDecimalFormat("quantity"))," ")}}function zt(t,r){t&1&&x(0,"th",23)}function At(t,r){if(t&1){let e=M();n(0,"td",24)(1,"button",26),C("click",function(){let i=f(e).$implicit,c=S();return _(c.selectProduct(i))}),l(2," Seleccionar "),o()()}}function Ht(t,r){t&1&&x(0,"tr",27)}function $t(t,r){t&1&&x(0,"tr",28)}function Bt(t,r){t&1&&(n(0,"tr",29)(1,"td",30),l(2,"No se encontraron productos"),o()())}var ue=(()=>{class t{products=[];displayedColumns=["reference","code","name","price","stock","actions"];searchControl=new q("");searchInput;totalProducts=0;pageSize=50;currentPage=0;productService=g(Mt);dialogRef=g(Ct);settingsService=g(_t);data=g(ht,{optional:!0});get locationId(){return this.data?.locationId||null}ngOnInit(){this.loadProducts(),this.searchControl.valueChanges.pipe(v(500),D()).subscribe(e=>{this.currentPage=0,this.loadProducts(e||"")}),setTimeout(()=>{this.searchInput.nativeElement.focus()},500)}onSearchEnter(e){let a=e.target.value?.trim();a&&this.productService.getAll(1,this.pageSize,{search:a,locationId:this.locationId}).subscribe({next:i=>{if(i.data&&i.data.length>0){let c=i.data.find(h=>h.code===a||h.reference===a);if(c){this.selectProduct(c);return}}this.products=i.data,this.totalProducts=i.total,i.data.length===0&&this.searchControl.setValue("")}})}loadProducts(e=""){let a=this.currentPage+1;this.productService.getAll(a,this.pageSize,{search:e,locationId:this.locationId}).subscribe({next:i=>{if(this.products=i.data,this.totalProducts=i.total,e&&i.data.length===1){let c=i.data[0];(c.code===e||c.reference===e)&&this.selectProduct(c)}}})}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadProducts(this.searchControl.value||"")}selectProduct(e){this.dialogRef.close(e)}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=E({type:t,selectors:[["app-product-selector"]],viewQuery:function(a,i){if(a&1&&I(wt,5),a&2){let c;T(c=y())&&(i.searchInput=c.first)}},decls:37,vars:8,consts:[["searchInput",""],["mat-dialog-title",""],[1,"search-container"],["appearance","outline",1,"full-width"],["matInput","","placeholder","Escanear o escribir para buscar...",3,"keyup.enter","formControl"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click",4,"ngIf"],[1,"table-container"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","reference"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","name"],["matColumnDef","price"],["matColumnDef","stock"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"page","length","pageSize","pageIndex"],["align","end"],["mat-button","",3,"click"],["matSuffix","","mat-icon-button","","aria-label","Limpiar",3,"click"],["mat-header-cell",""],["mat-cell",""],[2,"font-weight","bold"],["mat-stroked-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(a,i){if(a&1){let c=M();n(0,"h2",1),l(1,"Buscar Producto"),o(),n(2,"mat-dialog-content")(3,"div",2)(4,"mat-form-field",3)(5,"mat-label"),l(6,"Filtrar por nombre, c\xF3digo o referencia"),o(),n(7,"input",4,0),C("keyup.enter",function(w){return f(c),_(i.onSearchEnter(w))}),o(),d(9,bt,3,0,"button",5),o()(),n(10,"div",6)(11,"table",7),u(12,8),d(13,vt,2,0,"th",9)(14,Dt,2,1,"td",10),s(),u(15,11),d(16,Et,2,0,"th",9)(17,It,2,1,"td",10),s(),u(18,12),d(19,Tt,2,0,"th",9)(20,yt,3,1,"td",10),s(),u(21,13),d(22,kt,2,0,"th",9)(23,Rt,3,6,"td",10),s(),u(24,14),d(25,Vt,2,0,"th",9)(26,Ft,4,6,"td",10),s(),u(27,15),d(28,zt,1,0,"th",9)(29,At,3,0,"td",10),s(),d(30,Ht,1,0,"tr",16)(31,$t,1,0,"tr",17)(32,Bt,3,0,"tr",18),o()(),n(33,"app-shared-paginator",19),C("page",function(w){return f(c),_(i.onPageChange(w))}),o()(),n(34,"mat-dialog-actions",20)(35,"button",21),C("click",function(){return f(c),_(i.dialogRef.close())}),l(36,"Cancelar"),o()()}a&2&&(m(7),p("formControl",i.searchControl),m(2),p("ngIf",i.searchControl.value),m(2),p("dataSource",i.products),m(19),p("matHeaderRowDef",i.displayedColumns),m(),p("matRowDefColumns",i.displayedColumns),m(2),p("length",i.totalProducts)("pageSize",i.pageSize)("pageIndex",i.currentPage))},dependencies:[$,z,xt,gt,Pt,St,ut,et,nt,lt,ot,it,ct,rt,at,mt,dt,pt,st,ft,O,N,B,tt,Z,W,K,G,J,Y,X,j,L,Q,U,A,H],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.search-container[_ngcontent-%COMP%]{margin-bottom:10px}.table-container[_ngcontent-%COMP%]{max-height:800px;overflow:auto}td.mat-cell[_ngcontent-%COMP%]{padding:8px}"]})}return t})();export{ue as a};
