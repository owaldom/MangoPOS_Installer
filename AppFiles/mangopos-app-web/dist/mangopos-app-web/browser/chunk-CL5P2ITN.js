import{a as Mt,b as St,c as Pt}from"./chunk-G6XU55TA.js";import{a as Tt,b as Vt,c as At}from"./chunk-HCWDTVFW.js";import{a as Bt}from"./chunk-PGWFKS4C.js";import{a as We}from"./chunk-5MBFWMTP.js";import{a as It}from"./chunk-Y6WNQBHI.js";import{a as kt,b as Et}from"./chunk-MOTKDE4V.js";import{a as yt}from"./chunk-4LX67P6M.js";import{a as Ot}from"./chunk-7MVBSPFH.js";import{a as ke}from"./chunk-6XGWOI35.js";import{a as vt}from"./chunk-DEAF3FKS.js";import"./chunk-34EVCEMG.js";import{a as Dt}from"./chunk-HYURECNX.js";import"./chunk-2UF7BHSI.js";import{a as wt}from"./chunk-BK63NQ7D.js";import{a as ut,b as gt,c as _t,d as ft}from"./chunk-YFOFQKMN.js";import{a as mt}from"./chunk-7KQW3R3P.js";import{a as rt}from"./chunk-YSABNZJU.js";import{f as pt}from"./chunk-TW2J4ZKO.js";import"./chunk-UPZQJ6EF.js";import{c as at}from"./chunk-6OXQWIOV.js";import{b as bt}from"./chunk-XEWEKXFC.js";import{a as Ct}from"./chunk-NN3ONOAJ.js";import{a as ue}from"./chunk-RFRKPPY3.js";import{a as K,b as H,c as Ne,e as pe,f as me,g as we,h as N}from"./chunk-Z6YHTX75.js";import{a as Se,b as Pe}from"./chunk-26KDQVR5.js";import{a as te}from"./chunk-DGQM6DPS.js";import{a as Le}from"./chunk-SCPRHZYR.js";import"./chunk-EQXJNMRX.js";import{b as se,c as de}from"./chunk-APXOZHQA.js";import{a as xt,b as ht}from"./chunk-VNZMNOUU.js";import"./chunk-YCMZOG5D.js";import{a as Re}from"./chunk-PALJ6VDH.js";import"./chunk-TEMJ73U5.js";import{d as Be}from"./chunk-52A733DE.js";import"./chunk-GPHRSLLH.js";import{b as re,e as dt,f as Fe,i as ce,j as le}from"./chunk-EWTXOCXT.js";import{b as G,f as q,i as ct,j as U,m as lt,x as X,y as st}from"./chunk-AVLO2MYP.js";import{a as R,b as L}from"./chunk-JI7GBIO6.js";import"./chunk-VTP6RNFS.js";import{H as ee,I as j,K as B}from"./chunk-M7DMR53X.js";import"./chunk-JAVK727W.js";import"./chunk-3TNWXQYU.js";import"./chunk-UWUK32S4.js";import{k as $,l as z,m as tt,n as nt,o as it,q as ot,s as ae,u as Z,v as A}from"./chunk-ZD4QWOHN.js";import{$ as J,$b as fe,Ac as et,D as Ve,Fb as m,G as Ke,Gb as i,Hb as o,Ib as T,Mb as ne,Nb as ie,P as He,Pb as b,Sa as ye,Ua as Je,Ub as g,Va as Ze,Wa as l,Wb as s,_b as Me,a as ve,ac as xe,db as M,e as $e,ea as d,ec as he,fa as p,fc as Ae,gc as D,ic as c,j as Ge,jb as V,jc as C,kc as O,lc as oe,ma as Ye,mc as De,n as Te,nc as S,oc as P,pb as f,pc as w,vc as x,wc as Ie,xc as Q,zc as k}from"./chunk-WSMHJDAT.js";import{a as Qe}from"./chunk-C6Q5SG76.js";function Xt(r,u){if(r&1){let e=b();i(0,"div",19)(1,"div",20)(2,"button",21),g("click",function(t){d(e);let a=s().index,_=s(3);return p(_.updateQuantity(a,-1,t))}),c(3,"-"),o(),i(4,"span",22),c(5),x(6,"number"),o(),i(7,"button",21),g("click",function(t){d(e);let a=s().index,_=s(3);return p(_.updateQuantity(a,1,t))}),c(8,"+"),o()(),i(9,"button",23),g("click",function(){d(e);let t=s().index,a=s(3);return p(a.removeLine(t))}),i(10,"mat-icon"),c(11,"delete"),o()()()}if(r&2){let e=s().$implicit,n=s(3);l(5),C(Q(6,1,e.units,n.settingsService.getDecimalFormat("quantity")))}}function Qt(r,u){r&1&&(i(0,"div",24)(1,"mat-icon"),c(2,"label"),o(),i(3,"span"),c(4,"Descuento aplicado"),o()())}function $t(r,u){if(r&1){let e=b();i(0,"div",11),g("click",function(){let t=d(e).index,a=s(3);return p(a.selectLine(t))}),i(1,"div",12)(2,"div",13)(3,"span",14),c(4),o(),i(5,"span",15),c(6),x(7,"number"),x(8,"currency"),o()(),i(9,"div",16),c(10),x(11,"currency"),o()(),f(12,Xt,12,4,"div",17)(13,Qt,5,0,"div",18),o()}if(r&2){let e=u.$implicit,n=u.index,t=s(3);D("selected",t.selectedIndex===n),l(4),C(e.product_name),l(2),oe(" ",Q(7,8,e.units,t.settingsService.getDecimalFormat("quantity"))," x ",k(8,11,e.price*t.exchangeRate,"VES","Bs. ",t.settingsService.getDecimalFormat("price"))," "),l(4),O(" ",k(11,16,(e.discount_type==="FIXED"?e.price-(e.discount||0):e.discount_type==="FIXED_VES"?e.price-(e.discount||0)/t.exchangeRate:e.price)*e.units*t.exchangeRate,"VES","Bs. ",t.settingsService.getDecimalFormat("total"))," "),l(2),m("ngIf",t.selectedIndex===n),l(),m("ngIf",e.discount)}}function Gt(r,u){if(r&1&&(i(0,"div",9),f(1,$t,14,21,"div",10),o()),r&2){let e=s(2);l(),m("ngForOf",e.lines)}}function Kt(r,u){if(r&1&&(i(0,"span"),c(1),x(2,"currency"),o()),r&2){let e=s(2).$implicit,n=s(3);l(),C(k(2,1,e.discount,"USD","$ ",n.settingsService.getDecimalFormat("price")))}}function Ht(r,u){if(r&1&&(i(0,"span"),c(1),x(2,"currency"),o()),r&2){let e=s(2).$implicit,n=s(3);l(),C(k(2,1,e.discount,"VES","Bs. ",n.settingsService.getDecimalFormat("price")))}}function Yt(r,u){if(r&1&&(i(0,"span"),c(1),x(2,"number"),o()),r&2){let e=s(2).$implicit;l(),O("",Q(2,1,(e.discount||0)*100,"1.0-0"),"%")}}function Jt(r,u){if(r&1&&(i(0,"span",38),c(1," Dto: "),ne(2,39),f(3,Kt,3,6,"span",40)(4,Ht,3,6,"span",40)(5,Yt,3,4,"span",41),ie(),o()),r&2){let e=s().$implicit;l(2),m("ngSwitch",e.discount_type),l(),m("ngSwitchCase","FIXED"),l(),m("ngSwitchCase","FIXED_VES")}}function Zt(r,u){if(r&1&&(i(0,"span",42),c(1),x(2,"currency"),o()),r&2){let e=s().$implicit,n=s(3);l(),O(" ",k(2,1,(e.discount_type==="FIXED"?e.price-(e.discount||0):e.discount_type==="FIXED_VES"?e.price-(e.discount||0)/n.exchangeRate:e.price*(1-(e.discount||0)))*(1+(e.tax_rate-0||0))*n.exchangeRate,"VES","Bs. ",n.settingsService.getDecimalFormat("price"))," ")}}function en(r,u){if(r&1){let e=b();i(0,"tr",30),g("click",function(){let t=d(e).index,a=s(3);return p(a.selectLine(t))}),i(1,"td")(2,"div",31)(3,"span",32),c(4),o(),f(5,Jt,6,3,"span",33),o()(),i(6,"td",25)(7,"div",34)(8,"span"),c(9),x(10,"currency"),o(),f(11,Zt,3,6,"span",35),o()(),i(12,"td",26)(13,"div",36)(14,"button",21),g("click",function(t){let a=d(e).index,_=s(3);return p(_.updateQuantity(a,-1,t))}),c(15,"-"),o(),i(16,"span"),c(17),x(18,"number"),o(),i(19,"button",21),g("click",function(t){let a=d(e).index,_=s(3);return p(_.updateQuantity(a,1,t))}),c(20,"+"),o()()(),i(21,"td",27),c(22),x(23,"currency"),o(),i(24,"td",28)(25,"button",37),g("click",function(){let t=d(e).index,a=s(3);return p(a.removeLine(t))}),i(26,"mat-icon"),c(27,"delete_outline"),o()()()()}if(r&2){let e=u.$implicit,n=u.index,t=s(3);D("selected",t.selectedIndex===n),l(4),C(e.product_name),l(),m("ngIf",e.discount),l(3),D("strikethrough",e.discount),l(),O(" ",k(10,10,e.price*t.exchangeRate,"VES","Bs. ",t.settingsService.getDecimalFormat("price"))," "),l(2),m("ngIf",e.discount),l(6),C(Q(18,15,e.units,t.settingsService.getDecimalFormat("quantity"))),l(5),C(k(23,18,(e.discount_type==="FIXED"?e.price-(e.discount||0):e.discount_type==="FIXED_VES"?e.price-(e.discount||0)/t.exchangeRate:e.price*(1-(e.discount||0)))*e.units*t.exchangeRate,"VES","Bs. ",t.settingsService.getDecimalFormat("total")))}}function tn(r,u){if(r&1&&(i(0,"table")(1,"thead")(2,"tr")(3,"th"),c(4,"Art\xEDculo"),o(),i(5,"th",25),c(6,"Precio"),o(),i(7,"th",26),c(8,"Cant."),o(),i(9,"th",27),c(10,"Total"),o(),T(11,"th",28),o()(),i(12,"tbody"),f(13,en,28,23,"tr",29),o()()),r&2){let e=s(2);l(13),m("ngForOf",e.lines)}}function nn(r,u){if(r&1&&(i(0,"div",6),f(1,Gt,2,1,"div",7)(2,tn,14,1,"table",8),o()),r&2){let e,n,t=s();l(),m("ngIf",((e=t.settingsService.getSettings())==null?null:e.pos_layout)==="modern"),l(),m("ngIf",((n=t.settingsService.getSettings())==null?null:n.pos_layout)==="classic")}}function on(r,u){r&1&&(i(0,"div",43)(1,"mat-icon"),c(2,"shopping_cart"),o(),i(3,"p"),c(4,"El ticket est\xE1 vac\xEDo"),o()())}var Rt=(()=>{class r{salesService;settingsService;lines=[];ticketNumber=0;exchangeRate=1;selectedIndex=-1;subscription=new ve;constructor(e,n){this.salesService=e,this.settingsService=n}ngOnInit(){this.subscription.add(this.salesService.currentLines$.subscribe(e=>{this.lines=e})),this.subscription.add(this.salesService.exchangeRate$.subscribe(e=>{this.exchangeRate=e})),this.subscription.add(this.salesService.selectedLineIndex$.subscribe(e=>{this.selectedIndex=e})),this.ticketNumber=1}ngOnDestroy(){this.subscription.unsubscribe()}updateQuantity(e,n,t){let a=1;t&&t.shiftKey&&(a=.1);let _=n*a,v=this.lines[e].units+_;this.salesService.updateLineQuantity(e,parseFloat(v.toFixed(3)))}selectLine(e){this.salesService.setSelectedLineIndex(e)}removeLine(e){this.salesService.removeLine(e)}clearTicket(){confirm("\xBFEst\xE1 seguro de querer limpiar todo el ticket?")&&this.salesService.clearTicket()}static \u0275fac=function(n){return new(n||r)(M(ke),M(te))};static \u0275cmp=V({type:r,selectors:[["app-ticket-lines"]],decls:11,vars:5,consts:[["emptyState",""],[1,"ticket-container"],[1,"ticket-header"],["mat-icon-button","","matTooltip","Limpiar Ticket",1,"btn-clear",3,"click"],[1,"ticket-table-container"],["class","scrollable-content",4,"ngIf","ngIfElse"],[1,"scrollable-content"],["class","modern-lines-list",4,"ngIf"],[4,"ngIf"],[1,"modern-lines-list"],["class","modern-line-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"modern-line-item",3,"click"],[1,"item-main"],[1,"item-info"],[1,"name"],[1,"price-calc"],[1,"item-total"],["class","item-controls",4,"ngIf"],["class","item-discount",4,"ngIf"],[1,"item-controls"],[1,"qty-stepper"],[3,"click"],[1,"qty"],[1,"btn-remove",3,"click"],[1,"item-discount"],[1,"col-price"],[1,"col-units"],[1,"col-total"],[1,"col-actions"],["class","ticket-row",3,"selected","click",4,"ngFor","ngForOf"],[1,"ticket-row",3,"click"],[1,"product-info"],[1,"product-name"],["class","product-discount",4,"ngIf"],[1,"price-container"],["class","discounted-price",4,"ngIf"],[1,"units-control"],[1,"btn-delete",3,"click"],[1,"product-discount"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"discounted-price"],[1,"empty-state"]],template:function(n,t){if(n&1){let a=b();i(0,"div",1)(1,"div",2)(2,"h3"),c(3),o(),i(4,"button",3),g("click",function(){return d(a),p(t.clearTicket())}),i(5,"mat-icon"),c(6,"delete_sweep"),o()()(),i(7,"div",4),f(8,nn,3,2,"div",5)(9,on,5,0,"ng-template",null,0,et),o()()}if(n&2){let a,_,v=he(10);D("modern-layout",((a=t.settingsService.getSettings())==null?null:a.pos_layout)==="modern"),l(3),O("",((_=t.settingsService.getSettings())==null?null:_.pos_layout)==="modern"?"Orden Actual":"Ticket #"+t.ticketNumber," "),l(5),m("ngIf",t.lines.length>0)("ngIfElse",v)}},dependencies:[A,$,z,tt,nt,it,L,R,B,ee,Le,Re,ae,Z],styles:['.ticket-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background-color:#f8f9fa;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px #0000000d}.modern-layout[_ngcontent-%COMP%]{background:#fff;box-shadow:0 10px 25px -5px #0000001a,0 8px 10px -6px #0000001a;border-radius:20px;padding:0;overflow:hidden;position:relative}.modern-layout[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:6px;background:#6366f1}.modern-layout[_ngcontent-%COMP%]   .ticket-header[_ngcontent-%COMP%]{padding:24px 20px 12px;border-bottom:none;background:#fff}.modern-layout[_ngcontent-%COMP%]   .ticket-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:800;color:#1e293b;letter-spacing:-.025em}.modern-layout[_ngcontent-%COMP%]   .ticket-header[_ngcontent-%COMP%]   .btn-clear[_ngcontent-%COMP%]{color:#94a3b8}.modern-layout[_ngcontent-%COMP%]   .ticket-header[_ngcontent-%COMP%]   .btn-clear[_ngcontent-%COMP%]:hover{background:#fef2f2;color:#ef4444}.modern-layout[_ngcontent-%COMP%]   .ticket-table-container[_ngcontent-%COMP%]{padding:0 12px 20px;background:#fff}.modern-layout[_ngcontent-%COMP%]   .modern-lines-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:#f8fafc;border:1px solid transparent;transition:all .2s;cursor:pointer}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]:hover{background:#f1f5f9}.modern-layout[_ngcontent-%COMP%]   .modern-line-item.selected[_ngcontent-%COMP%]{background:#fff;border-color:#6366f1;box-shadow:0 4px 6px -1px #0000001a}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;color:#334155;font-size:14px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .price-calc[_ngcontent-%COMP%]{font-size:12px;color:#64748b;margin-top:2px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-total[_ngcontent-%COMP%]{font-weight:700;color:#1e293b;font-size:15px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px dashed #e2e8f0;display:flex;justify-content:space-between;align-items:center}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .qty-stepper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:#fff;border-radius:8px;border:1px solid #e2e8f0;padding:4px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .qty-stepper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:6px;border:none;background:#f1f5f9;color:#475569;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .qty-stepper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#6366f1;color:#fff}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .qty-stepper[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{font-weight:700;color:#1e293b;min-width:30px;text-align:center}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]{background:#fef2f2;color:#ef4444;border:none;padding:6px;border-radius:8px;cursor:pointer;display:flex}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]:hover{background:#ef4444;color:#fff}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-discount[_ngcontent-%COMP%]{margin-top:6px;display:flex;align-items:center;gap:4px;color:#10b981;font-size:11px;font-weight:600}.modern-layout[_ngcontent-%COMP%]   .modern-line-item[_ngcontent-%COMP%]   .item-discount[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:12px;width:12px;height:12px}.ticket-header[_ngcontent-%COMP%]{padding:16px;background-color:#fff;border-bottom:2px solid #eee;display:flex;justify-content:space-between;align-items:center}.ticket-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;color:#333;font-weight:600}.ticket-table-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{background-color:#fff;position:sticky;top:0;z-index:10}th[_ngcontent-%COMP%]{text-align:left;padding:12px 16px;font-size:.85rem;text-transform:uppercase;color:#888;font-weight:600;border-bottom:1px solid #efefef}td[_ngcontent-%COMP%]{padding:14px 16px;border-bottom:1px solid #f0f0f0;vertical-align:middle}.product-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.product-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.product-discount[_ngcontent-%COMP%]{font-size:.75rem;color:#e91e63;font-weight:600}.price-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.strikethrough[_ngcontent-%COMP%]{text-decoration:line-through;color:#999;font-size:.8rem}.discounted-price[_ngcontent-%COMP%]{font-weight:600;color:#e91e63}.col-units[_ngcontent-%COMP%]{width:100px}.units-control[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.units-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;border:1px solid #ddd;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.units-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#f0f0f0;border-color:#ccc}.units-control[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;min-width:20px;text-align:center}.col-price[_ngcontent-%COMP%], .col-total[_ngcontent-%COMP%]{text-align:right;font-family:Roboto Mono,monospace}.col-total[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50}.col-actions[_ngcontent-%COMP%]{width:50px;text-align:center}.btn-delete[_ngcontent-%COMP%]{color:#ff5252;background:none;border:none;cursor:pointer;padding:8px;border-radius:4px;transition:background .2s}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#ff52521a}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;color:#ccc;gap:12px}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.ticket-row[_ngcontent-%COMP%]{transition:background-color .2s}.ticket-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.ticket-row.selected[_ngcontent-%COMP%]{background-color:#e8f0fe!important;border-left:4px solid #6200ee}.ticket-row[_ngcontent-%COMP%]:last-child{border-bottom:none}']})}return r})();var Lt=(()=>{class r{dialogRef;data;constructor(e,n){this.dialogRef=e,this.data=n}onClose(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||r)(M(K),M(H))};static \u0275cmp=V({type:r,selectors:[["app-product-image-dialog"]],decls:9,vars:3,consts:[[1,"image-dialog-container"],[1,"dialog-header"],["mat-dialog-title",""],["mat-icon-button","",3,"click"],["mat-dialog-content","",1,"image-content"],[3,"src","alt"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),c(3),o(),i(4,"button",3),g("click",function(){return t.onClose()}),i(5,"mat-icon"),c(6,"close"),o()()(),i(7,"div",4),T(8,"img",5),o()()),n&2&&(l(3),C(t.data.productName),l(5),m("src","data:image/png;base64,"+t.data.image,ye)("alt",t.data.productName))},dependencies:[A,N,pe,me,B,ee,L,R],styles:[".image-dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-width:90vw;max-height:90vh;overflow:hidden}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;border-bottom:1px solid #eee}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600}.image-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:16px;overflow:auto}img[_ngcontent-%COMP%]{max-width:100%;max-height:70vh;object-fit:contain;border-radius:8px;box-shadow:0 4px 12px #0000001a}"]})}return r})();var an=["searchInput"];function rn(r,u){if(r&1){let e=b();ne(0),i(1,"mat-icon"),c(2,"chevron_right"),o(),i(3,"button",14),g("click",function(){let t=d(e).$implicit,a=s(2);return p(a.navigateTo(t))}),c(4),o(),ie()}if(r&2){let e=u.$implicit,n=u.last;l(3),D("active",n),l(),O(" ",e.name," ")}}function cn(r,u){if(r&1){let e=b();i(0,"div",12)(1,"div",13)(2,"button",14),g("click",function(){d(e);let t=s();return t.currentParentId=null,t.selectedCategory=null,t.navigationHistory=[],t.searchText="",p(t.updateDisplay())}),c(3," Categor\xEDas "),o(),f(4,rn,5,3,"ng-container",15),o()()}if(r&2){let e=s();l(2),D("active",!e.selectedCategory),l(2),m("ngForOf",e.navigationHistory)}}function ln(r,u){if(r&1){let e=b();i(0,"button",18),g("click",function(){let t=d(e).$implicit,a=s(2);return p(a.selectCategory(t))}),c(1),o()}if(r&2){let e=u.$implicit,n=s(2);D("active",(n.selectedCategory==null?null:n.selectedCategory.id)===e.id),l(),O(" ",e.name," ")}}function sn(r,u){if(r&1){let e=b();i(0,"div",16)(1,"div",17)(2,"button",18),g("click",function(){d(e);let t=s();return t.currentParentId=null,t.selectedCategory=null,t.navigationHistory=[],t.searchText="",p(t.updateDisplay())}),c(3," Todos "),o(),f(4,ln,2,3,"button",19),o()()}if(r&2){let e=s();l(2),D("active",!e.selectedCategory&&!e.searchText),l(2),m("ngForOf",e.topLevelCategories)}}function dn(r,u){if(r&1&&(i(0,"span"),c(1),o()),r&2){let e=u.$implicit;l(),C(e.name)}}function pn(r,u){if(r&1){let e=b();i(0,"div",20)(1,"button",21),g("click",function(){d(e);let t=s();return p(t.back())}),i(2,"mat-icon"),c(3,"arrow_back"),o(),c(4," Volver"),o(),i(5,"div",22),f(6,dn,2,1,"span",15),o()()}if(r&2){let e=s();l(6),m("ngForOf",e.navigationHistory)}}function mn(r,u){if(r&1&&T(0,"img",28),r&2){let e=s().$implicit;m("src","data:image/png;base64,"+e.image,ye)}}function un(r,u){r&1&&(i(0,"mat-icon"),c(1,"folder"),o())}function gn(r,u){if(r&1){let e=b();i(0,"div",25),g("click",function(){let t=d(e).$implicit,a=s(2);return p(a.selectCategory(t))}),f(1,mn,1,1,"img",26)(2,un,2,0,"mat-icon",11),i(3,"span",27),c(4),o()()}if(r&2){let e=u.$implicit;l(),m("ngIf",e.image),l(),m("ngIf",!e.image),l(2),C(e.name)}}function _n(r,u){r&1&&T(0,"div",29)}function fn(r,u){if(r&1&&(ne(0),f(1,gn,5,3,"div",23)(2,_n,1,0,"div",24),ie()),r&2){let e=s();l(),m("ngForOf",e.displayedCategories),l(),m("ngIf",e.displayedCategories.length>0&&e.filteredProducts.length>0)}}function xn(r,u){if(r&1&&T(0,"img",41),r&2){let e=s().$implicit;m("src","data:image/png;base64,"+e.image,ye)}}function hn(r,u){r&1&&(i(0,"mat-icon"),c(1,"fastfood"),o())}function Cn(r,u){if(r&1){let e=b();i(0,"div",31),g("click",function(){let t=d(e).$implicit,a=s(2);return p(a.addToTicket(t))}),i(1,"div",32),f(2,xn,1,1,"img",33)(3,hn,2,0,"mat-icon",11),i(4,"span",34),c(5),x(6,"currency"),o()(),i(7,"div",35)(8,"span",36),c(9),o(),i(10,"div",37)(11,"div",38),T(12,"div",39),o(),i(13,"span",40),c(14),x(15,"number"),o()()()()}if(r&2){let e=u.$implicit,n=s(2);l(2),m("ngIf",e.image),l(),m("ngIf",!e.image),l(2),C(k(6,11,e.pricesell*(1+(e.tax_rate-0||0))*n.exchangeRate,"VES","Bs. ",n.settingsService.getDecimalFormat("price"))),l(4),C(e.name),l(2),D("low",e.stock<5),l(),Ae("width",(e.stock>20?100:e.stock*5)+"%"),l(),D("low",e.stock<5),l(),O(" ",Q(15,16,e.stock,n.settingsService.getDecimalFormat("quantity"))," ")}}function bn(r,u){if(r&1&&(ne(0),f(1,Cn,16,19,"div",30),ie()),r&2){let e=s();l(),m("ngForOf",e.filteredProducts)}}function vn(r,u){if(r&1&&T(0,"img",52),r&2){let e=s().$implicit;m("src","data:image/png;base64,"+e.image,ye)}}function yn(r,u){if(r&1){let e=b();i(0,"button",53),g("click",function(t){d(e);let a=s().$implicit,_=s(2);return p(_.openImagePopup(t,a))}),i(1,"mat-icon",54),c(2,"photo_camera"),o()()}}function Mn(r,u){r&1&&(i(0,"mat-icon"),c(1,"image"),o())}function Sn(r,u){if(r&1){let e=b();i(0,"div",43),g("click",function(){let t=d(e).$implicit,a=s(2);return p(a.addToTicket(t))}),i(1,"div",44),f(2,vn,1,1,"img",45)(3,yn,3,0,"button",46)(4,Mn,2,0,"mat-icon",11),o(),i(5,"div",47)(6,"span",48),c(7),o(),i(8,"div",49)(9,"span",50),c(10),x(11,"currency"),o(),i(12,"span",51),c(13),x(14,"number"),o()()()()}if(r&2){let e=u.$implicit,n=s(2);l(2),m("ngIf",e.image),l(),m("ngIf",e.image),l(),m("ngIf",!e.image),l(3),C(e.name),l(3),C(k(11,8,e.pricesell*(1+(e.tax_rate-0||0))*n.exchangeRate,"VES","Bs. ",n.settingsService.getDecimalFormat("price"))),l(2),D("low-stock",e.stock<=0),l(),O(" Stock: ",Q(14,13,e.stock,n.settingsService.getDecimalFormat("quantity"))," ")}}function Pn(r,u){if(r&1&&(ne(0),f(1,Sn,15,16,"div",42),ie()),r&2){let e=s();l(),m("ngForOf",e.filteredProducts)}}var qe=(()=>{class r{salesService;dialog;snackBar;settingsService;categories=[];products=[];selectedCategory=null;currentParentId=null;navigationHistory=[];displayedCategories=[];filteredProducts=[];exchangeRate=1;searchText="";searchInput;productSelected=new Ye;subscription=new ve;get topLevelCategories(){return this.categories.filter(e=>e.parentid===null||e.parentid===void 0)}constructor(e,n,t,a){this.salesService=e,this.dialog=n,this.snackBar=t,this.settingsService=a}ngOnInit(){this.subscription.add(this.salesService.currentLocationId$.subscribe(e=>{this.refresh()})),this.subscription.add(this.salesService.exchangeRate$.subscribe(e=>{this.exchangeRate=e}))}refresh(){this.salesService.getCatalog().subscribe(e=>{this.categories=e.categories,this.products=e.products,this.updateDisplay()})}updateDisplay(){if(this.searchText){let e=this.searchText.toLowerCase();this.selectedCategory?(this.displayedCategories=this.categories.filter(n=>n.parentid===this.currentParentId&&n.name.toLowerCase().includes(e)),this.filteredProducts=this.products.filter(n=>n.category===this.selectedCategory.id&&(n.name.toLowerCase().includes(e)||n.code?.toLowerCase().includes(e)||n.reference?.toLowerCase().includes(e))).filter(n=>n.incatalog&&n.marketable)):(this.displayedCategories=this.categories.filter(n=>n.name.toLowerCase().includes(e)),this.filteredProducts=this.products.filter(n=>n.incatalog&&n.marketable&&(n.name.toLowerCase().includes(e)||n.code?.toLowerCase().includes(e)||n.reference?.toLowerCase().includes(e))))}else this.displayedCategories=this.categories.filter(e=>e.parentid===this.currentParentId),this.selectedCategory?this.filteredProducts=this.products.filter(e=>e.category===this.selectedCategory.id&&e.incatalog&&e.marketable):this.filteredProducts=this.products.filter(e=>e.incatalog&&e.marketable)}onSearch(e){this.searchText=e?.toString()||"",this.updateDisplay()}focusSearch(){this.searchInput&&this.searchInput.nativeElement.focus()}selectCategory(e){this.searchText="",this.buildCategoryPath(e),this.currentParentId=e.id,this.selectedCategory=e,this.updateDisplay()}buildCategoryPath(e){let n=[],t=e;for(;t;)n.unshift(t),t.parentid?t=this.categories.find(a=>a.id===t.parentid):t=null;this.navigationHistory=n}back(){if(this.searchText="",this.navigationHistory.length>0){this.navigationHistory.pop();let e=this.navigationHistory[this.navigationHistory.length-1];this.currentParentId=e?e.id:null,this.selectedCategory=e||null,this.updateDisplay()}}navigateTo(e){this.searchText="",this.buildCategoryPath(e),this.currentParentId=e.id,this.selectedCategory=e,this.updateDisplay()}addToTicket(e){this.productSelected.emit({product:e})}openImagePopup(e,n){e.stopPropagation(),this.dialog.open(Lt,{width:"auto",maxWidth:"90vw",data:{image:n.image,productName:n.name}})}executeAdd(e,n){let t=this.salesService.getSelectedCustomer();this.salesService.addLineWithDiscount(e,n,t?.id)}static \u0275fac=function(n){return new(n||r)(M(ke),M(Ne),M(Se),M(te))};static \u0275cmp=V({type:r,selectors:[["app-catalog"]],viewQuery:function(n,t){if(n&1&&Me(an,5),n&2){let a;fe(a=xe())&&(t.searchInput=a.first)}},outputs:{productSelected:"productSelected"},decls:15,vars:11,consts:[["searchInput",""],[1,"catalog-container"],[1,"catalog-header"],[1,"navigation-area"],["class","breadcrumb",4,"ngIf"],["class","modern-categories",4,"ngIf"],[1,"search-box"],["size","small"],["type","text","placeholder","Buscar producto (F2)...",3,"ngModelChange","ngModel"],["class","modern-breadcrumb",4,"ngIf"],[1,"item-grid","scrollable"],[4,"ngIf"],[1,"breadcrumb"],[1,"breadcrumb-scroll"],["mat-button","",3,"click"],[4,"ngFor","ngForOf"],[1,"modern-categories"],[1,"chips-scroll-container"],[1,"category-chip",3,"click"],["class","category-chip",3,"active","click",4,"ngFor","ngForOf"],[1,"modern-breadcrumb"],[1,"back-pill",3,"click"],[1,"path"],["class","category-card",3,"click",4,"ngFor","ngForOf"],["class","grid-divider",4,"ngIf"],[1,"category-card",3,"click"],["class","category-image",3,"src",4,"ngIf"],[1,"category-name"],[1,"category-image",3,"src"],[1,"grid-divider"],["class","modern-product-card",3,"click",4,"ngFor","ngForOf"],[1,"modern-product-card",3,"click"],[1,"image-area"],[3,"src",4,"ngIf"],[1,"price-badge"],[1,"info-area"],[1,"name"],[1,"modern-stock-info"],[1,"stock-indicator"],[1,"bar"],[1,"stock-count"],[3,"src"],["class","product-card",3,"click",4,"ngFor","ngForOf"],[1,"product-card",3,"click"],[1,"product-image"],["class","img-thumb",3,"src",4,"ngIf"],["mat-icon-button","","class","view-image-btn","matTooltip","Ver foto",3,"click",4,"ngIf"],[1,"product-details"],[1,"product-name"],[1,"product-meta"],[1,"product-price"],[1,"product-stock"],[1,"img-thumb",3,"src"],["mat-icon-button","","matTooltip","Ver foto",1,"view-image-btn",3,"click"],["ripple","false"]],template:function(n,t){if(n&1){let a=b();i(0,"div",1)(1,"div",2)(2,"div",3),f(3,cn,5,3,"div",4)(4,sn,5,3,"div",5),o(),i(5,"div",6)(6,"mat-icon",7),c(7,"search"),o(),i(8,"input",8,0),g("ngModelChange",function(v){return d(a),p(t.onSearch(v))}),o()()(),f(10,pn,7,1,"div",9),i(11,"div",10),f(12,fn,3,2,"ng-container",11)(13,bn,2,1,"ng-container",11)(14,Pn,2,1,"ng-container",11),o()()}if(n&2){let a,_,v,h,y,I,F,E;D("modern-layout",((a=t.settingsService.getSettings())==null?null:a.pos_layout)==="modern"),l(3),m("ngIf",((_=t.settingsService.getSettings())==null?null:_.pos_layout)==="classic"),l(),m("ngIf",((v=t.settingsService.getSettings())==null?null:v.pos_layout)==="modern"),l(4),m("ngModel",t.searchText),l(2),m("ngIf",((h=t.settingsService.getSettings())==null?null:h.pos_layout)==="modern"&&t.navigationHistory.length>0),l(),D("modern-grid",((y=t.settingsService.getSettings())==null?null:y.pos_layout)==="modern"),l(),m("ngIf",((I=t.settingsService.getSettings())==null?null:I.pos_layout)==="classic"||t.selectedCategory&&t.displayedCategories.length>0),l(),m("ngIf",((F=t.settingsService.getSettings())==null?null:F.pos_layout)==="modern"),l(),m("ngIf",((E=t.settingsService.getSettings())==null?null:E.pos_layout)==="classic")}},dependencies:[A,$,z,X,G,q,U,L,R,B,j,ee,N,Pe,ae,Z],styles:["[_nghost-%COMP%]{display:block;height:100%}.catalog-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background-color:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px #0000000d;padding:10px}.catalog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:2px solid #eee;margin-bottom:10px;gap:16px;flex-wrap:nowrap}.navigation-area[_ngcontent-%COMP%]{flex:1;min-width:0;overflow:hidden}.search-box[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f5f5f5;padding:4px 12px;border-radius:20px;gap:8px;flex-shrink:0}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;background:transparent;outline:none;font-size:.9rem;width:200px}.modern-layout[_ngcontent-%COMP%]   .catalog-header[_ngcontent-%COMP%]{background:transparent;padding:0;box-shadow:none;border-bottom:none;margin-bottom:8px}.modern-categories[_ngcontent-%COMP%]{flex:1;overflow:hidden;min-width:0;-webkit-mask-image:linear-gradient(to right,black 90%,transparent 100%);mask-image:linear-gradient(to right,black 90%,transparent 100%)}.chips-scroll-container[_ngcontent-%COMP%]{display:flex;gap:10px;overflow-x:auto;padding:4px 2px;scrollbar-width:thin;scrollbar-color:#cbd5e1 transparent}.chips-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.chips-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.category-chip[_ngcontent-%COMP%]{padding:8px 20px;border-radius:20px;border:1px solid #e2e8f0;background:#fff;color:#64748b;font-size:14px;font-weight:500;white-space:nowrap;cursor:pointer;transition:all .2s}.category-chip.active[_ngcontent-%COMP%]{background:#6366f1;border-color:#6366f1;color:#fff}.breadcrumb[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;width:100%}.breadcrumb-scroll[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;overflow-x:auto;scrollbar-width:thin;padding-bottom:2px;-webkit-mask-image:linear-gradient(to right,black 90%,transparent 100%);mask-image:linear-gradient(to right,black 90%,transparent 100%)}.breadcrumb-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{height:3px}.breadcrumb-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#e0e0e0;border-radius:3px}.breadcrumb[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;min-width:auto;font-size:.9rem;color:#666;white-space:nowrap}.breadcrumb[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:#3875d5;font-weight:600}.item-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));align-content:start;gap:12px;overflow-y:auto;flex:1;min-height:0;padding:10px 8px 10px 10px;scrollbar-width:thin;scrollbar-color:#cbd5e1 transparent;-webkit-mask-image:linear-gradient(to bottom,black 95%,transparent 100%);mask-image:linear-gradient(to bottom,black 95%,transparent 100%)}.item-grid[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.item-grid[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#e0e0e0;border-radius:10px}.modern-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))!important}.modern-product-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 1px 3px #0000001a;transition:all .2s;cursor:pointer;display:flex!important;flex-direction:column!important;height:220px!important}.modern-product-card[_ngcontent-%COMP%]   .image-area[_ngcontent-%COMP%]{height:120px!important;background:#f8fafc;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}.modern-product-card[_ngcontent-%COMP%]   .image-area[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%!important;height:100%!important;object-fit:cover!important}.modern-product-card[_ngcontent-%COMP%]   .info-area[_ngcontent-%COMP%]{padding:8px 12px;display:flex;flex-direction:column;gap:4px;flex:1}.modern-product-card[_ngcontent-%COMP%]   .info-area[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#334155;line-height:1.2;height:32px;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.modern-product-card[_ngcontent-%COMP%]   .price-badge[_ngcontent-%COMP%]{position:absolute;bottom:8px;right:8px;background:#ffffffe6;padding:4px 8px;border-radius:8px;font-weight:700;font-size:12px;color:#1e293b;box-shadow:0 2px 4px #0000001a}.modern-stock-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:auto}.stock-indicator[_ngcontent-%COMP%]{flex:1;height:4px;background:#f1f5f9;border-radius:2px;overflow:hidden}.stock-indicator[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:100%;background:#10b981}.stock-count[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#64748b}.product-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #eee;border-radius:12px;display:flex;flex-direction:column;cursor:pointer;transition:all .2s;height:175px!important;overflow:hidden}.product-image[_ngcontent-%COMP%]{height:80px!important;background-color:#f8f9fa;display:flex;align-items:center;justify-content:center;position:relative;border-bottom:1px solid #efefef;overflow:hidden}.product-image[_ngcontent-%COMP%]   .img-thumb[_ngcontent-%COMP%]{width:100%!important;height:100%!important;object-fit:cover!important}.product-details[_ngcontent-%COMP%]{padding:6px 8px;flex:1;display:flex;flex-direction:column}.product-name[_ngcontent-%COMP%]{font-size:.8rem;font-weight:500;color:#333;margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;height:2.4em}.product-price[_ngcontent-%COMP%]{font-weight:700;color:#3875d5;font-size:.9rem}.product-meta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:auto}.product-stock[_ngcontent-%COMP%]{font-size:.7rem;background:#e8f5e9;color:#2e7d32;padding:1px 4px;border-radius:4px;font-weight:600}.view-image-btn[_ngcontent-%COMP%]{position:absolute;top:4px;right:4px;color:#3875d5!important;background:#ffffffb3!important}"]})}return r})();function wn(r,u){if(r&1&&(i(0,"span"),c(1),o()),r&2){let e=s().$implicit;l(),O("(x",e.quantity,")")}}function kn(r,u){if(r&1&&(i(0,"mat-radio-button",10),c(1),f(2,wn,2,1,"span",11),o()),r&2){let e=u.$implicit;m("value",e),l(),O(" ",e.component_name," "),l(),m("ngIf",e.quantity>1)}}function On(r,u){if(r&1){let e=b();i(0,"div",7)(1,"h3"),c(2),o(),i(3,"mat-radio-group",8),w("ngModelChange",function(t){let a=d(e).$implicit,_=s();return P(_.selections[a.id],t)||(_.selections[a.id]=t),p(t)}),f(4,kn,3,3,"mat-radio-button",9),o()()}if(r&2){let e=u.$implicit,n=s();l(2),C(e.name||"Opciones"),l(),S("ngModel",n.selections[e.id]),l(),m("ngForOf",e.components)}}function En(r,u){if(r&1&&(i(0,"li"),c(1),o()),r&2){let e=u.$implicit;l(),oe(" ",e.component_name," x",e.quantity," ")}}function Dn(r,u){if(r&1&&(i(0,"div",12)(1,"h3"),c(2,"Incluye adem\xE1s:"),o(),i(3,"ul"),f(4,En,2,2,"li",13),o()()),r&2){let e=s();l(4),m("ngForOf",e.fixedComponents)}}var Nt=(()=>{class r{dialogRef;data;groups=[];fixedComponents=[];selections={};constructor(e,n){this.dialogRef=e,this.data=n}ngOnInit(){let e={},n={};this.data.components.forEach(t=>{t.group_id?(e[t.group_id]||(e[t.group_id]=[],n[t.group_id]=t.group_name||`Grupo ${t.group_id}`),e[t.group_id].push(t)):this.fixedComponents.push(t)}),Object.keys(e).forEach(t=>{let a=parseInt(t);this.groups.push({id:a,name:n[a],components:e[a]}),e[a].length>0})}allGroupsSelected(){return this.groups.every(e=>!!this.selections[e.id])}onConfirm(){let e=[...this.fixedComponents];Object.values(this.selections).forEach(n=>e.push(n)),this.dialogRef.close(e)}static \u0275fac=function(n){return new(n||r)(M(K),M(H))};static \u0275cmp=V({type:r,selectors:[["app-kit-selection-dialog"]],decls:11,vars:4,consts:[["mat-dialog-title",""],[1,"groups-container"],["class","group-box",4,"ngFor","ngForOf"],["class","fixed-box",4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"group-box"],[1,"options-list",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngIf"],[1,"fixed-box"],[4,"ngFor","ngForOf"]],template:function(n,t){n&1&&(i(0,"h2",0),c(1),o(),i(2,"mat-dialog-content")(3,"div",1),f(4,On,5,3,"div",2)(5,Dn,5,1,"div",3),o()(),i(6,"mat-dialog-actions",4)(7,"button",5),g("click",function(){return t.dialogRef.close()}),c(8,"Cancelar"),o(),i(9,"button",6),g("click",function(){return t.onConfirm()}),c(10," Agregar al Carrito "),o()()),n&2&&(l(),O("Personalizar Kit: ",t.data.productName),l(3),m("ngForOf",t.groups),l(),m("ngIf",t.fixedComponents.length>0),l(4),m("disabled",!t.allGroupsSelected()))},dependencies:[A,$,z,N,pe,we,me,B,j,pt,Pt,Mt,St,bt,X,q,U],styles:[".groups-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;min-width:300px}.group-box[_ngcontent-%COMP%]{border:1px solid #ddd;padding:16px;border-radius:8px}.group-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#1976d2;border-bottom:2px solid #e3f2fd;padding-bottom:8px}.options-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:10px}.fixed-box[_ngcontent-%COMP%]{background:#f9f9f9;padding:16px;border-radius:8px}.fixed-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}ul[_ngcontent-%COMP%]{padding-left:20px;margin:0}"]})}return r})();function Tn(r,u){if(r&1&&(i(0,"div",25)(1,"div",26)(2,"mat-icon"),c(3,"person"),o(),i(4,"span"),c(5),o()(),i(6,"div",27)(7,"div",28)(8,"span",29),c(9,"L\xEDmite:"),o(),i(10,"span",30),c(11),x(12,"currency"),o()(),i(13,"div",28)(14,"span",29),c(15,"Deuda:"),o(),i(16,"span",31),c(17),x(18,"currency"),o()(),i(19,"div",28)(20,"span",29),c(21,"Disponible:"),o(),i(22,"span",32),c(23),x(24,"currency"),o()()()()),r&2){let e=s();l(5),C(e.data.customer.name),l(6),C(k(12,4,e.data.customer.maxdebt,"USD","$ ",e.settingsService.getDecimalFormat("total"))),l(6),C(k(18,9,e.data.customer.curdebt||0,"USD","$ ",e.settingsService.getDecimalFormat("total"))),l(6),C(k(24,14,e.data.customer.maxdebt-(e.data.customer.curdebt||0),"USD","$ ",e.settingsService.getDecimalFormat("total")))}}function Vn(r,u){if(r&1&&(i(0,"div",33)(1,"span"),c(2),o(),i(3,"div",8)(4,"div",9),c(5),x(6,"currency"),o(),i(7,"div"),c(8),x(9,"currency"),o()()()),r&2){let e,n=s();l(2),O("I.G.T.F. (",((e=n.settingsService.getSettings())==null?null:e.igtf_percentage)||3,"%)"),l(3),C(k(6,3,n.igtfAmountAlt,"USD","$ ",n.settingsService.getDecimalFormat("total"))),l(3),C(k(9,8,n.igtfAmount,"VES","Bs. ",n.settingsService.getDecimalFormat("total")))}}function An(r,u){if(r&1){let e=b();i(0,"div",36)(1,"mat-form-field",37)(2,"mat-label"),c(3,"Monto Recibido"),o(),i(4,"span",38),c(5,"Bs. \xA0"),o(),i(6,"input",39),w("ngModelChange",function(t){d(e);let a=s(2);return P(a.receivedAmount,t)||(a.receivedAmount=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s(2);return p(a.calculateChange(t,"base"))}),o()()()}if(r&2){let e=s(2);l(6),S("ngModel",e.receivedAmount)}}function Bn(r,u){if(r&1){let e=b();i(0,"div",36)(1,"mat-form-field",37)(2,"mat-label"),c(3,"Monto Recibido"),o(),i(4,"span",38),c(5,"$ \xA0"),o(),i(6,"input",39),w("ngModelChange",function(t){d(e);let a=s(2);return P(a.receivedAmountAlt,t)||(a.receivedAmountAlt=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s(2);return p(a.calculateChange(t,"alt"))}),o()()()}if(r&2){let e=s(2);l(6),S("ngModel",e.receivedAmountAlt)}}function Fn(r,u){if(r&1){let e=b();i(0,"mat-form-field",48)(1,"mat-label"),c(2,"Tel\xE9fono / C\xE9dula"),o(),i(3,"input",49),w("ngModelChange",function(t){d(e);let a=s(3);return P(a.paymentDetails.PagoMovil.cedula,t)||(a.paymentDetails.PagoMovil.cedula=t),p(t)}),o()()}if(r&2){let e=s(3);l(3),S("ngModel",e.paymentDetails.PagoMovil.cedula)}}function Rn(r,u){if(r&1){let e=b();i(0,"mat-form-field",48)(1,"mat-label"),c(2,"N\xFAmero de Cuenta (Opcional)"),o(),i(3,"input",50),w("ngModelChange",function(t){d(e);let a=s(3);return P(a.paymentDetails.transfer.account,t)||(a.paymentDetails.transfer.account=t),p(t)}),o()()}if(r&2){let e=s(3);l(3),S("ngModel",e.paymentDetails.transfer.account)}}function Ln(r,u){if(r&1&&(i(0,"mat-option",51),c(1),o()),r&2){let e=u.$implicit;m("value",e.id),l(),De(" ",e.name," - ",e.account_type_name," (",e.currency,") ")}}function Nn(r,u){if(r&1){let e=b();i(0,"div",40),f(1,Fn,4,1,"mat-form-field",41)(2,Rn,4,1,"mat-form-field",41),i(3,"div",42)(4,"mat-form-field",43)(5,"mat-label"),c(6,"Referencia"),o(),i(7,"input",44),w("ngModelChange",function(t){d(e);let a=s(2);return P(a.paymentDetails[a.selectedMethod].reference,t)||(a.paymentDetails[a.selectedMethod].reference=t),p(t)}),o()(),i(8,"mat-form-field",43)(9,"mat-label"),c(10,"Banco"),o(),i(11,"mat-select",45),w("ngModelChange",function(t){d(e);let a=s(2);return P(a.selectedBankId,t)||(a.selectedBankId=t),p(t)}),i(12,"mat-option",46),c(13,"Ninguno"),o(),f(14,Ln,2,4,"mat-option",47),o()()()()}if(r&2){let e=s(2);l(),m("ngIf",e.selectedMethod==="PagoMovil"),l(),m("ngIf",e.selectedMethod==="transfer"),l(5),S("ngModel",e.paymentDetails[e.selectedMethod].reference),l(4),S("ngModel",e.selectedBankId),l(3),m("ngForOf",e.getFilteredBanks(e.selectedMethod))}}function Wn(r,u){if(r&1&&(ne(0),f(1,An,7,1,"div",34)(2,Bn,7,1,"div",34)(3,Nn,15,5,"div",35),ie()),r&2){let e=s();l(),m("ngIf",e.selectedCurrency==="base"),l(),m("ngIf",e.selectedCurrency==="alt"),l(),m("ngIf",e.requiresBank(e.selectedMethod))}}function zn(r,u){if(r&1&&(i(0,"mat-option",51),c(1),o()),r&2){let e=u.$implicit;m("value",e.id),l(),De(" ",e.name," - ",e.account_type_name," (",e.currency,") ")}}function jn(r,u){if(r&1&&(i(0,"mat-option",51),c(1),o()),r&2){let e=u.$implicit;m("value",e.id),l(),De(" ",e.name," - ",e.account_type_name," (",e.currency,") ")}}function qn(r,u){if(r&1&&(i(0,"mat-option",51),c(1),o()),r&2){let e=u.$implicit;m("value",e.id),l(),De(" ",e.name," - ",e.account_type_name," (",e.currency,") ")}}function Un(r,u){if(r&1){let e=b();i(0,"div",53)(1,"div",54)(2,"mat-icon",66),c(3,"request_quote"),o()(),i(4,"div",56),c(5,"Cr\xE9dito"),o(),i(6,"mat-form-field",57)(7,"span",38),c(8,"Bs. \xA0"),o(),i(9,"input",58),w("ngModelChange",function(t){d(e);let a=s(2);return P(a.payments.Credito,t)||(a.payments.Credito=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s(2);return p(a.updateMultiPayment("Credito",t,"base"))}),o()(),i(10,"mat-form-field",57)(11,"span",38),c(12,"$ \xA0"),o(),i(13,"input",59),w("ngModelChange",function(t){d(e);let a=s(2);return P(a.paymentsAlt.Credito,t)||(a.paymentsAlt.Credito=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s(2);return p(a.updateMultiPayment("Credito",t,"alt"))}),o()(),T(14,"div")(15,"div")(16,"div"),o()}if(r&2){let e=s(2);l(9),S("ngModel",e.payments.Credito),l(4),S("ngModel",e.paymentsAlt.Credito)}}function Xn(r,u){if(r&1){let e=b();i(0,"div",52)(1,"div",53)(2,"div",54)(3,"mat-icon",55),c(4,"payments"),o()(),i(5,"div",56),c(6,"Efectivo"),o(),i(7,"mat-form-field",57)(8,"span",38),c(9,"Bs. \xA0"),o(),i(10,"input",58),w("ngModelChange",function(t){d(e);let a=s();return P(a.payments.cash,t)||(a.payments.cash=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("cash",t,"base"))}),o()(),i(11,"mat-form-field",57)(12,"span",38),c(13,"$ \xA0"),o(),i(14,"input",59),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentsAlt.cash,t)||(a.paymentsAlt.cash=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("cash",t,"alt"))}),o()(),T(15,"div")(16,"div")(17,"div"),o(),i(18,"div",53)(19,"div",54)(20,"mat-icon",60),c(21,"credit_card"),o()(),i(22,"div",56),c(23,"Tarjeta"),o(),i(24,"mat-form-field",57)(25,"span",38),c(26,"Bs. \xA0"),o(),i(27,"input",58),w("ngModelChange",function(t){d(e);let a=s();return P(a.payments.card,t)||(a.payments.card=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("card",t,"base"))}),o()(),i(28,"mat-form-field",57)(29,"span",38),c(30,"$ \xA0"),o(),i(31,"input",61),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentsAlt.card,t)||(a.paymentsAlt.card=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("card",t,"alt"))}),o()(),i(32,"mat-form-field",57)(33,"mat-label"),c(34,"Referencia"),o(),i(35,"input",44),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.card.reference,t)||(a.paymentDetails.card.reference=t),p(t)}),o()(),i(36,"mat-form-field",57)(37,"mat-label"),c(38,"Banco"),o(),i(39,"mat-select",45),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.card.bank_id,t)||(a.paymentDetails.card.bank_id=t),p(t)}),i(40,"mat-option",46),c(41,"Ninguno"),o(),f(42,zn,2,4,"mat-option",47),o()(),T(43,"div"),o(),i(44,"div",53)(45,"div",54)(46,"mat-icon",62),c(47,"smartphone"),o()(),i(48,"div",56),c(49,"Pago M\xF3vil"),o(),i(50,"mat-form-field",57)(51,"span",38),c(52,"Bs. \xA0"),o(),i(53,"input",58),w("ngModelChange",function(t){d(e);let a=s();return P(a.payments.PagoMovil,t)||(a.payments.PagoMovil=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("PagoMovil",t,"base"))}),o()(),i(54,"mat-form-field",57)(55,"span",38),c(56,"$ \xA0"),o(),i(57,"input",61),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentsAlt.PagoMovil,t)||(a.paymentsAlt.PagoMovil=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("PagoMovil",t,"alt"))}),o()(),i(58,"mat-form-field",57)(59,"mat-label"),c(60,"Referencia"),o(),i(61,"input",44),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.PagoMovil.reference,t)||(a.paymentDetails.PagoMovil.reference=t),p(t)}),o()(),i(62,"mat-form-field",57)(63,"mat-label"),c(64,"Banco"),o(),i(65,"mat-select",45),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.PagoMovil.bank_id,t)||(a.paymentDetails.PagoMovil.bank_id=t),p(t)}),i(66,"mat-option",46),c(67,"Ninguno"),o(),f(68,jn,2,4,"mat-option",47),o()(),i(69,"mat-form-field",57)(70,"mat-label"),c(71,"Tlf / C\xE9dula"),o(),i(72,"input",63),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.PagoMovil.cedula,t)||(a.paymentDetails.PagoMovil.cedula=t),p(t)}),o()()(),i(73,"div",53)(74,"div",54)(75,"mat-icon",64),c(76,"sync_alt"),o()(),i(77,"div",56),c(78,"Transferencia"),o(),i(79,"mat-form-field",57)(80,"span",38),c(81,"Bs. \xA0"),o(),i(82,"input",58),w("ngModelChange",function(t){d(e);let a=s();return P(a.payments.transfer,t)||(a.payments.transfer=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("transfer",t,"base"))}),o()(),i(83,"mat-form-field",57)(84,"span",38),c(85,"$ \xA0"),o(),i(86,"input",61),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentsAlt.transfer,t)||(a.paymentsAlt.transfer=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateMultiPayment("transfer",t,"alt"))}),o()(),i(87,"mat-form-field",57)(88,"mat-label"),c(89,"Referencia"),o(),i(90,"input",44),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.transfer.reference,t)||(a.paymentDetails.transfer.reference=t),p(t)}),o()(),i(91,"mat-form-field",57)(92,"mat-label"),c(93,"Banco"),o(),i(94,"mat-select",45),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.transfer.bank_id,t)||(a.paymentDetails.transfer.bank_id=t),p(t)}),i(95,"mat-option",46),c(96,"Ninguno"),o(),f(97,qn,2,4,"mat-option",47),o()(),i(98,"mat-form-field",57)(99,"mat-label"),c(100,"Cuenta"),o(),i(101,"input",50),w("ngModelChange",function(t){d(e);let a=s();return P(a.paymentDetails.transfer.account,t)||(a.paymentDetails.transfer.account=t),p(t)}),o()()(),f(102,Un,17,2,"div",65),o()}if(r&2){let e=s();l(10),S("ngModel",e.payments.cash),l(4),S("ngModel",e.paymentsAlt.cash),l(13),S("ngModel",e.payments.card),l(4),S("ngModel",e.paymentsAlt.card),m("disabled",!0),l(4),S("ngModel",e.paymentDetails.card.reference),l(4),S("ngModel",e.paymentDetails.card.bank_id),l(3),m("ngForOf",e.getFilteredBanks("card")),l(11),S("ngModel",e.payments.PagoMovil),l(4),S("ngModel",e.paymentsAlt.PagoMovil),m("disabled",!0),l(4),S("ngModel",e.paymentDetails.PagoMovil.reference),l(4),S("ngModel",e.paymentDetails.PagoMovil.bank_id),l(3),m("ngForOf",e.getFilteredBanks("PagoMovil")),l(4),S("ngModel",e.paymentDetails.PagoMovil.cedula),l(10),S("ngModel",e.payments.transfer),l(4),S("ngModel",e.paymentsAlt.transfer),m("disabled",!0),l(4),S("ngModel",e.paymentDetails.transfer.reference),l(4),S("ngModel",e.paymentDetails.transfer.bank_id),l(3),m("ngForOf",e.getFilteredBanks("transfer")),l(4),S("ngModel",e.paymentDetails.transfer.account),l(),m("ngIf",e.data.customer)}}function Qn(r,u){r&1&&(i(0,"span",67),c(1,"Cambio:"),o())}function $n(r,u){if(r&1&&(i(0,"div",8)(1,"div",9),c(2),x(3,"currency"),o(),i(4,"div",68),c(5),x(6,"currency"),o()()),r&2){let e=s();l(2),C(k(3,2,e.changeAlt,"USD","$ ",e.settingsService.getDecimalFormat("total"))),l(3),O("",k(6,7,e.change,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))," ")}}function Gn(r,u){r&1&&(i(0,"span",69),c(1,"Restante:"),o())}function Kn(r,u){if(r&1&&(i(0,"div",8)(1,"div",70),c(2),x(3,"currency"),o(),i(4,"div",71),c(5),x(6,"currency"),o()()),r&2){let e=s();l(2),C(k(3,2,e.remainingAlt,"USD","$ ",e.settingsService.getDecimalFormat("total"))),l(3),O("",k(6,7,e.remaining,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))," ")}}function Hn(r,u){if(r&1){let e=b();i(0,"div",72)(1,"div",73),g("click",function(){d(e);let t=s();return p(t.selectedMethod="cash")}),i(2,"mat-icon"),c(3,"payments"),o(),i(4,"span"),c(5,"Efectivo"),o()(),i(6,"div",73),g("click",function(){d(e);let t=s();return p(!t.isMethodDisabled("card")&&(t.selectedMethod="card"))}),i(7,"mat-icon"),c(8,"credit_card"),o(),i(9,"span"),c(10,"Tarjeta"),o()(),i(11,"div",73),g("click",function(){d(e);let t=s();return p(!t.isMethodDisabled("PagoMovil")&&(t.selectedMethod="PagoMovil"))}),i(12,"mat-icon"),c(13,"smartphone"),o(),i(14,"span"),c(15,"Pago M\xF3vil"),o()(),i(16,"div",73),g("click",function(){d(e);let t=s();return p(!t.isMethodDisabled("transfer")&&(t.selectedMethod="transfer"))}),i(17,"mat-icon"),c(18,"sync_alt"),o(),i(19,"span"),c(20,"Transferencia"),o()(),i(21,"div",73),g("click",function(){d(e);let t=s();return p(!t.isMethodDisabled("Credito")&&(t.selectedMethod="Credito"))}),i(22,"mat-icon"),c(23,"request_quote"),o(),i(24,"span"),c(25,"Cr\xE9dito"),o()()()}if(r&2){let e=s();l(),D("active",e.selectedMethod==="cash"),l(5),D("active",e.selectedMethod==="card")("disabled",e.isMethodDisabled("card")),l(5),D("active",e.selectedMethod==="PagoMovil")("disabled",e.isMethodDisabled("PagoMovil")),l(5),D("active",e.selectedMethod==="transfer")("disabled",e.isMethodDisabled("transfer")),l(5),D("active",e.selectedMethod==="Credito")("disabled",e.isMethodDisabled("Credito"))}}var Wt=(()=>{class r{dialogRef;data;settingsService;banksService;receivedAmount=0;receivedAmountAlt=0;change=0;changeAlt=0;selectedMethod="cash";selectedCurrency="base";pow=Math.pow;isMultiPayment=!1;payments={cash:0,card:0,PagoMovil:0,transfer:0,Credito:0};paymentsAlt={cash:0,card:0,PagoMovil:0,transfer:0,Credito:0};paymentDetails={card:{reference:"",bank:"",cedula:"",bank_id:""},PagoMovil:{reference:"",bank:"",cedula:"",bank_id:"",is_pago_movil:!0},transfer:{reference:"",bank:"",cedula:"",bank_id:"",account:""},cash:{reference:"",bank:"",cedula:"",bank_id:""},Credito:{reference:"",bank:"",cedula:"",bank_id:""}};banks=[];selectedBankId="";remaining=0;remainingAlt=0;igtfAmount=0;igtfAmountAlt=0;constructor(e,n,t,a){this.dialogRef=e,this.data=n,this.settingsService=t,this.banksService=a}ngOnInit(){this.receivedAmountAlt=this.data.totalAlt,this.calculateChange(this.receivedAmountAlt,"alt"),this.loadBanks()}loadBanks(){this.banksService.getBanks(!0).subscribe({next:e=>{this.banks=e},error:e=>{console.error("Error loading banks:",e)}})}requiresBank(e){return["card","transfer","Debito","Credito","PagoMovil"].includes(e)}getFilteredBanks(e){return e==="PagoMovil"?this.banks.filter(n=>n.allows_pago_movil):this.banks}toggleMultiPayment(){this.isMultiPayment=!this.isMultiPayment,this.isMultiPayment?(this.receivedAmount>0&&(this.selectedCurrency==="base"?(this.payments.cash=this.receivedAmount,this.paymentsAlt.cash=0):(this.paymentsAlt.cash=this.receivedAmountAlt,this.payments.cash=0)),this.selectedMethod="mixed"):(this.selectedMethod="cash",this.payments={cash:0,card:0,PagoMovil:0,transfer:0,Credito:0},this.paymentsAlt={cash:0,card:0,PagoMovil:0,transfer:0,Credito:0},this.calculateChange(this.selectedCurrency==="base"?this.receivedAmount:this.receivedAmountAlt,this.selectedCurrency))}updateMultiPayment(e,n,t){let a=Number(n);isNaN(a)&&(a=0),t==="base"?this.payments[e]=a:this.paymentsAlt[e]=a,this.calculateTotals()}calculateTotals(){let e=this.settingsService.getSettings(),n=e?.total_decimals||2,t=this.data.exchangeRate||1,a=Object.values(this.payments).reduce((Y,ze)=>Y+ze,0),_=Object.values(this.paymentsAlt).reduce((Y,ze)=>Y+ze,0),v=e?.igtf_enabled?(e.igtf_percentage||3)/100:0;this.igtfAmountAlt=_*v,this.igtfAmount=this.igtfAmountAlt*t;let h=a+_*t,y=_+a/t;this.receivedAmount=parseFloat(h.toFixed(n)),this.receivedAmountAlt=parseFloat(y.toFixed(n));let I=parseFloat((this.data.totalAlt*t).toFixed(n)),F=this.data.totalAlt,E=I+this.igtfAmount,W=F+this.igtfAmountAlt;this.change=Math.max(0,this.receivedAmount-E),this.changeAlt=Math.max(0,this.receivedAmountAlt-W),this.remaining=Math.max(0,E-this.receivedAmount),this.remainingAlt=Math.max(0,W-this.receivedAmountAlt),this.change=parseFloat(this.change.toFixed(n)),this.changeAlt=parseFloat(this.changeAlt.toFixed(n)),this.remaining=parseFloat(this.remaining.toFixed(n)),this.remainingAlt=parseFloat(this.remainingAlt.toFixed(n))}calculateChange(e,n){let t=this.settingsService.getSettings(),a=t?.price_decimals||2,_=t?.total_decimals||2,v=this.data.exchangeRate||1,h=Number(e);isNaN(h)&&(h=0);let y=0;n==="alt"&&(y=h);let I=t?.igtf_enabled?(t.igtf_percentage||3)/100:0;this.igtfAmountAlt=y*I,this.igtfAmount=this.igtfAmountAlt*v,n==="base"?(this.receivedAmount=h,this.receivedAmountAlt=parseFloat((h/v).toFixed(a))):(this.receivedAmountAlt=h,this.receivedAmount=parseFloat((h*v).toFixed(a)));let F=parseFloat((this.data.totalAlt*v).toFixed(_)),E=this.data.totalAlt,W=F+this.igtfAmount,Y=E+this.igtfAmountAlt;this.change=Math.max(0,this.receivedAmount-W),this.changeAlt=Math.max(0,this.receivedAmountAlt-Y),this.remaining=Math.max(0,W-this.receivedAmount),this.remainingAlt=Math.max(0,Y-this.receivedAmountAlt),this.change=parseFloat(this.change.toFixed(_)),this.changeAlt=parseFloat(this.changeAlt.toFixed(_)),this.remaining=parseFloat(this.remaining.toFixed(_)),this.remainingAlt=parseFloat(this.remainingAlt.toFixed(_))}setCurrency(e){this.selectedCurrency=e,e==="alt"&&["card","transfer","PagoMovil"].includes(this.selectedMethod)&&(this.selectedMethod="cash"),this.calculateChange(this.selectedCurrency==="base"?this.receivedAmount:this.receivedAmountAlt,this.selectedCurrency)}isMethodDisabled(e){return!!(this.selectedCurrency==="alt"&&["card","transfer","PagoMovil"].includes(e)||e==="Credito"&&!this.data.customer)}onCancel(){this.dialogRef.close()}getTaxPercentage(){return this.data.subtotal>0&&this.data.taxes>0?Math.round(this.data.taxes/this.data.subtotal*100):16}onConfirm(){let e={method:this.isMultiPayment?"mixed":this.selectedMethod,amount:this.selectedCurrency==="base"?this.receivedAmount:this.receivedAmountAlt,total:this.data.total,change:this.selectedCurrency==="base"?this.change:this.changeAlt,currency_id:this.selectedCurrency==="base"?1:2,exchange_rate:this.data.exchangeRate,money_id:this.data.money_id,bank_id:this.selectedBankId||null,igtf_amount:this.igtfAmount,igtf_amount_alt:this.igtfAmountAlt,multiparams:this.isMultiPayment?{payments:this.payments,paymentsAlt:this.paymentsAlt}:null,paymentDetails:this.selectedMethod==="card"||this.selectedMethod==="transfer"||this.selectedMethod==="PagoMovil"||this.selectedMethod==="Credito"||this.isMultiPayment?this.paymentDetails:null},n=this.isMultiPayment&&(this.payments.Credito>0||this.paymentsAlt.Credito>0),t=!this.isMultiPayment&&this.selectedMethod==="Credito";if(n||t){if(!this.data.customer){alert("Debe seleccionar un cliente para realizar una venta a cr\xE9dito.");return}let a=Number(this.data.customer.curdebt||0),_=Number(this.data.customer.maxdebt||0),v=0;t?v=this.selectedCurrency==="base"?this.receivedAmount:this.receivedAmountAlt*this.data.exchangeRate:v=(this.payments.Credito||0)+(this.paymentsAlt.Credito||0)*this.data.exchangeRate;let y=(a+v)/(this.data.exchangeRate||1);if(_>0&&y>_+.01){alert(`El cliente ha excedido su l\xEDmite de cr\xE9dito. L\xEDmite: $ ${_}, Deuda total (en USD): $ ${y.toFixed(2)}`);return}}this.dialogRef.close(e)}static \u0275fac=function(n){return new(n||r)(M(K),M(H),M(te),M(Ct))};static \u0275cmp=V({type:r,selectors:[["app-payment-dialog"]],decls:53,vars:41,consts:[[1,"payment-container"],[1,"scrollable-content"],[1,"title"],["class","customer-credit-info",4,"ngIf"],[1,"totals-summary"],[1,"total-row"],["class","total-row igtf",4,"ngIf"],[1,"total-row","main"],[2,"text-align","right"],[2,"font-size","0.9rem","opacity","0.8"],[1,"input-section"],[1,"currency-tabs"],[3,"click"],[1,"payment-mode-toggle",2,"margin-top","10px","text-align","center","margin-bottom","1rem"],["mat-stroked-button","","color","primary",3,"click"],[4,"ngIf"],["class","multi-payment-list",4,"ngIf"],[1,"change-display"],["class","change-label",4,"ngIf"],["style","text-align: right;",4,"ngIf"],["class","change-label","style","color: #d32f2f;",4,"ngIf"],["class","methods-grid",4,"ngIf"],[1,"actions"],["mat-stroked-button","",1,"btn-cancel",3,"click"],["mat-raised-button","",1,"btn-confirm",3,"click","disabled"],[1,"customer-credit-info"],[1,"customer-name"],[1,"credit-details"],[1,"credit-stat"],[1,"label"],[1,"value"],[1,"value","debt"],[1,"value","available"],[1,"total-row","igtf"],["class","single-input-wrapper",4,"ngIf"],["style","margin-top: 8px; display: flex; flex-direction: column; gap: 8px;",4,"ngIf"],[1,"single-input-wrapper"],["appearance","outline",1,"full-width"],["matTextPrefix",""],["matInput","","appMoneyInput","","autocomplete","off",3,"ngModelChange","ngModel"],[2,"margin-top","8px","display","flex","flex-direction","column","gap","8px"],["appearance","outline","density","compact","style","width: 100%;",4,"ngIf"],[2,"display","flex","gap","8px"],["appearance","outline","density","compact",2,"flex","1"],["matInput","","placeholder","Ref #",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["appearance","outline","density","compact",2,"width","100%"],["matInput","","placeholder","0412... / V-1234...",3,"ngModelChange","ngModel"],["matInput","","placeholder","0102...",3,"ngModelChange","ngModel"],[3,"value"],[1,"multi-payment-list"],[1,"multi-row-mat"],[1,"method-icon"],["title","Efectivo"],[1,"method-name"],["appearance","outline","density","compact"],["matInput","","appMoneyInput","","placeholder","0,00",3,"ngModelChange","ngModel"],["matInput","","appMoneyInput","","placeholder","0.00",3,"ngModelChange","ngModel"],["title","Tarjeta"],["matInput","","appMoneyInput","","placeholder","0.00",3,"ngModelChange","ngModel","disabled"],["title","Pago M\xF3vil"],["matInput","","placeholder","0412... / V-...",3,"ngModelChange","ngModel"],["title","Transferencia"],["class","multi-row-mat",4,"ngIf"],["title","Venta a Cr\xE9dito"],[1,"change-label"],[1,"change-value"],[1,"change-label",2,"color","#d32f2f"],[2,"font-size","0.9rem","opacity","0.8","color","#d32f2f"],[1,"change-value",2,"color","#d32f2f"],[1,"methods-grid"],[1,"method-btn",3,"click"]],template:function(n,t){if(n&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Finalizar Venta"),o(),f(4,Tn,25,19,"div",3),i(5,"div",4)(6,"div",5)(7,"span"),c(8,"Subtotal"),o(),i(9,"span"),c(10),x(11,"currency"),o()(),i(12,"div",5)(13,"span"),c(14),o(),i(15,"span"),c(16),x(17,"currency"),o()(),f(18,Vn,10,13,"div",6),i(19,"div",7)(20,"span"),c(21,"TOTAL"),o(),i(22,"div",8)(23,"div",9),c(24),x(25,"currency"),o(),i(26,"div"),c(27),x(28,"currency"),o()()()(),i(29,"div",10)(30,"div",11)(31,"button",12),g("click",function(){return t.setCurrency("base")}),c(32,"Bs."),o(),i(33,"button",12),g("click",function(){return t.setCurrency("alt")}),c(34,"$ USD"),o()(),i(35,"div",13)(36,"button",14),g("click",function(){return t.toggleMultiPayment()}),i(37,"mat-icon"),c(38),o(),c(39),o()(),f(40,Wn,4,3,"ng-container",15)(41,Xn,103,23,"div",16),o(),i(42,"div",17),f(43,Qn,2,0,"span",18)(44,$n,7,12,"div",19)(45,Gn,2,0,"span",20)(46,Kn,7,12,"div",19),o()(),f(47,Hn,26,18,"div",21),i(48,"div",22)(49,"button",23),g("click",function(){return t.onCancel()}),c(50,"CANCELAR"),o(),i(51,"button",24),g("click",function(){return t.onConfirm()}),c(52," CONFIRMAR PAGO "),o()()()),n&2){let a;l(4),m("ngIf",t.data.customer),l(6),C(k(11,21,t.data.subtotal,"VES","Bs. ",t.settingsService.getDecimalFormat("total"))),l(4),O("IVA (",t.getTaxPercentage(),"%)"),l(2),C(k(17,26,t.data.taxes,"VES","Bs. ",t.settingsService.getDecimalFormat("total"))),l(2),m("ngIf",((a=t.settingsService.getSettings())==null?null:a.igtf_enabled)&&(t.selectedCurrency==="alt"||t.isMultiPayment)),l(6),C(k(25,31,t.data.totalAlt,"USD","$ ",t.settingsService.getDecimalFormat("total"))),l(3),C(k(28,36,t.data.total*t.data.exchangeRate,"VES","Bs. ",t.settingsService.getDecimalFormat("total"))),l(4),D("active",t.selectedCurrency==="base"),l(2),D("active",t.selectedCurrency==="alt"),l(5),C(t.isMultiPayment?"arrow_back":"layers"),l(),O(" ",t.isMultiPayment?"Volver a Pago Simple":"Activar Pago Mixto"," "),l(),m("ngIf",!t.isMultiPayment),l(),m("ngIf",t.isMultiPayment),l(2),m("ngIf",t.remaining<=0),l(),m("ngIf",t.remaining<=0),l(),m("ngIf",t.remaining>0),l(),m("ngIf",t.remaining>0),l(),m("ngIf",!t.isMultiPayment),l(4),m("disabled",t.remaining>.01)}},dependencies:[A,$,z,X,G,q,U,N,L,R,B,j,le,ce,re,dt,de,se,ht,xt,Be,ue,Z],styles:[".payment-container[_ngcontent-%COMP%]{padding:16px 24px;max-width:1000px;width:95%;max-height:95vh;display:flex;flex-direction:column}.scrollable-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-right:8px;margin-bottom:16px}.title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin:0;color:#333}.totals-summary[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:20px;border-radius:12px;display:flex;flex-direction:column;gap:8px}.customer-credit-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f0f7ff,#e1effe);border:1px solid #c3ddfd;padding:12px 16px;border-radius:12px;display:flex;flex-direction:column;gap:8px;margin-bottom:5px}.customer-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600;color:#1a56db}.customer-name[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.credit-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}.credit-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column}.credit-stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:#4b5563;text-transform:uppercase}.credit-stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:.95rem;font-weight:700;color:#111827}.credit-stat[_ngcontent-%COMP%]   .value.debt[_ngcontent-%COMP%]{color:#e02424}.credit-stat[_ngcontent-%COMP%]   .value.available[_ngcontent-%COMP%]{color:#057a55}.method-btn.disabled[_ngcontent-%COMP%]{opacity:.5;background-color:#f3f4f6;cursor:not-allowed;pointer-events:none}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1.1rem}.total-row.igtf[_ngcontent-%COMP%]{font-size:1rem;color:#e02424;font-weight:500}.total-row.main[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#3875d5;border-top:1px solid #ddd;padding-top:12px;margin-top:4px}.input-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.input-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#666}.amount-input[_ngcontent-%COMP%]{font-size:2rem;font-family:Roboto Mono,monospace;width:100%;text-align:right;padding:12px;border:2px solid #e0e0e0;border-radius:8px;outline:none;transition:border-color .2s}.amount-input[_ngcontent-%COMP%]:focus{border-color:#3875d5}.currency-tabs[_ngcontent-%COMP%]{display:flex;gap:6px;margin-bottom:6px}.currency-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;height:40px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer;font-weight:600;transition:all .2s}.currency-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#3875d5;color:#fff;border-color:#3875d5}.change-display[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;background-color:#e8f5e9;border-radius:8px;color:#2e7d32}.change-label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:500}.change-value[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;font-family:Roboto Mono,monospace}.methods-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}.method-btn[_ngcontent-%COMP%]{height:80px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;border:1px solid #dadce0;background:#fff;border-radius:12px;cursor:pointer;transition:all .2s}.method-btn[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;border-color:#3875d5}.method-btn.active[_ngcontent-%COMP%]{background-color:#e8f0fe;border-color:#1967d2;color:#1967d2}.method-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:12px}.btn-cancel[_ngcontent-%COMP%]{flex:1}.btn-confirm[_ngcontent-%COMP%]{flex:2;background-color:#4caf50;color:#fff}.single-input-wrapper[_ngcontent-%COMP%]{margin-top:10px}.multi-row-mat[_ngcontent-%COMP%]{display:grid;grid-template-columns:32px 80px repeat(5,minmax(0,1fr));align-items:center;gap:8px;padding:8px 12px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0;width:100%;box-sizing:border-box}.method-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.method-name[_ngcontent-%COMP%]{font-weight:600;font-size:13px;color:#334155;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}  .multi-payment-list .mat-mdc-text-field-wrapper{background-color:#fff!important}.full-width[_ngcontent-%COMP%]{width:100%}@media(max-width:600px){.payment-container[_ngcontent-%COMP%]{padding:16px;gap:16px}.title[_ngcontent-%COMP%]{font-size:1.25rem;text-align:center}.totals-summary[_ngcontent-%COMP%]{padding:16px}.total-row[_ngcontent-%COMP%]{font-size:1rem}.total-row.main[_ngcontent-%COMP%]{font-size:1.5rem}.currency-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:36px;font-size:.9rem}.amount-input[_ngcontent-%COMP%]{font-size:1.5rem;padding:10px}.methods-grid[_ngcontent-%COMP%]{gap:8px}.method-btn[_ngcontent-%COMP%]{height:70px}.method-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.change-display[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:4px}.change-display[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:baseline}.change-label[_ngcontent-%COMP%]{font-size:1rem}.change-value[_ngcontent-%COMP%]{font-size:1.5rem}.actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.btn-confirm[_ngcontent-%COMP%], .btn-cancel[_ngcontent-%COMP%]{width:100%;height:48px}}"]})}return r})();var zt=(()=>{class r{dialogRef;data;notes="";constructor(e,n){this.dialogRef=e,this.data=n,this.notes=n.notes||""}onCancel(){this.dialogRef.close()}onSave(){this.dialogRef.close(this.notes)}static \u0275fac=function(n){return new(n||r)(M(K),M(H))};static \u0275cmp=V({type:r,selectors:[["app-ticket-notes-dialog"]],decls:14,vars:1,consts:[["mat-dialog-title",""],["appearance","outline",1,"full-width"],["matInput","","rows","6","placeholder","Ej: Entregar en el estacionamiento, Cliente frecuente, etc.",3,"ngModelChange","ngModel"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(i(0,"h2",0)(1,"mat-icon"),c(2,"note_add"),o(),c(3," Notas al Ticket "),o(),i(4,"mat-dialog-content")(5,"mat-form-field",1)(6,"mat-label"),c(7,"Escriba aqu\xED sus observaciones..."),o(),i(8,"textarea",2),w("ngModelChange",function(_){return P(t.notes,_)||(t.notes=_),_}),o()()(),i(9,"mat-dialog-actions",3)(10,"button",4),g("click",function(){return t.onCancel()}),c(11,"CANCELAR"),o(),i(12,"button",5),g("click",function(){return t.onSave()}),c(13,"GUARDAR NOTA"),o()()),n&2&&(l(8),S("ngModel",t.notes))},dependencies:[A,X,G,q,U,N,pe,we,me,B,j,le,ce,re,de,se,L,R],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-top:10px}h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}textarea[_ngcontent-%COMP%]{font-size:16px}"]})}return r})();var Yn=["barcodeInput"];function Jn(r,u){if(r&1&&(i(0,"mat-option",22),c(1),o()),r&2){let e=u.$implicit;m("value",e),l(),oe(" ",e.name," (",e.code,") ")}}function Zn(r,u){if(r&1){let e=b();i(0,"button",23),g("click",function(){d(e);let t=s();return p(t.clearSearch())}),i(1,"mat-icon"),c(2,"close"),o()()}}function ei(r,u){if(r&1&&(i(0,"div",31)(1,"mat-icon",32),c(2,"warning"),o(),c(3),o()),r&2){let e=s(2);l(3),O(" Producto simple (",e.selectedProduct.typeproduct,"). Verifique condiciones. ")}}function ti(r,u){if(r&1&&(i(0,"div",24)(1,"div",25),c(2),o(),i(3,"div",26)(4,"div",27)(5,"span",28),c(6,"Precio (Bs)"),o(),i(7,"span",29),c(8),x(9,"currency"),o()(),i(10,"div",27)(11,"span",28),c(12,"Precio ($)"),o(),i(13,"span",29),c(14),x(15,"currency"),o()(),i(16,"div",27)(17,"span",28),c(18,"Stock Actual"),o(),i(19,"span",29),c(20),x(21,"number"),o()()(),f(22,ei,4,1,"div",30),o()),r&2){let e=s();l(2),C(e.selectedProduct.name),l(6),C(k(9,8,e.selectedProduct.pricesell*e.exchangeRate,"VES","Bs. ","1.2-2")),l(6),C(k(15,13,e.selectedProduct.pricesell,"USD","$ ","1.2-2")),l(5),Ae("color",e.selectedProduct.stock<=0?"red":"inherit"),l(),oe(" ",Q(21,18,e.selectedProduct.stock,e.settingsService.getDecimalFormat("quantity"))," ",e.getUnitName(e.selectedProduct.codeunit)," "),l(2),m("ngIf",e.selectedProduct.typeproduct!=="P")}}function ni(r,u){if(r&1&&(i(0,"div",41)(1,"span",42),c(2),o(),i(3,"span",43),c(4),x(5,"number"),o()()),r&2){let e=s(2);l(2),O("Cantidad a Vender (",e.getUnitName(e.selectedProduct.codeunit),"):"),l(2),O("",Q(5,2,e.calculatedQuantity,e.settingsService.getDecimalFormat("quantity"))," ")}}function ii(r,u){if(r&1){let e=b();i(0,"div",33)(1,"div",34)(2,"button",35),g("click",function(){d(e);let t=s();return p(t.setCurrency("Bs"))}),c(3,"Bol\xEDvares (Bs)"),o(),i(4,"button",35),g("click",function(){d(e);let t=s();return p(t.setCurrency("USD"))}),c(5,"D\xF3lares ($)"),o()(),i(6,"div",36)(7,"mat-form-field",37)(8,"mat-label"),c(9),o(),i(10,"input",38),w("ngModelChange",function(t){d(e);let a=s();return P(a.amountToBuy,t)||(a.amountToBuy=t),p(t)}),g("keyup.enter",function(){d(e);let t=s();return p(t.calculate())}),o()(),i(11,"button",39),g("click",function(){d(e);let t=s();return p(t.calculate())}),i(12,"mat-icon"),c(13,"calculate"),o(),c(14," CALCULAR "),o()(),f(15,ni,6,5,"div",40),o()}if(r&2){let e=s();l(2),D("active",e.currencyMode==="Bs"),l(2),D("active",e.currencyMode==="USD"),l(5),O("Monto a Comprar (",e.currencyMode,")"),l(),S("ngModel",e.amountToBuy),l(),m("disabled",!e.amountToBuy||e.amountToBuy<=0),l(4),m("ngIf",e.calculatedQuantity>0)}}var jt=(()=>{class r{dialogRef;data;searchControl=new ct("");barcode="";currencyMode="Bs";amountToBuy=0;calculatedQuantity=0;filteredProducts=[];selectedProduct=null;exchangeRate=1;barcodeInput;productService=J(We);snackBar=J(Se);settingsService=J(te);unitService=J(Bt);unitsMap=new Map;constructor(e,n){this.dialogRef=e,this.data=n,this.exchangeRate=n.exchangeRate||1}ngOnInit(){this.unitService.getAll().subscribe(e=>{e.forEach(n=>this.unitsMap.set(n.code,n.name))}),this.setupAutocomplete(),setTimeout(()=>this.focusBarcode(),500)}getUnitName(e){return this.unitsMap.get(e)||e}setupAutocomplete(){this.searchControl.valueChanges.pipe(Ve(300),Ke(),He(e=>typeof e=="string"&&e.length>=2?this.productService.getAll(1,10,{search:e,marketable:!0,iscom:!0,isscale:!0,incatalog:!0}):Ge({data:[]}))).subscribe(e=>{this.filteredProducts=e.data})}displayProduct(e){return e?e.name:""}onProductSelected(e){let n=e.option.value;this.selectProductInternal(n)}onBarcodeEnter(e){let n=e.target.value?.trim();if(!n){this.barcode="";return}this.productService.getAll(1,1,{search:n,marketable:!0,iscom:!0,isscale:!0,incatalog:!0}).subscribe(t=>{if(t.data&&t.data.length>0){let a=t.data.find(_=>_.code===n||_.reference===n)||t.data[0];a.code===n||a.reference===n?(this.selectProductInternal(a),this.barcode="",this.searchControl.setValue(a,{emitEvent:!1})):(this.snackBar.open("Producto no encontrado (coincidencia exacta)","Cerrar",{duration:2e3}),this.barcode="")}else this.snackBar.open("C\xF3digo no encontrado","Cerrar",{duration:2e3}),this.barcode=""})}selectProductInternal(e){this.selectedProduct=Qe({},e),this.selectedProduct.stock===void 0&&this.selectedProduct.stock_current!==void 0&&(this.selectedProduct.stock=this.selectedProduct.stock_current),this.calculatedQuantity=0,this.amountToBuy=0}clearSearch(){this.searchControl.setValue(""),this.onClear()}onClear(){this.selectedProduct=null,this.calculatedQuantity=0,this.amountToBuy=0,this.searchControl.setValue(""),this.barcode="",this.focusBarcode()}focusBarcode(){this.barcodeInput&&this.barcodeInput.nativeElement.focus()}setCurrency(e){this.currencyMode=e,this.calculate()}calculate(){if(!this.selectedProduct||!this.amountToBuy||this.amountToBuy<=0){this.calculatedQuantity=0;return}let e=this.selectedProduct.pricesell;if(e<=0){this.snackBar.open("El producto no tiene precio v\xE1lido.","Cerrar",{duration:3e3});return}if(this.currencyMode==="Bs"){let n=e*this.exchangeRate;this.calculatedQuantity=this.amountToBuy/n}else this.calculatedQuantity=this.amountToBuy/e}onSelect(){if(!this.selectedProduct||this.calculatedQuantity<=0)return;let e=!!(this.selectedProduct.servicio&&this.selectedProduct.servicio!=="0"&&this.selectedProduct.servicio!==!1),n=this.selectedProduct.typeproduct==="CO",t=this.selectedProduct.typeproduct==="KI";!e&&!n&&!t&&this.selectedProduct.stock<this.calculatedQuantity&&!window.confirm(`Stock insuficiente (${this.selectedProduct.stock}). \xBFContinuar con stock negativo?`)||this.dialogRef.close({product:this.selectedProduct,quantity:this.calculatedQuantity})}onClose(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||r)(M(K),M(H))};static \u0275cmp=V({type:r,selectors:[["app-sales-calculator-dialog"]],viewQuery:function(n,t){if(n&1&&Me(Yn,5),n&2){let a;fe(a=xe())&&(t.barcodeInput=a.first)}},decls:36,vars:9,consts:[["auto","matAutocomplete"],["barcodeInput",""],[1,"dialog-container"],[1,"dialog-header"],["mat-icon-button","",3,"click"],[1,"dialog-content"],[1,"search-section"],["appearance","outline",1,"full-width"],["type","text","matInput","",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],[1,"barcode-container"],[1,"barcode-icon"],["type","text","placeholder","Escanea...","autocomplete","off",1,"barcode-input",3,"ngModelChange","keyup.enter","ngModel"],["class","product-info-card",4,"ngIf"],["class","calculation-section",4,"ngIf"],[1,"dialog-actions"],["mat-stroked-button","","color","warn",3,"click"],[1,"spacer"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"value"],["mat-icon-button","","matSuffix","",3,"click"],[1,"product-info-card"],[1,"product-name"],[1,"info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],["style","color: orange; font-weight: 500; font-size: 0.9rem;",4,"ngIf"],[2,"color","orange","font-weight","500","font-size","0.9rem"],[2,"font-size","16px","height","16px","width","16px","vertical-align","text-bottom"],[1,"calculation-section"],[1,"currency-toggle"],[3,"click"],[1,"input-row"],["appearance","outline",2,"flex","1"],["matInput","","appMoneyInput","","decimalType","price","placeholder","0.00",3,"ngModelChange","keyup.enter","ngModel"],["mat-raised-button","","color","accent",2,"height","56px",3,"click","disabled"],["class","calculated-result",4,"ngIf"],[1,"calculated-result"],[1,"result-label"],[1,"result-value"]],template:function(n,t){if(n&1){let a=b();i(0,"div",2)(1,"div",3)(2,"h2"),c(3,"Calculadora de Venta R\xE1pida"),o(),i(4,"button",4),g("click",function(){return d(a),p(t.onClose())}),i(5,"mat-icon"),c(6,"close"),o()()(),i(7,"div",5)(8,"div",6)(9,"mat-form-field",7)(10,"mat-label"),c(11,"Buscar Producto (Nombre o C\xF3digo)"),o(),T(12,"input",8),i(13,"mat-autocomplete",9,0),g("optionSelected",function(v){return d(a),p(t.onProductSelected(v))}),f(15,Jn,2,3,"mat-option",10),o(),f(16,Zn,3,0,"button",11),o(),i(17,"div",12)(18,"mat-icon",13),c(19,"qr_code_scanner"),o(),i(20,"input",14,1),w("ngModelChange",function(v){return d(a),P(t.barcode,v)||(t.barcode=v),p(v)}),g("keyup.enter",function(v){return d(a),p(t.onBarcodeEnter(v))}),o()()(),f(22,ti,23,21,"div",15)(23,ii,16,8,"div",16),o(),i(24,"div",17)(25,"button",18),g("click",function(){return d(a),p(t.onClear())}),i(26,"mat-icon"),c(27,"refresh"),o(),c(28," LIMPIAR "),o(),T(29,"div",19),i(30,"button",20),g("click",function(){return d(a),p(t.onClose())}),c(31,"CERRAR"),o(),i(32,"button",21),g("click",function(){return d(a),p(t.onSelect())}),i(33,"mat-icon"),c(34,"check"),o(),c(35," SELECCIONAR "),o()()()}if(n&2){let a=he(14);l(12),m("formControl",t.searchControl)("matAutocomplete",a),l(),m("displayWith",t.displayProduct),l(2),m("ngForOf",t.filteredProducts),l(),m("ngIf",t.searchControl.value),l(4),S("ngModel",t.barcode),l(2),m("ngIf",t.selectedProduct),l(),m("ngIf",t.selectedProduct),l(9),m("disabled",!t.selectedProduct||t.calculatedQuantity<=0)}},dependencies:[A,$,z,X,G,q,U,st,lt,N,le,ce,re,Fe,de,se,B,j,ee,L,R,At,Tt,Be,Vt,Pe,ue,ae,Z],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;max-height:80vh;overflow:hidden;padding:0}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background-color:#f5f5f5;border-bottom:1px solid #e0e0e0}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:500;color:#333}.dialog-content[_ngcontent-%COMP%]{flex:1;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:20px}.search-section[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start}.search-section[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.barcode-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f0f2f5;border-radius:4px;padding:4px 12px;border:1px solid #ccc;height:52px;box-sizing:border-box;width:200px}.barcode-container[_ngcontent-%COMP%]:focus-within{border-color:#3f51b5;background:#fff}.barcode-icon[_ngcontent-%COMP%]{color:#666;margin-right:8px}.barcode-input[_ngcontent-%COMP%]{border:none;background:transparent;outline:none;width:100%;font-size:1rem;color:#333}.product-info-card[_ngcontent-%COMP%]{background-color:#e3f2fd;border:1px solid #bbdefb;border-radius:8px;padding:16px;display:flex;flex-direction:column;gap:12px}.product-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500;color:#0d47a1}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.info-label[_ngcontent-%COMP%]{font-size:.8rem;color:#546e7a;margin-bottom:4px}.info-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#263238}.calculation-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;background-color:#fafafa;padding:16px;border-radius:8px;border:1px solid #eee}.currency-toggle[_ngcontent-%COMP%]{display:flex;gap:0;border-radius:4px;overflow:hidden;border:1px solid #ccc;width:fit-content;align-self:center}.currency-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 24px;border:none;background:#fff;cursor:pointer;font-weight:500;transition:all .2s}.currency-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#3f51b5;color:#fff}.currency-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){border-right:1px solid #ccc}.input-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.calculated-result[_ngcontent-%COMP%]{margin-top:16px;text-align:center;padding:16px;background:#e8f5e9;border-radius:8px;border:1px solid #c8e6c9}.result-label[_ngcontent-%COMP%]{display:block;font-size:.9rem;color:#2e7d32;margin-bottom:8px}.result-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1b5e20}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;background-color:#f5f5f5;border-top:1px solid #e0e0e0;display:flex;justify-content:flex-end;gap:12px}.spacer[_ngcontent-%COMP%]{flex:1}"]})}return r})();function oi(r,u){if(r&1){let e=b();i(0,"input",9),w("ngModelChange",function(t){d(e);let a=s();return P(a.value,t)||(a.value=t),p(t)}),g("keyup.enter",function(){d(e);let t=s();return p(t.onConfirm())}),o()}if(r&2){let e=s();S("ngModel",e.value)}}function ai(r,u){if(r&1){let e=b();i(0,"input",10),w("ngModelChange",function(t){d(e);let a=s();return P(a.value,t)||(a.value=t),p(t)}),g("keyup.enter",function(){d(e);let t=s();return p(t.onConfirm())}),o()}if(r&2){let e=s();S("ngModel",e.value)}}function ri(r,u){r&1&&(i(0,"span",11),c(1,"%"),o())}function ci(r,u){r&1&&(i(0,"span",11),c(1,"$"),o())}function li(r,u){r&1&&(i(0,"span",11),c(1,"Bs."),o())}var qt=(()=>{class r{dialogRef;data;value=0;type="PERCENT";constructor(e,n){this.dialogRef=e,this.data=n,this.type=n.type}getIcon(){switch(this.type){case"PERCENT":return"percent";case"FIXED":return"attach_money";case"FIXED_VES":return"payments";default:return"local_offer"}}getTitle(){switch(this.type){case"PERCENT":return"Descuento Porcentual";case"FIXED":return"Descuento Fijo ($)";case"FIXED_VES":return"Descuento Fijo (Bs.)";default:return"Aplicar Descuento"}}onCancel(){this.dialogRef.close()}onConfirm(){this.isValid()&&this.dialogRef.close(this.value)}isValid(){return this.value!==null&&this.value>=0}static \u0275fac=function(n){return new(n||r)(M(K),M(H))};static \u0275cmp=V({type:r,selectors:[["app-discount-dialog"]],decls:19,vars:8,consts:[["mat-dialog-title",""],[1,"input-container"],["appearance","outline",1,"full-width"],["matInput","","appMoneyInput","","decimalType","price","placeholder","0.00","cdkFocusInitial","",3,"ngModel","ngModelChange","keyup.enter",4,"ngIf"],["matInput","","appMoneyInput","","decimalType","percent","placeholder","0","cdkFocusInitial","",3,"ngModel","ngModelChange","keyup.enter",4,"ngIf"],["matSuffix","",4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["matInput","","appMoneyInput","","decimalType","price","placeholder","0.00","cdkFocusInitial","",3,"ngModelChange","keyup.enter","ngModel"],["matInput","","appMoneyInput","","decimalType","percent","placeholder","0","cdkFocusInitial","",3,"ngModelChange","keyup.enter","ngModel"],["matSuffix",""]],template:function(n,t){n&1&&(i(0,"h2",0)(1,"mat-icon"),c(2),o(),c(3),o(),i(4,"mat-dialog-content")(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),c(8,"Valor"),o(),f(9,oi,1,1,"input",3)(10,ai,1,1,"input",4)(11,ri,2,0,"span",5)(12,ci,2,0,"span",5)(13,li,2,0,"span",5),o()()(),i(14,"mat-dialog-actions",6)(15,"button",7),g("click",function(){return t.onCancel()}),c(16,"CANCELAR"),o(),i(17,"button",8),g("click",function(){return t.onConfirm()}),c(18,"APLICAR"),o()()),n&2&&(l(2),C(t.getIcon()),l(),O(" ",t.getTitle()," "),l(6),m("ngIf",t.type!=="PERCENT"),l(),m("ngIf",t.type==="PERCENT"),l(),m("ngIf",t.type==="PERCENT"),l(),m("ngIf",t.type==="FIXED"),l(),m("ngIf",t.type==="FIXED_VES"),l(4),m("disabled",!t.isValid()))},dependencies:[A,z,X,G,q,U,N,pe,we,me,B,j,le,ce,re,Fe,de,se,L,R,ue],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-top:10px}h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:#3875d5}.input-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}input[_ngcontent-%COMP%]{font-size:1.5rem;text-align:center}"]})}return r})();var si=["barcodeInput"];function di(r,u){if(r&1){let e=b();i(0,"button",16),g("click",function(t){d(e);let a=s().index,_=s(2);return p(_.removeTicket(t,a))}),i(1,"mat-icon",17),c(2,"close"),o()()}}function pi(r,u){if(r&1){let e=b();i(0,"div",13),g("click",function(){let t=d(e).index,a=s(2);return p(a.selectTicket(t))}),i(1,"mat-icon"),c(2,"receipt"),o(),i(3,"span",14),c(4),o(),f(5,di,3,0,"button",15),o()}if(r&2){let e=u.$implicit,n=u.index,t=s(2);D("active",n===t.activeTicketIndex),l(4),O(" ",e.selectedCustomer?e.selectedCustomer.name:"Ticket "+(n+1)," "),l(),m("ngIf",t.tickets.length>1)}}function mi(r,u){if(r&1){let e=b();i(0,"button",18),g("click",function(){d(e);let t=s(2);return p(t.addTicket())}),i(1,"mat-icon"),c(2,"add"),o()()}}function ui(r,u){if(r&1&&(i(0,"div",10),f(1,pi,6,4,"div",11)(2,mi,3,0,"button",12),o()),r&2){let e=s();l(),m("ngForOf",e.tickets),l(),m("ngIf",e.tickets.length<10)}}function gi(r,u){if(r&1&&(i(0,"div",34)(1,"mat-icon"),c(2,"warehouse"),o(),i(3,"span",21),c(4),o(),i(5,"mat-icon",35),c(6,"arrow_drop_down"),o()()),r&2){let e=u.ngIf;s(2);let n=he(8);m("matMenuTriggerFor",n),l(4),C(e)}}function _i(r,u){if(r&1){let e=b();i(0,"div",19)(1,"div",20),g("click",function(){d(e);let t=s();return p(t.openCustomerSelector())}),i(2,"mat-icon"),c(3,"person"),o(),i(4,"span",21),c(5),o(),i(6,"span",22),c(7,"Cambiar"),o()(),f(8,gi,7,2,"div",23),x(9,"async"),i(10,"div",24)(11,"span",25),c(12,"Tasa:"),o(),i(13,"span",26),c(14),x(15,"number"),o()(),i(16,"div",27)(17,"mat-icon"),c(18,"qr_code_scanner"),o(),i(19,"input",28,1),w("ngModelChange",function(t){d(e);let a=s();return P(a.barcode,t)||(a.barcode=t),p(t)}),g("keyup.enter",function(t){d(e);let a=s();return p(a.onBarcodeEnter(t))}),o()(),i(21,"div",29)(22,"button",30),g("click",function(){d(e);let t=s();return p(t.catalog.refresh())}),i(23,"mat-icon"),c(24,"sync"),o()(),i(25,"button",31),g("click",function(){d(e);let t=s();return p(t.openProductSearch())}),i(26,"mat-icon"),c(27,"search"),o()(),i(28,"button",32),g("click",function(){d(e);let t=s();return p(t.openCalculator())}),i(29,"mat-icon"),c(30,"calculate"),o()(),i(31,"button",33),g("click",function(){d(e);let t=s();return p(t.openNotesDialog())}),i(32,"mat-icon"),c(33,"note_add"),o()()()()}if(r&2){let e=s();l(5),C((e.selectedCustomer==null?null:e.selectedCustomer.name)||"Cliente General"),l(3),m("ngIf",Ie(9,4,e.currentLocationName$)),l(6),O("",Q(15,6,e.exchangeRate,e.settingsService.getDecimalFormat("price"))," Bs/$"),l(5),S("ngModel",e.barcode)}}function fi(r,u){if(r&1){let e=b();i(0,"button",16),g("click",function(t){d(e);let a=s().index,_=s(2);return p(_.removeTicket(t,a))}),i(1,"mat-icon",17),c(2,"close"),o()()}}function xi(r,u){if(r&1){let e=b();i(0,"div",57),g("click",function(){let t=d(e).index,a=s(2);return p(a.selectTicket(t))}),i(1,"mat-icon"),c(2,"receipt"),o(),i(3,"span",14),c(4),o(),f(5,fi,3,0,"button",15),o()}if(r&2){let e=u.$implicit,n=u.index,t=s(2);D("active",n===t.activeTicketIndex),l(4),O(" ",e.selectedCustomer?e.selectedCustomer.name:"Ticket "+(n+1)," "),l(),m("ngIf",t.tickets.length>1)}}function hi(r,u){if(r&1){let e=b();i(0,"button",58),g("click",function(){d(e);let t=s(2);return p(t.addTicket())}),i(1,"mat-icon"),c(2,"add"),o()()}}function Ci(r,u){if(r&1&&(i(0,"div",59)(1,"mat-icon"),c(2,"warehouse"),o(),i(3,"span"),c(4),o(),i(5,"mat-icon",35),c(6,"arrow_drop_down"),o()()),r&2){let e=u.ngIf;s(2);let n=he(8);m("matMenuTriggerFor",n),l(4),C(e)}}function bi(r,u){if(r&1){let e=b();i(0,"div",36)(1,"div",37),f(2,xi,6,4,"div",38)(3,hi,3,0,"button",39),o(),i(4,"header",40)(5,"div",41)(6,"mat-icon",42),c(7,"account_circle"),o(),i(8,"span",43),c(9),o(),i(10,"button",44),g("click",function(){d(e);let t=s();return p(t.openCustomerSelector())}),c(11,"Cambiar"),o(),i(12,"div",45)(13,"mat-icon",46),c(14,"qr_code_scanner"),o(),i(15,"input",47,1),w("ngModelChange",function(t){d(e);let a=s();return P(a.barcode,t)||(a.barcode=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.onBarcodeChange(t))})("keyup.enter",function(t){d(e);let a=s();return p(a.onBarcodeEnter(t))}),o()(),f(17,Ci,7,2,"div",48),x(18,"async"),o(),i(19,"div",49)(20,"div",50)(21,"span",25),c(22,"Tasa: "),o(),i(23,"input",51),w("ngModelChange",function(t){d(e);let a=s();return P(a.exchangeRate,t)||(a.exchangeRate=t),p(t)}),g("ngModelChange",function(t){d(e);let a=s();return p(a.updateRate(t))}),o(),i(24,"span",52),c(25,"Bs/$"),o()(),i(26,"button",53),g("click",function(){d(e);let t=s();return p(t.syncAll())}),i(27,"mat-icon"),c(28,"sync"),o()(),i(29,"button",54),g("click",function(){d(e);let t=s();return p(t.openProductSearch())}),i(30,"mat-icon"),c(31,"search"),o()(),i(32,"button",55),g("click",function(){d(e);let t=s();return p(t.openCalculator())}),i(33,"mat-icon"),c(34,"calculate"),o()(),i(35,"button",56),g("click",function(){d(e);let t=s();return p(t.openNotesDialog())}),i(36,"mat-icon"),c(37,"note_add"),o()()()()()}if(r&2){let e=s();l(2),m("ngForOf",e.tickets),l(),m("ngIf",e.tickets.length<10),l(6),O(" ",e.selectedCustomer?e.selectedCustomer.name:"Cliente General"," "),l(6),S("ngModel",e.barcode),l(2),m("ngIf",Ie(18,6,e.currentLocationName$)),l(6),S("ngModel",e.exchangeRate)}}function vi(r,u){if(r&1&&(i(0,"div",81)(1,"span"),c(2,"Descuento:"),o(),i(3,"span"),c(4),x(5,"currency"),o()()),r&2){let e=s(2);l(4),O("-",k(5,1,e.globalDiscountAmount,"VES","Bs. ",e.settingsService.getDecimalFormat("total")))}}function yi(r,u){if(r&1){let e=b();i(0,"div",60)(1,"div",61)(2,"aside",62)(3,"div",63),T(4,"app-ticket-lines"),o(),i(5,"div",64)(6,"div",65)(7,"div",66)(8,"span"),c(9,"Sub Total:"),o(),i(10,"span"),c(11),x(12,"currency"),o()(),i(13,"div",66)(14,"span"),c(15,"Impuestos:"),o(),i(16,"span"),c(17),x(18,"currency"),o()(),f(19,vi,6,6,"div",67),o(),i(20,"div",68)(21,"span",25),c(22,"TOTAL A PAGAR"),o(),i(23,"div",69)(24,"span",70),c(25),x(26,"currency"),o(),i(27,"span",71),c(28),x(29,"currency"),o()()()(),i(30,"button",72),g("click",function(){d(e);let t=s();return p(t.onPay())}),i(31,"mat-icon"),c(32,"payments"),o(),i(33,"span"),c(34,"PAGAR AHORA"),o()()(),i(35,"main",73)(36,"app-catalog",74),g("productSelected",function(t){d(e);let a=s();return p(a.addToTicket(t.product,t.units))}),o(),i(37,"div",75)(38,"button",76),g("click",function(){d(e);let t=s();return p(t.requestDiscount("PERCENT"))}),i(39,"mat-icon"),c(40,"percent"),o()(),i(41,"button",77),g("click",function(){d(e);let t=s();return p(t.requestDiscount("FIXED"))}),i(42,"mat-icon"),c(43,"attach_money"),o()(),i(44,"button",78),g("click",function(){d(e);let t=s();return p(t.requestDiscount("FIXED_VES"))}),i(45,"mat-icon"),c(46,"payments"),o()(),T(47,"div",79),i(48,"button",80),g("click",function(){d(e);let t=s();return p(t.removeDiscount())}),i(49,"mat-icon"),c(50,"money_off"),o()()()()()()}if(r&2){let e=s();l(11),C(k(12,6,e.subtotal,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))),l(6),C(k(18,11,e.taxes,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))),l(2),m("ngIf",e.salesService.getGlobalDiscount()>0),l(6),C(k(26,16,e.total,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))),l(3),C(k(29,21,e.totalAlt,"USD","$ ",e.settingsService.getDecimalFormat("total"))),l(2),m("disabled",e.linesCount===0)}}function Mi(r,u){if(r&1&&(i(0,"div",101),c(1),x(2,"currency"),o()),r&2){let e=s(2);l(),O(" Descuento Global: ",k(2,1,e.globalDiscountAmount,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))," ")}}function Si(r,u){if(r&1){let e=b();i(0,"div",82)(1,"aside",83)(2,"div",84),T(3,"app-ticket-lines"),o(),i(4,"div",85)(5,"div",86)(6,"div",87),c(7),x(8,"currency"),o(),i(9,"div",87),c(10),x(11,"currency"),o(),f(12,Mi,3,6,"div",88),o(),i(13,"div",89)(14,"div",90),c(15),x(16,"currency"),o(),i(17,"div",91),c(18),x(19,"currency"),o()()(),i(20,"button",92),g("click",function(){d(e);let t=s();return p(t.onPay())}),i(21,"mat-icon"),c(22,"payments"),o(),c(23," PAGAR "),o()(),i(24,"main",93)(25,"div",94)(26,"app-catalog",74),g("productSelected",function(t){d(e);let a=s();return p(a.addToTicket(t.product,t.units))}),o()(),i(27,"div",95)(28,"div",96),g("click",function(){d(e);let t=s();return p(t.requestDiscount("PERCENT"))}),i(29,"div",97)(30,"mat-icon"),c(31,"percent"),o()(),i(32,"div",98),c(33,"Porcentual"),o()(),i(34,"div",96),g("click",function(){d(e);let t=s();return p(t.requestDiscount("FIXED"))}),i(35,"div",97)(36,"mat-icon"),c(37,"attach_money"),o()(),i(38,"div",98),c(39,"Fijo ($)"),o()(),i(40,"div",96),g("click",function(){d(e);let t=s();return p(t.requestDiscount("FIXED_VES"))}),i(41,"div",97)(42,"mat-icon"),c(43,"payments"),o()(),i(44,"div",98),c(45,"Fijo (Bs.)"),o()(),i(46,"div",99),g("click",function(){d(e);let t=s();return p(t.removeDiscount())}),i(47,"div",97)(48,"mat-icon",100),c(49,"money_off"),o()(),i(50,"div",98),c(51,"Quitar Desc."),o()()()()()}if(r&2){let e=s();l(7),O("Sub Total: ",k(8,6,e.subtotal,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))),l(3),O("Impuestos: ",k(11,11,e.taxes,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))),l(2),m("ngIf",e.salesService.getGlobalDiscount()>0),l(3),C(k(16,16,e.totalAlt,"USD","$ ",e.settingsService.getDecimalFormat("total"))),l(3),C(k(19,21,e.total,"VES","Bs. ",e.settingsService.getDecimalFormat("total"))),l(2),m("disabled",e.linesCount===0)}}function Pi(r,u){if(r&1){let e=b();i(0,"button",102),g("click",function(){let t=d(e).$implicit,a=s();return p(a.switchWarehouse(t))}),i(1,"mat-icon",103),x(2,"async"),c(3),x(4,"async"),o(),i(5,"span"),c(6),o()()}if(r&2){let e=u.$implicit,n=s();l(),m("color",e.name===Ie(2,4,n.currentLocationName$)?"primary":""),l(2),O(" ",e.name===Ie(4,6,n.currentLocationName$)?"check_circle":"warehouse"," "),l(3),oe("",e.name," (",e.type==="factory"?"F\xE1brica":"POS",")")}}var Mr=(()=>{class r{salesService;authService;dialog;settingsService;router;printService;salesHistoryService;cashService;warehouseService;appConfigService;selectedCustomer=null;total=0;subtotal=0;taxes=0;linesCount=0;currentLines=[];currentLocationName="";warehouses=[];snackBar=J(Se);productService=J(We);productKitService=J(yt);compoundProductsService=J(Ot);currencies=[];selectedCurrency=null;usdCurrency=null;exchangeRate=1;totalAlt=0;tickets=[];activeTicketIndex=0;selectedLineIndex=-1;Math=Math;get isModernLayout(){return this.settingsService.getSettings()?.pos_layout==="modern"}get globalDiscountAmount(){let e=this.salesService.getGlobalDiscount(),n=this.salesService.getGlobalDiscountType();return n==="FIXED"?e*this.exchangeRate:n==="FIXED_VES"?e:this.subtotal*e}barcode="";barcodeSubject=new $e;catalog;barcodeInput;subscription=new ve;constructor(e,n,t,a,_,v,h,y,I,F){this.salesService=e,this.authService=n,this.dialog=t,this.settingsService=a,this.router=_,this.printService=v,this.salesHistoryService=h,this.cashService=y,this.warehouseService=I,this.appConfigService=F}async ngOnInit(){await this.cashService.checkStatus()||this.promptCashOpening(),this.loadCurrencies(),this.loadWarehouses(),this.activeTicketIndex=this.salesService.getActiveTicketIndex(),this.subscription.add(this.salesService.currentLines$.subscribe(n=>{this.currentLines=n,this.linesCount=n.length,this.calculateTotals(n),this.selectedLineIndex===-1&&n.length>0?this.salesService.setSelectedLineIndex(n.length-1):n.length===0&&this.salesService.setSelectedLineIndex(-1)})),this.subscription.add(this.salesService.selectedLineIndex$.subscribe(n=>{this.selectedLineIndex=n})),this.subscription.add(this.salesService.tickets$.subscribe(n=>{this.tickets=n})),this.subscription.add(this.salesService.activeTicketIndex$.subscribe(n=>{this.activeTicketIndex=n})),this.subscription.add(this.salesService.selectedCustomer$.subscribe(n=>{this.selectedCustomer=n})),setTimeout(()=>this.focusBarcode(),500),this.subscription.add(this.barcodeSubject.pipe(Ve(400)).subscribe(n=>{n&&n.length>=3&&this.processBarcode(n)}))}handleGlobalShortcuts(e){let n=document.activeElement,t=n?.tagName==="INPUT"||n?.tagName==="TEXTAREA";e.key==="F10"||e.key==="+"&&!t?(e.preventDefault(),this.onPay()):e.key==="F2"?(e.preventDefault(),this.openProductSearch()):e.key==="F4"?(e.preventDefault(),this.openCalculator()):t||(e.key==="ArrowUp"?(e.preventDefault(),this.navigateSelection(-1)):e.key==="ArrowDown"?(e.preventDefault(),this.navigateSelection(1)):e.key==="Delete"&&(e.preventDefault(),this.removeSelectedLine()))}navigateSelection(e){if(this.currentLines.length===0)return;let n=this.selectedLineIndex+e;n<0&&(n=0),n>=this.currentLines.length&&(n=this.currentLines.length-1),this.salesService.setSelectedLineIndex(n)}removeSelectedLine(){this.selectedLineIndex>=0&&this.selectedLineIndex<this.currentLines.length&&this.salesService.removeLine(this.selectedLineIndex)}async promptCashOpening(){let{CashOpeningComponent:e}=await import("./chunk-JYECM7H3.js");this.dialog.open(e,{width:"400px",disableClose:!0}).afterClosed().subscribe(t=>{t||this.router.navigate(["/dashboard"])})}async openCustomerSelector(){let{CustomerSelectorComponent:e}=await import("./chunk-HUMS5COT.js");this.dialog.open(e,{width:"500px"}).afterClosed().subscribe(t=>{t&&(this.salesService.setSelectedCustomer(t),this.snackBar.open(`Cliente seleccionado: ${t.name}`,"Cerrar",{duration:3e3}),this.salesService.refreshAllLineDiscounts(t.id))})}loadCurrencies(e=!1){this.salesService.getCurrencies().subscribe(n=>{if(this.currencies=n,this.usdCurrency=n.find(t=>t.code==="USD")||null,this.usdCurrency){let t=this.settingsService.getSettings()?.price_decimals||2,a=Number(this.usdCurrency.exchange_rate);this.exchangeRate=parseFloat(a.toFixed(t)),this.salesService.setExchangeRate(this.exchangeRate)}e?this.salesService.getCatalog().subscribe(t=>{this.salesService.refreshCartPrices(t.products)?this.snackBar.open("Precios y tasas actualizados","Cerrar",{duration:3e3}):this.snackBar.open("Tasas de cambio actualizadas","Cerrar",{duration:2e3}),this.calculateTotals(this.currentLines)}):this.calculateTotals(this.currentLines)})}loadWarehouses(){let e=this.appConfigService.getInstallationType();this.warehouseService.getAll().subscribe(n=>{this.warehouses=n.filter(t=>t.type===e)})}switchWarehouse(e){e.id!==this.salesService.currentLocationId&&(this.salesService.setCurrentLocation(e.id,e.name),this.snackBar.open(`Cambiado a almac\xE9n: ${e.name}`,"Cerrar",{duration:2e3}))}get currentLocationName$(){return this.salesService.currentLocationName$}syncAll(){this.snackBar.open("Sincronizando datos...","Cerrar",{duration:1e3}),this.loadCurrencies(!0)}ngOnDestroy(){this.subscription.unsubscribe()}calculateTotals(e){let t=this.settingsService.getSettings()?.total_decimals||2,a=e.reduce((F,E)=>{let W=E.price;if(E.discount)if(E.discount_type==="FIXED")W=Math.max(0,E.price-E.discount);else if(E.discount_type==="FIXED_VES"){let Y=E.discount/this.exchangeRate;W=Math.max(0,E.price-Y)}else W=E.price*(1-E.discount);return F+E.units*W},0),_=e.reduce((F,E)=>{let W=E.price;if(E.discount)if(E.discount_type==="FIXED")W=Math.max(0,E.price-E.discount);else if(E.discount_type==="FIXED_VES"){let Y=E.discount/this.exchangeRate;W=Math.max(0,E.price-Y)}else W=E.price*(1-E.discount||0);return F+E.units*W*(E.tax_rate||0)},0),v=this.salesService.getGlobalDiscount(),h=this.salesService.getGlobalDiscountType(),y=a+_;if(v)if(h==="FIXED")this.totalAlt=Math.max(0,y-v);else if(h==="FIXED_VES"){let F=v/this.exchangeRate;this.totalAlt=Math.max(0,y-F)}else this.totalAlt=y*(1-v);else this.totalAlt=y;this.totalAlt=parseFloat(this.totalAlt.toFixed(t)),this.total=this.totalAlt*this.exchangeRate,this.total=parseFloat(this.total.toFixed(t));let I=1;v&&y>0&&(I=this.totalAlt/y),this.subtotal=parseFloat((a*this.exchangeRate*I).toFixed(t)),this.taxes=parseFloat((_*this.exchangeRate*I).toFixed(t))}updateRate(e){let n=parseFloat(e);if(!isNaN(n)&&n>0){let t=this.settingsService.getSettings()?.price_decimals||2;this.exchangeRate=parseFloat(n.toFixed(t)),this.salesService.setExchangeRate(this.exchangeRate),this.calculateTotals(this.currentLines)}}onPay(){if(this.linesCount===0)return;if(!this.cashService.isOpened()){this.snackBar.open("Debe abrir la caja antes de vender","Cerrar",{duration:3e3}),this.promptCashOpening();return}let e=this.salesService.getTotal();this.dialog.open(Wt,{width:"1000px",maxWidth:"95vw",height:"95vh",data:{total:e,subtotal:this.subtotal,taxes:this.taxes,exchangeRate:this.exchangeRate,totalAlt:this.totalAlt,money_id:this.cashService.getMoneyId(),customer:this.selectedCustomer}}).afterClosed().subscribe(t=>{t&&this.processPayment(t)})}async processPayment(e){try{let n=this.authService.getCurrentUser();if(!n){this.snackBar.open("Error: Sesi\xF3n no v\xE1lida","Cerrar",{duration:3e3});return}let t=[],a=e.paymentDetails||{};if(e.method==="mixed"&&e.multiparams){if(e.multiparams.payments)for(let[h,y]of Object.entries(e.multiparams.payments)){let I=Number(y);I>0&&t.push({method:h,total:I,amount_base:I,currency_id:1,exchange_rate:1,bank:a[h]?.bank,reference:a[h]?.reference,cedula:a[h]?.cedula,bank_id:a[h]?.bank_id,account_number:a[h]?.account,is_pago_movil:a[h]?.is_pago_movil})}if(e.multiparams.paymentsAlt)for(let[h,y]of Object.entries(e.multiparams.paymentsAlt)){let I=Number(y);I>0&&t.push({method:h,total:I,amount_base:I*this.exchangeRate,currency_id:2,exchange_rate:this.exchangeRate,bank:a[h]?.bank,reference:a[h]?.reference,cedula:a[h]?.cedula,bank_id:a[h]?.bank_id,account_number:a[h]?.account,is_pago_movil:a[h]?.is_pago_movil})}}else{let h=a[e.method];t.push({method:e.method,total:e.amount,amount_base:e.currency_id===1?e.amount:e.amount*e.exchange_rate,currency_id:e.currency_id,exchange_rate:e.exchange_rate,bank:h?.bank,reference:h?.reference,cedula:h?.cedula,bank_id:e.bank_id||h?.bank_id,account_number:h?.account,is_pago_movil:h?.is_pago_movil})}let _={person_id:n.id,lines:this.currentLines,payments:t,total:this.total,currency_id:1,exchange_rate:this.exchangeRate,money_id:e.money_id,customer_id:this.selectedCustomer?.id||null,cash_register_id:this.cashService.getCashRegisterId()||1,notes:this.salesService.getNotes(),location_id:this.salesService.currentLocationId||1,igtf_amount:e.igtf_amount||0,igtf_amount_alt:e.igtf_amount_alt||0,change:e.change||0},v=await Te(this.salesService.createSale(_));this.snackBar.open(`Venta realizada con \xE9xito. Ticket #${v.ticketNumber}`,"Cerrar",{duration:5e3,panelClass:["success-snackbar"]}),this.catalog&&this.catalog.refresh(),v.ticketId&&this.salesHistoryService.getTicketById(v.ticketId).subscribe(async h=>{let y=await this.printService.printTicket(h);if(y.success&&y.usedThermal)this.snackBar.open("\u2705 Ticket impreso correctamente","OK",{duration:2e3});else{let I=y.error||"Error desconocido";this.snackBar.open(`\u274C Error al imprimir: ${I}`,"Cerrar",{duration:8e3,panelClass:["error-snackbar"]}),console.error("Error de impresi\xF3n:",y)}}),this.salesService.clearTicket(),this.selectedCustomer=null}catch(n){console.error("Error al procesar pago:",n),this.snackBar.open("Error al procesar venta: "+(n.error?.error||n.message),"Cerrar",{duration:5e3})}}openProductSearch(){this.dialog.open(Et,{width:"800px",height:"600px",panelClass:"custom-dialog-container"}).afterClosed().subscribe(n=>{n&&n.product&&this.addToTicket(n.product,n.units)})}openCalculator(){this.dialog.open(jt,{width:"600px",data:{exchangeRate:this.exchangeRate},panelClass:"custom-dialog-container"}).afterClosed().subscribe(n=>{n&&n.product&&n.quantity>0&&this.addToTicket(n.product,n.quantity)})}openNotesDialog(){this.dialog.open(zt,{width:"500px",data:{notes:this.salesService.getNotes()}}).afterClosed().subscribe(n=>{n!==void 0&&this.salesService.setNotes(n)})}onBarcodeEnter(e){let n=e.target.value?.trim();if(!n){this.barcode="";return}this.processBarcode(n)}onBarcodeChange(e){let n=e?.trim();n&&this.barcodeSubject.next(n)}processBarcode(e){this.productService.getAll(1,1,{search:e}).subscribe(n=>{if(n.data&&n.data.length>0){let t=n.data.find(a=>a.code===e||a.reference===e)||n.data[0];t.code===e||t.reference===e?(this.addToTicket(t),this.barcode="",this.snackBar.open(`Agregado: ${t.name}`,"OK",{duration:1500})):(this.barcode="",this.snackBar.open("Producto no encontrado por c\xF3digo exacto","Cerrar",{duration:2e3}))}else this.barcode="",this.snackBar.open("C\xF3digo no encontrado","Cerrar",{duration:2e3})})}focusBarcode(){this.barcodeInput&&this.barcodeInput.nativeElement.focus()}onDocumentClick(e){let n=e.target,t=n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable,a=n.closest("button");!t&&!a&&this.focusBarcode()}async addToTicket(e,n){let t=n||1,a=e.stock!==void 0?e.stock:e.stock_current||0,_=!!(e.servicio&&e.servicio!=="0"&&e.servicio!==!1),v=e.typeproduct==="CO",h=e.typeproduct==="KI";if(console.log("Validating Add:",e.name,"isService:",_,"isCompound:",v,"isKit:",h,"stock:",a),!_&&!v&&!h&&t>a){this.snackBar.open(`Stock insuficiente para ${e.name}. Disponible: ${a}`,"Cerrar",{duration:3e3});return}if(v)try{let y=await Te(this.compoundProductsService.validateStock(e.id,t));if(!y.hasStock){this.snackBar.open(`Faltan insumos para preparar "${e.name}": ${y.message}`,"Cerrar",{duration:5e3});return}}catch(y){console.error("Error validating compound stock:",y)}if(h)try{if(!(await Te(this.productKitService.validateStock(e.id,t))).hasStock){this.snackBar.open(`Stock insuficiente de componentes para el combo "${e.name}".`,"Cerrar",{duration:5e3});return}}catch(y){console.error("Error validating kit stock:",y)}if(h){this.productKitService.getKitComponents(e.id).subscribe(y=>{if(!y||y.length===0){this.snackBar.open("Este kit no tiene componentes configurados.","Cerrar",{duration:3e3});return}y.some(F=>F.group_id)?this.dialog.open(Nt,{width:"500px",data:{productName:e.name,components:y}}).afterClosed().subscribe(E=>{E&&this.executeAdd(e,n||1,E)}):this.executeAdd(e,n||1,y)});return}e.isscale&&n===void 0?this.dialog.open(kt,{width:"400px",data:{product:e}}).afterClosed().subscribe(I=>{if(I){if(!_&&!v&&!h&&I>a){this.snackBar.open(`Cantidad pedida (${I}) excede el stock (${a})`,"Cerrar",{duration:3e3});return}this.executeAdd(e,I)}}):this.executeAdd(e,t)}executeAdd(e,n,t){let a=this.selectedCustomer?.id;this.salesService.addLineWithDiscount(e,n,a,t)}requestDiscount(e){this.dialog.open(qt,{width:"350px",data:{type:e}}).afterClosed().subscribe(t=>{t!=null&&this.applyDiscount(e,t)})}applyDiscount(e,n){this.selectedLineIndex>=0&&this.selectedLineIndex<this.currentLines.length?e==="PERCENT"?this.salesService.updateLineDiscount(this.selectedLineIndex,n,"PERCENT"):e==="FIXED"?this.salesService.updateLineDiscount(this.selectedLineIndex,n,"FIXED"):e==="FIXED_VES"&&this.salesService.updateLineDiscount(this.selectedLineIndex,n,"FIXED_VES"):e==="PERCENT"?(this.salesService.setGlobalDiscount(n,"PERCENT"),this.snackBar.open(`Descuento global del ${n}% aplicado`,"Cerrar",{duration:2e3})):e==="FIXED"?(this.salesService.setGlobalDiscount(n,"FIXED"),this.snackBar.open(`Descuento global de $${n} aplicado`,"Cerrar",{duration:2e3})):e==="FIXED_VES"&&(this.salesService.setGlobalDiscount(n,"FIXED_VES"),this.snackBar.open(`Descuento global de Bs. ${n} aplicado`,"Cerrar",{duration:2e3}))}removeDiscount(){if(this.selectedLineIndex>=0&&this.selectedLineIndex<this.currentLines.length){let e=this.currentLines[this.selectedLineIndex];this.salesService.updateLineDiscount(this.selectedLineIndex,0,"PERCENT"),this.snackBar.open("Descuento de l\xEDnea eliminado","Cerrar",{duration:2e3})}else this.salesService.setGlobalDiscount(0,"PERCENT"),this.snackBar.open("Descuento global eliminado","Cerrar",{duration:2e3})}addTicket(){this.salesService.addTicket()}selectTicket(e){this.salesService.setActiveTicket(e)}removeTicket(e,n){e.stopPropagation(),this.salesService.removeTicket(n)}static \u0275fac=function(n){return new(n||r)(M(ke),M(rt),M(Ne),M(te),M(at),M(Dt),M(It),M(wt),M(vt),M(mt))};static \u0275cmp=V({type:r,selectors:[["app-sales"]],viewQuery:function(n,t){if(n&1&&Me(qe,5)(si,5),n&2){let a;fe(a=xe())&&(t.catalog=a.first),fe(a=xe())&&(t.barcodeInput=a.first)}},hostBindings:function(n,t){n&1&&g("keydown",function(_){return t.handleGlobalShortcuts(_)},Je)("click",function(_){return t.onDocumentClick(_)},Ze)},decls:10,vars:8,consts:[["locationMenu","matMenu"],["barcodeInput",""],[1,"sales-container"],["class","modern-ticket-tabs",4,"ngIf"],["class","sales-top-bar",4,"ngIf"],["class","classic-header",4,"ngIf"],[1,"sales-content-wrapper"],["class","modern-main-content",4,"ngIf"],["class","sales-content classic",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],[1,"modern-ticket-tabs"],["class","ticket-tab modern",3,"active","click",4,"ngFor","ngForOf"],["mat-icon-button","","class","add-tab modern","matTooltip","Nuevo Ticket (+)",3,"click",4,"ngIf"],[1,"ticket-tab","modern",3,"click"],[1,"tab-label"],["mat-icon-button","","class","close-tab",3,"click",4,"ngIf"],["mat-icon-button","",1,"close-tab",3,"click"],["ripple","false"],["mat-icon-button","","matTooltip","Nuevo Ticket (+)",1,"add-tab","modern",3,"click"],[1,"sales-top-bar"],[1,"customer-pill",3,"click"],[1,"name"],[1,"action"],["class","location-pill clickable",3,"matMenuTriggerFor",4,"ngIf"],[1,"exchange-pill"],[1,"label"],[1,"value"],[1,"search-main"],["type","text","placeholder","Escanear C\xF3digo...",3,"ngModelChange","keyup.enter","ngModel"],[1,"utility-actions"],["mat-icon-button","","matTooltip","Refrescar cat\xE1logo",3,"click"],["mat-icon-button","","matTooltip","B\xFAsqueda avanzada",3,"click"],["mat-icon-button","","matTooltip","Calculadora",3,"click"],["mat-icon-button","","matTooltip","Notas de venta",3,"click"],[1,"location-pill","clickable",3,"matMenuTriggerFor"],[1,"arrow"],[1,"classic-header"],[1,"ticket-tabs"],["class","ticket-tab",3,"active","click",4,"ngFor","ngForOf"],["mat-icon-button","","class","add-tab","matTooltip","Nuevo Ticket (+)",3,"click",4,"ngIf"],[1,"top-bar"],[1,"customer-info"],["color","primary"],[2,"font-weight","500"],["mat-button","","color","primary",2,"margin-right","12px",3,"click"],[1,"barcode-container"],[1,"barcode-icon"],["type","text","placeholder","Escanear C\xF3digo...",1,"barcode-input",3,"ngModelChange","keyup.enter","ngModel"],["class","location-info-classic clickable",3,"matMenuTriggerFor",4,"ngIf"],[1,"sale-actions"],[1,"rate-display"],["type","text","appMoneyInput","","decimalType","price",1,"rate-input",3,"ngModelChange","ngModel"],[1,"currency"],["mat-icon-button","","matTooltip","Sincronizar precios y tasa",3,"click"],["mat-icon-button","","matTooltip","Buscador de productos (F2)",3,"click"],["mat-icon-button","","matTooltip","Calculadora (F4)",3,"click"],["mat-icon-button","","matTooltip","Notas al ticket",3,"click"],[1,"ticket-tab",3,"click"],["mat-icon-button","","matTooltip","Nuevo Ticket (+)",1,"add-tab",3,"click"],[1,"location-info-classic","clickable",3,"matMenuTriggerFor"],[1,"modern-main-content"],[1,"main-split"],[1,"ticket-sidebar"],[1,"ticket-scroll"],[1,"modern-totals"],[1,"subtotals"],[1,"total-row"],["class","total-row discount",4,"ngIf"],[1,"final-total"],[1,"values"],[1,"bs"],[1,"usd"],[1,"btn-pay","modern",3,"click","disabled"],[1,"catalog-area","modern"],[3,"productSelected"],[1,"quick-discounts"],["matTooltip","Descuento %",1,"fab-discount",3,"click"],["matTooltip","Descuento $",1,"fab-discount",3,"click"],["matTooltip","Descuento Bs",1,"fab-discount",3,"click"],[1,"divider"],["matTooltip","Quitar Descuento",1,"fab-discount","clear",3,"click"],[1,"total-row","discount"],[1,"sales-content","classic"],[1,"left-panel"],[2,"flex","1","overflow","hidden"],[1,"totals-panel"],[1,"total-info"],[1,"total-label"],["class","total-label discount-label",4,"ngIf"],[1,"dual-totals"],[1,"total-alt"],[1,"total-value"],[1,"btn-pay",3,"click","disabled"],[1,"right-panel"],[1,"catalog-area"],[1,"discount-container"],["matRipple","",1,"discount-card",3,"click"],[1,"card-icon"],[1,"card-label"],["matRipple","",1,"discount-card","remove-discount",3,"click"],["color","warn"],[1,"total-label","discount-label"],["mat-menu-item","",3,"click"],[3,"color"]],template:function(n,t){n&1&&(i(0,"div",2),f(1,ui,3,2,"div",3)(2,_i,34,9,"div",4)(3,bi,38,8,"div",5),i(4,"div",6),f(5,yi,51,26,"div",7)(6,Si,52,26,"div",8),o(),i(7,"mat-menu",null,0),f(9,Pi,7,8,"button",9),o()()),n&2&&(D("modern-layout",t.isModernLayout),l(),m("ngIf",t.isModernLayout),l(),m("ngIf",t.isModernLayout),l(),m("ngIf",!t.isModernLayout),l(2),m("ngIf",t.isModernLayout),l(),m("ngIf",!t.isModernLayout),l(3),m("ngForOf",t.warehouses))},dependencies:[A,$,z,X,G,q,U,L,R,B,j,ee,Le,Re,N,Pe,Rt,qe,ue,ft,gt,ut,_t,ot,ae,Z],styles:[".ticket-tabs[_ngcontent-%COMP%]{display:flex;gap:6px;padding:2px 12px;overflow-x:auto;scrollbar-width:thin;scrollbar-color:#cbd5e1 transparent;align-items:flex-end;flex-wrap:nowrap;-webkit-mask-image:linear-gradient(to right,black 95%,transparent 100%);mask-image:linear-gradient(to right,black 95%,transparent 100%)}.ticket-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.ticket-tabs[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.ticket-tab[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 16px;background:#d1d5db;border-radius:12px 12px 0 0;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);min-width:140px;max-width:220px;border-bottom:2px solid transparent;-webkit-user-select:none;user-select:none;position:relative;color:#4b5563}.ticket-tab.active[_ngcontent-%COMP%]{background:#fff;color:#3b82f6;font-weight:700;box-shadow:0 -4px 12px #00000014;transform:translateY(-2px)}.ticket-tab[_ngcontent-%COMP%]   .tab-label[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:.88rem;letter-spacing:-.01em}.ticket-tab[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;opacity:.8}.close-tab[_ngcontent-%COMP%]{width:24px!important;height:24px!important;padding:0!important;display:flex!important;align-items:center!important;justify-content:center!important;margin-right:-6px;opacity:.3;transition:all .2s;border-radius:50%!important}.close-tab[_ngcontent-%COMP%]:hover{opacity:1!important;background:#ef44441a!important;color:#ef4444!important}.close-tab[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px!important;width:16px!important;height:16px!important}.add-tab[_ngcontent-%COMP%]{background:#fff;box-shadow:0 2px 4px #0000000d;border-radius:50%!important;margin-left:8px;width:36px!important;height:36px!important;display:flex!important;align-items:center!important;justify-content:center!important;color:#6366f1;margin-bottom:4px}.add-tab[_ngcontent-%COMP%]:hover{background:#6366f1!important;color:#fff!important;transform:rotate(90deg)}.sales-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;box-sizing:border-box;gap:12px;padding:12px;background-color:#f0f2f5}.modern-layout[_ngcontent-%COMP%]{background:#f8fafc!important;padding:16px!important;height:100vh!important;overflow:hidden}.modern-layout[_ngcontent-%COMP%]   .sales-top-bar[_ngcontent-%COMP%]{height:60px;display:flex;align-items:center;gap:16px;background:#fff;border-radius:16px;padding:0 20px;margin-bottom:16px;box-shadow:0 1px 3px #0000001a}.modern-layout[_ngcontent-%COMP%]   .customer-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 16px;background:#f1f5f9;border-radius:12px;cursor:pointer;transition:all .2s}.modern-layout[_ngcontent-%COMP%]   .customer-pill[_ngcontent-%COMP%]:hover{background:#e2e8f0}.modern-layout[_ngcontent-%COMP%]   .customer-pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#6366f1}.modern-layout[_ngcontent-%COMP%]   .customer-pill[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700;color:#1e293b;font-size:14px}.modern-layout[_ngcontent-%COMP%]   .customer-pill[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{font-size:11px;text-transform:uppercase;color:#6366f1;font-weight:800;border-left:1px solid #cbd5e1;padding-left:12px;margin-left:4px}.modern-layout[_ngcontent-%COMP%]   .exchange-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px}.modern-layout[_ngcontent-%COMP%]   .exchange-pill[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#64748b;font-weight:600}.modern-layout[_ngcontent-%COMP%]   .exchange-pill[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#6366f1;font-weight:800}.modern-layout[_ngcontent-%COMP%]   .location-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:12px;color:#166534}.modern-layout[_ngcontent-%COMP%]   .location-pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#22c55e}.modern-layout[_ngcontent-%COMP%]   .location-pill[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700;font-size:13px}.modern-layout[_ngcontent-%COMP%]   .location-pill.clickable[_ngcontent-%COMP%]:hover{background:#dcfce7!important;border-color:#86efac!important;transform:translateY(-1px);cursor:pointer}.location-pill[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%], .location-info-classic[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{font-size:18px!important;width:18px!important;height:18px!important;margin-left:2px;opacity:.5}.location-info-classic.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s;padding:4px 8px;border-radius:8px;display:flex;align-items:center}.location-info-classic.clickable[_ngcontent-%COMP%]:hover{background:#0000000d}.modern-layout[_ngcontent-%COMP%]   .search-main[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:12px;background:#f8fafc;border-radius:12px;padding:0 16px;height:44px;border:1px solid #e2e8f0}.modern-layout[_ngcontent-%COMP%]   .search-main[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#94a3b8}.modern-layout[_ngcontent-%COMP%]   .search-main[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;background:transparent;outline:none;width:100%;font-weight:500;color:#1e293b}.modern-layout[_ngcontent-%COMP%]   .utility-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.modern-layout[_ngcontent-%COMP%]   .utility-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#64748b}.modern-layout[_ngcontent-%COMP%]   .utility-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#6366f1;background:#f1f5f9}.modern-ticket-tabs[_ngcontent-%COMP%]{display:flex;gap:12px;padding:4px;margin-bottom:12px;overflow-x:auto;scrollbar-width:thin;scrollbar-color:#6366f1 transparent;flex-wrap:nowrap;-webkit-mask-image:linear-gradient(to right,black 95%,transparent 100%);mask-image:linear-gradient(to right,black 95%,transparent 100%);align-items:center}.modern-ticket-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.modern-ticket-tabs[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#e2e8f0;border-radius:4px}.ticket-tab.modern[_ngcontent-%COMP%]{background:#fff;border-radius:16px;border:1px solid #e2e8f0;min-width:140px;padding:8px 16px;box-shadow:0 4px 6px -1px #00000008;transition:all .3s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;gap:10px}.ticket-tab.modern[_ngcontent-%COMP%]:hover{border-color:#6366f1;transform:translateY(-2px);box-shadow:0 10px 15px -3px #0000000d}.ticket-tab.modern.active[_ngcontent-%COMP%]{background:#6366f1;color:#fff;border-color:#6366f1;box-shadow:0 10px 15px -3px #6366f140}.ticket-tab.modern.active[_ngcontent-%COMP%]   .close-tab[_ngcontent-%COMP%]{color:#fff!important;opacity:.6!important}.ticket-tab.modern.active[_ngcontent-%COMP%]   .close-tab[_ngcontent-%COMP%]:hover{opacity:1!important;background:#fff3!important;color:#fff!important}.ticket-tab.modern.active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff}.add-tab.modern[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:16px!important;width:44px!important;height:44px!important;display:flex!important;align-items:center!important;justify-content:center!important;color:#6366f1;box-shadow:0 4px 6px -1px #00000008;transition:all .2s}.add-tab.modern[_ngcontent-%COMP%]:hover{background:#6366f1;color:#fff;border-color:#6366f1;transform:scale(1.05)}.sales-content-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0}.modern-main-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;min-height:0}.modern-layout[_ngcontent-%COMP%]   .main-split[_ngcontent-%COMP%]{display:flex;flex:1;gap:20px;min-height:0;height:auto}.modern-layout[_ngcontent-%COMP%]   .ticket-sidebar[_ngcontent-%COMP%]{width:400px;display:flex;flex-direction:column;gap:16px;height:100%;min-height:0}.modern-layout[_ngcontent-%COMP%]   .ticket-scroll[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:#fff;border-radius:20px;padding:10px;box-shadow:0 4px 6px -1px #0000000d;min-height:0}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]{background:#1e293b;color:#fff;border-radius:20px;padding:20px;display:flex;flex-direction:column;gap:12px;flex-shrink:0}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:14px;opacity:.8}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .total-row.discount[_ngcontent-%COMP%]{color:#f87171;opacity:1;font-weight:600}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .final-total[_ngcontent-%COMP%]{border-top:1px solid rgba(255,255,255,.1);padding-top:12px;display:flex;justify-content:space-between;align-items:flex-end}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .final-total[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:11px;font-weight:800;color:#94a3b8;text-transform:uppercase}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .final-total[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{text-align:right}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .final-total[_ngcontent-%COMP%]   .bs[_ngcontent-%COMP%]{display:block;font-size:28px;font-weight:900}.modern-layout[_ngcontent-%COMP%]   .modern-totals[_ngcontent-%COMP%]   .final-total[_ngcontent-%COMP%]   .usd[_ngcontent-%COMP%]{display:block;font-size:16px;color:#818cf8;font-weight:700}.modern-layout[_ngcontent-%COMP%]   .btn-pay.modern[_ngcontent-%COMP%]{height:60px;background:#10b981;color:#fff;border:none;border-radius:16px;font-size:18px;font-weight:800;display:flex;align-items:center;justify-content:center;gap:12px;cursor:pointer;box-shadow:0 8px 15px #10b9814d;transition:all .2s;margin-top:auto;width:100%}.modern-layout[_ngcontent-%COMP%]   .btn-pay.modern[_ngcontent-%COMP%]:hover{background:#059669;transform:translateY(-2px)}.modern-layout[_ngcontent-%COMP%]   .btn-pay.modern[_ngcontent-%COMP%]:disabled{background:#cbd5e1;box-shadow:none;cursor:not-allowed}.modern-layout[_ngcontent-%COMP%]   .catalog-area.modern[_ngcontent-%COMP%]{flex:1;position:relative;background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 4px 6px -1px #0000000d;height:100%}.modern-layout[_ngcontent-%COMP%]   .catalog-area.modern[_ngcontent-%COMP%]   .quick-discounts[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;display:flex;gap:8px;background:#fff;padding:10px;border-radius:50px;box-shadow:0 10px 25px #00000026;z-index:10}.modern-layout[_ngcontent-%COMP%]   .catalog-area.modern[_ngcontent-%COMP%]   .fab-discount[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;border:none;background:#f1f5f9;color:#475569;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.modern-layout[_ngcontent-%COMP%]   .catalog-area.modern[_ngcontent-%COMP%]   .fab-discount[_ngcontent-%COMP%]:hover{background:#6366f1;color:#fff;transform:translateY(-4px)}.modern-layout[_ngcontent-%COMP%]   .catalog-area.modern[_ngcontent-%COMP%]   .fab-discount.clear[_ngcontent-%COMP%]:hover{background:#ef4444}.modern-layout[_ngcontent-%COMP%]   .catalog-area.modern[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{width:1px;background:#e2e8f0;height:24px;align-self:center}.sales-content[_ngcontent-%COMP%]{display:flex;flex:1;gap:16px;overflow:hidden}.left-panel[_ngcontent-%COMP%]{flex:3.5;display:flex;flex-direction:column;gap:16px;min-width:600px;min-height:0}.right-panel[_ngcontent-%COMP%]{flex:6.5;display:flex;flex-direction:column;gap:16px;min-height:0}.top-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:8px 20px;border-radius:12px;box-shadow:0 2px 8px #0000000d}.sale-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.rate-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#f8f9fa;padding:4px 12px;border-radius:20px;border:1px solid #eee;margin-right:12px}.rate-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.8rem;color:#666;font-weight:500}.rate-input[_ngcontent-%COMP%]{width:70px;border:none;background:transparent;font-weight:700;color:#3875d5;font-size:.95rem;outline:none;text-align:center}.customer-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex:1}.barcode-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f0f2f5;border-radius:8px;padding:4px 12px;border:1px solid #ddd;box-shadow:inset 0 1px 3px #0000000d;transition:all .3s ease;width:250px}.barcode-container[_ngcontent-%COMP%]:focus-within{border-color:#3875d5;background:#fff;box-shadow:0 0 0 2px #6200ee1a}.barcode-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:#666;margin-right:8px}.barcode-input[_ngcontent-%COMP%]{border:none;background:transparent;outline:none;width:100%;font-size:.9rem;color:#333;font-family:Roboto Mono,monospace}.barcode-input[_ngcontent-%COMP%]::placeholder{color:#aaa;font-style:italic}.location-info-classic[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:4px 12px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;color:#166534;margin-left:12px;font-size:13px;font-weight:600}.location-info-classic[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;color:#22c55e}.totals-panel[_ngcontent-%COMP%]{background:#2c3e50;color:#fff;padding:16px;border-radius:12px;display:flex;justify-content:space-between;align-items:center}.total-label[_ngcontent-%COMP%]{font-size:1rem;opacity:.8;margin-bottom:8px}.discount-label[_ngcontent-%COMP%]{color:#ff5252;font-weight:700;opacity:1}.dual-totals[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.total-alt[_ngcontent-%COMP%]{font-size:1.1rem;opacity:.9;font-weight:500;margin-bottom:15px}.total-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;font-family:Roboto Mono,monospace}.btn-pay[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;height:50px;font-size:1.3rem;font-weight:700;border-radius:8px;display:flex;align-items:center;justify-content:center;gap:12px;transition:all .2s;cursor:pointer;border:none;width:100%}.btn-pay[_ngcontent-%COMP%]:hover{background-color:#43a047;transform:scale(1.02)}.btn-pay[_ngcontent-%COMP%]:active{transform:scale(.98)}.customer-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.catalog-area[_ngcontent-%COMP%]{flex:1;overflow:hidden;display:flex;flex-direction:column}.catalog-area[_ngcontent-%COMP%]   app-catalog[_ngcontent-%COMP%]{flex:1;height:100%}.numpad-area[_ngcontent-%COMP%]{width:100%;align-content:baseline}.discount-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;background:#fff;padding:8px 16px;border-radius:12px;box-shadow:0 2px 8px #0000000d;margin-top:8px}.discount-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:6px}.discount-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#e0e0e0;border-radius:3px}.discount-card[_ngcontent-%COMP%]{width:65px;height:65px;background:#fff;border-radius:8px;box-shadow:0 2px 6px #00000014;padding:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;border:1px solid transparent;-webkit-user-select:none;user-select:none;position:relative;overflow:hidden}.discount-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #3875d526;border-color:#3875d5}.discount-card[_ngcontent-%COMP%]:active{transform:translateY(0)}.discount-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:#f0f4ff;color:#3875d5;display:flex;align-items:center;justify-content:center;transition:all .2s}.discount-card[_ngcontent-%COMP%]:hover   .card-icon[_ngcontent-%COMP%]{background:#3875d5;color:#fff}.discount-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.discount-card[_ngcontent-%COMP%]   .card-label[_ngcontent-%COMP%]{font-weight:600;font-size:.7rem;color:#555;transition:color .2s}.discount-card[_ngcontent-%COMP%]:hover   .card-label[_ngcontent-%COMP%]{color:#3875d5}.discount-card.remove-discount[_ngcontent-%COMP%]:hover{border-color:#f44336;box-shadow:0 6px 16px #f4433626}.discount-card.remove-discount[_ngcontent-%COMP%]:hover   .card-icon[_ngcontent-%COMP%]{background:#f44336;color:#fff}.discount-card.remove-discount[_ngcontent-%COMP%]:hover   .card-label[_ngcontent-%COMP%]{color:#f44336}.discount-card.remove-discount[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:#ffebee}@media(max-width:1200px){.sales-content[_ngcontent-%COMP%]{flex-direction:column}.left-panel[_ngcontent-%COMP%], .right-panel[_ngcontent-%COMP%]{flex:none;width:100%;height:auto}}"]})}return r})();export{Mr as SalesComponent};
